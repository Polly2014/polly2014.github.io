<!doctype html><html><head><title>ğŸ§¹ Jarvis Phase 2.5ï¼šç»™ Agent åšä¸€æ¬¡ã€Œå¤§æ‰«é™¤ã€</title><meta content="Phase 2 å®Œæˆåï¼ŒJarvis æœ‰äº†å¿ƒè·³ã€è®°å¿†å’Œæ€è€ƒèƒ½åŠ›â€”â€”ä½†ä»£ç å·²ç»å¼€å§‹å‘è‡­äº†ã€‚1909 è¡Œçš„ cli.pyã€ä¸ƒä¸ªæ— äººå¼•ç”¨çš„æ­»ä»£ç æ–‡ä»¶ã€ä¸€ä¸ªæ²¡åŠ é”çš„å…±äº«æ•°æ®ç»“æ„â€¦â€¦Phase 2.5 ä¸å†™æ–°åŠŸèƒ½ï¼Œä¸“é—¨è¿˜æŠ€æœ¯å€ºã€‚è¿™ç¯‡æ–‡ç« è®°å½•æˆ‘å¦‚ä½•æŠŠä¸€ä¸ªã€Œèƒ½è·‘å°±è¡Œã€çš„ Agent æ•´ç†æˆã€Œå¯ä»¥ç»§ç»­è¿›åŒ–ã€çš„æ¶æ„ã€‚" name=description><meta content="Polly, Blog, AI Blog, AI Assistant, Tutorials, Technology Blog, Baoli Wang" name=keywords><meta content="width=device-width,initial-scale=1" name=viewport><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content=#333 name=theme-color><meta content=article property=og:type><meta content=https://polly.wang/jarvis-agent-phase25-code-cleanup/ property=og:url><meta content="ğŸ§¹ Jarvis Phase 2.5ï¼šç»™ Agent åšä¸€æ¬¡ã€Œå¤§æ‰«é™¤ã€" property=og:title><meta content="Phase 2 å®Œæˆåï¼ŒJarvis æœ‰äº†å¿ƒè·³ã€è®°å¿†å’Œæ€è€ƒèƒ½åŠ›â€”â€”ä½†ä»£ç å·²ç»å¼€å§‹å‘è‡­äº†ã€‚1909 è¡Œçš„ cli.pyã€ä¸ƒä¸ªæ— äººå¼•ç”¨çš„æ­»ä»£ç æ–‡ä»¶ã€ä¸€ä¸ªæ²¡åŠ é”çš„å…±äº«æ•°æ®ç»“æ„â€¦â€¦Phase 2.5 ä¸å†™æ–°åŠŸèƒ½ï¼Œä¸“é—¨è¿˜æŠ€æœ¯å€ºã€‚è¿™ç¯‡æ–‡ç« è®°å½•æˆ‘å¦‚ä½•æŠŠä¸€ä¸ªã€Œèƒ½è·‘å°±è¡Œã€çš„ Agent æ•´ç†æˆã€Œå¯ä»¥ç»§ç»­è¿›åŒ–ã€çš„æ¶æ„ã€‚" property=og:description><meta content=https://polly.wang/jarvis-agent-phase25-code-cleanup/cover.jpg property=og:image><meta content="Polly Blog" property=og:site_name><meta content=zh_CN property=og:locale><meta content=summary_large_image name=twitter:card><meta content=https://polly.wang/jarvis-agent-phase25-code-cleanup/ name=twitter:url><meta content="ğŸ§¹ Jarvis Phase 2.5ï¼šç»™ Agent åšä¸€æ¬¡ã€Œå¤§æ‰«é™¤ã€" name=twitter:title><meta content="Phase 2 å®Œæˆåï¼ŒJarvis æœ‰äº†å¿ƒè·³ã€è®°å¿†å’Œæ€è€ƒèƒ½åŠ›â€”â€”ä½†ä»£ç å·²ç»å¼€å§‹å‘è‡­äº†ã€‚1909 è¡Œçš„ cli.pyã€ä¸ƒä¸ªæ— äººå¼•ç”¨çš„æ­»ä»£ç æ–‡ä»¶ã€ä¸€ä¸ªæ²¡åŠ é”çš„å…±äº«æ•°æ®ç»“æ„â€¦â€¦Phase 2.5 ä¸å†™æ–°åŠŸèƒ½ï¼Œä¸“é—¨è¿˜æŠ€æœ¯å€ºã€‚è¿™ç¯‡æ–‡ç« è®°å½•æˆ‘å¦‚ä½•æŠŠä¸€ä¸ªã€Œèƒ½è·‘å°±è¡Œã€çš„ Agent æ•´ç†æˆã€Œå¯ä»¥ç»§ç»­è¿›åŒ–ã€çš„æ¶æ„ã€‚" name=twitter:description><meta content=https://polly.wang/jarvis-agent-phase25-code-cleanup/cover.jpg name=twitter:image><meta content=2026-02-06T00:00:00 property=article:published_time><meta content=Polly property=article:author><meta content=Jarvis-Agent property=article:tag><meta content="AI Agent" property=article:tag><meta content=é‡æ„ property=article:tag><meta content=ä»£ç è´¨é‡ property=article:tag><meta content=CLI property=article:tag><meta content=Python property=article:tag><meta content=æ¨¡å—åŒ– property=article:tag><link rel="shortcut icon" href=https://polly.wang/images/polly.ico type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=icon type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=apple-touch-icon><link href=https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css rel=stylesheet><link href=https://polly.wang/css/style_new.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-8JD13N7PHS" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-8JD13N7PHS';);</script><body><div class=menu-toggle><img alt=Menu src=https://polly.wang/images/polly.png></div><div class=overlay></div><div class="pure-g container"><div class="sidebar pure-u-1 pure-u-md-1-5"><div class=title><a class=pure-menu-heading href=https://polly.wang> <img class="avatar pure-img-responsive" src=https://polly.wang/images/polly.png> </a><div class=introduction><p>Polly's Blog</div><div class=nav><ul class=nav-links><li><a href=https://polly.wang><i class="fas fa-home"></i>Home</a><li><a href=https://polly.wang/archive><i class="fas fa-archive"></i>Archive</a><li><a href=https://polly.wang/category><i class="fas fa-folder"></i>Category</a><li><a href=https://polly.wang/blog><i class="fas fa-file-alt"></i>Posts</a><li><a href=https://polly.wang/cfp><i class="fas fa-calendar-alt"></i>CFP</a><li><a href=https://polly.wang/publication><i class="fas fa-file-pdf"></i>Research</a><li><a href=https://polly.wang/changelog><i class="fas fa-history"></i>Change log</a><li><a href=https://polly.wang/about><i class="fas fa-info-circle"></i>About Me</a></ul></div><div class=social><ul class=social-links><li><a href=mailto:26716201@qq.com><i class="fas fa-envelope"></i></a><li><a href=https://twitter.com/Polly__007><i class="fab fa-twitter"></i></a><li><a href=https://www.linkedin.com/in/baoliwang><i class="fab fa-linkedin-in"></i></a><li><a href=https://github.com/Polly2014><i class="fab fa-github"></i></a></ul></div></div></div><div class="content pure-u-1 pure-u-md-4-5"><div class=blog-post><h1>ğŸ§¹ Jarvis Phase 2.5ï¼šç»™ Agent åšä¸€æ¬¡ã€Œå¤§æ‰«é™¤ã€</h1><div class=cover-image><img alt="ğŸ§¹ Jarvis Phase 2.5ï¼šç»™ Agent åšä¸€æ¬¡ã€Œå¤§æ‰«é™¤ã€" loading=lazy src=cover.jpg></div><div class=content><p>å½“ <code>jarvis --help</code> æ˜¾ç¤º 13 ä¸ªå­å‘½ä»¤å…¨éƒ¨æ­£å¸¸æ³¨å†Œæ—¶ï¼Œæˆ‘ç»ˆäºç¡®è®¤ï¼šè¿™æ¬¡é‡æ„æ²¡æœ‰ç¿»è½¦ã€‚<p>è¿™æ˜¯ <a href=/jarvis-agent-genesis/>Jarvis-Agent</a> çš„ç¬¬ 2.5 é˜¶æ®µâ€”â€”ä¸€ä¸ªæ²¡æœ‰æ–°åŠŸèƒ½çš„ç‰ˆæœ¬ã€‚å¬èµ·æ¥æ— èŠï¼Ÿä½†è¿™å¯èƒ½æ˜¯æ•´ä¸ªé¡¹ç›®ä¸­æœ€é‡è¦çš„ä¸€æ¬¡è¿­ä»£ã€‚</p><span id=continue-reading></span><h2 id=wei-shi-yao-yao-ting-xia-lai-da-sao>ä¸ºä»€ä¹ˆè¦åœä¸‹æ¥æ‰“æ‰«ï¼Ÿ</h2><p>Phase 2 å†™å®Œåï¼Œæˆ‘åšäº†ä¸€æ¬¡å®Œæ•´çš„ä»£ç å®¡æŸ¥ã€‚ç»“æœè®©æˆ‘æœ‰ç‚¹ä¸å¥½æ„æ€ï¼š<table><thead><tr><th>é—®é¢˜<th>ä¸¥é‡ç¨‹åº¦<th>æè¿°<tbody><tr><td>ğŸ”´ <strong>çº¿ç¨‹å®‰å…¨</strong><td>P0<td><code>_recent_changes</code> åœ¨ watchdog çº¿ç¨‹å’Œ async ä¸»å¾ªç¯ä¹‹é—´è£¸è¯»å†™<tr><td>ğŸ”´ <strong>æ­»ä»£ç </strong><td>P0<td>7 ä¸ªæ–‡ä»¶å®Œå…¨æ²¡æœ‰è¢«å¼•ç”¨ï¼Œè¿˜å ç€å·¥ç¨‹ç›®å½•<tr><td>ğŸŸ¡ <strong>CLI å·¨çŸ³</strong><td>P1<td><code>cli.py</code> è†¨èƒ€åˆ° 1909 è¡Œï¼Œä»€ä¹ˆé€»è¾‘éƒ½å¾€é‡Œå¡<tr><td>ğŸŸ¡ <strong>é—ç•™æ¨¡å—</strong><td>P1<td>Phase 0 çš„ <code>config.py</code>ã€<code>main.py</code> è¿˜èººåœ¨ <code>src/</code> é‡Œ</table><p>çœ‹å®Œè¿™ä»½æ¸…å•ï¼Œæˆ‘æ„è¯†åˆ°ä¸€ä¸ªäº‹å®ï¼š<blockquote><p><strong>å¦‚æœä¸åœ¨ Phase 3 ä¹‹å‰æŠŠè¿™äº›å€ºè¿˜æ‰ï¼Œåé¢æ¯åŠ ä¸€ä¸ªåŠŸèƒ½éƒ½è¦è¸©ä¸€æ¬¡å‘ã€‚</strong></blockquote><p>äºæ˜¯æˆ‘å†³å®šï¼šPhase 2.5ï¼Œä¸å†™æ–°åŠŸèƒ½ï¼Œåªè¿˜å€ºã€‚<hr><h2 id=unloc-di-yi-dao-xian-cheng-an-quan>ğŸ”’ ç¬¬ä¸€åˆ€ï¼šçº¿ç¨‹å®‰å…¨</h2><p>è¿™ä¸ª bug æœ€éšè”½ï¼Œä¹Ÿæœ€å±é™©ã€‚<p><code>JarvisEventHandler</code> æ˜¯ watchdog çš„æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ã€‚å®ƒæœ‰ä¸€ä¸ª <code>_recent_changes</code> åˆ—è¡¨ï¼Œç”¨æ¥æ”¶é›†æ–‡ä»¶å˜åŒ–ã€‚é—®é¢˜æ˜¯ï¼šwatchdog çš„å›è°ƒè·‘åœ¨<strong>ç‹¬ç«‹çº¿ç¨‹</strong>é‡Œï¼Œè€Œä¸»å¾ªç¯æ˜¯ <strong>asyncio</strong>ã€‚ä¸¤è¾¹åŒæ—¶è¯»å†™åŒä¸€ä¸ªåˆ—è¡¨ï¼Œæ²¡æœ‰ä»»ä½•ä¿æŠ¤ã€‚<p>ä½ å¯èƒ½è¯´"Python æœ‰ GILï¼Œåˆ—è¡¨æ“ä½œæ˜¯åŸå­çš„"â€”â€”ç¡®å®ï¼Œ<code>list.append()</code> æ˜¯åŸå­çš„ï¼Œä½† <code>get_and_clear_changes()</code> é‡Œæ˜¯å…ˆè¯»åæ¸…ï¼Œè¿™ä¸ªç»„åˆæ“ä½œä¸æ˜¯åŸå­çš„ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># âŒ ä¿®å¤å‰ï¼šä¸¤æ­¥æ“ä½œä¹‹é—´å¯èƒ½è¢«æ’å…¥
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>get_and_clear_changes</span><span>(</span><span style=color:#bf616a>self</span><span>):
</span><span>    changes = </span><span style=color:#bf616a>self</span><span>._recent_changes.</span><span style=color:#bf616a>copy</span><span>()  </span><span style=color:#65737e># è¯»
</span><span>    </span><span style=color:#bf616a>self</span><span>._recent_changes.</span><span style=color:#bf616a>clear</span><span>()           </span><span style=color:#65737e># æ¸… â† è¯»å’Œæ¸…ä¹‹é—´å¯èƒ½æœ‰æ–°å†™å…¥
</span><span>    </span><span style=color:#b48ead>return </span><span>changes
</span></code></pre><p>ä¿®å¤å¾ˆç®€å•ï¼ŒåŠ ä¸€æŠŠé”ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#b48ead>import </span><span>threading
</span><span>
</span><span style=color:#b48ead>class </span><span style=color:#ebcb8b>JarvisEventHandler</span><span style=color:#eff1f5>(</span><span style=color:#a3be8c>FileSystemEventHandler</span><span style=color:#eff1f5>):
</span><span>    </span><span style=color:#b48ead>def </span><span style=color:#96b5b4>__init__</span><span>(</span><span style=color:#bf616a>self</span><span>):
</span><span>        </span><span style=color:#bf616a>self</span><span>._recent_changes = []
</span><span>        </span><span style=color:#bf616a>self</span><span>._lock = threading.</span><span style=color:#bf616a>Lock</span><span>()  </span><span style=color:#65737e># âœ… æ–°å¢
</span><span>    
</span><span>    </span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>_record_change</span><span>(</span><span style=color:#bf616a>self</span><span>, </span><span style=color:#bf616a>event_type</span><span>, </span><span style=color:#bf616a>path</span><span>):
</span><span>        </span><span style=color:#b48ead>with </span><span style=color:#bf616a>self</span><span>._lock:  </span><span style=color:#65737e># âœ… å†™å…¥åŠ é”
</span><span>            </span><span style=color:#bf616a>self</span><span>._recent_changes.</span><span style=color:#bf616a>append</span><span>({</span><span style=color:#d08770>...</span><span>})
</span><span>    
</span><span>    </span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>get_and_clear_changes</span><span>(</span><span style=color:#bf616a>self</span><span>):
</span><span>        </span><span style=color:#b48ead>with </span><span style=color:#bf616a>self</span><span>._lock:  </span><span style=color:#65737e># âœ… è¯»+æ¸…åŸå­åŒ–
</span><span>            changes = </span><span style=color:#bf616a>self</span><span>._recent_changes.</span><span style=color:#bf616a>copy</span><span>()
</span><span>            </span><span style=color:#bf616a>self</span><span>._recent_changes.</span><span style=color:#bf616a>clear</span><span>()
</span><span>            </span><span style=color:#b48ead>return </span><span>changes
</span></code></pre><p>ä¸‰è¡Œä»£ç ï¼Œæ¶ˆé™¤ä¸€ä¸ª race conditionã€‚è¿™ç§ bug å¯èƒ½è·‘ä¸€ä¸‡æ¬¡éƒ½ä¸å‡ºé—®é¢˜ï¼Œä½†å‡ºä¸€æ¬¡å°±æ˜¯æ•°æ®ä¸¢å¤±ã€‚<hr><h2 id=wastebasket-di-er-dao-qing-chu-si-dai-ma>ğŸ—‘ï¸ ç¬¬äºŒåˆ€ï¼šæ¸…é™¤æ­»ä»£ç </h2><p>æ¥ä¸‹æ¥æ˜¯æœ€çˆ½çš„éƒ¨åˆ†â€”â€”åˆ ä»£ç ã€‚<p>æˆ‘ç”¨ <code>grep -r</code> æœç´¢æ¯ä¸ªæ¨¡å—çš„å¯¼å…¥å’Œå¼•ç”¨æƒ…å†µï¼Œæ‰¾å‡ºäº†ä¸ƒä¸ªå®Œå…¨æ²¡æœ‰è¢«ä½¿ç”¨çš„æ–‡ä»¶ï¼š<table><thead><tr><th>æ–‡ä»¶<th>æ¥å†<th>è¡Œæ•°<th>çŠ¶æ€<tbody><tr><td><code>src/main.py</code><td>Phase 0 çš„ FastAPI å…¥å£<td>180 è¡Œ<td>ğŸ—‘ï¸ å·²åˆ é™¤<tr><td><code>src/config.py</code><td>Phase 0 çš„ Pydantic Settings<td>120 è¡Œ<td>ğŸ—‘ï¸ å·²åˆ é™¤<tr><td><code>src/llm/client.py</code><td>æ—©æœŸç›´è°ƒ DeepSeek/Claude API<td>200 è¡Œ<td>ğŸ—‘ï¸ å·²åˆ é™¤<tr><td><code>src/memory/database.py</code><td>Phase 1 çš„çº¯ SQLite æ–¹æ¡ˆ<td>250 è¡Œ<td>ğŸ—‘ï¸ å·²åˆ é™¤<tr><td><code>src/memory/models.py</code><td>æ—§æ•°æ®æ¨¡å‹<td>80 è¡Œ<td>ğŸ—‘ï¸ å·²åˆ é™¤<tr><td><code>src/proactive/scheduler.py</code><td>æœªå®ç°çš„å®šæ—¶è°ƒåº¦<td>150 è¡Œ<td>ğŸ—‘ï¸ å·²åˆ é™¤<tr><td><code>src/proactive/__init__.py</code><td>ç©ºåŒ…<td>5 è¡Œ<td>ğŸ—‘ï¸ å·²åˆ é™¤</table><p>å¦å¤–è¿˜åˆ æ‰äº† <code>cli.py</code> ä¸­çš„ <code>serve</code> å‘½ä»¤â€”â€”é‚£æ˜¯ Phase 0 é—ç•™çš„ FastAPI serve é€»è¾‘ï¼Œä»æ¥æ²¡æœ‰è¢«è°ƒç”¨è¿‡ã€‚<p><strong>æ€»è®¡åˆ é™¤çº¦ 1000 è¡Œä»£ç </strong>ã€‚åˆ å®Œä¹‹åé¡¹ç›®ç›®å½•æ¸…çˆ½å¤šäº†ï¼šæ²¡æœ‰çš„å¼•ç”¨çš„æ¨¡å—å…¨éƒ¨æ¶ˆå¤±ï¼Œ<code>src/proactive/</code> æ•´ä¸ªç›®å½•éƒ½ä¸å­˜åœ¨äº†ã€‚<blockquote><p>åˆ ä»£ç æ¯”å†™ä»£ç æ›´éœ€è¦å‹‡æ°”â€”â€”ä½ å¾—ç¡®è®¤æ¯ä¸€è¡ŒçœŸçš„æ²¡äººç”¨ã€‚ä½†åˆ å®Œä¹‹åçš„è½»æ¾æ„Ÿï¼Œæ— ä¸ä¼¦æ¯”ã€‚</blockquote><hr><h2 id=package-di-san-dao-cli-mo-kuai-hua>ğŸ“¦ ç¬¬ä¸‰åˆ€ï¼šCLI æ¨¡å—åŒ–</h2><p>è¿™æ˜¯å·¥ä½œé‡æœ€å¤§çš„éƒ¨åˆ†ã€‚<p><code>cli.py</code> æ˜¯æ•´ä¸ªé¡¹ç›®çš„ CLI å…¥å£ï¼Œæ‰¿è½½äº† 13 ä¸ªå­å‘½ä»¤ã€èŠå¤©å¾ªç¯ã€Tab è¡¥å…¨ã€æµå¼è¾“å‡ºã€å®ˆæŠ¤è¿›ç¨‹ç®¡ç†â€¦â€¦å…¨éƒ¨å †åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œ<strong>1909 è¡Œ</strong>ã€‚<p>æ‰¾ä¸€ä¸ªå‡½æ•°ï¼Ÿå…ˆ Ctrl+Fã€‚æ”¹ä¸€ä¸ªå‘½ä»¤ï¼Ÿæ‹…å¿ƒå½±å“å…¶ä»–å‘½ä»¤ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå¯ä»¥ç»§ç»­è¿›åŒ–çš„æ¶æ„ã€‚<h3 id=fen-chai-ce-lue>åˆ†æ‹†ç­–ç•¥</h3><p>æˆ‘æŒ‰<strong>èŒè´£è¾¹ç•Œ</strong>æŠŠ <code>cli.py</code> æ‹†æˆäº† 6 ä¸ªæ¨¡å—ï¼š<pre style=background:#2b303b;color:#c0c5ce><code><span>src/cli/                       # ğŸ“¦ ä» 1 ä¸ªæ–‡ä»¶ â†’ 6 ä¸ªæ¨¡å—
</span><span>â”œâ”€â”€ __init__.py          # 141 è¡Œ  app å®šä¹‰ + main callback
</span><span>â”œâ”€â”€ common.py            # 180 è¡Œ  å¸¸é‡ã€è·¯å¾„ã€çŠ¶æ€æŸ¥è¯¢
</span><span>â”œâ”€â”€ chat.py              # 335 è¡Œ  èŠå¤©å¾ªç¯ã€è¡¥å…¨å™¨ã€streaming
</span><span>â”œâ”€â”€ daemon_cmds.py       # 272 è¡Œ  start/rest/status
</span><span>â”œâ”€â”€ memory_cmds.py       # 310 è¡Œ  recall/think/insights
</span><span>â””â”€â”€ explore_cmds.py      # 415 è¡Œ  init/explore/projects/discoveries/skills
</span></code></pre><h3 id=guan-jian-she-ji-jue-ce>å…³é”®è®¾è®¡å†³ç­–</h3><p><strong>1. ä¿æŒå…¥å£ä¸å˜</strong><p><code>pyproject.toml</code> é‡Œçš„å…¥å£æ˜¯ <code>jarvis = "src.cli:app"</code>ã€‚æŠŠ <code>cli.py</code> å˜æˆ <code>cli/</code> åŒ…ä¹‹åï¼Œ<code>__init__.py</code> å¯¼å‡º <code>app</code> å¯¹è±¡ï¼Œå…¥å£é›¶æ”¹åŠ¨ã€‚æ‰€æœ‰ç”¨æˆ·çš„ <code>jarvis</code> å‘½ä»¤æ— æ„Ÿå‡çº§ã€‚<p><strong>2. å…±äº«çŠ¶æ€ä¸‹æ²‰</strong><p><code>JARVIS_HOME</code>ã€<code>VERSION</code>ã€<code>get_config_path()</code> è¿™äº›å¸¸é‡å’Œå·¥å…·å‡½æ•°ï¼Œä¸‹æ²‰åˆ° <code>common.py</code>ï¼Œå…¶ä»–æ¨¡å— <code>from .common import</code> å³å¯ã€‚<p><strong>3. å¾ªç¯ä¾èµ–é¢„é˜²</strong><p>èŠå¤©æ¨¡å—å¯èƒ½éœ€è¦è°ƒç”¨ daemon å‘½ä»¤ï¼ˆæ¯”å¦‚ç”¨æˆ·åœ¨èŠå¤©ä¸­è¾“å…¥ <code>/start</code>ï¼‰ï¼Œdaemon æ¨¡å—ä¸éœ€è¦çŸ¥é“èŠå¤©çš„å­˜åœ¨ã€‚ä¾èµ–æ–¹å‘æ˜¯å•å‘çš„ï¼š<pre style=background:#2b303b;color:#c0c5ce><code><span>__init__.py â†’ æ‰€æœ‰å­æ¨¡å—
</span><span>chat.py â†’ common.py, daemon_cmds.py, memory_cmds.py, explore_cmds.py
</span><span>daemon_cmds.py â†’ common.py
</span><span>memory_cmds.py â†’ common.py
</span><span>explore_cmds.py â†’ common.py
</span></code></pre><h3 id=before-vs-after>Before vs After</h3><table><thead><tr><th>æŒ‡æ ‡<th>Before<th>After<tbody><tr><td>æ–‡ä»¶æ•°<td>1 ä¸ª<td>6 ä¸ª<tr><td>æœ€å¤§æ–‡ä»¶<td>1909 è¡Œ<td>415 è¡Œ<tr><td>å¹³å‡æ–‡ä»¶<td>1909 è¡Œ<td>276 è¡Œ<tr><td>æ‰¾å‡½æ•°<td>Ctrl+F å…¨æ–‡æœ<td>æŒ‰èŒè´£æ‰“å¼€å¯¹åº”æ–‡ä»¶<tr><td>æ”¹å‘½ä»¤<td>æ‹…å¿ƒå½±å“å…¨å±€<td>ä¿®æ”¹å¯¹åº”æ¨¡å—å³å¯</table><hr><h2 id=wrench-fu-zeng-liang-ge-xin-gong-neng>ğŸ”§ é™„èµ ï¼šä¸¤ä¸ªæ–°åŠŸèƒ½</h2><p>è¶ç€é‡æ„ï¼Œé¡ºæ‰‹å®ç°äº†ä¸¤ä¸ªä¸€ç›´æƒ³åšä½†æ²¡åšçš„å°åŠŸèƒ½ï¼š<h3 id=jarvis-projects-zhen-zheng-neng-yong-liao><code>jarvis projects</code>ï¼šçœŸæ­£èƒ½ç”¨äº†</h3><p>Phase 1 å†™äº†è¿™ä¸ªå‘½ä»¤çš„ç­¾åï¼Œä½†å®ç°æ˜¯ç©ºçš„ã€‚ç°åœ¨å®ƒä¼šè¯»å– <code>discoveries.json</code>ï¼Œæå–æ‰€æœ‰è¢«å‘ç°çš„é¡¹ç›®ï¼š<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>$</span><span> jarvis projects
</span><span>
</span><span style=color:#bf616a>ğŸ“‚</span><span> å·²å‘ç°çš„é¡¹ç›® (3ä¸ª)
</span><span>
</span><span>  </span><span style=color:#bf616a>1.</span><span> ğŸ“¦ Jarvis-Agent (python)
</span><span>     </span><span style=color:#bf616a>è·¯å¾„:</span><span> /Users/polly/.../Jarvis-Agent
</span><span>     </span><span style=color:#bf616a>å‘ç°æ—¶é—´:</span><span> 2026-02-05 02:39
</span><span>
</span><span>  </span><span style=color:#bf616a>2.</span><span> ğŸ“¦ Master-Translator-MCP-Server (python)
</span><span>     </span><span style=color:#bf616a>è·¯å¾„:</span><span> /Users/polly/.../Master-Translator-MCP-Server
</span><span>     </span><span style=color:#bf616a>å‘ç°æ—¶é—´:</span><span> 2026-02-05 02:40
</span><span>
</span><span>  </span><span style=color:#bf616a>3.</span><span> ğŸ“¦ www.polly.com (zola)
</span><span>     </span><span style=color:#bf616a>è·¯å¾„:</span><span> /Users/polly/.../www.polly.com
</span><span>     </span><span style=color:#bf616a>å‘ç°æ—¶é—´:</span><span> 2026-02-05 02:41
</span></code></pre><h3 id=jarvis-init-zi-dong-chuang-jian-ren-ge><code>jarvis init</code>ï¼šè‡ªåŠ¨åˆ›å»ºäººæ ¼</h3><p>åˆå§‹åŒ–æ—¶è‡ªåŠ¨è°ƒç”¨ <code>MemoryWriter.init_persona()</code>ï¼Œåœ¨ <code>~/.jarvis/memory/persona.md</code> åˆ›å»ºäººæ ¼éª¨æ¶æ–‡ä»¶ã€‚Jarvis çš„"çµé­‚"ä»ç¬¬ä¸€æ¬¡å¯åŠ¨å°±å¼€å§‹ç”Ÿé•¿ã€‚<hr><h2 id=pid-guan-li-you-ya-di-ting-zhi>ğŸ«€ PID ç®¡ç†ï¼šä¼˜é›…åœ°åœæ­¢</h2><p>Phase 2 æœ‰ä¸€ä¸ªæ¼äººçš„ bugï¼š<code>jarvis -r</code>ï¼ˆåœæ­¢ daemonï¼‰ä¸ç”Ÿæ•ˆã€‚<p>æ ¹æœ¬åŸå› æ˜¯ daemon è·‘åœ¨å­è¿›ç¨‹é‡Œï¼Œ<code>-r</code> å‘½ä»¤åªæ˜¯è®¾ç½®äº†ä¸€ä¸ªçŠ¶æ€æ–‡ä»¶ï¼Œä½† daemon çš„ <code>asyncio.sleep(300)</code> ä¸ä¼šè¢«æ‰“æ–­â€”â€”å®ƒè¦ç­‰ 5 åˆ†é’Ÿæ‰èƒ½æ£€æŸ¥åˆ°åœæ­¢ä¿¡å·ã€‚<p>ä¿®å¤æ–¹æ¡ˆï¼š<strong>PID æ–‡ä»¶ + SIGTERM ä¿¡å·</strong>ã€‚<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># å¯åŠ¨æ—¶å†™å…¥ PID
</span><span>pid_path = </span><span style=color:#bf616a>get_pid_path</span><span>()
</span><span>pid_path.</span><span style=color:#bf616a>write_text</span><span>(</span><span style=color:#bf616a>str</span><span>(daemon_process.pid))
</span><span>
</span><span style=color:#65737e># åœæ­¢æ—¶å‘é€ SIGTERM
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>_do_rest</span><span>():
</span><span>    pid = </span><span style=color:#bf616a>int</span><span>(pid_path.</span><span style=color:#bf616a>read_text</span><span>())
</span><span>    os.</span><span style=color:#bf616a>kill</span><span>(pid, signal.</span><span style=color:#bf616a>SIGTERM</span><span>)
</span></code></pre><p>Daemon ç«¯æ³¨å†Œä¿¡å·å¤„ç†å™¨ï¼Œæ”¶åˆ° SIGTERM åç«‹å³å–æ¶ˆ sleepï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#b48ead>async def </span><span style=color:#8fa1b3>run_daemon</span><span>():
</span><span>    loop = asyncio.</span><span style=color:#bf616a>get_event_loop</span><span>()
</span><span>    stop_event = asyncio.</span><span style=color:#bf616a>Event</span><span>()
</span><span>    
</span><span>    </span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>handle_signal</span><span>():
</span><span>        stop_event.</span><span style=color:#bf616a>set</span><span>()
</span><span>    
</span><span>    loop.</span><span style=color:#bf616a>add_signal_handler</span><span>(signal.</span><span style=color:#bf616a>SIGTERM</span><span>, handle_signal)
</span><span>    
</span><span>    </span><span style=color:#b48ead>while </span><span>not stop_event.</span><span style=color:#bf616a>is_set</span><span>():
</span><span>        </span><span style=color:#b48ead>await </span><span style=color:#bf616a>heartbeat</span><span>()
</span><span>        </span><span style=color:#65737e># å¯è¢«ä¿¡å·æ‰“æ–­çš„ç­‰å¾…
</span><span>        </span><span style=color:#b48ead>try</span><span>:
</span><span>            </span><span style=color:#b48ead>await </span><span>asyncio.</span><span style=color:#bf616a>wait_for</span><span>(stop_event.</span><span style=color:#bf616a>wait</span><span>(), </span><span style=color:#bf616a>timeout</span><span>=</span><span style=color:#d08770>300</span><span>)
</span><span>        </span><span style=color:#b48ead>except </span><span>asyncio.TimeoutError:
</span><span>            </span><span style=color:#b48ead>pass  </span><span style=color:#65737e># æ­£å¸¸è¶…æ—¶ï¼Œç»§ç»­å¾ªç¯
</span></code></pre><p>æ•ˆæœï¼š<code>jarvis -r</code> å daemon <strong>ç«‹å³åœæ­¢</strong>ï¼Œä¸å†éœ€è¦ç­‰å¾…ä¸‹ä¸€ä¸ªå¿ƒè·³å‘¨æœŸã€‚<hr><h2 id=bar-chart-phase-2-5-zong-jie>ğŸ“Š Phase 2.5 æ€»ç»“</h2><p>æœ€ç»ˆçš„ä»£ç ç»Ÿè®¡ï¼š<table><thead><tr><th>æŒ‡æ ‡<th>Phase 2 ç»“æŸ<th>Phase 2.5 ç»“æŸ<th>å˜åŒ–<tbody><tr><td>æ€»ä»£ç é‡<td>~4800 è¡Œ<td>3794 è¡Œ<td>-1000 è¡Œ<tr><td>æ–‡ä»¶æ•°<td>~20 ä¸ª .py<td>14 ä¸ª .py<td>-6 ä¸ª<tr><td>æœ€å¤§æ–‡ä»¶<td>1909 è¡Œ (cli.py)<td>666 è¡Œ (daemon.py)<td>-65%<tr><td>æ­»ä»£ç <td>7 ä¸ªæ–‡ä»¶<td>0<td>âœ…<tr><td>çº¿ç¨‹å®‰å…¨é—®é¢˜<td>1 ä¸ª<td>0<td>âœ…</table><p>Git ç»Ÿè®¡ï¼š<code>19 files changed, 1742 insertions(+), 2512 deletions(-)</code><p><strong>åˆ æ‰çš„æ¯”å†™çš„å¤š</strong>â€”â€”è¿™æ­£æ˜¯ä¸€æ¬¡æˆåŠŸé‡æ„çš„æ ‡å¿—ã€‚<hr><h2 id=thought-balloon-fan-si-wei-shi-yao-phase-2-5-hen-zhong-yao>ğŸ’­ åæ€ï¼šä¸ºä»€ä¹ˆ Phase 2.5 å¾ˆé‡è¦</h2><p>è½¯ä»¶å¼€å‘æœ‰ä¸ªè¯´æ³•ï¼š<strong>"ä»£ç çš„ç†µå¢æ˜¯ä¸å¯é€†çš„"</strong>ã€‚<p>æ¯æ¬¡åŠ åŠŸèƒ½ï¼Œä»£ç éƒ½ä¼šå˜å¤æ‚ä¸€ç‚¹ã€‚å¦‚æœä¸å®šæœŸåšæ¸…ç†ï¼Œå¤æ‚åº¦ä¼šæŒ‡æ•°å¢é•¿ï¼Œç›´åˆ°ä½ ä¸æ•¢å†åŠ¨å®ƒã€‚<p>Jarvis-Agent è¿˜åœ¨è¿›åŒ–çš„æ—©æœŸã€‚Phase 3ï¼ˆå·¥å…·è°ƒç”¨ï¼‰å’Œ Phase 4ï¼ˆSkill è‡ªç”Ÿæˆï¼‰éƒ½æ˜¯å¤§å·¥ç¨‹ã€‚å¦‚æœå¸¦ç€ 1909 è¡Œçš„å·¨çŸ³ CLI å’Œä¸ƒä¸ªæ­»ä»£ç æ–‡ä»¶å»åšè¿™äº›ï¼Œæ¯ä¸€æ­¥éƒ½ä¼šæ›´éš¾ã€‚<p>Phase 2.5 å°±åƒæ˜¯ä¸€æ¬¡ã€Œæ·±å‘¼å¸ã€â€”â€”åœä¸‹æ¥ï¼Œæ•´ç†å¥½è¡Œè£…ï¼Œå†å‡ºå‘ã€‚<h3 id=yi-ge-you-qu-de-shu-zi>ä¸€ä¸ªæœ‰è¶£çš„æ•°å­—</h3><p>æ•´ä¸ª Phase 2.5 ä»å¼€å§‹åˆ°ç»“æŸï¼Œå¤§çº¦èŠ±äº† 3 å°æ—¶ã€‚ä½†å¦‚æœä¸åšè¿™æ¬¡æ¸…ç†ï¼Œè¿™äº›æŠ€æœ¯å€ºä¼šåœ¨æ¥ä¸‹æ¥çš„æ¯ä¸ª Phase ä¸­åå¤å‡ºç°ï¼Œç´¯è®¡æµªè´¹çš„æ—¶é—´å¯èƒ½æ˜¯ 30 å°æ—¶ã€‚<blockquote><p>è¿˜å€ºçš„æœ€ä½³æ—¶æœºï¼Œæ°¸è¿œæ˜¯ç°åœ¨ã€‚</blockquote><hr><h2 id=crystal-ball-phase-3-yu-gao>ğŸ”® Phase 3 é¢„å‘Š</h2><p>Phase 2.5 è®© Jarvis çš„ä»£ç åº“å˜å¾—å¹²å‡€ã€æ¨¡å—åŒ–ã€‚æ¥ä¸‹æ¥ï¼ŒPhase 3 çš„ç›®æ ‡æ˜¯è®© Jarvis å­¦ä¼š<strong>åŠ¨æ‰‹åšäº‹</strong>ï¼š<ul><li>ğŸ¦¾ <strong>Tool Registry</strong>ï¼šå·¥å…·æ³¨å†Œä¸å‘ç°<li>ğŸ”Œ <strong>MCP é›†æˆ</strong>ï¼šå¤ç”¨å·²æœ‰çš„ MCP Server<li>ğŸ“‹ <strong>ä»»åŠ¡è§„åˆ’</strong>ï¼šåˆ†è§£å¤æ‚ä»»åŠ¡ï¼Œé€æ­¥æ‰§è¡Œ</ul><p>ä»"èƒ½æƒ³"åˆ°"èƒ½åš"â€”â€”è¿™æ‰æ˜¯ Agent çœŸæ­£çš„è¿›åŒ–æ–¹å‘ã€‚<hr><blockquote><p>ç›¸å…³æ–‡ç« ï¼š<ul><li><a href=/jarvis-agent-genesis/>ğŸ¥š Jarvis çš„è¯ç”Ÿï¼šAgent å››å¤§å†…æ ¸</a><li><a href=/jarvis-agent-phase1-development/>ğŸ¥š Phase 1 + 1.5ï¼šä»å¿ƒè·³åˆ°çµé­‚äº¤äº’</a><li><a href=/jarvis-agent-phase2-memory-system/>ğŸ§  Phase 2ï¼šä»è¢«åŠ¨é—®ç­”åˆ°ä¸»åŠ¨æ€è€ƒ</a></ul></blockquote></div><div class=navigation></div></div><div id=giscus-container><h2>ç•™è¨€ä¸è®¨è®º</h2><div class=giscus></div></div><script data-category="Blog Comments" async crossorigin data-category-id=DIC_kwDOL45duM4CnjlZ data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=pathname data-reactions-enabled=1 data-repo=Polly2014/polly2014.github.io data-repo-id=R_kgDOL45duA data-strict=0 data-theme=noborder_light src=https://giscus.app/client.js></script><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                // ç°ç™½é»‘è‰²è°ƒ + è“è‰²ç‚¹ç¼€
                primaryColor: '#e8e8e8',
                primaryTextColor: '#333',
                primaryBorderColor: '#999',
                lineColor: 'rgb(61, 146, 201)',
                secondaryColor: '#f5f5f5',
                tertiaryColor: '#fafafa',
                background: '#f2f2f2',
                mainBkg: '#f5f5f5',
                nodeBorder: '#999',
                clusterBkg: '#eee',
                clusterBorder: '#ccc',
                titleColor: '#333',
                edgeLabelBackground: '#f2f2f2',
                // æ–‡æœ¬é¢œè‰²
                textColor: '#333',
                nodeTextColor: '#333',
                // å…¶ä»–
                fontFamily: "'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace"
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // æŸ¥æ‰¾æ‰€æœ‰ mermaid ä»£ç å—å¹¶æ¸²æŸ“
        document.querySelectorAll('pre code.language-mermaid').forEach((block, index) => {
            const container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = block.textContent;
            block.parentNode.replaceWith(container);
        });

        // æ¸²æŸ“æ‰€æœ‰ mermaid å›¾è¡¨
        await mermaid.run();
    </script><style>.cover-image{text-align:center;margin:1.5em 0 2em 0}.cover-image img{width:60%;height:auto;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15)}.mermaid{background:#fafafa;border:1px solid #ddd;padding:20px;margin:20px 0;overflow-x:auto}.mermaid svg{max-width:100%;height:auto}@media (max-width:768px){.cover-image img{width:100%}}</style></div></div><script>document.addEventListener('DOMContentLoaded',function(){const c=document.querySelector('.menu-toggle');const d=document.querySelector('.sidebar');const e=document.querySelector('.overlay');function a(){d.classList.toggle('active');e.classList.toggle('active')}c.addEventListener('click',a);e.addEventListener('click',a);let f=0;let g=0;document.addEventListener('touchstart',h=>{f=h.changedTouches[0].screenX},false);document.addEventListener('touchend',h=>{g=h.changedTouches[0].screenX;b()},false);function b(){const h=g- f;if(h>50&&f<30){d.classList.add('active');e.classList.add('active')}else if(h<-50&&d.classList.contains('active')){d.classList.remove('active');e.classList.remove('active')}}})</script>