<!doctype html><html><head><title>日夜奋战：ContextWeave 实验体系重构全记录</title><meta content="历时三天日夜奋战，ContextWeave 论文的实验体系终于完成重构。13个实验、13张LaTeX表格、跨5种语言验证——这是一次从混乱到秩序的学术工程之旅。" name=description><meta content="Polly, Blog, AI Blog, AI Assistant, Tutorials, Technology Blog, Baoli Wang" name=keywords><meta content="width=device-width,initial-scale=1" name=viewport><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content=#333 name=theme-color><meta content=article property=og:type><meta content=https://polly.wang/contextweave-experiment-reconstruction-complete/ property=og:url><meta content="日夜奋战：ContextWeave 实验体系重构全记录" property=og:title><meta content="历时三天日夜奋战，ContextWeave 论文的实验体系终于完成重构。13个实验、13张LaTeX表格、跨5种语言验证——这是一次从混乱到秩序的学术工程之旅。" property=og:description><meta content=https://polly.wang/images/polly.png property=og:image><meta content="Polly Blog" property=og:site_name><meta content=zh_CN property=og:locale><meta content=summary_large_image name=twitter:card><meta content=https://polly.wang/contextweave-experiment-reconstruction-complete/ name=twitter:url><meta content="日夜奋战：ContextWeave 实验体系重构全记录" name=twitter:title><meta content="历时三天日夜奋战，ContextWeave 论文的实验体系终于完成重构。13个实验、13张LaTeX表格、跨5种语言验证——这是一次从混乱到秩序的学术工程之旅。" name=twitter:description><meta content=https://polly.wang/images/polly.png name=twitter:image><meta content=2026-01-11T00:00:00 property=article:published_time><meta content=Polly property=article:author><meta content=机器翻译 property=article:tag><meta content=LLM property=article:tag><meta content=实验设计 property=article:tag><meta content=ContextWeave property=article:tag><meta content=长文档翻译 property=article:tag><meta content=学术论文 property=article:tag><meta content=ACL property=article:tag><meta content=消融实验 property=article:tag><link rel="shortcut icon" href=https://polly.wang/images/polly.ico type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=icon type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=apple-touch-icon><link href=https://polly.wang/vendor/purecss/pure-min.css rel=stylesheet><link href=https://polly.wang/vendor/purecss/grids-responsive-min.css rel=stylesheet><link href=https://polly.wang/vendor/font-awesome/css/all.min.css rel=stylesheet><link href=https://polly.wang/css/style_new.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-8JD13N7PHS" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-8JD13N7PHS';);</script><body><div class=menu-toggle><img alt=Menu src=https://polly.wang/images/polly.png></div><div class=overlay></div><div class="pure-g container"><div class="sidebar pure-u-1 pure-u-md-1-5"><div class=title><a class=pure-menu-heading href=https://polly.wang> <img class="avatar pure-img-responsive" src=https://polly.wang/images/polly.png> </a><div class=introduction><p>Polly's Blog</div><div class=nav><ul class=nav-links><li><a href=https://polly.wang><i class="fas fa-home"></i>Home</a><li><a href=https://polly.wang/archive><i class="fas fa-archive"></i>Archive</a><li><a href=https://polly.wang/category><i class="fas fa-folder"></i>Category</a><li><a href=https://polly.wang/blog><i class="fas fa-file-alt"></i>Posts</a><li><a href=https://polly.wang/cfp><i class="fas fa-calendar-alt"></i>CFP</a><li><a href=https://polly.wang/publication><i class="fas fa-file-pdf"></i>Research</a><li><a href=https://polly.wang/changelog><i class="fas fa-history"></i>Change Log</a><li><a href=https://polly.wang/about><i class="fas fa-info-circle"></i>About Me</a></ul></div><div class=social><ul class=social-links><li><a href=mailto:26716201@qq.com><i class="fas fa-envelope"></i></a><li><a href=https://twitter.com/Polly__007><i class="fab fa-twitter"></i></a><li><a href=https://www.linkedin.com/in/baoliwang><i class="fab fa-linkedin-in"></i></a><li><a href=https://github.com/Polly2014><i class="fab fa-github"></i></a></ul></div></div></div><div class="content pure-u-1 pure-u-md-4-5"><div class=blog-post><h1>日夜奋战：ContextWeave 实验体系重构全记录</h1><div class=content><p>凌晨两点，当最后一行 JSON 数据通过一致性校验时，我长舒一口气。<p><strong>Code4Paper v2.0.7，13个实验全部完成，学术审查评分：⭐⭐⭐⭐⭐。</strong><p>这三天的日夜奋战，终于画上了句号。<h2 id=dart-wei-shi-yao-xu-yao-zhong-gou>🎯 为什么需要重构？</h2><p>事情要从一周前说起。当时我的 ContextWeave 长文档翻译系统已经开发完成，各种实验也跑过一遍。但当我准备整理论文投稿材料时，发现了一个致命问题：<p><strong>实验代码和结果散落在各个文件夹，没有统一的组织逻辑。</strong><ul><li>EXP01 的结果在 <code>old_experiments/</code> 目录<li>EXP05 和 EXP06 数据重复，分不清谁依赖谁<li>部分实验有 JSON 结果但没有 LaTeX 表格<li>术语不统一："Content Shrinkage" 和 "Structural Compression" 混用</ul><p>这样的状态，别说投稿 ACL/EMNLP，就连自己复盘都头疼。<p>于是我决定：<strong>推倒重来，按论文叙事逻辑重新组织所有实验。</strong><h2 id=clipboard-zhong-gou-she-ji-yuan-ze>📋 重构设计原则</h2><p>在动手之前，我确立了三条设计原则：<h3 id=yuan-ze-yi-lun-wen-luo-ji-qu-dong-shi-yan-zu-zhi>原则一：论文逻辑驱动实验组织</h3><p>传统的实验目录按时间或功能分类（<code>baseline/</code>、<code>ablation/</code>、<code>analysis/</code>）。但这样的结构和论文章节对应不上，写作时需要频繁"翻译"。<p>我的方案：<strong>实验编号直接对应论文 Section 5 的小节编号</strong>。<pre style=background:#2b303b;color:#c0c5ce><code><span>EXP01 → Section 5.2 (Sentence Baseline)
</span><span>EXP02 → Section 5.3 (Generation Collapse)
</span><span>EXP03 → Section 5.4.1 (Structural Compression)
</span><span>...
</span><span>EXP13 → Section 5.10 (Key Results Summary)
</span></code></pre><p>这样写论文时，直接引用 <code>table03_collapse.tex</code> 就能对应到正确的实验，零心智负担。<h3 id=yuan-ze-er-shu-ju-zhen-shi-xing-shi-sheng-ming-xian>原则二：数据真实性是生命线</h3><p>学术研究最忌讳的就是数据"调整"。我给自己定了一条铁律：<blockquote><p><strong>所有指标必须从真实翻译文件实时计算，绝不允许预设值。</strong></blockquote><p>这意味着每个 <code>metrics.json</code> 都是脚本运行的输出，而非手工编辑的结果。任何人 clone 仓库后运行 <code>run_all_experiments.sh</code>，都能复现完全一致的数字。<h3 id=yuan-ze-san-yin-guo-lian-bi-xu-qing-xi>原则三：因果链必须清晰</h3><p>实验之间不是孤立的，而是环环相扣。我花了大量时间梳理因果关系：<pre style=background:#2b303b;color:#c0c5ce><code><span>EXP02 (发现问题) → EXP03 (定位根因) → EXP05 (解决方案)
</span><span>    ↓                    ↓                    ↓
</span><span>生成坍塌            结构压缩            Section-Aware 分块
</span></code></pre><p>每个实验的 README 都会标注"与前置实验的关系"，让审稿人一目了然。<h2 id=microscope-13ge-shi-yan-de-wan-zheng-tu-pu>🔬 13个实验的完整图谱</h2><p>三天时间，我完成了 13 个实验的组织和验证。这里分享一下核心发现：<h3 id=exp01-02-ji-xian-yu-wen-ti-ding-yi>EXP01-02: 基线与问题定义</h3><p>首先用 FLORES-200 数据集验证 DeepSeek 作为 Base LLM 的质量（COMET=88.5，与 Google 88.8 相当）。然后在 20K-100K 规模上验证"生成坍塌"现象：<table><thead><tr><th>输入规模<th>完成率 (RCR)<tbody><tr><td>20K<td>103.4% ✅<tr><td>50K<td>78.2% ⚠️<tr><td>100K<td><strong>53.1%</strong> ❌</table><p>100K 输入时，LLM 只输出了一半内容就"累了"。这就是 ContextWeave 要解决的核心问题。<h3 id=exp03-jie-kai-jie-gou-ya-suo-de-zhen-xiang>EXP03: 揭开"结构压缩"的真相</h3><p>这是整个实验体系中最关键的发现。<p>最初我以为 LLM "偷懒"是删除了内容（MQM Omission）。但数据告诉我真相完全不同：<table><thead><tr><th>策略<th>PRR (段落保留率)<th>char_ratio (字符压缩比)<tbody><tr><td>Minimal<td>31.8%<td>29.0%<tr><td>Anti-Shrinkage+<td><strong>100.0%</strong><td>30.9%</table><p>注意看：所有策略的 char_ratio 都在 ~29%，说明<strong>内容是完整的</strong>！<p>LLM 做的不是删除内容，而是<strong>合并段落</strong>——把原本独立的 10 个段落合并成连贯的 3 个段落。语义完整，但结构被压缩了。<p>我把这个现象正式命名为 <strong>Structural Compression（结构压缩）</strong>，与 Generation Collapse（生成坍塌）区分开来：<table><thead><tr><th>特征<th>Generation Collapse<th>Structural Compression<tbody><tr><td>触发条件<td>Token 限制耗尽<td>Token 充足<tr><td>表现<td>硬截断，<code>finish_reason=length</code><td>段落合并，语义完整<tr><td>解决方案<td>输入端分块<td>Prompt 负面约束 (FORBIDDEN)</table><p>这个区分非常重要——很多人误以为"内容缩水"是 LLM 在删东西，实际上它只是在"编辑"文档结构。<h3 id=exp03b-03c-xiao-rong-yan-zheng>EXP03b/03c: 消融验证</h3><p>为了确认这是 LLM 的内在行为而非超参数问题，我做了两个补充实验：<ul><li><strong>EXP03b (Temperature)</strong>: T=0.0~1.3 全范围测试，PRR 恒定 ~32%。Temperature 无影响。<li><strong>EXP03c (Rich-Format)</strong>: 含 LaTeX 公式/表格的学术论文，公式保留率 98.8%，语义保留 100%。</ul><p><strong>结论：结构压缩是 LLM 的内在优化倾向，与温度、文档类型无关。</strong><h3 id=exp05-07-fen-kuai-yu-bian-jie-chu-li>EXP05-07: 分块与边界处理</h3><p>Section-Aware 分块策略的效果验证：<ul><li><strong>物理重叠</strong>: 6.6% → 0%（从源头消除）<li><strong>边界截断率 (BTR)</strong>: 97.4% → 0%（不再在句子中间切分）<li><strong>翻译质量 (COMETKiwi)</strong>: 0.535 → 0.580 (+8.5%)</ul><h3 id=exp08-09-zhu-yu-yi-zhi-xing>EXP08-09: 术语一致性</h3><p>跨 5 类文档验证 Context-Aware Terminology Injection：<table><thead><tr><th>文档类型<th>Fixed TCR-A<th>Section TCR-A<th>提升<tbody><tr><td>学术论文<td>75.2%<td>84.5%<td><strong>+9.3%</strong> ⭐<tr><td>法律合同<td>74.1%<td>79.9%<td>+5.9%<tr><td>技术文档<td>79.8%<td>80.8%<td>+1.0%<tr><td>平均<td>67.2%<td>72.5%<td><strong>+5.3%</strong></table><p>有趣的发现：术语注入会略微降低 COMETKiwi（-0.018），因为强制使用术语表会打断 LLM 的自然表达流。这是一个 <strong>TCR-A vs COMETKiwi 的 Trade-off</strong>，需要根据场景权衡。<h3 id=exp10-11-xiao-lu-yu-duo-yu-yan>EXP10-11: 效率与多语言</h3><ul><li><strong>并行加速</strong>: Sequential 13min → Parallel-5 2.6min，<strong>5× 提速</strong><li><strong>多语言验证</strong>: 5 种语言（中/日/法/俄/印地语）全部通过 CCF 阈值</ul><h3 id=exp13-guan-jian-jie-guo-hui-zong>EXP13: 关键结果汇总</h3><p>最后一张表，汇总 ContextWeave 的 6 大核心改进：<table><thead><tr><th>挑战<th>解决方案<th>指标<th>基线<th>CW<th>提升<tbody><tr><td>结构压缩<td>FORBIDDEN 约束<td>PRR<td>31.8%<td>100%<td>+68.2pp<tr><td>边界截断<td>Section-Aware<td>BTR<td>97.4%<td>0%<td>-97.4pp<tr><td>质量下降<td>Context Weaving<td>COMETKiwi<td>0.535<td>0.580<td>+8.5%<tr><td>术语不一致<td>Smart Injection<td>TCR-A<td>67.2%<td>72.5%<td>+5.3pp<tr><td>Token 浪费<td>Chunk-Relevant<td>Tokens<td>14,805<td>1,795<td>-87.9%<tr><td>延迟<td>Parallel Mode<td>Speed<td>1×<td>5×<td>5× faster</table><h2 id=zhi-liang-bao-zheng-yi-zhi-xing-xiao-yan>🛠️ 质量保证：一致性校验</h2><p>实验多了，最怕的就是数据不一致。比如 EXP03 说基线 PRR 是 31.8%，EXP13 总结表里写成了 31.2%——这种低级错误会让审稿人对整个论文产生怀疑。<p>为此，我写了一个跨实验一致性校验脚本：<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># 核心检查项
</span><span>checks = [
</span><span>    ("</span><span style=color:#a3be8c>EXP03 PRR Baseline</span><span>", exp03_prr, </span><span style=color:#d08770>0.318</span><span>),
</span><span>    ("</span><span style=color:#a3be8c>EXP04 Human char_ratio</span><span>", exp04_ratio, </span><span style=color:#d08770>0.331</span><span>),
</span><span>    ("</span><span style=color:#a3be8c>EXP07 vs EXP09 COMETKiwi</span><span>", </span><span style=color:#96b5b4>abs</span><span>(exp07_comet - exp09_comet) < </span><span style=color:#d08770>0.02</span><span>),
</span><span>    ("</span><span style=color:#a3be8c>EXP08 vs EXP09 TCR-A</span><span>", </span><span style=color:#96b5b4>abs</span><span>(exp08_tcr - exp09_tcr) < </span><span style=color:#d08770>0.02</span><span>),
</span><span>    ("</span><span style=color:#a3be8c>EXP11 CCF All Pass</span><span>", </span><span style=color:#96b5b4>all</span><span>(lang["</span><span style=color:#a3be8c>ccf_pass</span><span>"] </span><span style=color:#b48ead>for </span><span>lang </span><span style=color:#b48ead>in </span><span>exp11_results)),
</span><span>]
</span></code></pre><p>运行结果：<strong>ALL CONSISTENCY CHECKS PASSED</strong> ✅<p>这个脚本现在是 CI 流程的一部分，每次提交都会自动验证。<h2 id=bar-chart-zui-zhong-jiao-fu-wu>📊 最终交付物</h2><p>三天奋战的成果：<table><thead><tr><th>交付物<th>数量<th>状态<tbody><tr><td>实验脚本<td>13 个<td>✅ 全部可重现<tr><td>JSON 结果<td>13 组<td>✅ 数据一致<tr><td>LaTeX 表格<td>13 张<td>✅ 论文可直接引用<tr><td>一致性校验<td>1 套<td>✅ 自动化验证<tr><td>README 文档<td>1 份<td>✅ 500+ 行</table><p>目录结构：<pre style=background:#2b303b;color:#c0c5ce><code><span>Code4Paper_v2/
</span><span>├── 01_data/          # 原始数据（只读）
</span><span>├── 02_configs/       # 实验配置
</span><span>├── 03_evaluation/    # 评估脚本
</span><span>├── 04_experiments/   # 13个实验脚本
</span><span>├── 05_results/       # 结果 + LaTeX表格
</span><span>└── README.md         # 实验指南
</span></code></pre><h2 id=thought-balloon-fan-si-xue-zhu-yan-jiu-de-gong-cheng-hua>💭 反思：学术研究的工程化</h2><p>这次重构让我深刻体会到：<strong>顶会论文不只是创新，更是工程。</strong><p>创新点固然重要，但如果实验混乱、数据不一致、无法复现，再好的想法也会在审稿中被质疑。<p>我总结了几条经验：<ol><li><strong>早规划，晚动手</strong>：先定好实验编号与论文章节的映射，再开始跑实验<li><strong>数据不可篡改</strong>：用脚本生成结果，用版本控制追踪变更<li><strong>因果链要可视化</strong>：每个实验的 README 都标注前置/后置实验<li><strong>自动化校验</strong>：写检查脚本比人工核对可靠 100 倍</ol><h2 id=tada-xia-yi-bu>🎉 下一步</h2><p>实验体系已经就绪，接下来的计划：<ol><li><strong>论文初稿</strong>：按照 Section 5 结构填充实验结果<li><strong>可视化</strong>：为关键发现制作示意图<li><strong>同行评审</strong>：找 2-3 位同事帮忙 review<li><strong>投稿准备</strong>：确认 ACL 2026 DDL，准备 submission checklist</ol><hr><p>凌晨三点，保存最后一个文件，合上电脑。<p>窗外的城市已经沉睡，而我心里是满满的成就感。这三天虽然累，但每一行代码、每一个数字，都是为 ContextWeave 论文打下的坚实地基。<p><strong>学术研究就是这样——日夜奋战的背后，是对真理的执着追求。</strong><p>期待在 ACL 2026 见到这些成果。<hr><p><em>如果你也在准备顶会投稿，欢迎在评论区交流实验组织的经验。学术之路，与君共勉。</em></div><div class=navigation></div></div><div id=giscus-container><h2>Comments</h2><div class=giscus></div></div><script data-category="Blog Comments" async crossorigin data-category-id=DIC_kwDOL45duM4CnjlZ data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=pathname data-reactions-enabled=1 data-repo=Polly2014/polly2014.github.io data-repo-id=R_kgDOL45duA data-strict=0 data-theme=noborder_light src=https://giscus.app/client.js></script><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                // 灰白黑色调 + 蓝色点缀
                primaryColor: '#e8e8e8',
                primaryTextColor: '#333',
                primaryBorderColor: '#999',
                lineColor: 'rgb(61, 146, 201)',
                secondaryColor: '#f5f5f5',
                tertiaryColor: '#fafafa',
                background: '#f2f2f2',
                mainBkg: '#f5f5f5',
                nodeBorder: '#999',
                clusterBkg: '#eee',
                clusterBorder: '#ccc',
                titleColor: '#333',
                edgeLabelBackground: '#f2f2f2',
                // 文本颜色
                textColor: '#333',
                nodeTextColor: '#333',
                // 其他
                fontFamily: "'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace"
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // 查找所有 mermaid 代码块并渲染
        document.querySelectorAll('pre code.language-mermaid').forEach((block, index) => {
            const container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = block.textContent;
            block.parentNode.replaceWith(container);
        });

        // 渲染所有 mermaid 图表
        await mermaid.run();
    </script><style>.cover-image{text-align:center;margin:1.5em 0 2em 0}.cover-image img{width:60%;height:auto;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15)}.mermaid{background:#fafafa;border:1px solid #ddd;padding:20px;margin:20px 0;overflow-x:auto}.mermaid svg{max-width:100%;height:auto}@media (max-width:768px){.cover-image img{width:100%}}</style></div></div><script>document.addEventListener('DOMContentLoaded',function(){const c=document.querySelector('.menu-toggle');const d=document.querySelector('.sidebar');const e=document.querySelector('.overlay');function a(){d.classList.toggle('active');e.classList.toggle('active')}c.addEventListener('click',a);e.addEventListener('click',a);let f=0;let g=0;document.addEventListener('touchstart',h=>{f=h.changedTouches[0].screenX},false);document.addEventListener('touchend',h=>{g=h.changedTouches[0].screenX;b()},false);function b(){const h=g- f;if(h>50&&f<30){d.classList.add('active');e.classList.add('active')}else if(h<-50&&d.classList.contains('active')){d.classList.remove('active');e.classList.remove('active')}}})</script>