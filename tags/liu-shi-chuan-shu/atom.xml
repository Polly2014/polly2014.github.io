<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <title>Polly Blog - AI Assistant, Tutorials, and Insights - æµå¼ä¼ è¾“</title>
    <subtitle>Explore Polly Blog for AI tutorials, insights, and updates on cutting-edge technology.</subtitle>
    <link href="https://polly.wang/tags/liu-shi-chuan-shu/atom.xml" rel="self" type="application/atom+xml"/>
    <link href="https://polly.wang"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2026-01-08T00:00:00+00:00</updated>
    <id>https://polly.wang/tags/liu-shi-chuan-shu/atom.xml</id>
    <entry xml:lang="en">
        <title>æ·±åº¦è°ƒè¯•ï¼šDeepSeek API TransferEncodingError çš„æ ¹å› åˆ†æä¸æµå¼ä¼ è¾“ä¿®å¤</title>
        <published>2026-01-08T00:00:00+00:00</published>
        <updated>2026-01-08T00:00:00+00:00</updated>
        <author>
          <name>Unknown</name>
        </author>
        <link rel="alternate" href="https://polly.wang/deepseek-api-transfer-encoding-error-debug/" type="text/html"/>
        <id>https://polly.wang/deepseek-api-transfer-encoding-error-debug/</id>
        
        <content type="html">&lt;h1 id=&quot;shen-du-diao-shi-deepseek-api-transferencodingerror-de-gen-yin-fen-xi-yu-liu-shi-chuan-shu-xiu-fu&quot;&gt;æ·±åº¦è°ƒè¯•ï¼šDeepSeek API TransferEncodingError çš„æ ¹å› åˆ†æä¸æµå¼ä¼ è¾“ä¿®å¤&lt;&#x2F;h1&gt;
&lt;blockquote&gt;
&lt;p&gt;è°ƒè¯•çš„ä¹è¶£åœ¨äºï¼šä½ ä»¥ä¸ºé—®é¢˜å‡ºåœ¨ Aï¼Œç»“æœæ ¹å› åœ¨ Bï¼Œè€Œæœ€ç»ˆè§£æ³•æ˜¯ Cã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;h2 id=&quot;wen-ti-xian-xiang&quot;&gt;é—®é¢˜ç°è±¡&lt;&#x2F;h2&gt;
&lt;p&gt;æœ€è¿‘æˆ‘åœ¨å¼€å‘ä¸€ä¸ªåŸºäº LLM çš„é•¿æ–‡æ¡£ç¿»è¯‘ç³»ç»Ÿ ContextWeaveï¼Œç”¨äºå°†æŠ€æœ¯ä¹¦ç±è¿›è¡Œé«˜è´¨é‡çš„åŒè¯­ç¿»è¯‘ã€‚ç³»ç»Ÿä½¿ç”¨ DeepSeek V3 API ä½œä¸ºç¿»è¯‘å¼•æ“ï¼Œé€šè¿‡åˆ†å—ç­–ç•¥å¤„ç†è¶…é•¿æ–‡æ¡£ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸€åˆ‡çœ‹èµ·æ¥éƒ½å¾ˆç¾å¥½ï¼Œç›´åˆ°æˆ‘å¼€å§‹ç¿»è¯‘ä¸€æœ¬ 12 ä¸‡å­—ç¬¦çš„ AV1 è§†é¢‘ç¼–ç æŠ€æœ¯ä¹¦ç±æ—¶ï¼Œé‡åˆ°äº†è¿™ä¸ªé”™è¯¯ï¼š&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;TransferEncodingError: 400, message=&amp;#39;Not enough data to satisfy transfer length header.&amp;#39;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;æ›´è¯¡å¼‚çš„æ˜¯ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çŸ­æ–‡æœ¬ç¿»è¯‘ï¼ˆ~200å­—ç¬¦ï¼‰&lt;&#x2F;strong&gt;ï¼šâœ… æ­£å¸¸&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;ä¸­ç­‰æ–‡æœ¬ç¿»è¯‘ï¼ˆ~1Kå­—ç¬¦ï¼‰&lt;&#x2F;strong&gt;ï¼šâœ… æ­£å¸¸&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;é•¿æ–‡æœ¬ç¿»è¯‘ï¼ˆ~4Kå­—ç¬¦ï¼‰&lt;&#x2F;strong&gt;ï¼šâŒ å¿…ç°å¤±è´¥&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;é‡è¯• 3 æ¬¡&lt;&#x2F;strong&gt;ï¼šâŒ å…¨éƒ¨å¤±è´¥&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;è¿™ä¸ªé”™è¯¯ä¿¡æ¯ç›¸å½“&amp;quot;æŠ€æœ¯&amp;quot;ï¼Œç›´è¯‘å°±æ˜¯ï¼š&amp;quot;ä¼ è¾“é•¿åº¦å¤´å£°æ˜çš„æ•°æ®é‡ï¼Œä¸å®é™…æ¥æ”¶åˆ°çš„æ•°æ®é‡ä¸åŒ¹é…&amp;quot;ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘çš„ç¬¬ä¸€ååº”æ˜¯ï¼šéš¾é“ DeepSeek API æœ‰ bugï¼Ÿ&lt;&#x2F;p&gt;
&lt;h2 id=&quot;jia-she-yu-pai-chu&quot;&gt;å‡è®¾ä¸æ’é™¤&lt;&#x2F;h2&gt;
&lt;p&gt;ä½œä¸ºä¸€ä¸ªæœ‰ç»éªŒçš„å·¥ç¨‹å¸ˆï¼ˆè‡ªå¤¸ä¸€ä¸‹ï¼‰ï¼Œæˆ‘å¼€å§‹åˆ—ä¸¾å¯èƒ½çš„åŸå› ï¼š&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;å‡è®¾&lt;&#x2F;th&gt;&lt;th&gt;å¯èƒ½æ€§&lt;&#x2F;th&gt;&lt;th&gt;éªŒè¯æ–¹æ³•&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;1. API Key å¤±æ•ˆ&lt;&#x2F;td&gt;&lt;td&gt;ä½&lt;&#x2F;td&gt;&lt;td&gt;çŸ­è¯·æ±‚æ­£å¸¸&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;2. è¾“å‡ºè¶…è¿‡ 8K token é™åˆ¶&lt;&#x2F;td&gt;&lt;td&gt;ä¸­&lt;&#x2F;td&gt;&lt;td&gt;æ£€æŸ¥ max_tokens é…ç½®&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;3. ç½‘ç»œä¸ç¨³å®š&lt;&#x2F;td&gt;&lt;td&gt;ä¸­&lt;&#x2F;td&gt;&lt;td&gt;è¯Šæ–­è„šæœ¬&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;4. aiohttp å®¢æˆ·ç«¯é…ç½®é—®é¢˜&lt;&#x2F;td&gt;&lt;td&gt;ä¸­&lt;&#x2F;td&gt;&lt;td&gt;è°ƒæ•´è¶…æ—¶å‚æ•°&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;5. ä¸­é—´ä»£ç†&#x2F;CDN é—®é¢˜&lt;&#x2F;td&gt;&lt;td&gt;ä½&lt;&#x2F;td&gt;&lt;td&gt;traceroute åˆ†æ&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;æœ€åˆæˆ‘æ€€ç–‘æ˜¯ &lt;strong&gt;8K token é™åˆ¶&lt;&#x2F;strong&gt; çš„é—®é¢˜ã€‚DeepSeek å®˜æ–¹æ–‡æ¡£æ˜ç¡®è¯´æ˜ï¼š&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;æµå¼è¾“å‡ºåªæ˜¯ä¸€ç§å“åº”ä¼ è¾“æ–¹å¼ï¼Œä¸ä¼šæ”¹å˜ 8K çš„è¾“å‡º token é™åˆ¶ã€‚è¿™ä¸ªé™åˆ¶æ˜¯ç”±æ¨¡å‹æœ¬èº«çš„èƒ½åŠ›å†³å®šçš„ï¼Œä¸ API è°ƒç”¨æ–¹å¼æ— å…³ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;ä½†é—®é¢˜æ˜¯ï¼š4K å­—ç¬¦çš„ä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ï¼Œè¾“å‡ºä¸ä¼šè¶…è¿‡ 8K tokensï¼ˆå®æµ‹çº¦ 2-3K tokensï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è¿™æ¡è·¯èµ°ä¸é€šã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;bian-xie-zhen-duan-jiao-ben&quot;&gt;ç¼–å†™è¯Šæ–­è„šæœ¬&lt;&#x2F;h2&gt;
&lt;p&gt;æ—¢ç„¶çŒœä¸å‡ºæ¥ï¼Œé‚£å°±ç”¨æ•°æ®è¯´è¯ã€‚æˆ‘å†™äº†ä¸€ä¸ªå®Œæ•´çš„è¯Šæ–­è„šæœ¬ &lt;code&gt;diagnose_deepseek_api.py&lt;&#x2F;code&gt;ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;async def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;test_large_translation&lt;&#x2F;span&gt;&lt;span&gt;():
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&amp;quot;&amp;quot;&amp;quot;æµ‹è¯• 4: å¤§æ–‡æœ¬ç¿»è¯‘ (~4K å­—ç¬¦)&amp;quot;&amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# è¯»å–å®é™…çš„ AV1 Book æ–‡æœ¬
&lt;&#x2F;span&gt;&lt;span&gt;    test_text = full_text[:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;4000&lt;&#x2F;span&gt;&lt;span&gt;]  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# å–å‰ 4K
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    payload = {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;model&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;deepseek-chat&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;messages&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;...&lt;&#x2F;span&gt;&lt;span&gt;],
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;max_tokens&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8192&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;temperature&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1.3
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try&lt;&#x2F;span&gt;&lt;span&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;async with &lt;&#x2F;span&gt;&lt;span&gt;aiohttp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ClientSession&lt;&#x2F;span&gt;&lt;span&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span&gt;session:
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;async with &lt;&#x2F;span&gt;&lt;span&gt;session.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;post&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;API_URL&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;json&lt;&#x2F;span&gt;&lt;span&gt;=payload) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span&gt;resp:
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;resp.status == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;200&lt;&#x2F;span&gt;&lt;span&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;                    data = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;await &lt;&#x2F;span&gt;&lt;span&gt;resp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;json&lt;&#x2F;span&gt;&lt;span&gt;()  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# &amp;lt;- è¿™é‡ŒæŠ›å‡º TransferEncodingError
&lt;&#x2F;span&gt;&lt;span&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;True
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;except &lt;&#x2F;span&gt;&lt;span&gt;aiohttp.ClientPayloadError &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span&gt;e:
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;âŒ ClientPayloadError: &lt;&#x2F;span&gt;&lt;span&gt;{e}&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;   è¿™æ˜¯ TransferEncodingError çš„çˆ¶ç±»é”™è¯¯&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;False
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;============================================================
&lt;&#x2F;span&gt;&lt;span&gt;æµ‹è¯• 1: åŸºæœ¬è¿æ¥ (Hello World)
&lt;&#x2F;span&gt;&lt;span&gt;============================================================
&lt;&#x2F;span&gt;&lt;span&gt;çŠ¶æ€ç : 200
&lt;&#x2F;span&gt;&lt;span&gt;è€—æ—¶: 1.23s
&lt;&#x2F;span&gt;&lt;span&gt;å“åº”: Hello! How can I assist you today?
&lt;&#x2F;span&gt;&lt;span&gt;âœ… åŸºæœ¬è¿æ¥æ­£å¸¸
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;============================================================
&lt;&#x2F;span&gt;&lt;span&gt;æµ‹è¯• 2: çŸ­æ–‡æœ¬ç¿»è¯‘ (~200 å­—ç¬¦)
&lt;&#x2F;span&gt;&lt;span&gt;============================================================
&lt;&#x2F;span&gt;&lt;span&gt;æºæ–‡æœ¬: 78 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;çŠ¶æ€ç : 200
&lt;&#x2F;span&gt;&lt;span&gt;è€—æ—¶: 2.45s
&lt;&#x2F;span&gt;&lt;span&gt;è¯‘æ–‡: 156 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;âœ… çŸ­æ–‡æœ¬ç¿»è¯‘æ­£å¸¸
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;============================================================
&lt;&#x2F;span&gt;&lt;span&gt;æµ‹è¯• 3: ä¸­ç­‰æ–‡æœ¬ç¿»è¯‘ (~1K å­—ç¬¦)
&lt;&#x2F;span&gt;&lt;span&gt;============================================================
&lt;&#x2F;span&gt;&lt;span&gt;æºæ–‡æœ¬: 892 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;çŠ¶æ€ç : 200
&lt;&#x2F;span&gt;&lt;span&gt;è€—æ—¶: 8.67s
&lt;&#x2F;span&gt;&lt;span&gt;è¯‘æ–‡: 1847 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;âœ… ä¸­ç­‰æ–‡æœ¬ç¿»è¯‘æ­£å¸¸
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;============================================================
&lt;&#x2F;span&gt;&lt;span&gt;æµ‹è¯• 4: å¤§æ–‡æœ¬ç¿»è¯‘ (~4K å­—ç¬¦)
&lt;&#x2F;span&gt;&lt;span&gt;============================================================
&lt;&#x2F;span&gt;&lt;span&gt;æºæ–‡æœ¬: 4000 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;çŠ¶æ€ç : 200
&lt;&#x2F;span&gt;&lt;span&gt;âŒ ClientPayloadError: 400, message=&amp;#39;Not enough data to satisfy transfer length header.&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt;   è¿™æ˜¯ TransferEncodingError çš„çˆ¶ç±»é”™è¯¯
&lt;&#x2F;span&gt;&lt;span&gt;   å¯èƒ½åŸå› ï¼šå“åº”è¢«ä¸­é€”æˆªæ–­
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å…³é”®å‘ç°ï¼š&lt;strong&gt;çŠ¶æ€ç æ˜¯ 200&lt;&#x2F;strong&gt;ï¼&lt;&#x2F;p&gt;
&lt;p&gt;è¿™æ„å‘³ç€ DeepSeek API æˆåŠŸç”Ÿæˆäº†å“åº”ï¼Œä½†åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å‡ºäº†é—®é¢˜ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;liu-shi-chuan-shu-ce-shi&quot;&gt;æµå¼ä¼ è¾“æµ‹è¯•&lt;&#x2F;h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥æˆ‘æ·»åŠ äº†æµå¼ä¼ è¾“æµ‹è¯•ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;async def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;test_with_stream&lt;&#x2F;span&gt;&lt;span&gt;():
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&amp;quot;&amp;quot;&amp;quot;æµ‹è¯• 5: ä½¿ç”¨æµå¼ä¼ è¾“&amp;quot;&amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    payload = {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;model&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;deepseek-chat&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;messages&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;...&lt;&#x2F;span&gt;&lt;span&gt;],
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;max_tokens&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8192&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;stream&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;True  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ğŸ”‘ å…³é”®ï¼šå¯ç”¨æµå¼ä¼ è¾“
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;async with &lt;&#x2F;span&gt;&lt;span&gt;session.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;post&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;API_URL&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;json&lt;&#x2F;span&gt;&lt;span&gt;=payload) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span&gt;resp:
&lt;&#x2F;span&gt;&lt;span&gt;        result_chunks = []
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;async for &lt;&#x2F;span&gt;&lt;span&gt;line &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;in &lt;&#x2F;span&gt;&lt;span&gt;resp.content:
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# é€è¡Œè¯»å– SSE æ•°æ®
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;line.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;startswith&lt;&#x2F;span&gt;&lt;span&gt;(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;data: &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;):
&lt;&#x2F;span&gt;&lt;span&gt;                data = json.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;loads&lt;&#x2F;span&gt;&lt;span&gt;(line[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;6&lt;&#x2F;span&gt;&lt;span&gt;:])
&lt;&#x2F;span&gt;&lt;span&gt;                content = data[&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;choices&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;][&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;][&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;delta&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;].&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;content&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&amp;#39;)
&lt;&#x2F;span&gt;&lt;span&gt;                result_chunks.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;append&lt;&#x2F;span&gt;&lt;span&gt;(content)
&lt;&#x2F;span&gt;&lt;span&gt;        
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&amp;#39;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span&gt;(result_chunks)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ç»“æœä»¤äººæƒŠå–œï¼š&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;============================================================
&lt;&#x2F;span&gt;&lt;span&gt;æµ‹è¯• 5: æµå¼ä¼ è¾“
&lt;&#x2F;span&gt;&lt;span&gt;============================================================
&lt;&#x2F;span&gt;&lt;span&gt;æºæ–‡æœ¬: 4000 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;çŠ¶æ€ç : 200
&lt;&#x2F;span&gt;&lt;span&gt;è€—æ—¶: 45.32s
&lt;&#x2F;span&gt;&lt;span&gt;æ”¶åˆ° chunks: 1847
&lt;&#x2F;span&gt;&lt;span&gt;è¯‘æ–‡: 9234 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;æ¯”ç‡: 230.9%
&lt;&#x2F;span&gt;&lt;span&gt;âœ… æµå¼ä¼ è¾“æ­£å¸¸
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;åŒæ ·çš„è¯·æ±‚ï¼Œæµå¼æ¨¡å¼æˆåŠŸäº†ï¼&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;wang-luo-lu-jing-fen-xi&quot;&gt;ç½‘ç»œè·¯å¾„åˆ†æ&lt;&#x2F;h2&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆéæµå¼å¤±è´¥ï¼Œæµå¼æˆåŠŸï¼Ÿæˆ‘å¼€å§‹æ€€ç–‘ä¸­é—´ä»£ç†çš„é—®é¢˜ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä½¿ç”¨ traceroute åˆ†æç½‘ç»œè·¯å¾„ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt; traceroute&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -m&lt;&#x2F;span&gt;&lt;span&gt; 10 api.deepseek.com
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;  192.168.31.1 (192.168.31.1)    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;6.296&lt;&#x2F;span&gt;&lt;span&gt; ms   3.957 ms   3.599 ms
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;  192.168.1.1 (192.168.1.1)      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;4.828&lt;&#x2F;span&gt;&lt;span&gt; ms   4.850 ms   4.957 ms
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span&gt;  123.116.96.1 (åŒ—äº¬è”é€š)        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;5.163&lt;&#x2F;span&gt;&lt;span&gt; ms   7.575 ms   5.734 ms
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;4&lt;&#x2F;span&gt;&lt;span&gt;  114.245.244.129                7.896 ms   *   *
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;5  &lt;&#x2F;span&gt;&lt;span&gt;* * *
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;6&lt;&#x2F;span&gt;&lt;span&gt;  219.158.8.38 (ä¸­å›½éª¨å¹²ç½‘)      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;9.924&lt;&#x2F;span&gt;&lt;span&gt; ms
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;7&lt;&#x2F;span&gt;&lt;span&gt;  219.158.10.86                  8.833 ms   *   *
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;  219.158.12.162                 198.562 ms
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;9&lt;&#x2F;span&gt;&lt;span&gt;  151.148.9.32 (å›½é™…å‡ºå£)        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;137.116&lt;&#x2F;span&gt;&lt;span&gt; ms  165.002 ms  154.920 ms
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;10  &lt;&#x2F;span&gt;&lt;span&gt;* * *
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;PING&lt;&#x2F;span&gt;&lt;span&gt; d3bbv8sr76az5s.cloudfront.net (3.173.21.63)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt; bytes from 3.173.21.63: time=196.103 ms
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt; bytes from 3.173.21.63: time=194.315 ms
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt; bytes from 3.173.21.63: time=201.644 ms
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å…³é”®å‘ç°ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;DeepSeek API ä½¿ç”¨ AWS CloudFront CDN&lt;&#x2F;strong&gt;ï¼ˆåŸŸåè§£æåˆ° cloudfront.netï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ç½‘ç»œè·¯å¾„ï¼šå®¶åº­è·¯ç”±å™¨ â†’ åŒ—äº¬è”é€š â†’ ä¸­å›½éª¨å¹²ç½‘ â†’ å›½é™…å‡ºå£ â†’ AWS CloudFront&lt;&#x2F;li&gt;
&lt;li&gt;å»¶è¿Ÿçº¦ 200msï¼Œå±äºè·¨å›½è¯·æ±‚çš„æ­£å¸¸èŒƒå›´&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;gen-yin-fen-xi&quot;&gt;æ ¹å› åˆ†æ&lt;&#x2F;h2&gt;
&lt;p&gt;ç»“åˆæ‰€æœ‰è¯æ®ï¼Œæˆ‘ç”»å‡ºäº†é—®é¢˜çš„å®Œæ•´é“¾è·¯ï¼š&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;éæµå¼è¯·æ±‚çš„ä¼ è¾“è¿‡ç¨‹ï¼š
&lt;&#x2F;span&gt;&lt;span&gt;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  DeepSeek API                                              â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â”‚ ç”Ÿæˆå®Œæ•´å“åº”      â”‚  â† è¿™ä¸€æ­¥éœ€è¦ 30-60 ç§’              â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â”‚ (8K tokens)      â”‚                                      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚           â”‚                                                â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚           â–¼                                                â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â”‚ å‘é€HTTPå“åº”      â”‚                                      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â”‚ Content-Length:  â”‚  â† å£°æ˜ï¼šæˆ‘è¦å‘é€ 50000 bytes        â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â”‚ 50000            â”‚                                      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;&#x2F;span&gt;&lt;span&gt;            â”‚
&lt;&#x2F;span&gt;&lt;span&gt;    â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•  CloudFront CDN &#x2F; è¿è¥å•†ç½‘ç»œ
&lt;&#x2F;span&gt;&lt;span&gt;            â”‚
&lt;&#x2F;span&gt;&lt;span&gt;            â”‚  âŒ ä¼ è¾“åœ¨è¿™é‡Œè¢«ä¸­æ–­ï¼
&lt;&#x2F;span&gt;&lt;span&gt;            â”‚     CloudFront Origin Response Timeout: 30ç§’
&lt;&#x2F;span&gt;&lt;span&gt;            â”‚     è¿æ¥å¤„äº&amp;quot;ç­‰å¾…&amp;quot;çŠ¶æ€è¶…æ—¶ï¼Œè¢« CDN æ–­å¼€
&lt;&#x2F;span&gt;&lt;span&gt;            â”‚
&lt;&#x2F;span&gt;&lt;span&gt;            â–¼ (åªæ”¶åˆ° 30000 bytes)
&lt;&#x2F;span&gt;&lt;span&gt;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  aiohttp å®¢æˆ·ç«¯                                            â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â”‚ æœŸæœ›: 50000 bytes â”‚                                      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â”‚ å®é™…: 30000 bytes â”‚  â†’ TransferEncodingError!           â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;æ ¹å› ï¼šCloudFront CDN çš„ Origin Response Timeout&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å½“ DeepSeek API åœ¨ç”Ÿæˆå¤§æ–‡æœ¬å“åº”æ—¶ï¼ˆéœ€è¦ 30 ç§’ä»¥ä¸Šï¼‰ï¼ŒHTTP è¿æ¥å¤„äº&amp;quot;ç­‰å¾…&amp;quot;çŠ¶æ€â€”â€”æ²¡æœ‰ä»»ä½•æ•°æ®ä¼ è¾“ã€‚CloudFront CDN æ£€æµ‹åˆ°è¿æ¥&amp;quot;ç©ºé—²&amp;quot;ï¼Œåœ¨è¾¾åˆ°è¶…æ—¶é˜ˆå€¼åæ–­å¼€è¿æ¥ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è¿™å¯¼è‡´ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Content-Length&lt;&#x2F;code&gt; å¤´å£°æ˜äº†å®Œæ•´å“åº”å¤§å°ï¼ˆæ¯”å¦‚ 50000 bytesï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ä½†å®é™…åªæ”¶åˆ°éƒ¨åˆ†æ•°æ®ï¼ˆæ¯”å¦‚ 30000 bytesï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;aiohttp æ£€æµ‹åˆ°ä¸ä¸€è‡´ï¼ŒæŠ›å‡º &lt;code&gt;TransferEncodingError&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;wei-shi-yao-liu-shi-chuan-shu-neng-jie-jue&quot;&gt;ä¸ºä»€ä¹ˆæµå¼ä¼ è¾“èƒ½è§£å†³ï¼Ÿ&lt;&#x2F;h2&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;æµå¼è¯·æ±‚çš„ä¼ è¾“è¿‡ç¨‹ï¼š
&lt;&#x2F;span&gt;&lt;span&gt;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  DeepSeek API                                              â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â”‚ è¾¹ç”Ÿæˆè¾¹å‘é€      â”‚  â† ä¸éœ€è¦ç­‰å¾…å®Œæ•´å“åº”                â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚           â”‚ chunk1 (100 bytes)                             â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚           â”‚ chunk2 (100 bytes)                             â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚           â”‚ chunk3 (100 bytes)                             â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚           â”‚ ... (æŒç»­å‘é€)                                  â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚           â”‚                                                â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  HTTPå“åº”: Transfer-Encoding: chunked  â† æ²¡æœ‰ Content-Lengthï¼
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;&#x2F;span&gt;&lt;span&gt;            â”‚
&lt;&#x2F;span&gt;&lt;span&gt;    â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•  CloudFront CDN &#x2F; è¿è¥å•†ç½‘ç»œ
&lt;&#x2F;span&gt;&lt;span&gt;            â”‚
&lt;&#x2F;span&gt;&lt;span&gt;            â”‚  âœ… æ¯ä¸ªå° chunk å¿«é€Ÿä¼ è¾“å®Œæˆ
&lt;&#x2F;span&gt;&lt;span&gt;            â”‚     CDN çœ‹åˆ°çš„æ˜¯&amp;quot;æ´»è·ƒè¿æ¥&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;            â”‚     ä¸ä¼šè§¦å‘è¶…æ—¶
&lt;&#x2F;span&gt;&lt;span&gt;            â”‚
&lt;&#x2F;span&gt;&lt;span&gt;            â–¼
&lt;&#x2F;span&gt;&lt;span&gt;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  aiohttp å®¢æˆ·ç«¯                                            â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚  âœ… é€ chunk æ¥æ”¶ï¼Œæ‹¼æ¥æˆå®Œæ•´ç»“æœ                           â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å…³é”®åŒºåˆ«ï¼š&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;æ¨¡å¼&lt;&#x2F;th&gt;&lt;th&gt;HTTP ä¼ è¾“æ–¹å¼&lt;&#x2F;th&gt;&lt;th&gt;å“åº”å¤´&lt;&#x2F;th&gt;&lt;th&gt;CDN è¡Œä¸º&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;éæµå¼&lt;&#x2F;strong&gt;&lt;&#x2F;td&gt;&lt;td&gt;ä¸€æ¬¡æ€§å‘é€å®Œæ•´å“åº”&lt;&#x2F;td&gt;&lt;td&gt;&lt;code&gt;Content-Length: 50000&lt;&#x2F;code&gt;&lt;&#x2F;td&gt;&lt;td&gt;ç­‰å¾… 30s+ æ— æ•°æ® â†’ è¶…æ—¶æ–­å¼€&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;æµå¼&lt;&#x2F;strong&gt;&lt;&#x2F;td&gt;&lt;td&gt;åˆ†å—æŒç»­å‘é€&lt;&#x2F;td&gt;&lt;td&gt;&lt;code&gt;Transfer-Encoding: chunked&lt;&#x2F;code&gt;&lt;&#x2F;td&gt;&lt;td&gt;æŒç»­æ”¶åˆ°æ•°æ® â†’ ä¿æŒè¿æ¥&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;h2 id=&quot;xiu-fu-fang-an&quot;&gt;ä¿®å¤æ–¹æ¡ˆ&lt;&#x2F;h2&gt;
&lt;p&gt;ä¿®æ”¹ &lt;code&gt;llm_provider.py&lt;&#x2F;code&gt;ï¼Œå°† DeepSeek API è°ƒç”¨æ”¹ä¸ºæµå¼æ¨¡å¼ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;async def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;_complete_deepseek_direct&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;system_prompt&lt;&#x2F;span&gt;&lt;span&gt;: str,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;user_prompt&lt;&#x2F;span&gt;&lt;span&gt;: str,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;max_retries&lt;&#x2F;span&gt;&lt;span&gt;: int = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;timeout&lt;&#x2F;span&gt;&lt;span&gt;: int = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;600
&lt;&#x2F;span&gt;&lt;span&gt;) -&amp;gt; str:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&amp;quot;&amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    ç›´æ¥è°ƒç”¨ DeepSeek å®˜æ–¹ APIï¼ˆä½¿ç”¨æµå¼ä¼ è¾“ï¼‰
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    ä¸ºä»€ä¹ˆä½¿ç”¨ stream=True:
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    ---------------------
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    é—®é¢˜: éæµå¼æ¨¡å¼åœ¨å¤§å“åº”(~4K+å­—ç¬¦)æ—¶å‡ºç° TransferEncodingError
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    æ ¹æœ¬åŸå› åˆ†æ:
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    1. éæµå¼æ¨¡å¼ä½¿ç”¨ Content-Length å¤´ï¼Œå£°æ˜å®Œæ•´å“åº”å¤§å°
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    2. å¤§å“åº”ç”Ÿæˆéœ€è¦30ç§’+ï¼Œæ­¤æœŸé—´ HTTP è¿æ¥å¤„äº&amp;quot;ç­‰å¾…&amp;quot;çŠ¶æ€
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    3. ä¸­é—´ä»£ç†&#x2F;CDN è®¾æœ‰ç©ºé—²è¶…æ—¶é™åˆ¶ï¼Œä¼šåœ¨30-60ç§’åæ–­å¼€è¿æ¥
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    4. è¿æ¥æ–­å¼€å¯¼è‡´å®é™…æ”¶åˆ°çš„æ•°æ®å°‘äº Content-Length å£°æ˜çš„é•¿åº¦
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    5. aiohttp æ£€æµ‹åˆ°ä¸ä¸€è‡´ï¼ŒæŠ›å‡º TransferEncodingError
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    è§£å†³æ–¹æ¡ˆ:
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    - æµå¼æ¨¡å¼ä½¿ç”¨ Transfer-Encoding: chunkedï¼Œæ²¡æœ‰ Content-Length
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    - è¾¹ç”Ÿæˆè¾¹å‘é€ï¼Œæ¯ä¸ª chunk éƒ½å¾ˆå°(~100 bytes)ï¼Œå¿«é€Ÿä¼ è¾“
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    - ä¸­é—´ä»£ç†çœ‹åˆ°æŒç»­çš„æ•°æ®æµåŠ¨ï¼Œä¸ä¼šè§¦å‘è¶…æ—¶
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    æ³¨æ„: è¿™ä¸ 8K token é™åˆ¶æ— å…³ã€‚æµå¼ä¸æ”¹å˜ token é™åˆ¶ï¼Œ
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;          å®ƒåªæ”¹å˜äº† HTTP ä¼ è¾“æ–¹å¼ï¼Œé¿å…ä¸­é—´ä»£ç†è¶…æ—¶é—®é¢˜ã€‚
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    payload = {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;model&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;deepseek-chat&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;messages&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [
&lt;&#x2F;span&gt;&lt;span&gt;            {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;role&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;system&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;content&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: system_prompt},
&lt;&#x2F;span&gt;&lt;span&gt;            {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;role&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;user&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;content&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: user_prompt}
&lt;&#x2F;span&gt;&lt;span&gt;        ],
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;max_tokens&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.config.max_tokens,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;temperature&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.config.temperature,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;stream&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;True&lt;&#x2F;span&gt;&lt;span&gt;,  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ğŸ”‘ å¯ç”¨æµå¼ä¼ è¾“
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;async with &lt;&#x2F;span&gt;&lt;span&gt;aiohttp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ClientSession&lt;&#x2F;span&gt;&lt;span&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span&gt;session:
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;async with &lt;&#x2F;span&gt;&lt;span&gt;session.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;post&lt;&#x2F;span&gt;&lt;span&gt;(url, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;headers&lt;&#x2F;span&gt;&lt;span&gt;=headers, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;json&lt;&#x2F;span&gt;&lt;span&gt;=payload) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span&gt;response:
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# æµå¼è¯»å–å¹¶æ‹¼æ¥ç»“æœ
&lt;&#x2F;span&gt;&lt;span&gt;            result_chunks = []
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;async for &lt;&#x2F;span&gt;&lt;span&gt;line &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;in &lt;&#x2F;span&gt;&lt;span&gt;response.content:
&lt;&#x2F;span&gt;&lt;span&gt;                line = line.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;decode&lt;&#x2F;span&gt;&lt;span&gt;(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;utf-8&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;strip&lt;&#x2F;span&gt;&lt;span&gt;()
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;line.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;startswith&lt;&#x2F;span&gt;&lt;span&gt;(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;data: &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;):
&lt;&#x2F;span&gt;&lt;span&gt;                    data_str = line[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;6&lt;&#x2F;span&gt;&lt;span&gt;:]
&lt;&#x2F;span&gt;&lt;span&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;data_str == &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;[DONE]&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;:
&lt;&#x2F;span&gt;&lt;span&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break
&lt;&#x2F;span&gt;&lt;span&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try&lt;&#x2F;span&gt;&lt;span&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;                        data = json.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;loads&lt;&#x2F;span&gt;&lt;span&gt;(data_str)
&lt;&#x2F;span&gt;&lt;span&gt;                        content = data[&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;choices&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;][&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;].&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;delta&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, {}).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;content&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&amp;#39;)
&lt;&#x2F;span&gt;&lt;span&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;content:
&lt;&#x2F;span&gt;&lt;span&gt;                            result_chunks.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;append&lt;&#x2F;span&gt;&lt;span&gt;(content)
&lt;&#x2F;span&gt;&lt;span&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;except &lt;&#x2F;span&gt;&lt;span&gt;json.JSONDecodeError:
&lt;&#x2F;span&gt;&lt;span&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;continue  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# SSE åè®®ä¸­çš„ç©ºè¡Œæˆ–ä¸å®Œæ•´è¡Œï¼Œæ­£å¸¸è·³è¿‡
&lt;&#x2F;span&gt;&lt;span&gt;            
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&amp;#39;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span&gt;(result_chunks)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;xiu-fu-yan-zheng&quot;&gt;ä¿®å¤éªŒè¯&lt;&#x2F;h2&gt;
&lt;p&gt;ä¿®å¤åé‡æ–°è¿è¡Œç¿»è¯‘å®éªŒï¼š&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;============================================================
&lt;&#x2F;span&gt;&lt;span&gt;E14 AV1 ç¿»è¯‘å®éªŒç»“æœ
&lt;&#x2F;span&gt;&lt;span&gt;============================================================
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;é…ç½®: A1_fixed_only
&lt;&#x2F;span&gt;&lt;span&gt;  æºæ–‡æœ¬: 20,000 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;  è¯‘æ–‡: 46,755 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;  æ‰©å±•æ¯”: 233.8%
&lt;&#x2F;span&gt;&lt;span&gt;  æœ¯è¯­è¦†ç›–ç‡: 65.4%
&lt;&#x2F;span&gt;&lt;span&gt;  è€—æ—¶: 366.6s
&lt;&#x2F;span&gt;&lt;span&gt;  âœ… æˆåŠŸ
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;é…ç½®: A2_section_only
&lt;&#x2F;span&gt;&lt;span&gt;  æºæ–‡æœ¬: 20,000 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;  è¯‘æ–‡: 47,062 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;  æ‰©å±•æ¯”: 235.3%
&lt;&#x2F;span&gt;&lt;span&gt;  æœ¯è¯­è¦†ç›–ç‡: 66.1%
&lt;&#x2F;span&gt;&lt;span&gt;  è€—æ—¶: 365.1s
&lt;&#x2F;span&gt;&lt;span&gt;  âœ… æˆåŠŸ
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;é…ç½®: A4_full (ContextWeave)
&lt;&#x2F;span&gt;&lt;span&gt;  æºæ–‡æœ¬: 20,000 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;  è¯‘æ–‡: 47,736 å­—ç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;  æ‰©å±•æ¯”: 238.7%
&lt;&#x2F;span&gt;&lt;span&gt;  æœ¯è¯­è¦†ç›–ç‡: 65.4%
&lt;&#x2F;span&gt;&lt;span&gt;  è€—æ—¶: 672.0s
&lt;&#x2F;span&gt;&lt;span&gt;  âœ… æˆåŠŸ
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;æ‰€æœ‰é…ç½®éƒ½æˆåŠŸå®Œæˆï¼ç¿»è¯‘è´¨é‡å’Œå®Œæ•´æ€§ä¹Ÿç»è¿‡éªŒè¯ï¼Œæ²¡æœ‰å†…å®¹ä¸¢å¤±ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;jing-yan-zong-jie&quot;&gt;ç»éªŒæ€»ç»“&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;1-cuo-wu-xin-xi-ke-neng-ju-you-wu-dao-xing&quot;&gt;1. é”™è¯¯ä¿¡æ¯å¯èƒ½å…·æœ‰è¯¯å¯¼æ€§&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;code&gt;TransferEncodingError&lt;&#x2F;code&gt; çœ‹èµ·æ¥åƒæ˜¯å®¢æˆ·ç«¯çš„é—®é¢˜ï¼Œä½†æ ¹å› åœ¨ç½‘ç»œä¼ è¾“å±‚ã€‚ä¸è¦è¢«é”™è¯¯ä¿¡æ¯çš„è¡¨é¢å«ä¹‰è¯¯å¯¼ã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;2-http-xie-yi-xi-jie-hen-zhong-yao&quot;&gt;2. HTTP åè®®ç»†èŠ‚å¾ˆé‡è¦&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Content-Length&lt;&#x2F;code&gt; vs &lt;code&gt;Transfer-Encoding: chunked&lt;&#x2F;code&gt; æ˜¯ä¸¤ç§å®Œå…¨ä¸åŒçš„ä¼ è¾“æ–¹å¼&lt;&#x2F;li&gt;
&lt;li&gt;å‰è€…éœ€è¦é¢„å…ˆçŸ¥é“å®Œæ•´å“åº”å¤§å°ï¼Œåè€…æ”¯æŒè¾¹ç”Ÿæˆè¾¹å‘é€&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨æ¶‰åŠ CDNã€ä»£ç†çš„åœºæ™¯ä¸‹ï¼Œè¿™ä¸ªåŒºåˆ«å¯èƒ½å¯¼è‡´å®Œå…¨ä¸åŒçš„ç»“æœ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;3-liu-shi-chuan-shu-bu-jin-jin-shi-ux-you-hua&quot;&gt;3. æµå¼ä¼ è¾“ä¸ä»…ä»…æ˜¯ UX ä¼˜åŒ–&lt;&#x2F;h3&gt;
&lt;p&gt;å¾ˆå¤šäººè®¤ä¸ºæµå¼ä¼ è¾“åªæ˜¯ä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰ã€‚ä½†åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæµå¼ä¼ è¾“æ˜¯&lt;strong&gt;åŠŸèƒ½æ€§å¿…éœ€&lt;&#x2F;strong&gt;â€”â€”æ²¡æœ‰å®ƒï¼Œå¤§å“åº”æ ¹æœ¬æ— æ³•å®Œæ•´ä¼ è¾“ã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;4-zhong-jian-dai-li-wu-chu-bu-zai&quot;&gt;4. ä¸­é—´ä»£ç†æ— å¤„ä¸åœ¨&lt;&#x2F;h3&gt;
&lt;p&gt;ä½ çš„è¯·æ±‚å¯èƒ½ç»è¿‡ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å®¶åº­è·¯ç”±å™¨&lt;&#x2F;li&gt;
&lt;li&gt;è¿è¥å•†é€æ˜ä»£ç†&lt;&#x2F;li&gt;
&lt;li&gt;å›½é™…å‡ºå£ç½‘å…³&lt;&#x2F;li&gt;
&lt;li&gt;CDN èŠ‚ç‚¹ï¼ˆæœ¬æ¡ˆä¾‹ä¸­çš„ CloudFrontï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ç›®æ ‡æœåŠ¡å™¨å‰çš„è´Ÿè½½å‡è¡¡å™¨&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ä»»ä½•ä¸€ä¸ªç¯èŠ‚éƒ½å¯èƒ½æœ‰è‡ªå·±çš„è¶…æ—¶ç­–ç•¥ã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;5-zhen-duan-jiao-ben-de-jie-zhi&quot;&gt;5. è¯Šæ–­è„šæœ¬çš„ä»·å€¼&lt;&#x2F;h3&gt;
&lt;p&gt;ç¼–å†™ä¸“é—¨çš„è¯Šæ–­è„šæœ¬ï¼Œé€æ­¥ç¼©å°é—®é¢˜èŒƒå›´ï¼Œæ¯”ç›²ç›®çŒœæµ‹é«˜æ•ˆå¾—å¤šã€‚è¿™æ¬¡çš„è¯Šæ–­è„šæœ¬å¸®æˆ‘åœ¨ 30 åˆ†é’Ÿå†…å®šä½äº†æ ¹å› ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;fu-lu-zhen-duan-jiao-ben-wan-zheng-dai-ma&quot;&gt;é™„å½•ï¼šè¯Šæ–­è„šæœ¬å®Œæ•´ä»£ç &lt;&#x2F;h2&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿å…¶ä»–é‡åˆ°ç±»ä¼¼é—®é¢˜çš„å¼€å‘è€…ï¼Œæˆ‘å°†è¯Šæ–­è„šæœ¬å¼€æºåœ¨ï¼š&lt;&#x2F;p&gt;
&lt;p&gt;ğŸ“ &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Polly2014&#x2F;Master-Translator-MCP-Server&#x2F;blob&#x2F;main&#x2F;diagnose_deepseek_api.py&quot;&gt;diagnose_deepseek_api.py&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©é‡åˆ°ç±»ä¼¼é—®é¢˜çš„ä½ èŠ‚çœè°ƒè¯•æ—¶é—´ã€‚&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;&lt;em&gt;å¦‚æœä½ åœ¨ä½¿ç”¨ DeepSeek API æˆ–å…¶ä»– LLM API æ—¶é‡åˆ°äº†ç±»ä¼¼çš„é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç»éªŒï¼&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
</content>
        
    </entry>
</feed>
