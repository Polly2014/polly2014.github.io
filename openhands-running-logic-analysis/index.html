<!doctype html><html><head><title>OpenHands 运行流程分析：杭州三天旅游案例</title><meta content="通过一个杭州三天旅游规划案例，深入分析OpenHands基于Agent Hub的端到端智能编码平台的运行流程和架构设计。" name=description><meta content="Polly, Blog, AI Blog, AI Assistant, Tutorials, Technology Blog, Baoli Wang" name=keywords><meta content="width=device-width,initial-scale=1" name=viewport><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content=article property=og:type><meta content=https://polly.wang/openhands-running-logic-analysis/ property=og:url><meta content="OpenHands 运行流程分析：杭州三天旅游案例" property=og:title><meta content="通过一个杭州三天旅游规划案例，深入分析OpenHands基于Agent Hub的端到端智能编码平台的运行流程和架构设计。" property=og:description><meta content=https://polly.wang/images/polly.png property=og:image><meta content="Polly Blog" property=og:site_name><meta content=zh_CN property=og:locale><meta content=summary_large_image name=twitter:card><meta content=https://polly.wang/openhands-running-logic-analysis/ name=twitter:url><meta content="OpenHands 运行流程分析：杭州三天旅游案例" name=twitter:title><meta content="通过一个杭州三天旅游规划案例，深入分析OpenHands基于Agent Hub的端到端智能编码平台的运行流程和架构设计。" name=twitter:description><meta content=https://polly.wang/images/polly.png name=twitter:image><meta content=2025-04-11T00:00:00 property=article:published_time><meta content=Polly property=article:author><meta content=OpenHands property=article:tag><meta content=AI助手 property=article:tag><meta content=Agent架构 property=article:tag><meta content=事件驱动 property=article:tag><meta content=系统分析 property=article:tag><meta content=AI应用 property=article:tag><link rel="shortcut icon" href=https://polly.wang/images/polly.ico type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=icon type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=apple-touch-icon><link href=https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css rel=stylesheet><link href=https://polly.wang/css/style_new.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-8JD13N7PHS" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-8JD13N7PHS';);</script><body><div class=menu-toggle><img alt=Menu src=https://polly.wang/images/polly.png></div><div class=overlay></div><div class="pure-g container"><div class="sidebar pure-u-1 pure-u-md-1-5"><div class=title><a class=pure-menu-heading href=https://polly.wang> <img class="avatar pure-img-responsive" src=https://polly.wang/images/polly.png> </a><div class=introduction><p>Polly's Blog</div><div class=nav><ul class=nav-links><li><a href=https://polly.wang><i class="fas fa-home"></i>Home</a><li><a href=https://polly.wang/archive><i class="fas fa-archive"></i>Archive</a><li><a href=https://polly.wang/category><i class="fas fa-folder"></i>Category</a><li><a href=https://polly.wang/blog><i class="fas fa-file-alt"></i>Posts</a><li><a href=https://polly.wang/cfp><i class="fas fa-calendar-alt"></i>CFP</a><li><a href=https://polly.wang/publication><i class="fas fa-file-pdf"></i>Research</a><li><a href=https://polly.wang/changelog><i class="fas fa-history"></i>Change log</a><li><a href=https://polly.wang/about><i class="fas fa-info-circle"></i>About Me</a></ul></div><div class=social><ul class=social-links><li><a href=mailto:26716201@qq.com><i class="fas fa-envelope"></i></a><li><a href=https://twitter.com/Polly__007><i class="fab fa-twitter"></i></a><li><a href=https://www.linkedin.com/in/baoliwang><i class="fab fa-linkedin-in"></i></a><li><a href=https://github.com/Polly2014><i class="fab fa-github"></i></a></ul></div></div></div><div class="content pure-u-1 pure-u-md-4-5"><div class=blog-post><h1>OpenHands 运行流程分析：杭州三天旅游案例</h1><div class=content><h2 id=yi-zheng-ti-jia-gou-gai-shu>一、整体架构概述</h2><p>OpenHands 是一个基于 Agent Hub 的智能端到端编码平台，通过多个组件的协同工作来完成用户任务。从日志可以看出，系统主要包括以下核心部分：<ol><li><strong>会话管理器 (Conversation Manager)</strong>：负责创建、管理和跟踪对话<li><strong>代理控制器 (Agent Controller)</strong>：协调各组件的工作流程<li><strong>大模型组件 (LLM)</strong>：使用 Claude 3.7 Sonnet 进行核心推理<li><strong>运行时环境 (Runtime)</strong>：在 Docker 容器中提供安全的执行环境<li><strong>Agent工具集 (Agent Tools)</strong>：包括文件操作、命令执行等各种工具<li><strong>事件流系统 (Event Stream)</strong>：所有组件通过事件流进行通信</ol><details><summary>OpenHands执行流程日志 (点击展开)</summary> <h2 id=12-08-07-openhands-info-manage-conversations-py-148-initializing-new-conversation12-08-07-openhands-info-manage-conversations-py-54-creating-conversation12-08-07-openhands-info-manage-conversations-py-58-loading-settings12-08-07-openhands-info-manage-conversations-py-61-settings-loaded12-08-07-openhands-info-manage-conversations-py-85-loading-conversation-store12-08-07-openhands-info-manage-conversations-py-87-conversation-store-loaded12-08-07-openhands-info-manage-conversations-py-93-new-conversation-id-740715d40a3c4be385b644a20b0fdfaf12-08-07-openhands-info-manage-conversations-py-103-saving-metadata-for-conversation-740715d40a3c4be385b644a20b0fdfaf12-08-07-openhands-info-manage-conversations-py-115-starting-agent-loop-for-conversation-740715d40a3c4be385b644a20b0fdfaf12-08-07-openhands-info-standalone-conversation-manager-py-259-maybe-start-agent-loop-740715d40a3c4be385b644a20b0fdfaf12-08-07-openhands-info-standalone-conversation-manager-py-262-start-agent-loop-740715d40a3c4be385b644a20b0fdfaf12-08-07-openhands-debug-stream-py-96-no-events-found-for-session-740715d40a3c4be385b644a20b0fdfaf12-08-07-openhands-info-standalone-conversation-manager-py-312-get-event-stream-740715d40a3c4be385b644a20b0fdfaf12-08-07-openhands-info-standalone-conversation-manager-py-315-found-local-agent-loop-740715d40a3c4be385b644a20b0fdfaf12-08-07-openhands-info-manage-conversations-py-136-finished-initializing-conversation-740715d40a3c4be385b644a20b0fdfaf12-08-07-openhands-debug-stream-py-273-adding-agentstatechangedobservation-id-0-from-environment12-08-07-openhands-debug-llm-py-126-llm-model-has-vision-enabled12-08-07-openhands-debug-llm-py-128-llm-caching-prompt-enabled12-08-07-openhands-debug-llm-py-130-llm-model-supports-function-calling12-08-07-openhands-info-session-py-121-enabling-default-condenser-type-llm-llm-config-llmconfig-model-anthropic-claude-3-7-sonnet-20250219-api-key-base-url-none-api-version-none-aws-access-key-id-aws-secret-access-key-aws-region-name-none-openrouter-site-url-https-docs-all-hands-dev-openrouter-app-name-openhands-num-retries-4-retry-multiplier-2-retry-min-wait-5-retry-max-wait-30-timeout-none-max-message-chars-30000-temperature-0-0-top-p-1-0-custom-llm-provider-none-max-input-tokens-200000-max-output-tokens-64000-input-cost-per-token-none-output-cost-per-token-none-ollama-base-url-none-drop-params-true-modify-params-true-disable-vision-none-caching-prompt-true-log-completions-false-log-completions-folder-home-ubuntu-github-workspace-pro-agent-logs-completions-custom-tokenizer-none-native-tool-calling-none-reasoning-effort-high-keep-first-3-max-size-4012-08-07-openhands-debug-codeact-agent-py-75-tools-loaded-for-codeactagent-execute-bash-think-finish-web-read-browser-execute-ipython-cell-str-replace-editor12-08-07-openhands-debug-llm-py-385-model-info-key-claude-3-7-sonnet-20250219-max-tokens-128000-max-input-tokens-200000-max-output-tokens-128000-input-cost-per-token-3e-06-cache-creation-input-token-cost-3-75e-06-cache-read-input-token-cost-3e-07-input-cost-per-character-null-input-cost-per-token-above-128k-tokens-null-input-cost-per-query-null-input-cost-per-second-null-input-cost-per-audio-token-null-input-cost-per-token-batches-null-output-cost-per-token-batches-null-output-cost-per-token-1-5e-05-output-cost-per-audio-token-null-output-cost-per-character-null-output-cost-per-token-above-128k-tokens-null-output-cost-per-character-above-128k-tokens-null-output-cost-per-second-null-output-cost-per-image-null-output-vector-size-null-litellm-provider-anthropic-mode-chat-supports-system-messages-null-supports-response-schema-true-supports-vision-true-supports-function-calling-true-supports-tool-choice-true-supports-assistant-prefill-true-supports-prompt-caching-true-supports-audio-input-false-supports-audio-output-false-supports-pdf-input-true-supports-embedding-image-input-false-supports-native-streaming-null-tpm-null-rpm-null-supported-openai-params-stream-stop-temperature-top-p-max-tokens-max-completion-tokens-tools-tool-choice-extra-headers-parallel-tool-calls-response-format-user-thinking-12-08-07-openhands-debug-llm-py-126-llm-model-has-vision-enabled12-08-07-openhands-debug-llm-py-128-llm-caching-prompt-enabled12-08-07-openhands-debug-llm-py-130-llm-model-supports-function-calling12-08-07-openhands-debug-codeact-agent-py-86-using-condenser-class-openhands-memory-condenser-impl-llm-summarizing-condenser-llmsummarizingcondenser-12-08-07-openhands-warning-app-config-py-99-llm-config-group-gpt3-not-found-using-default-config12-08-07-openhands-debug-agent-session-py-232-initializing-runtime-docker-now-12-08-08-openhands-info-runtime-build-py-182-building-image-ghcr-io-all-hands-ai-runtime-oh-v0-29-1-05sp9yfx3qcxs36a-glqmvuuklhkqib9w12-08-08-openhands-debug-docker-py-254-checking-if-image-exists-locally-ghcr-io-all-hands-ai-runtime-oh-v0-29-1-05sp9yfx3qcxs36a-glqmvuuklhkqib9w12-08-08-openhands-debug-docker-py-256-image-found-locally-12-08-08-openhands-debug-runtime-build-py-211-reusing-image-ghcr-io-all-hands-ai-runtime-oh-v0-29-1-05sp9yfx3qcxs36a-glqmvuuklhkqib9w-12-08-08-openhands-info-docker-runtime-py-140-runtime-740715d40a3c4be385b644a20b0fdfaf-starting-runtime-with-image-ghcr-io-all-hands-ai-runtime-oh-v0-29-1-05sp9yfx3qcxs36a-glqmvuuklhkqib9w12-08-08-openhands-debug-docker-runtime-py-186-runtime-740715d40a3c4be385b644a20b0fdfaf-preparing-to-start-container-12-08-08-openhands-debug-docker-runtime-py-244-runtime-740715d40a3c4be385b644a20b0fdfaf-workspace-base-home-ubuntu-github-workspace-pro-agent-workspace12-08-08-openhands-debug-docker-runtime-py-256-mount-dir-home-ubuntu-github-workspace-pro-agent-workspace12-08-08-openhands-debug-docker-runtime-py-262-runtime-740715d40a3c4be385b644a20b0fdfaf-sandbox-workspace-workspace12-08-08-openhands-info-listen-socket-py-32-sio-connect-srjs3cbdfcdebgmoaaad12-08-08-openhands-info-standalone-conversation-manager-py-116-join-conversation-740715d40a3c4be385b644a20b0fdfaf-srjs3cbdfcdebgmoaaad12-08-08-openhands-info-standalone-conversation-manager-py-312-get-event-stream-740715d40a3c4be385b644a20b0fdfaf12-08-08-openhands-info-standalone-conversation-manager-py-315-found-local-agent-loop-740715d40a3c4be385b644a20b0fdfaf12-08-08-openhands-debug-docker-runtime-py-291-runtime-740715d40a3c4be385b644a20b0fdfaf-container-started-server-url-http-localhost-3995512-08-08-openhands-info-docker-runtime-py-144-runtime-740715d40a3c4be385b644a20b0fdfaf-container-started-openhands-runtime-740715d40a3c4be385b644a20b0fdfaf-vscode-url-none12-08-08-openhands-info-docker-runtime-py-155-runtime-740715d40a3c4be385b644a20b0fdfaf-waiting-for-client-to-become-ready-at-http-localhost-39955-12-08-38-openhands-info-docker-runtime-py-161-runtime-740715d40a3c4be385b644a20b0fdfaf-runtime-is-ready-12-08-38-openhands-debug-base-py-141-adding-env-vars-dict-keys-12-08-38-openhands-debug-base-py-183-added-env-vars-to-ipython12-08-38-openhands-debug-docker-runtime-py-166-runtime-740715d40a3c4be385b644a20b0fdfaf-container-initialized-with-plugins-agent-skills-jupyter-vscode-vscode-url-none12-08-38-openhands-debug-agent-session-py-281-runtime-initialized-with-plugins-agent-skills-jupyter-vscode-12-08-38-openhands-debug-agent-session-py-325-openhands-configuration-llm-anthropic-claude-3-7-sonnet-20250219base-url-noneagent-codeactagentruntime-dockerruntimeplugins-agentskillsrequirement-name-agent-skills-documentation-open-file-path-str-line-number-int-none-1-context-lines-int-none-100-none-n-opens-a-file-in-the-editor-and-optionally-positions-at-a-specific-line-n-the-function-displays-a-limited-window-of-content-centered-around-the-specified-line-n-number-if-provided-to-view-the-complete-file-content-the-agent-should-use-scroll-down-and-scroll-up-n-commands-iteratively-n-args-n-path-the-path-to-the-file-to-open-absolute-path-is-recommended-n-line-number-the-target-line-number-to-center-the-view-on-if-possible-n-defaults-to-1-n-context-lines-maximum-number-of-lines-to-display-in-the-view-window-n-limited-to-100-lines-defaults-to-100-n-ngoto-line-line-number-int-none-n-moves-the-window-to-show-the-specified-line-number-n-args-n-line-number-int-the-line-number-to-move-to-n-nscroll-down-none-n-moves-the-window-down-by-100-lines-n-args-n-none-n-nscroll-up-none-n-moves-the-window-up-by-100-lines-n-args-n-none-n-nsearch-dir-search-term-str-dir-path-str-none-n-searches-for-search-term-in-all-files-in-dir-if-dir-is-not-provided-searches-in-the-current-directory-n-args-n-search-term-str-the-term-to-search-for-n-dir-path-str-the-path-to-the-directory-to-search-n-nsearch-file-search-term-str-file-path-str-none-none-none-n-searches-for-search-term-in-file-if-file-is-not-provided-searches-in-the-current-open-file-n-args-n-search-term-the-term-to-search-for-n-file-path-the-path-to-the-file-to-search-n-nfind-file-file-name-str-dir-path-str-none-n-finds-all-files-with-the-given-name-in-the-specified-directory-n-args-n-file-name-str-the-name-of-the-file-to-find-n-dir-path-str-the-path-to-the-directory-to-search-n-nparse-pdf-file-path-str-none-n-parses-the-content-of-a-pdf-file-and-prints-it-n-args-n-file-path-str-the-path-to-the-file-to-open-n-nparse-docx-file-path-str-none-n-parses-the-content-of-a-docx-file-and-prints-it-n-args-n-file-path-str-the-path-to-the-file-to-open-n-nparse-latex-file-path-str-none-n-parses-the-content-of-a-latex-file-and-prints-it-n-args-n-file-path-str-the-path-to-the-file-to-open-n-nparse-pptx-file-path-str-none-n-parses-the-content-of-a-pptx-file-and-prints-it-n-args-n-file-path-str-the-path-to-the-file-to-open-n-n-jupyterrequirement-name-jupyter>12:08:07 - openhands:INFO: manage_conversations.py:148 - Initializing new conversation 12:08:07 - openhands:INFO: manage_conversations.py:54 - Creating conversation 12:08:07 - openhands:INFO: manage_conversations.py:58 - Loading settings 12:08:07 - openhands:INFO: manage_conversations.py:61 - Settings loaded 12:08:07 - openhands:INFO: manage_conversations.py:85 - Loading conversation store 12:08:07 - openhands:INFO: manage_conversations.py:87 - Conversation store loaded 12:08:07 - openhands:INFO: manage_conversations.py:93 - New conversation ID: 740715d40a3c4be385b644a20b0fdfaf 12:08:07 - openhands:INFO: manage_conversations.py:103 - Saving metadata for conversation 740715d40a3c4be385b644a20b0fdfaf 12:08:07 - openhands:INFO: manage_conversations.py:115 - Starting agent loop for conversation 740715d40a3c4be385b644a20b0fdfaf 12:08:07 - openhands:INFO: standalone_conversation_manager.py:259 - maybe_start_agent_loop:740715d40a3c4be385b644a20b0fdfaf 12:08:07 - openhands:INFO: standalone_conversation_manager.py:262 - start_agent_loop:740715d40a3c4be385b644a20b0fdfaf 12:08:07 - openhands:DEBUG: stream.py:96 - No events found for session 740715d40a3c4be385b644a20b0fdfaf 12:08:07 - openhands:INFO: standalone_conversation_manager.py:312 - _get_event_stream:740715d40a3c4be385b644a20b0fdfaf 12:08:07 - openhands:INFO: standalone_conversation_manager.py:315 - found_local_agent_loop:740715d40a3c4be385b644a20b0fdfaf 12:08:07 - openhands:INFO: manage_conversations.py:136 - Finished initializing conversation 740715d40a3c4be385b644a20b0fdfaf 12:08:07 - openhands:DEBUG: stream.py:273 - Adding AgentStateChangedObservation id=0 from ENVIRONMENT 12:08:07 - openhands:DEBUG: llm.py:126 - LLM: model has vision enabled 12:08:07 - openhands:DEBUG: llm.py:128 - LLM: caching prompt enabled 12:08:07 - openhands:DEBUG: llm.py:130 - LLM: model supports function calling 12:08:07 - openhands:INFO: session.py:121 - Enabling default condenser: type='llm' llm_config=LLMConfig(model='anthropic/claude-3-7-sonnet-20250219', api_key='<strong><strong><strong>'('</strong></strong></strong><strong><strong>'), base_url=None, api_version=None, aws_access_key_id='</strong></strong><strong>', aws_secret_access_key='</strong>****', aws_region_name=None, openrouter_site_url='https://docs.all-hands.dev/', openrouter_app_name='OpenHands', num_retries=4, retry_multiplier=2, retry_min_wait=5, retry_max_wait=30, timeout=None, max_message_chars=30000, temperature=0.0, top_p=1.0, custom_llm_provider=None, max_input_tokens=200000, max_output_tokens=64000, input_cost_per_token=None, output_cost_per_token=None, ollama_base_url=None, drop_params=True, modify_params=True, disable_vision=None, caching_prompt=True, log_completions=False, log_completions_folder='/home/ubuntu/GitHub_Workspace/pro-agent/logs/completions', custom_tokenizer=None, native_tool_calling=None, reasoning_effort='high') keep_first=3 max_size=40 12:08:07 - openhands:DEBUG: codeact_agent.py:75 - TOOLS loaded for CodeActAgent: execute_bash, think, finish, web_read, browser, execute_ipython_cell, str_replace_editor 12:08:07 - openhands:DEBUG: llm.py:385 - Model info: { "key": "claude-3-7-sonnet-20250219", "max_tokens": 128000, "max_input_tokens": 200000, "max_output_tokens": 128000, "input_cost_per_token": 3e-06, "cache_creation_input_token_cost": 3.75e-06, "cache_read_input_token_cost": 3e-07, "input_cost_per_character": null, "input_cost_per_token_above_128k_tokens": null, "input_cost_per_query": null, "input_cost_per_second": null, "input_cost_per_audio_token": null, "input_cost_per_token_batches": null, "output_cost_per_token_batches": null, "output_cost_per_token": 1.5e-05, "output_cost_per_audio_token": null, "output_cost_per_character": null, "output_cost_per_token_above_128k_tokens": null, "output_cost_per_character_above_128k_tokens": null, "output_cost_per_second": null, "output_cost_per_image": null, "output_vector_size": null, "litellm_provider": "anthropic", "mode": "chat", "supports_system_messages": null, "supports_response_schema": true, "supports_vision": true, "supports_function_calling": true, "supports_tool_choice": true, "supports_assistant_prefill": true, "supports_prompt_caching": true, "supports_audio_input": false, "supports_audio_output": false, "supports_pdf_input": true, "supports_embedding_image_input": false, "supports_native_streaming": null, "tpm": null, "rpm": null, "supported_openai_params": [ "stream", "stop", "temperature", "top_p", "max_tokens", "max_completion_tokens", "tools", "tool_choice", "extra_headers", "parallel_tool_calls", "response_format", "user", "thinking" ] } 12:08:07 - openhands:DEBUG: llm.py:126 - LLM: model has vision enabled 12:08:07 - openhands:DEBUG: llm.py:128 - LLM: caching prompt enabled 12:08:07 - openhands:DEBUG: llm.py:130 - LLM: model supports function calling 12:08:07 - openhands:DEBUG: codeact_agent.py:86 - Using condenser: &LTclass 'openhands.memory.condenser.impl.llm_summarizing_condenser.LLMSummarizingCondenser'> 12:08:07 - openhands:WARNING: app_config.py:99 - llm config group gpt3 not found, using default config 12:08:07 - openhands:DEBUG: agent_session.py:232 - Initializing runtime <code>docker</code> now... 12:08:08 - openhands:INFO: runtime_build.py:182 - Building image: ghcr.io/all-hands-ai/runtime:oh_v0.29.1_05sp9yfx3qcxs36a_glqmvuuklhkqib9w 12:08:08 - openhands:DEBUG: docker.py:254 - Checking, if image exists locally: ghcr.io/all-hands-ai/runtime:oh_v0.29.1_05sp9yfx3qcxs36a_glqmvuuklhkqib9w 12:08:08 - openhands:DEBUG: docker.py:256 - Image found locally. 12:08:08 - openhands:DEBUG: runtime_build.py:211 - Reusing Image [ghcr.io/all-hands-ai/runtime:oh_v0.29.1_05sp9yfx3qcxs36a_glqmvuuklhkqib9w] 12:08:08 - openhands:INFO: docker_runtime.py:140 - [runtime 740715d40a3c4be385b644a20b0fdfaf] Starting runtime with image: ghcr.io/all-hands-ai/runtime:oh_v0.29.1_05sp9yfx3qcxs36a_glqmvuuklhkqib9w 12:08:08 - openhands:DEBUG: docker_runtime.py:186 - [runtime 740715d40a3c4be385b644a20b0fdfaf] Preparing to start container... 12:08:08 - openhands:DEBUG: docker_runtime.py:244 - [runtime 740715d40a3c4be385b644a20b0fdfaf] Workspace Base: /home/ubuntu/GitHub_Workspace/pro-agent/workspace 12:08:08 - openhands:DEBUG: docker_runtime.py:256 - Mount dir: /home/ubuntu/GitHub_Workspace/pro-agent/workspace 12:08:08 - openhands:DEBUG: docker_runtime.py:262 - [runtime 740715d40a3c4be385b644a20b0fdfaf] Sandbox workspace: /workspace 12:08:08 - openhands:INFO: listen_socket.py:32 - sio:connect: SRJs3cbDFCDEbGmoAAAD 12:08:08 - openhands:INFO: standalone_conversation_manager.py:116 - join_conversation:740715d40a3c4be385b644a20b0fdfaf:SRJs3cbDFCDEbGmoAAAD 12:08:08 - openhands:INFO: standalone_conversation_manager.py:312 - _get_event_stream:740715d40a3c4be385b644a20b0fdfaf 12:08:08 - openhands:INFO: standalone_conversation_manager.py:315 - found_local_agent_loop:740715d40a3c4be385b644a20b0fdfaf 12:08:08 - openhands:DEBUG: docker_runtime.py:291 - [runtime 740715d40a3c4be385b644a20b0fdfaf] Container started. Server url: http://localhost:39955 12:08:08 - openhands:INFO: docker_runtime.py:144 - [runtime 740715d40a3c4be385b644a20b0fdfaf] Container started: openhands-runtime-740715d40a3c4be385b644a20b0fdfaf. VSCode URL: None 12:08:08 - openhands:INFO: docker_runtime.py:155 - [runtime 740715d40a3c4be385b644a20b0fdfaf] Waiting for client to become ready at http://localhost:39955... 12:08:38 - openhands:INFO: docker_runtime.py:161 - [runtime 740715d40a3c4be385b644a20b0fdfaf] Runtime is ready. 12:08:38 - openhands:DEBUG: base.py:141 - Adding env vars: dict_keys([]) 12:08:38 - openhands:DEBUG: base.py:183 - Added env vars to IPython 12:08:38 - openhands:DEBUG: docker_runtime.py:166 - [runtime 740715d40a3c4be385b644a20b0fdfaf] Container initialized with plugins: ['agent_skills', 'jupyter', 'vscode']. VSCode URL: None 12:08:38 - openhands:DEBUG: agent_session.py:281 - Runtime initialized with plugins: ['agent_skills', 'jupyter', 'vscode'] 12:08:38 - openhands:DEBUG: agent_session.py:325 - --------------------------------- OpenHands Configuration --------------------------------- LLM: anthropic/claude-3-7-sonnet-20250219 Base URL: None Agent: CodeActAgent Runtime: DockerRuntime Plugins: [AgentSkillsRequirement(name='agent_skills', documentation="open_file(path: str, line_number: int | None = 1, context_lines: int | None = 100) -> None:\n Opens a file in the editor and optionally positions at a specific line.\n The function displays a limited window of content, centered around the specified line\n number if provided. To view the complete file content, the agent should use scroll_down and scroll_up\n commands iteratively.\n Args:\n path: The path to the file to open. Absolute path is recommended.\n line_number: The target line number to center the view on (if possible).\n Defaults to 1.\n context_lines: Maximum number of lines to display in the view window.\n Limited to 100 lines. Defaults to 100.\n\ngoto_line(line_number: int) -> None:\n Moves the window to show the specified line number.\n Args:\n line_number: int: The line number to move to.\n\nscroll_down() -> None:\n Moves the window down by 100 lines.\n Args:\n None\n\nscroll_up() -> None:\n Moves the window up by 100 lines.\n Args:\n None\n\nsearch_dir(search_term: str, dir_path: str = './') -> None:\n Searches for search_term in all files in dir. If dir is not provided, searches in the current directory.\n Args:\n search_term: str: The term to search for.\n dir_path: str: The path to the directory to search.\n\nsearch_file(search_term: str, file_path: str | None = None) -> None:\n Searches for search_term in file. If file is not provided, searches in the current open file.\n Args:\n search_term: The term to search for.\n file_path: The path to the file to search.\n\nfind_file(file_name: str, dir_path: str = './') -> None:\n Finds all files with the given name in the specified directory.\n Args:\n file_name: str: The name of the file to find.\n dir_path: str: The path to the directory to search.\n\nparse_pdf(file_path: str) -> None:\n Parses the content of a PDF file and prints it.\n Args:\n file_path: str: The path to the file to open.\n\nparse_docx(file_path: str) -> None:\n Parses the content of a DOCX file and prints it.\n Args:\n file_path: str: The path to the file to open.\n\nparse_latex(file_path: str) -> None:\n Parses the content of a LaTex file and prints it.\n Args:\n file_path: str: The path to the file to open.\n\nparse_pptx(file_path: str) -> None:\n Parses the content of a pptx file and prints it.\n Args:\n file_path: str: The path to the file to open.\n\n"), JupyterRequirement(name='jupyter')]</h2> <p>12:08:38 - openhands:DEBUG: state.py:122 - Could not restore state from session: [Errno 2] No such file or directory: '/tmp/openhands_file_store/sessions/740715d40a3c4be385b644a20b0fdfaf/agent_state.pkl' 12:08:38 - openhands:DEBUG: agent_session.py:381 - No events found, no state to restore 12:08:38 - openhands:DEBUG: agent_controller.py:881 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] AgentController 740715d40a3c4be385b644a20b0fdfaf - created new state. start_id: 0 12:08:38 - openhands:DEBUG: microagent.py:152 - Loading agents from /home/ubuntu/GitHub_Workspace/pro-agent/microagents 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/README.md... 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/tasks/update_test_for_new_implementation.md... 12:08:38 - openhands:DEBUG: microagent.py:167 - Loaded agent update_test_for_new_implementation from /home/ubuntu/GitHub_Workspace/pro-agent/microagents/tasks/update_test_for_new_implementation.md 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/tasks/get_test_to_pass.md... 12:08:38 - openhands:DEBUG: microagent.py:167 - Loaded agent get_test_to_pass from /home/ubuntu/GitHub_Workspace/pro-agent/microagents/tasks/get_test_to_pass.md 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/tasks/add_openhands_repo_instruction.md... 12:08:38 - openhands:DEBUG: microagent.py:167 - Loaded agent add_openhands_repo_instruction from /home/ubuntu/GitHub_Workspace/pro-agent/microagents/tasks/add_openhands_repo_instruction.md 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/tasks/update_pr_description.md... 12:08:38 - openhands:DEBUG: microagent.py:167 - Loaded agent update_pr_description from /home/ubuntu/GitHub_Workspace/pro-agent/microagents/tasks/update_pr_description.md 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/tasks/address_pr_comments.md... 12:08:38 - openhands:DEBUG: microagent.py:167 - Loaded agent address_pr_comments from /home/ubuntu/GitHub_Workspace/pro-agent/microagents/tasks/address_pr_comments.md 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/docker.md... 12:08:38 - openhands:DEBUG: microagent.py:167 - Loaded agent docker from /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/docker.md 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/swift-linux.md... 12:08:38 - openhands:DEBUG: microagent.py:167 - Loaded agent swift-linux from /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/swift-linux.md 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/github.md... 12:08:38 - openhands:DEBUG: microagent.py:167 - Loaded agent github from /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/github.md 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/npm.md... 12:08:38 - openhands:DEBUG: microagent.py:167 - Loaded agent npm from /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/npm.md 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/kubernetes.md... 12:08:38 - openhands:DEBUG: microagent.py:167 - Loaded agent kubernetes from /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/kubernetes.md 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/add_agent.md... 12:08:38 - openhands:DEBUG: microagent.py:167 - Loaded agent add_agent from /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/add_agent.md 12:08:38 - openhands:DEBUG: microagent.py:155 - Checking file /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/flarglebargle.md... 12:08:38 - openhands:DEBUG: microagent.py:167 - Loaded agent flarglebargle from /home/ubuntu/GitHub_Workspace/pro-agent/microagents/knowledge/flarglebargle.md 12:08:38 - openhands:INFO: base.py:346 - [runtime 740715d40a3c4be385b644a20b0fdfaf] Selected repo: None, loading microagents from /workspace/.openhands/microagents (inside runtime) 12:08:38 - openhands:INFO: memory.py:233 - Loading user workspace microagents: [] 12:08:38 - openhands:DEBUG: stream.py:273 - Adding MessageAction id=1 from USER 12:08:38 - openhands:DEBUG: stream.py:273 - Adding ChangeAgentStateAction id=2 from ENVIRONMENT 12:08:38 - openhands:INFO: agent_session.py:161 - Agent session start 12:08:38 - openhands:DEBUG: agent_controller.py:441 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] <strong>MessageAction</strong> (source=EventSource.USER) CONTENT: 给我做一个杭州三天春游的规划，给我一个可访问的web让我看规划内容 12:08:38 - openhands:DEBUG: agent_controller.py:456 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] Extended max iterations to 500 after user message 12:08:38 - openhands:DEBUG: stream.py:273 - Adding RecallAction id=3 from USER 12:08:38 - openhands:INFO: agent_controller.py:520 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] Setting agent(CodeActAgent) state from AgentState.LOADING to AgentState.RUNNING 12:08:38 - openhands:DEBUG: stream.py:273 - Adding AgentStateChangedObservation id=4 from ENVIRONMENT 12:08:38 - openhands:DEBUG: memory.py:86 - Workspace context recall 12:08:38 - openhands:DEBUG: stream.py:273 - Adding RecallObservation id=5 from ENVIRONMENT 12:08:38 - openhands:INFO: agent_controller.py:520 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] Setting agent(CodeActAgent) state from AgentState.RUNNING to AgentState.RUNNING 12:08:38 - openhands:DEBUG: agent_controller.py:409 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] AgentStateChangedObservation(content='', agent_state='running', observation='agent_state_changed') 12:08:38 - openhands:DEBUG: agent_controller.py:409 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] <strong>RecallObservation</strong> recall_type=RecallType.WORKSPACE_CONTEXT, repo_name=, repo_instructions=..., runtime_hosts={'http://localhost:53941': 53941, 'http://localhost:56576': 56576}, additional_agent_instructions=... 12:08:38 - openhands:INFO: agent_controller.py:696 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] LEVEL 0 LOCAL STEP 0 GLOBAL STEP 0 12:08:38 - openhands:DEBUG: codeact_agent.py:171 - Processing 3 events from a total of 3 events 12:08:38 - openhands:DEBUG: conversation_memory.py:71 - Visual browsing: False 12:08:38 - openhands:DEBUG: logger.py:445 - Logging to /home/ubuntu/GitHub_Workspace/pro-agent/logs/llm/25-04-11_12-07/prompt_001.log 12:09:37 - openhands:DEBUG: logger.py:445 - Logging to /home/ubuntu/GitHub_Workspace/pro-agent/logs/llm/25-04-11_12-07/response_001.log 12:09:37 - openhands:DEBUG: llm.py:561 - Cost: 0.10 USD | Accumulated Cost: 0.10 USD Response Latency: 58.893 seconds Input tokens: 5411 | Output tokens: 4202 Input tokens (cache write): 5407</p> <p>12:09:37 - openhands:DEBUG: agent_controller.py:1171 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] Action metrics - accumulated_cost: 0.09953925, tokens (prompt/completion/cache_read/cache_write): 5411/4202/0/5407 12:09:37 - openhands:DEBUG: stream.py:273 - Adding FileEditAction id=6 from AGENT 12:09:37 - openhands:DEBUG: agent_controller.py:795 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] <strong>FileEditAction</strong> Path: [/tmp/hangzhou_trip_planner.py] Thought: 我将为您创建一个杭州三天春游的规划，并通过一个网页展示给您。我会使用Python的Flask框架来创建一个简单的网页应用。</p> <p>首先，让我创建一个包含杭州三天春游规划的网页应用： Command: create Created File with Text:</p> <pre style=background:#2b303b;color:#c0c5ce><code><span>from flask import Flask, render_template_string
</span><span>from flask_cors import CORS
</span><span>
</span><span>app = Flask(__name__)
</span><span>CORS(app)  # 启用CORS以允许跨域请求
</span><span>
</span><span># HTML模板
</span><span>HTML_TEMPLATE = """
</span><span>...//省略
</span><span>"""
</span><span>
</span><span>@app.route('/')
</span><span>def index():
</span><span>    return render_template_string(HTML_TEMPLATE)
</span><span>
</span><span>if __name__ == '__main__':
</span><span>    app.run(host='0.0.0.0', port=53941, debug=True)
</span></code></pre> <p>12:09:37 - openhands:DEBUG: stream.py:273 - Adding FileEditObservation id=7 from AGENT 12:09:37 - openhands:DEBUG: agent_controller.py:409 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] File created successfully at: /tmp/hangzhou_trip_planner.py 12:09:37 - openhands:INFO: agent_controller.py:696 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] LEVEL 0 LOCAL STEP 1 GLOBAL STEP 1 12:09:37 - openhands:DEBUG: codeact_agent.py:171 - Processing 5 events from a total of 5 events 12:09:37 - openhands:DEBUG: conversation_memory.py:71 - Visual browsing: False 12:09:37 - openhands:DEBUG: conversation_memory.py:207 - Tool calls type: &LTclass 'list'>, value: [ChatCompletionMessageToolCall(index=1, function=Function(arguments='{"command": "create", "path": "/tmp/hangzhou_trip_planner.py", "file_text": "...', name='str_replace_editor'), id='toolu_01SjNBn1Mkke6C1DJjkPcjsN', type='function')] 12:09:37 - openhands:DEBUG: logger.py:445 - Logging to /home/ubuntu/GitHub_Workspace/pro-agent/logs/llm/25-04-11_12-07/prompt_002.log 12:09:40 - openhands:DEBUG: logger.py:445 - Logging to /home/ubuntu/GitHub_Workspace/pro-agent/logs/llm/25-04-11_12-07/response_002.log 12:09:40 - openhands:DEBUG: llm.py:561 - Cost: 0.03 USD | Accumulated Cost: 0.13 USD Response Latency: 3.062 seconds Input tokens: 9639 | Output tokens: 102 Input tokens (cache hit): 5407 Input tokens (cache write): 4226</p> <p>12:09:40 - openhands:DEBUG: agent_controller.py:1171 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] Action metrics - accumulated_cost: 0.13123485000000001, tokens (prompt/completion/cache_read/cache_write): 9639/102/5407/4226 12:09:40 - openhands:DEBUG: stream.py:273 - Adding CmdRunAction id=8 from AGENT 12:09:40 - openhands:DEBUG: agent_controller.py:795 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] <strong>CmdRunAction (source=EventSource.AGENT, is_input=False)</strong> THOUGHT: 现在，让我安装必要的依赖并运行这个网页应用： COMMAND: pip install flask flask-cors 12:09:42 - openhands:DEBUG: stream.py:273 - Adding CmdOutputObservation id=9 from AGENT 12:09:42 - openhands:DEBUG: agent_controller.py:409 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] <strong>CmdOutputObservation (source=EventSource.AGENT, exit code=0, metadata={ "exit_code": 0, "pid": -1, "username": "openhands", "hostname": "2d4de2f65b26", "working_dir": "/workspace", "py_interpreter_path": "/openhands/poetry/openhands-ai-5O4_aCHf-py3.12/bin/python", "prefix": "", "suffix": "\n[The command completed with exit code 0.]" })</strong> --BEGIN AGENT OBSERVATION-- Collecting flask Downloading flask-3.1.0-py3-none-any.whl.metadata (2.7 kB) Collecting flask-cors Downloading flask_cors-5.0.1-py3-none-any.whl.metadata (961 bytes) Collecting Werkzeug>=3.1 (from flask) Downloading werkzeug-3.1.3-py3-none-any.whl.metadata (3.7 kB) Requirement already satisfied: Jinja2>=3.1.2 in /openhands/poetry/openhands-ai-5O4_aCHf-py3.12/lib/python3.12/site-packages (from flask) (3.1.6) Collecting itsdangerous>=2.2 (from flask) Downloading itsdangerous-2.2.0-py3-none-any.whl.metadata (1.9 kB) Requirement already satisfied: click>=8.1.3 in /openhands/poetry/openhands-ai-5O4_aCHf-py3.12/lib/python3.12/site-packages (from flask) (8.1.8) Collecting blinker>=1.9 (from flask) Downloading blinker-1.9.0-py3-none-any.whl.metadata (1.6 kB) Requirement already satisfied: MarkupSafe>=2.0 in /openhands/poetry/openhands-ai-5O4_aCHf-py3.12/lib/python3.12/site-packages (from Jinja2>=3.1.2->flask) (3.0.2) Downloading flask-3.1.0-py3-none-any.whl (102 kB) Downloading flask_cors-5.0.1-py3-none-any.whl (11 kB) Downloading blinker-1.9.0-py3-none-any.whl (8.5 kB) Downloading itsdangerous-2.2.0-py3-none-any.whl (16 kB) Downloading werkzeug-3.1.3-py3-none-any.whl (224 kB) Installing collected packages: Werkzeug, itsdangerous, blinker, flask, flask-cors Successfully installed Werkzeug-3.1.3 blinker-1.9.0 flask-3.1.0 flask-cors-5.0.1 itsdangerous-2.2.0 [The command completed with exit code 0.] [Current working directory: /workspace] [Python interpreter: /openhands/poetry/openhands-ai-5O4_aCHf-py3.12/bin/python] [Command finished with exit code 0] --END AGENT OBSERVATION-- 12:09:42 - openhands:INFO: agent_controller.py:696 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] LEVEL 0 LOCAL STEP 2 GLOBAL STEP 2 12:09:42 - openhands:DEBUG: codeact_agent.py:171 - Processing 7 events from a total of 7 events 12:09:42 - openhands:DEBUG: conversation_memory.py:71 - Visual browsing: False 12:09:42 - openhands:DEBUG: conversation_memory.py:207 - Tool calls type: &LTclass 'list'>, value: [ChatCompletionMessageToolCall(index=1, function=Function(arguments='{"command": "create", "path": "/tmp/hangzhou_trip_planner.py", "file_text": "...', name='str_replace_editor'), id='toolu_01SjNBn1Mkke6C1DJjkPcjsN', type='function')] 12:09:42 - openhands:DEBUG: conversation_memory.py:207 - Tool calls type: &LTclass 'list'>, value: [ChatCompletionMessageToolCall(index=1, function=Function(arguments='{"command": "pip install flask flask-cors", "is_input": "false"}', name='execute_bash'), id='toolu_01CDVDLZbXn5Ge8adnBXCSzC', type='function')] 12:09:42 - openhands:DEBUG: logger.py:445 - Logging to /home/ubuntu/GitHub_Workspace/pro-agent/logs/llm/25-04-11_12-07/prompt_003.log 12:09:45 - openhands:DEBUG: logger.py:445 - Logging to /home/ubuntu/GitHub_Workspace/pro-agent/logs/llm/25-04-11_12-07/response_003.log 12:09:45 - openhands:DEBUG: llm.py:561 - Cost: 0.01 USD | Accumulated Cost: 0.14 USD Response Latency: 2.354 seconds Input tokens: 10457 | Output tokens: 99 Input tokens (cache hit): 9633 Input tokens (cache write): 818</p> <p>12:09:45 - openhands:DEBUG: agent_controller.py:1171 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] Action metrics - accumulated_cost: 0.14114925, tokens (prompt/completion/cache_read/cache_write): 10457/99/9633/818 12:09:45 - openhands:DEBUG: stream.py:273 - Adding CmdRunAction id=10 from AGENT 12:09:45 - openhands:DEBUG: agent_controller.py:795 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] <strong>CmdRunAction (source=EventSource.AGENT, is_input=False)</strong> THOUGHT: 现在让我运行这个网页应用： COMMAND: python /tmp/hangzhou_trip_planner.py 12:10:16 - openhands:DEBUG: stream.py:273 - Adding CmdOutputObservation id=11 from AGENT 12:10:16 - openhands:DEBUG: agent_controller.py:409 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] <strong>CmdOutputObservation (source=EventSource.AGENT, exit code=-1, metadata={ "exit_code": -1, "pid": -1, "username": null, "hostname": null, "working_dir": null, "py_interpreter_path": null, "prefix": "", "suffix": "\n[The command has no new output after 30 seconds. You may wait longer to see additional output by sending empty command '', send other commands to interact with the current process, or send keys to interrupt/kill the command.]" })</strong> --BEGIN AGENT OBSERVATION--</p> <ul><li>Serving Flask app 'hangzhou_trip_planner'<li>Debug mode: on WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.<li>Running on all addresses (0.0.0.0)<li>Running on http://127.0.0.1:53941<li>Running on http://172.17.0.2:53941 Press CTRL+C to quit<li>Restarting with stat<li>Debugger is active!<li>Debugger PIN: 996-648-230 [The command has no new output after 30 seconds. You may wait longer to see additional output by sending empty command '', send other commands to interact with the current process, or send keys to interrupt/kill the command.] --END AGENT OBSERVATION-- 12:10:16 - openhands:INFO: agent_controller.py:696 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] LEVEL 0 LOCAL STEP 3 GLOBAL STEP 3 12:10:16 - openhands:DEBUG: codeact_agent.py:171 - Processing 9 events from a total of 9 events 12:10:16 - openhands:DEBUG: conversation_memory.py:71 - Visual browsing: False 12:10:16 - openhands:DEBUG: conversation_memory.py:207 - Tool calls type: &LTclass 'list'>, value: [ChatCompletionMessageToolCall(index=1, function=Function(arguments='{"command": "create", "path": "/tmp/hangzhou_trip_planner.py", "file_text": "...', name='str_replace_editor'), id='toolu_01SjNBn1Mkke6C1DJjkPcjsN', type='function')] 12:10:16 - openhands:DEBUG: conversation_memory.py:207 - Tool calls type: &LTclass 'list'>, value: [ChatCompletionMessageToolCall(index=1, function=Function(arguments='{"command": "pip install flask flask-cors", "is_input": "false"}', name='execute_bash'), id='toolu_01CDVDLZbXn5Ge8adnBXCSzC', type='function')] 12:10:16 - openhands:DEBUG: conversation_memory.py:207 - Tool calls type: &LTclass 'list'>, value: [ChatCompletionMessageToolCall(index=1, function=Function(arguments='{"command": "python /tmp/hangzhou_trip_planner.py", "is_input": "false"}', name='execute_bash'), id='toolu_01HwMwZtdS8dsFCDREbPKopu', type='function')] 12:10:16 - openhands:DEBUG: logger.py:445 - Logging to /home/ubuntu/GitHub_Workspace/pro-agent/logs/llm/25-04-11_12-07/prompt_004.log 12:10:24 - openhands:DEBUG: logger.py:445 - Logging to /home/ubuntu/GitHub_Workspace/pro-agent/logs/llm/25-04-11_12-07/response_004.log 12:10:24 - openhands:DEBUG: llm.py:561 - Cost: 0.01 USD | Accumulated Cost: 0.15 USD Response Latency: 8.065 seconds Input tokens: 10753 | Output tokens: 419 Input tokens (cache hit): 10451 Input tokens (cache write): 296</ul> <p>12:10:24 - openhands:DEBUG: agent_controller.py:1171 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] Action metrics - accumulated_cost: 0.15258555000000001, tokens (prompt/completion/cache_read/cache_write): 10753/419/10451/296 12:10:24 - openhands:DEBUG: stream.py:273 - Adding MessageAction id=12 from AGENT 12:10:24 - openhands:DEBUG: agent_controller.py:795 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] <strong>MessageAction</strong> (source=EventSource.AGENT) CONTENT: 太好了！网页应用已经成功运行起来了。您现在可以通过以下链接访问杭州三天春游规划：</p> <p>http://localhost:53941</p> <p>这个网页包含了详细的杭州三天春游规划，内容包括：</p> <ol><li><p><strong>第一天：西湖精华游</strong></p> <ul><li>上午：断桥-白堤-孤山<li>中午：湖畔午餐<li>下午：苏堤-雷峰塔<li>晚上：河坊街-清河坊</ul><li><p><strong>第二天：西湖西线与灵隐寺</strong></p> <ul><li>上午：灵隐寺-飞来峰<li>中午：素斋午餐<li>下午：龙井村-九溪烟树<li>晚上：西湖音乐喷泉</ul><li><p><strong>第三天：城市文化与休闲</strong></p> <ul><li>上午：西溪湿地<li>中午：农家午餐<li>下午：杭州博物馆-运河<li>晚上：宋城千古情</ul></ol> <p>此外，网页还包含了春季杭州旅游小贴士、美食推荐和购物建议，帮助您更好地规划行程。</p> <p>请点击上面的链接查看完整的旅游规划。如果您需要对规划内容进行任何修改或有其他问题，请随时告诉我！ 12:10:24 - openhands:INFO: agent_controller.py:520 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] Setting agent(CodeActAgent) state from AgentState.RUNNING to AgentState.AWAITING_USER_INPUT 12:10:24 - openhands:DEBUG: stream.py:273 - Adding AgentStateChangedObservation id=13 from ENVIRONMENT 12:10:24 - openhands:DEBUG: agent_controller.py:409 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] AgentStateChangedObservation(content='', agent_state='awaiting_user_input', observation='agent_state_changed') 12:11:05 - openhands:DEBUG: shutdown_listener.py:26 - shutdown_signal:2 12:11:06 - openhands:INFO: listen_socket.py:81 - sio:disconnect:SRJs3cbDFCDEbGmoAAAD 12:11:06 - openhands:INFO: standalone_conversation_manager.py:334 - disconnect_from_session:SRJs3cbDFCDEbGmoAAAD:740715d40a3c4be385b644a20b0fdfaf 12:11:06 - openhands:INFO: standalone_conversation_manager.py:351 - _close_session:740715d40a3c4be385b644a20b0fdfaf 12:11:06 - openhands:INFO: standalone_conversation_manager.py:359 - removing connections: [] 12:11:06 - openhands:INFO: standalone_conversation_manager.py:371 - closing_session:740715d40a3c4be385b644a20b0fdfaf 12:11:06 - openhands:DEBUG: state.py:107 - Saving state to session 740715d40a3c4be385b644a20b0fdfaf:AgentState.AWAITING_USER_INPUT 12:11:06 - openhands:INFO: agent_controller.py:520 - [Agent Controller 740715d40a3c4be385b644a20b0fdfaf] Setting agent(CodeActAgent) state from AgentState.AWAITING_USER_INPUT to AgentState.STOPPED 12:11:06 - openhands:DEBUG: stream.py:273 - Adding AgentStateChangedObservation id=14 from ENVIRONMENT 12:11:06 - openhands:WARNING: stream.py:260 - Callback not found during unsubscribe: 740715d40a3c4be385b644a20b0fdfaf 12:11:06 - openhands:INFO: standalone_conversation_manager.py:373 - closed_session:740715d40a3c4be385b644a20b0fdfaf</p></details><h2 id=er-gong-zuo-liu-cheng-fen-jie>二、工作流程分解</h2><h3 id=1-hui-hua-chu-shi-hua-jie-duan>1. 会话初始化阶段</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:08:07 - openhands:INFO: manage_conversations.py:148 - Initializing new conversation
</span><span>12:08:07 - openhands:INFO: manage_conversations.py:54 - Creating conversation
</span></code></pre><p>当用户发起请求时，系统首先初始化一个新的会话，分配一个唯一的会话 ID (<code>740715d40a3c4be385b644a20b0fdfaf</code>)，用于后续所有组件的协调和跟踪。<h3 id=2-pei-zhi-jia-zai-jie-duan>2. 配置加载阶段</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:08:07 - openhands:INFO: manage_conversations.py:58 - Loading settings
</span><span>12:08:07 - openhands:DEBUG: llm.py:385 - Model info: { "key": "claude-3-7-sonnet-20250219", ... }
</span></code></pre><p>系统加载配置信息，包括语言模型的设置、最大token限制、支持的功能等。此案例使用的是 Anthropic 的 Claude 3.7 Sonnet 模型。<h3 id=3-yun-xing-shi-huan-jing-zhun-bei>3. 运行时环境准备</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:08:07 - openhands:DEBUG: agent_session.py:232 - Initializing runtime `docker` now...
</span><span>12:08:08 - openhands:INFO: runtime_build.py:182 - Building image: ghcr.io/all-hands-ai/runtime:oh_v0.29.1...
</span></code></pre><p>系统启动一个隔离的 Docker 容器作为运行时环境，这样可以安全地执行代码而不影响主系统。容器有特定端口映射（53941、56576）用于网络应用访问。<h3 id=4-gong-ju-jia-zai-jie-duan>4. 工具加载阶段</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:08:38 - openhands:DEBUG: codeact_agent.py:75 - TOOLS loaded for CodeActAgent: execute_bash, think, finish, web_read, browser, execute_ipython_cell, str_replace_editor
</span></code></pre><p>系统启动 Agent (CodeActAgent) 并为其加载相关工具，让 Agent 能够执行命令、编辑文件等操作。这些工具是 CodeActAgent 与 Runtime 运行时环境交互的接口。<h3 id=5-yong-hu-shu-ru-chu-li>5. 用户输入处理</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:08:38 - openhands:DEBUG: agent_controller.py:441 - **MessageAction** (source=EventSource.USER)
</span><span>CONTENT: 给我做一个杭州三天春游的规划，给我一个可访问的web让我看规划内容
</span></code></pre><p>系统捕获并处理用户输入，识别出这是一个需要创建网页内容的请求。<h3 id=6-agent-si-kao-yu-gui-hua-jie-duan>6. Agent 思考与规划阶段</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:08:38 - openhands:DEBUG: logger.py:445 - Logging to .../prompt_001.log
</span><span>12:09:37 - openhands:DEBUG: logger.py:445 - Logging to .../response_001.log
</span></code></pre><p>Agent 使用大型语言模型 (Claude 3.7) 分析用户请求，并制定执行计划。这个过程大约持续了59秒，系统记录了完整的思考过程。<h3 id=7-wen-jian-chuang-jian-cao-zuo>7. 文件创建操作</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:09:37 - openhands:DEBUG: stream.py:273 - Adding FileEditAction id=6 from AGENT
</span><span>12:09:37 - openhands:DEBUG: agent_controller.py:795 - **FileEditAction**
</span><span>Path: [/tmp/hangzhou_trip_planner.py]
</span></code></pre><p>Agent Controller 决定创建一个 Flask 网页应用，包含完整的杭州三天春游规划。它使用 <code>str_replace_editor</code> 工具创建文件，并嵌入了 HTML、CSS 和后端逻辑。<h3 id=8-yi-lai-an-zhuang-jie-duan>8. 依赖安装阶段</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:09:40 - openhands:DEBUG: stream.py:273 - Adding CmdRunAction id=8 from AGENT
</span><span>COMMAND: pip install flask flask-cors
</span></code></pre><p>Agent 识别到需要安装依赖库（Flask 和 Flask-CORS），并自动执行安装命令。这显示了 Agent 能够理解和处理依赖关系。<h3 id=9-ying-yong-qi-dong-jie-duan>9. 应用启动阶段</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:09:45 - openhands:DEBUG: stream.py:273 - Adding CmdRunAction id=10 from AGENT
</span><span>COMMAND: python /tmp/hangzhou_trip_planner.py
</span></code></pre><p>安装完依赖后，在运行时环境中启动创建的网页应用。应用在端口 53941 上运行，允许用户通过浏览器访问。<h3 id=10-jie-guo-cheng-xian-jie-duan>10. 结果呈现阶段</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:10:24 - openhands:DEBUG: stream.py:273 - Adding MessageAction id=12 from AGENT
</span><span>CONTENT: 太好了！网页应用已经成功运行起来了。您现在可以通过以下链接访问杭州三天春游规划：http://localhost:53941
</span></code></pre><p>Agent 返回成功消息，告知用户可以通过指定链接访问旅游规划，并提供内容概览。<h2 id=san-he-xin-zu-jian-xiang-jie>三、核心组件详解</h2><h3 id=1-shi-jian-liu-xi-tong>1. 事件流系统</h3><p>整个系统基于事件流工作：<pre style=background:#2b303b;color:#c0c5ce><code><span>12:08:38 - openhands:DEBUG: stream.py:273 - Adding MessageAction id=1 from USER
</span><span>12:08:38 - openhands:DEBUG: stream.py:273 - Adding RecallAction id=3 from USER
</span></code></pre><p>所有操作都被封装为事件，由事件流系统处理，确保组件间通信有序可追踪。<h3 id=2-dai-li-zhuang-tai-guan-li>2. 代理状态管理</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:08:38 - openhands:INFO: agent_controller.py:520 - Setting agent(CodeActAgent) state from AgentState.LOADING to AgentState.RUNNING
</span></code></pre><p>系统维护了代理的状态机，从加载(LOADING)到运行(RUNNING)再到等待用户输入(AWAITING_USER_INPUT)，确保行为的连贯性。<h3 id=3-yu-yan-mo-xing-shi-yong>3. 语言模型使用</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:09:37 - openhands:DEBUG: llm.py:561 - Cost: 0.10 USD | Accumulated Cost: 0.10 USD
</span><span>Response Latency: 58.893 seconds
</span><span>Input tokens: 5411 | Output tokens: 4202
</span></code></pre><p>系统对语言模型的使用非常精确，记录每次调用的成本、延迟和token使用情况，并使用缓存优化性能：<pre style=background:#2b303b;color:#c0c5ce><code><span>Input tokens (cache hit): 9633
</span><span>Input tokens (cache write): 818
</span></code></pre><h3 id=4-dockeryun-xing-shi-huan-jing>4. Docker运行时环境</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:08:08 - openhands:DEBUG: docker_runtime.py:256 - Mount dir: /home/ubuntu/GitHub_Workspace/pro-agent/workspace
</span><span>12:08:08 - openhands:DEBUG: docker_runtime.py:262 - Sandbox workspace: /workspace
</span></code></pre><p>系统创建隔离的Docker容器作为沙盒环境，并挂载必要的目录以保持文件持久性，同时确保安全执行。<h3 id=5-gong-ju-diao-yong-xi-tong>5. 工具调用系统</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>12:09:37 - openhands:DEBUG: conversation_memory.py:207 - Tool calls type: &LTclass 'list'>, value: [ChatCompletionMessageToolCall...]
</span></code></pre><p>Agent通过结构化格式调用工具，每个工具调用都包含明确的参数和目标。这种方式让AI能以一致的方式使用各种系统功能。<h2 id=si-guan-jian-ji-zhu-liang-dian>四、关键技术亮点</h2><ol><li><p><strong>事件驱动架构</strong>：系统通过事件流协调各组件，使复杂流程更容易管理和追踪</p><li><p><strong>沙盒安全执行</strong>：使用Docker容器创建安全的执行环境，防止恶意代码影响宿主系统</p><li><p><strong>智能工具使用</strong>：AI能够识别任务所需的工具链（如依赖安装、代码执行），并按正确顺序使用</p><li><p><strong>清晰的工作流状态</strong>：系统维护代理状态机，确保处理流程的连贯性</p><li><p><strong>资源优化</strong>：通过缓存和累计成本跟踪优化语言模型使用</p><li><p><strong>多模态输出</strong>：不仅生成文字描述，还能创建完整的网页应用，提供更丰富的用户体验</p></ol><h2 id=wu-zhi-xing-liu-cheng-tu>五、执行流程图</h2><details><summary>OpenHands执行流程详细图示 (点击展开)</summary> <p><img alt=OpenHands执行流程图 src=https://polly.wang/openhands-running-logic-analysis/openhands_running_logic.svg></p></details><h2 id=liu-agent-hubjia-gou-de-you-shi>六、Agent Hub架构的优势</h2><p>在OpenHands的Agent Hub架构下，各个组件通过事件流系统紧密协作，形成了一个高效的智能编码生态系统：<ol><li><strong>组件解耦</strong>：每个组件负责特定功能，可以独立升级和维护<li><strong>流程透明</strong>：完整的日志记录和事件跟踪使得系统行为可预测和可调试<li><strong>扩展性强</strong>：新工具可以轻松集成到现有架构中，无需修改核心逻辑<li><strong>安全可控</strong>：Docker运行时提供了隔离执行环境，同时支持丰富的权限控制<li><strong>快速响应</strong>：事件驱动模式确保系统能够实时响应用户输入和环境变化</ol><p>这种架构设计使得OpenHands能够处理从简单的代码生成到复杂的应用开发等多样化任务，同时保持系统的稳定性和安全性。<h2 id=qi-shi-ji-ying-yong-chang-jing-fen-xi>七、实际应用场景分析</h2><p>我们的杭州春游案例展示了OpenHands处理实际问题的能力。值得注意的是，Agent在整个过程中表现出了以下关键能力：<ol><li><strong>需求理解</strong>：正确解析了用户想要一个可访问的网页展示旅游规划的需求<li><strong>技术选型</strong>：自主选择了Flask作为网页框架，适合快速构建轻量级应用<li><strong>依赖管理</strong>：识别并安装了所需的Python包（flask、flask-cors）<li><strong>内容创建</strong>：组织了有价值的旅游信息，包括景点、美食和交通建议<li><strong>用户体验设计</strong>：创建了一个包含CSS样式的美观网页，而不是简单的文本输出<li><strong>端口配置</strong>：正确配置了Web服务器端口，确保用户可访问</ol><p>这个案例完美展示了OpenHands如何从用户简单的自然语言请求出发，通过一系列复杂但协调一致的步骤，最终交付一个完整可用的解决方案。</div><div class=navigation></div></div><div id=giscus-container><h2>留言与讨论</h2><div class=giscus></div></div><script data-category="Blog Comments" async crossorigin data-category-id=DIC_kwDOL45duM4CnjlZ data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=pathname data-reactions-enabled=1 data-repo=Polly2014/polly2014.github.io data-repo-id=R_kgDOL45duA data-strict=0 data-theme=noborder_light src=https://giscus.app/client.js></script><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                // 灰白黑色调 + 蓝色点缀
                primaryColor: '#e8e8e8',
                primaryTextColor: '#333',
                primaryBorderColor: '#999',
                lineColor: 'rgb(61, 146, 201)',
                secondaryColor: '#f5f5f5',
                tertiaryColor: '#fafafa',
                background: '#f2f2f2',
                mainBkg: '#f5f5f5',
                nodeBorder: '#999',
                clusterBkg: '#eee',
                clusterBorder: '#ccc',
                titleColor: '#333',
                edgeLabelBackground: '#f2f2f2',
                // 文本颜色
                textColor: '#333',
                nodeTextColor: '#333',
                // 其他
                fontFamily: "'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace"
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // 查找所有 mermaid 代码块并渲染
        document.querySelectorAll('pre code.language-mermaid').forEach((block, index) => {
            const container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = block.textContent;
            block.parentNode.replaceWith(container);
        });

        // 渲染所有 mermaid 图表
        await mermaid.run();
    </script><style>.cover-image{text-align:center;margin:1.5em 0 2em 0}.cover-image img{width:60%;height:auto;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15)}.mermaid{background:#fafafa;border:1px solid #ddd;padding:20px;margin:20px 0;overflow-x:auto}.mermaid svg{max-width:100%;height:auto}@media (max-width:768px){.cover-image img{width:100%}}</style></div></div><script>document.addEventListener('DOMContentLoaded',function(){const c=document.querySelector('.menu-toggle');const d=document.querySelector('.sidebar');const e=document.querySelector('.overlay');function a(){d.classList.toggle('active');e.classList.toggle('active')}c.addEventListener('click',a);e.addEventListener('click',a);let f=0;let g=0;document.addEventListener('touchstart',h=>{f=h.changedTouches[0].screenX},false);document.addEventListener('touchend',h=>{g=h.changedTouches[0].screenX;b()},false);function b(){const h=g- f;if(h>50&&f<30){d.classList.add('active');e.classList.add('active')}else if(h<-50&&d.classList.contains('active')){d.classList.remove('active');e.classList.remove('active')}}})</script>