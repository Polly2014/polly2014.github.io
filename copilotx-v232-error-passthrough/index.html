<!doctype html><html><head><title>ğŸ” CopilotX v2.3.2ï¼šå½“ 400 å˜æˆäº†ã€Œä½ çŒœæ€ä¹ˆäº†ã€</title><meta content="ä¸€æ¬¡ 18 é¡¹ API å…¨é¢æµ‹è¯•æ­å¼€äº† CopilotX çš„æœ€åä¸€å—çŸ­æ¿â€”â€”åç«¯è¿”å› 400ï¼Œå®¢æˆ·ç«¯åªçœ‹åˆ°ã€ŒBad Requestã€ã€‚ä»å°é¾™è™¾çš„è‡ªåŠ¨åŒ–æµ‹è¯•å¼€å§‹ï¼Œåˆ°äººè™¾åä½œå®Œå–„é”™è¯¯é€ä¼ é“¾è·¯ï¼Œè®°å½• v2.3.2 çš„å®Œæ•´è¯ç”Ÿè¿‡ç¨‹ã€‚" name=description><meta content="Polly, Blog, AI Blog, AI Assistant, Tutorials, Technology Blog, Baoli Wang" name=keywords><meta content="width=device-width,initial-scale=1" name=viewport><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content=#333 name=theme-color><meta content=article property=og:type><meta content=https://polly.wang/copilotx-v232-error-passthrough/ property=og:url><meta content="ğŸ” CopilotX v2.3.2ï¼šå½“ 400 å˜æˆäº†ã€Œä½ çŒœæ€ä¹ˆäº†ã€" property=og:title><meta content="ä¸€æ¬¡ 18 é¡¹ API å…¨é¢æµ‹è¯•æ­å¼€äº† CopilotX çš„æœ€åä¸€å—çŸ­æ¿â€”â€”åç«¯è¿”å› 400ï¼Œå®¢æˆ·ç«¯åªçœ‹åˆ°ã€ŒBad Requestã€ã€‚ä»å°é¾™è™¾çš„è‡ªåŠ¨åŒ–æµ‹è¯•å¼€å§‹ï¼Œåˆ°äººè™¾åä½œå®Œå–„é”™è¯¯é€ä¼ é“¾è·¯ï¼Œè®°å½• v2.3.2 çš„å®Œæ•´è¯ç”Ÿè¿‡ç¨‹ã€‚" property=og:description><meta content=https://polly.wang/copilotx-v232-error-passthrough/cover.jpg property=og:image><meta content="Polly Blog" property=og:site_name><meta content=zh_CN property=og:locale><meta content=summary_large_image name=twitter:card><meta content=https://polly.wang/copilotx-v232-error-passthrough/ name=twitter:url><meta content="ğŸ” CopilotX v2.3.2ï¼šå½“ 400 å˜æˆäº†ã€Œä½ çŒœæ€ä¹ˆäº†ã€" name=twitter:title><meta content="ä¸€æ¬¡ 18 é¡¹ API å…¨é¢æµ‹è¯•æ­å¼€äº† CopilotX çš„æœ€åä¸€å—çŸ­æ¿â€”â€”åç«¯è¿”å› 400ï¼Œå®¢æˆ·ç«¯åªçœ‹åˆ°ã€ŒBad Requestã€ã€‚ä»å°é¾™è™¾çš„è‡ªåŠ¨åŒ–æµ‹è¯•å¼€å§‹ï¼Œåˆ°äººè™¾åä½œå®Œå–„é”™è¯¯é€ä¼ é“¾è·¯ï¼Œè®°å½• v2.3.2 çš„å®Œæ•´è¯ç”Ÿè¿‡ç¨‹ã€‚" name=twitter:description><meta content=https://polly.wang/copilotx-v232-error-passthrough/cover.jpg name=twitter:image><meta content=2026-02-18T00:00:00 property=article:published_time><meta content=Polly property=article:author><meta content=CopilotX property=article:tag><meta content=OpenClaw property=article:tag><meta content=é”™è¯¯å¤„ç† property=article:tag><meta content="API ä»£ç†" property=article:tag><meta content=Python property=article:tag><meta content=è°ƒè¯• property=article:tag><link rel="shortcut icon" href=https://polly.wang/images/polly.ico type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=icon type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=apple-touch-icon><link href=https://polly.wang/vendor/purecss/pure-min.css rel=stylesheet><link href=https://polly.wang/vendor/purecss/grids-responsive-min.css rel=stylesheet><link href=https://polly.wang/vendor/font-awesome/css/all.min.css rel=stylesheet><link href=https://polly.wang/css/style_new.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-8JD13N7PHS" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-8JD13N7PHS';);</script><body><div class=menu-toggle><img alt=Menu src=https://polly.wang/images/polly.png></div><div class=overlay></div><div class="pure-g container"><div class="sidebar pure-u-1 pure-u-md-1-5"><div class=title><a class=pure-menu-heading href=https://polly.wang> <img class="avatar pure-img-responsive" src=https://polly.wang/images/polly.png> </a><div class=introduction><p>Polly's Blog</div><div class=nav><ul class=nav-links><li><a href=https://polly.wang><i class="fas fa-home"></i>Home</a><li><a href=https://polly.wang/archive><i class="fas fa-archive"></i>Archive</a><li><a href=https://polly.wang/category><i class="fas fa-folder"></i>Category</a><li><a href=https://polly.wang/blog><i class="fas fa-file-alt"></i>Posts</a><li><a href=https://polly.wang/cfp><i class="fas fa-calendar-alt"></i>CFP</a><li><a href=https://polly.wang/publication><i class="fas fa-file-pdf"></i>Research</a><li><a href=https://polly.wang/changelog><i class="fas fa-history"></i>Change Log</a><li><a href=https://polly.wang/about><i class="fas fa-info-circle"></i>About Me</a></ul></div><div class=social><ul class=social-links><li><a href=mailto:26716201@qq.com><i class="fas fa-envelope"></i></a><li><a href=https://twitter.com/Polly__007><i class="fab fa-twitter"></i></a><li><a href=https://www.linkedin.com/in/baoliwang><i class="fab fa-linkedin-in"></i></a><li><a href=https://github.com/Polly2014><i class="fab fa-github"></i></a></ul></div></div></div><div class="content pure-u-1 pure-u-md-4-5"><div class=blog-post><h1>ğŸ” CopilotX v2.3.2ï¼šå½“ 400 å˜æˆäº†ã€Œä½ çŒœæ€ä¹ˆäº†ã€</h1><div class=cover-image><img alt="ğŸ” CopilotX v2.3.2ï¼šå½“ 400 å˜æˆäº†ã€Œä½ çŒœæ€ä¹ˆäº†ã€" loading=lazy src=cover.jpg></div><div class=content><p>æ™šä¸Šå…­ç‚¹åŠï¼Œæˆ‘è®©å°é¾™è™¾ï¼ˆæˆ‘çš„ AI åŠ©æ‰‹ï¼‰å¸®æˆ‘æµ‹è¯•ä¸€ä¸‹ CopilotXï¼Œçœ‹çœ‹è¿˜æœ‰ä»€ä¹ˆä¸è¶³ã€‚<p>å®ƒå›æ¥äº¤äº†ä¸€ä»½ 18 é¡¹æµ‹è¯•æŠ¥å‘Šï¼Œ17 é¡¹å…¨è¿‡ï¼Œ1 é¡¹æ ‡çº¢ã€‚ä½†è®©æˆ‘çœŸæ­£åŠ¨æ‰‹æ”¹ä»£ç çš„ï¼Œä¸æ˜¯é‚£ä¸ªçº¢è‰²çš„ âŒâ€”â€”è€Œæ˜¯çº¢è‰²èƒŒåé‚£å¥æ¯«æ— ä¿¡æ¯é‡çš„é”™è¯¯ä¿¡æ¯ã€‚</p><span id=continue-reading></span><h2 id=qi-yin-rang-ai-ce-shi-ai-de-api>èµ·å› ï¼šè®© AI æµ‹è¯• AI çš„ API</h2><p>æ•…äº‹çš„èƒŒæ™¯æ˜¯è¿™æ ·çš„ï¼šCopilotX æ˜¯æˆ‘å†™çš„ä¸€ä¸ª API ä»£ç†ï¼ŒæŠŠ GitHub Copilot çš„è®¢é˜…å˜æˆæ ‡å‡†çš„ OpenAI / Anthropic å…¼å®¹ APIã€‚<a href=/copilotx-v23-tools-support-journey>v2.3.0</a> åˆšè§£å†³äº† tool calling çš„é—®é¢˜ï¼Œå°é¾™è™¾ç»ˆäºèƒ½åŠ¨æ‰‹å†™æ–‡ä»¶äº†ã€‚<p>ä»Šå¤©æŠ˜è…¾å®Œ <a href=/making-openclaw-run-with-copilotx>OpenClaw</a> çš„ç‰ˆæœ¬å‡çº§åï¼Œæˆ‘æƒ³â€”â€”æ—¢ç„¶ CopilotX æ˜¯å°é¾™è™¾çš„ã€Œè„ŠæŸ±ã€ï¼Œä¸å¦‚è®©å®ƒè‡ªå·±æ¥åšä¸€æ¬¡å…¨é¢ä½“æ£€ã€‚<p>äºæ˜¯æˆ‘è¯´ï¼š<blockquote><p>å¸®æˆ‘å®Œæ•´æµ‹è¯•ä¸€æ³¢ CopilotXï¼Œçœ‹çœ‹è¿˜æœ‰ä»€ä¹ˆä¸è¶³</blockquote><p>å°é¾™è™¾çœŸçš„è·‘äº† 18 ä¸ªç«¯åˆ°ç«¯æµ‹è¯•ï¼Œè¦†ç›–äº†æˆ‘éƒ½æ²¡æƒ³åˆ°çš„è¾¹ç•Œåœºæ™¯ï¼š<table><thead><tr><th>#<th>æµ‹è¯•é¡¹<th>ç»“æœ<tbody><tr><td>1<td>Health Check<td>âœ…<tr><td>2<td>æ¨¡å‹åˆ—è¡¨ï¼ˆ25 ä¸ªæ¨¡å‹ï¼‰<td>âœ…<tr><td>3<td>OpenAI Chatï¼ˆéæµå¼ï¼‰<td>âœ…<tr><td>4<td>OpenAI Chatï¼ˆæµå¼ï¼‰<td>âœ…<tr><td>5<td>Anthropic Messagesï¼ˆéæµå¼ï¼‰<td>âœ…<tr><td>6<td>Anthropic Messagesï¼ˆæµå¼ï¼‰<td>âœ…<tr><td>7<td>Anthropic Tool Useï¼ˆéæµå¼ï¼‰<td>âœ…<tr><td>8<td>Anthropic Tool Useï¼ˆæµå¼ï¼‰<td>âœ…<tr><td>9<td>å¤šè½®å·¥å…·å¯¹è¯ï¼ˆtool_resultï¼‰<td>âœ…<tr><td>10<td>System ä¸ºå†…å®¹å—åˆ—è¡¨<td>âœ…<tr><td>11<td><strong>Responses API</strong><td><strong>âŒ 400</strong><tr><td>12<td>OpenAI Chat with Tools<td>âœ…<tr><td>13<td>å¤šå·¥å…·å¹¶è¡Œè°ƒç”¨<td>âœ…<tr><td>14<td>tool_choice=any<td>âœ…<tr><td>15<td>tool_choice=specific<td>âœ…<tr><td>16-17<td>è®¤è¯æ‹¦æˆªï¼ˆç¼ºå¤±/é”™è¯¯ keyï¼‰<td>âœ…<tr><td>18<td>æ—§ç‰ˆ model åæ˜ å°„<td>âœ…</table><p>17/18 é€šè¿‡ï¼Œæ ¸å¿ƒåŠŸèƒ½å¾ˆç¨³ã€‚ä½†é‚£ä¸ª Responses API çš„ 400 é”™è¯¯ï¼Œè¿”å›çš„ä¿¡æ¯æ˜¯è¿™æ ·çš„ï¼š<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>error</span><span>": {
</span><span>    "</span><span style=color:#a3be8c>message</span><span>": "</span><span style=color:#a3be8c>Copilot backend error: Client error '400 Bad Request' for url 'https://api.enterprise.githubcopilot.com/responses'</span><span>",
</span><span>    "</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>upstream_error</span><span>"
</span><span>  }
</span><span>}
</span></code></pre><p><strong>å°±è¿™ï¼Ÿ</strong> åç«¯æ˜æ˜è¿”å›äº†å…·ä½“çš„é”™è¯¯åŸå› ï¼Œä½† CopilotX åªå‘Šè¯‰æˆ‘ã€Œ400 Bad Requestã€ã€‚è¿™å°±åƒåŒ»ç”Ÿå‘Šè¯‰ä½ "ä½ æœ‰ç—…"ä½†ä¸è¯´æ˜¯ä»€ä¹ˆç—…ä¸€æ ·ã€‚<h2 id=gen-yin-raise-for-status-de-zui>æ ¹å› ï¼š<code>raise_for_status()</code> çš„ç½ª</h2><p>é—®é¢˜å‡ºåœ¨ <code>client.py</code> é‡Œå››ä¸ª HTTP è¯·æ±‚æ–¹æ³•ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#b48ead>async def </span><span style=color:#8fa1b3>chat_completions</span><span>(</span><span style=color:#bf616a>self</span><span>, </span><span style=color:#bf616a>payload</span><span>: dict) -> dict:
</span><span>    resp = </span><span style=color:#b48ead>await </span><span style=color:#bf616a>self</span><span>._client.</span><span style=color:#bf616a>post</span><span>(url, </span><span style=color:#bf616a>json</span><span>=payload, </span><span style=color:#bf616a>headers</span><span>=</span><span style=color:#bf616a>self</span><span>.</span><span style=color:#bf616a>_headers</span><span>())
</span><span>    resp.</span><span style=color:#bf616a>raise_for_status</span><span>()  </span><span style=color:#65737e># â† è¿™è¡Œæ˜¯ç½ªé­ç¥¸é¦–
</span><span>    </span><span style=color:#b48ead>return </span><span>resp.</span><span style=color:#bf616a>json</span><span>()
</span></code></pre><p><code>httpx.raise_for_status()</code> åœ¨é‡åˆ° 4xx/5xx å“åº”æ—¶ï¼Œç›´æ¥æŠ›å‡ºä¸€ä¸ª <code>HTTPStatusError</code> å¼‚å¸¸ã€‚å¼‚å¸¸ä¿¡æ¯åªåŒ…å« HTTP çŠ¶æ€ç å’Œ URLâ€”â€”<strong>åç«¯è¿”å›çš„å“åº”ä½“ï¼ˆerror bodyï¼‰è¢«å®Œå…¨ä¸¢å¼ƒäº†</strong>ã€‚<p>ç„¶ååœ¨è·¯ç”±å±‚ï¼Œ<code>except Exception as e</code> æŠŠè¿™ä¸ªæ®‹ç¼ºçš„å¼‚å¸¸ä¿¡æ¯åŒ…è£…æˆ 502 è¿”å›ç»™å®¢æˆ·ç«¯ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#b48ead>except </span><span>Exception </span><span style=color:#b48ead>as </span><span>e:
</span><span>    </span><span style=color:#b48ead>return </span><span style=color:#bf616a>JSONResponse</span><span>(
</span><span>        </span><span style=color:#bf616a>status_code</span><span>=</span><span style=color:#d08770>502</span><span>,  </span><span style=color:#65737e># æ°¸è¿œæ˜¯ 502
</span><span>        </span><span style=color:#bf616a>content</span><span>={"</span><span style=color:#a3be8c>error</span><span>": {"</span><span style=color:#a3be8c>message</span><span>": </span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Copilot backend error: </span><span>{e}"}}
</span><span>    )
</span></code></pre><p>ä¸¤ä¸ªé—®é¢˜å åŠ ï¼š<ol><li><strong>é”™è¯¯ä½“ä¸¢å¤±</strong>ï¼š<code>raise_for_status()</code> ä¸ä¿ç•™ response body<li><strong>çŠ¶æ€ç ç¯¡æ”¹</strong>ï¼šåç«¯è¿”å› 400ï¼Œå®¢æˆ·ç«¯çœ‹åˆ° 502</ol><h2 id=xiu-fu-si-ceng-cuo-wu-tou-chuan>ä¿®å¤ï¼šå››å±‚é”™è¯¯é€ä¼ </h2><p>å°é¾™è™¾å…ˆå†™äº†ç¬¬ä¸€ç‰ˆä¿®å¤ï¼Œæˆ‘åœ¨å®ƒçš„åŸºç¡€ä¸Šè¡¥å……äº†ä¸¤ç‚¹ã€‚æœ€ç»ˆçš„æ”¹åŠ¨è¦†ç›–å››ä¸ªå±‚é¢ï¼š<h3 id=di-yi-ceng-fei-liu-shi-qing-qiu-du-qu-cuo-wu-ti>ç¬¬ä¸€å±‚ï¼šéæµå¼è¯·æ±‚è¯»å–é”™è¯¯ä½“</h3><p><strong>ä¹‹å‰ï¼š</strong><pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span>resp = </span><span style=color:#b48ead>await </span><span style=color:#bf616a>self</span><span>._client.</span><span style=color:#bf616a>post</span><span>(url, </span><span style=color:#bf616a>json</span><span>=payload, </span><span style=color:#bf616a>headers</span><span>=</span><span style=color:#bf616a>self</span><span>.</span><span style=color:#bf616a>_headers</span><span>())
</span><span>resp.</span><span style=color:#bf616a>raise_for_status</span><span>()  </span><span style=color:#65737e># ç›²æŠ›ï¼Œä¸¢å¼ƒ body
</span></code></pre><p><strong>ä¹‹åï¼š</strong><pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span>resp = </span><span style=color:#b48ead>await </span><span style=color:#bf616a>self</span><span>._client.</span><span style=color:#bf616a>post</span><span>(url, </span><span style=color:#bf616a>json</span><span>=payload, </span><span style=color:#bf616a>headers</span><span>=</span><span style=color:#bf616a>self</span><span>.</span><span style=color:#bf616a>_headers</span><span>())
</span><span style=color:#b48ead>if </span><span>resp.status_code >= </span><span style=color:#d08770>400</span><span>:
</span><span>    error_body = resp.text
</span><span>    logger.</span><span style=color:#bf616a>error</span><span>("</span><span style=color:#a3be8c>Chat completions error: status=</span><span style=color:#d08770>%d</span><span style=color:#a3be8c> body=</span><span style=color:#d08770>%s</span><span>",
</span><span>                 resp.status_code, error_body[:</span><span style=color:#d08770>1000</span><span>])
</span><span>    </span><span style=color:#b48ead>raise </span><span>httpx.</span><span style=color:#bf616a>HTTPStatusError</span><span>(
</span><span>        </span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>HTTP </span><span>{resp.status_code}</span><span style=color:#a3be8c>: </span><span>{error_body[:</span><span style=color:#d08770>500</span><span>]}",
</span><span>        </span><span style=color:#bf616a>request</span><span>=resp.request,
</span><span>        </span><span style=color:#bf616a>response</span><span>=resp,  </span><span style=color:#65737e># ä¿ç•™å®Œæ•´ response å¯¹è±¡
</span><span>    )
</span></code></pre><p>å…³é”®å˜åŒ–ï¼š<strong>å…ˆè¯» <code>resp.text</code>ï¼Œå†æ„é€ å¼‚å¸¸</strong>ã€‚è¿™æ ·ä¸Šæ¸¸ catch åˆ°å¼‚å¸¸æ—¶ï¼Œè¿˜èƒ½é€šè¿‡ <code>e.response.text</code> æ‹¿åˆ°å®Œæ•´é”™è¯¯ä½“ã€‚<h3 id=di-er-ceng-liu-shi-qing-qiu-de-cuo-wu-chu-li>ç¬¬äºŒå±‚ï¼šæµå¼è¯·æ±‚çš„é”™è¯¯å¤„ç†</h3><p>è¿™æ˜¯æˆ‘è¡¥å……çš„ç¬¬ä¸€ç‚¹ã€‚å°é¾™è™¾çš„ç¬¬ä¸€ç‰ˆåªæ”¹äº†éæµå¼æ–¹æ³•ï¼Œä½†æµå¼è¯·æ±‚æœ‰ä¸ªå¾®å¦™çš„åŒºåˆ«â€”â€”åœ¨ <code>httpx.stream()</code> ä¸Šä¸‹æ–‡é‡Œï¼Œresponse body è¿˜æ²¡è¢«è¯»å–ï¼Œå¿…é¡»ç”¨ <code>await resp.aread()</code> æ˜¾å¼è¯»å–ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#b48ead>async with </span><span style=color:#bf616a>self</span><span>._client.</span><span style=color:#bf616a>stream</span><span>("</span><span style=color:#a3be8c>POST</span><span>", url, </span><span style=color:#bf616a>json</span><span>=payload, </span><span style=color:#d08770>...</span><span>) </span><span style=color:#b48ead>as </span><span>resp:
</span><span>    </span><span style=color:#b48ead>if </span><span>resp.status_code >= </span><span style=color:#d08770>400</span><span>:
</span><span>        error_body = </span><span style=color:#b48ead>await </span><span>resp.</span><span style=color:#bf616a>aread</span><span>()  </span><span style=color:#65737e># æµå¼ä¸Šä¸‹æ–‡é‡Œå¿…é¡» aread()
</span><span>        logger.</span><span style=color:#bf616a>error</span><span>("</span><span style=color:#a3be8c>Stream error: status=</span><span style=color:#d08770>%d</span><span style=color:#a3be8c> body=</span><span style=color:#d08770>%s</span><span>",
</span><span>                     resp.status_code, error_body[:</span><span style=color:#d08770>1000</span><span>])
</span><span>        </span><span style=color:#b48ead>raise </span><span>httpx.</span><span style=color:#bf616a>HTTPStatusError</span><span>(
</span><span>            </span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>HTTP </span><span>{resp.status_code}</span><span style=color:#a3be8c>: </span><span>{error_body.</span><span style=color:#bf616a>decode</span><span>('</span><span style=color:#a3be8c>utf-8</span><span>', </span><span style=color:#bf616a>errors</span><span>='</span><span style=color:#a3be8c>replace</span><span>')[:</span><span style=color:#d08770>500</span><span>]}",
</span><span>            </span><span style=color:#bf616a>request</span><span>=resp.request, </span><span style=color:#bf616a>response</span><span>=resp,
</span><span>        )
</span></code></pre><p>å¦‚æœä¸ç”¨ <code>aread()</code> è€Œæ˜¯ç›´æ¥è¯» <code>resp.text</code>ï¼Œä½ æ‹¿åˆ°çš„æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚<h3 id=di-san-ceng-lu-you-ceng-tou-chuan-zhen-shi-zhuang-tai-ma>ç¬¬ä¸‰å±‚ï¼šè·¯ç”±å±‚é€ä¼ çœŸå®çŠ¶æ€ç </h3><p>è·¯ç”±å±‚ä¸å†ä¸€å¾‹è¿”å› 502ï¼Œè€Œæ˜¯ä»å¼‚å¸¸ä¸­æå–åç«¯çš„çœŸå®çŠ¶æ€ç ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#b48ead>except </span><span>Exception </span><span style=color:#b48ead>as </span><span>e:
</span><span>    status_code = </span><span style=color:#d08770>502
</span><span>    error_content = {"</span><span style=color:#a3be8c>error</span><span>": {"</span><span style=color:#a3be8c>message</span><span>": </span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Copilot backend error: </span><span>{e}", </span><span style=color:#d08770>...</span><span>}}
</span><span>    </span><span style=color:#b48ead>if </span><span style=color:#96b5b4>hasattr</span><span>(e, '</span><span style=color:#a3be8c>response</span><span>') and e.response is not </span><span style=color:#d08770>None</span><span>:
</span><span>        status_code = e.response.status_code  </span><span style=color:#65737e># é€ä¼ çœŸå®çŠ¶æ€ç 
</span><span>        </span><span style=color:#b48ead>try</span><span>:
</span><span>            error_content = json.</span><span style=color:#bf616a>loads</span><span>(e.response.text)  </span><span style=color:#65737e># é€ä¼  JSON é”™è¯¯ä½“
</span><span>        </span><span style=color:#b48ead>except </span><span>(json.JSONDecodeError, ValueError):
</span><span>            error_content["</span><span style=color:#a3be8c>error</span><span>"]["</span><span style=color:#a3be8c>message</span><span>"] = e.response.text[:</span><span style=color:#d08770>500</span><span>]
</span><span>    </span><span style=color:#b48ead>return </span><span style=color:#bf616a>JSONResponse</span><span>(</span><span style=color:#bf616a>status_code</span><span>=status_code, </span><span style=color:#bf616a>content</span><span>=error_content)
</span></code></pre><h3 id=di-si-ceng-json-cuo-wu-ti-jie-xi>ç¬¬å››å±‚ï¼šJSON é”™è¯¯ä½“è§£æ</h3><p>è¿™æ˜¯æˆ‘è¡¥å……çš„ç¬¬äºŒç‚¹ã€‚åç«¯çš„é”™è¯¯ä¿¡æ¯é€šå¸¸æ˜¯ JSON æ ¼å¼çš„ï¼Œæ¯”å¦‚ï¼š<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{"</span><span style=color:#a3be8c>error</span><span>": {"</span><span style=color:#a3be8c>message</span><span>": "</span><span style=color:#a3be8c>Model xxx not supported for Responses API</span><span>", "</span><span style=color:#a3be8c>code</span><span>": "</span><span style=color:#a3be8c>invalid_model</span><span>"}}
</span></code></pre><p>ä¹‹å‰æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ <code>"Copilot backend error: {error_msg}"</code>ï¼Œç°åœ¨å°è¯• <code>json.loads()</code> è§£æï¼ŒæˆåŠŸäº†å°±ç›´æ¥è½¬å‘åç«¯çš„åŸå§‹ JSONã€‚å®¢æˆ·ç«¯çœ‹åˆ°çš„å°±æ˜¯åç«¯æƒ³è¯´çš„è¯ï¼Œä¸€å­—ä¸å·®ã€‚<h2 id=po-an-responses-api-de-400-zhen-xiang>ç ´æ¡ˆï¼šResponses API çš„ 400 çœŸç›¸</h2><p>æ”¹å®Œä»£ç åï¼Œæˆ‘é‡æ–°æµ‹è¯•äº† Responses APIï¼Œè¿™æ¬¡ç”¨å¯¹äº†æ¨¡å‹ï¼š<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#65737e># âŒ Claude æ¨¡å‹ â†’ 400
</span><span style=color:#bf616a>curl -X</span><span> POST https://api.polly.wang/v1/responses \
</span><span style=color:#bf616a>  -d </span><span>'</span><span style=color:#a3be8c>{"model": "claude-sonnet-4", "input": "hello"}</span><span>'
</span><span>
</span><span style=color:#65737e># âœ… GPT-5 æ¨¡å‹ â†’ æ­£å¸¸
</span><span style=color:#bf616a>curl -X</span><span> POST https://api.polly.wang/v1/responses \
</span><span style=color:#bf616a>  -d </span><span>'</span><span style=color:#a3be8c>{"model": "gpt-5-mini", "input": "2+2=?"}</span><span>'
</span></code></pre><pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>output</span><span>": [
</span><span>    {"</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>reasoning</span><span>", "</span><span style=color:#a3be8c>summary</span><span>": []},
</span><span>    {"</span><span style=color:#a3be8c>content</span><span>": [{"</span><span style=color:#a3be8c>text</span><span>": "</span><span style=color:#a3be8c>2 + 2 = 4</span><span>", "</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>output_text</span><span>"}],
</span><span>     "</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>message</span><span>", "</span><span style=color:#a3be8c>status</span><span>": "</span><span style=color:#a3be8c>completed</span><span>"}
</span><span>  ]
</span><span>}
</span></code></pre><p>åŸæ¥ <strong>Responses API åªæ”¯æŒ GPT-5 ç³»åˆ—æ¨¡å‹</strong>â€”â€”Claude ç³»åˆ—èµ°çš„æ˜¯ Chat Completions + Anthropic ç¿»è¯‘ã€‚è¿™ä¸æ˜¯ CopilotX çš„ bugï¼Œæ˜¯ Copilot åç«¯çš„é™åˆ¶ã€‚ä½†ä»¥å‰çš„é”™è¯¯ä¿¡æ¯å®Œå…¨æ²¡å‘Šè¯‰æˆ‘è¿™ä¸€ç‚¹ï¼Œåªè¯´äº†ä¸€å¥ã€Œ400 Bad Requestã€ã€‚<p>ç°åœ¨æ”¹å®Œä¹‹åï¼Œå¦‚æœä½ ç”¨é”™äº†æ¨¡å‹ï¼Œèƒ½çœ‹åˆ°åç«¯çš„å®Œæ•´é”™è¯¯ä¿¡æ¯ã€‚è¿™æ‰æ˜¯ä¸€ä¸ª API ä»£ç†è¯¥åšçš„äº‹â€”â€”<strong>é€æ˜åœ°è½¬å‘ï¼ŒåŒ…æ‹¬é”™è¯¯</strong>ã€‚<h2 id=ren-xia-xie-zuo>äººè™¾åä½œ</h2><p>è¿™æ¬¡çš„æ”¹åŠ¨å¾ˆæœ‰æ„æ€â€”â€”å®ƒæ˜¯ä¸€ä¸ªäººæœºåä½œçš„è¿‡ç¨‹ï¼š<ol><li><strong>å°é¾™è™¾</strong>è·‘äº† 18 é¡¹è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå‘ç°äº† Responses API çš„é—®é¢˜<li><strong>å°é¾™è™¾</strong>å†™äº†ç¬¬ä¸€ç‰ˆä¿®å¤ï¼šéæµå¼è¯·æ±‚çš„é”™è¯¯ä½“è¯»å– + è·¯ç”±å±‚çŠ¶æ€ç é€ä¼ <li><strong>æˆ‘</strong>å®¡äº†å®ƒçš„ diffï¼Œè¡¥å……äº†ä¸¤ç‚¹ï¼š <ul><li>æµå¼è¯·æ±‚çš„ <code>aread()</code> å¤„ç†ï¼ˆå®ƒæ¼æ‰äº†ï¼‰<li>JSON é”™è¯¯ä½“è§£æï¼ˆä»å­—ç¬¦ä¸²æ‹¼æ¥å‡çº§åˆ°ç»“æ„åŒ–é€ä¼ ï¼‰</ul><li><strong>å°é¾™è™¾</strong> review äº†æœ€ç»ˆæ”¹åŠ¨ï¼Œç¡®è®¤å®Œå–„</ol><p>æœ€ç»ˆæ”¹åŠ¨é‡ï¼š4 ä¸ªæ–‡ä»¶ï¼Œ+112 è¡Œã€‚<table><thead><tr><th>æ–‡ä»¶<th>æ”¹åŠ¨<tbody><tr><td><code>client.py</code><td>éæµå¼ + æµå¼è¯·æ±‚éƒ½æ•è·å®Œæ•´é”™è¯¯ä½“<tr><td><code>routes_openai.py</code><td>åŠ  logging + JSON é”™è¯¯ä½“è§£æ<tr><td><code>routes_anthropic.py</code><td>åŠ  json import + JSON é”™è¯¯ä½“è§£æ<tr><td><code>routes_responses.py</code><td>JSON é”™è¯¯ä½“è§£æ</table><h2 id=ban-ben-xian>ç‰ˆæœ¬çº¿</h2><p>ä» 2 æœˆ 9 æ—¥åˆ°ä»Šå¤©ï¼ŒCopilotX çš„è¿›åŒ–è½¨è¿¹ï¼š<table><thead><tr><th>æ—¥æœŸ<th>ç‰ˆæœ¬<th>é‡Œç¨‹ç¢‘<tbody><tr><td>02/09<td>v1.0<td><a href=/copilotx-turn-copilot-into-local-api>ä¸€ä¸ªæ™šä¸Šï¼Œæœ¬åœ° API æœåŠ¡å™¨</a><tr><td>02/09<td>v2.0<td><a href=/copilotx-v2-remote-deployment>è¿œç¨‹éƒ¨ç½² + API Key è®¤è¯</a><tr><td>02/11<td>â€”<td><a href=/making-openclaw-run-with-copilotx>è®© OpenClaw è·‘èµ·æ¥</a><tr><td>02/13<td>v2.3<td><a href=/copilotx-v23-tools-support-journey>Tool Calling å®Œæ•´æ”¯æŒ</a><tr><td><strong>02/18</strong><td><strong>v2.3.2</strong><td><strong>é”™è¯¯é€ä¼  + æµå¼é”™è¯¯å¤„ç†</strong></table><p>æ¯ä¸€ä¸ªç‰ˆæœ¬éƒ½æ˜¯è§£å†³ä¸€ä¸ªå®é™…ç—›ç‚¹â€”â€”ä¸æ˜¯ä¸ºäº†åŠ åŠŸèƒ½è€ŒåŠ åŠŸèƒ½ï¼Œè€Œæ˜¯ç”¨ç€ç”¨ç€å‘ç°ã€Œè¿™é‡Œä¸å¯¹ã€ï¼Œç„¶åæ”¹å¥½å®ƒã€‚<h2 id=jing-yan>ç»éªŒ</h2><ol><li><strong>è®© AI æµ‹ AI çš„åŸºç¡€è®¾æ–½</strong>â€”â€”å°é¾™è™¾æµ‹ CopilotX æ¯”æˆ‘æ‰‹åŠ¨ curl æ•ˆç‡é«˜å¾—å¤šï¼Œå®ƒä¸€å£æ°”è·‘å®Œ 18 ä¸ªåœºæ™¯è¿˜è‡ªåŠ¨åˆ†ç±»æ€»ç»“<li><strong>é”™è¯¯ä¿¡æ¯æ˜¯ API çš„çµé­‚</strong>â€”â€”proxy çš„èŒè´£æ˜¯é€æ˜ï¼ŒåŒ…æ‹¬é€æ˜åœ°è½¬å‘é”™è¯¯ã€‚åæ‰é”™è¯¯ä½“æ˜¯æœ€å®¹æ˜“çŠ¯ä¹Ÿæœ€éš¾æ’æŸ¥çš„é—®é¢˜<li><strong>æµå¼å’Œéæµå¼æ˜¯ä¸¤ä¸ªä¸–ç•Œ</strong>â€”â€”<code>resp.text</code> vs <code>await resp.aread()</code>ï¼Œä¸€ä¸ªå­—çš„å·®åˆ«ï¼Œç»“æœå¤©å·®åœ°åˆ«<li><strong>å…ˆè®©å®ƒè¯´è¯ï¼Œå†ä¿®å®ƒçš„ç—…</strong>â€”â€”æ”¹è¿›é”™è¯¯å¤„ç† â†’ çœ‹åˆ°çœŸæ­£çš„é”™è¯¯ â†’ å‘ç°æ ¹æœ¬ä¸æ˜¯ bug è€Œæ˜¯æ¨¡å‹é™åˆ¶ã€‚å¦‚æœè¿˜æ˜¯ 502 ä¸€ç‰‡ç³Šæ¶‚ï¼Œæˆ‘å¯èƒ½ä¼šèŠ±å‡ ä¸ªå°æ—¶æ”¹ä¸€ä¸ªä¸å­˜åœ¨çš„ bug</ol><hr><p><em>ä¸‹ä¸€æ­¥ï¼šå°é¾™è™¾å·²ç»è·‘ç¨³äº†ï¼ŒCopilotX ä¹Ÿç¨³äº†ã€‚æ˜¯æ—¶å€™è®©å®ƒåšç‚¹æ›´æœ‰è¶£çš„äº‹æƒ…äº†ã€‚ğŸ¦</em></div><div class=navigation></div></div><div id=giscus-container><h2>Comments</h2><div class=giscus></div></div><script data-category="Blog Comments" async crossorigin data-category-id=DIC_kwDOL45duM4CnjlZ data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=pathname data-reactions-enabled=1 data-repo=Polly2014/polly2014.github.io data-repo-id=R_kgDOL45duA data-strict=0 data-theme=noborder_light src=https://giscus.app/client.js></script><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                // ç°ç™½é»‘è‰²è°ƒ + è“è‰²ç‚¹ç¼€
                primaryColor: '#e8e8e8',
                primaryTextColor: '#333',
                primaryBorderColor: '#999',
                lineColor: 'rgb(61, 146, 201)',
                secondaryColor: '#f5f5f5',
                tertiaryColor: '#fafafa',
                background: '#f2f2f2',
                mainBkg: '#f5f5f5',
                nodeBorder: '#999',
                clusterBkg: '#eee',
                clusterBorder: '#ccc',
                titleColor: '#333',
                edgeLabelBackground: '#f2f2f2',
                // æ–‡æœ¬é¢œè‰²
                textColor: '#333',
                nodeTextColor: '#333',
                // å…¶ä»–
                fontFamily: "'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace"
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // æŸ¥æ‰¾æ‰€æœ‰ mermaid ä»£ç å—å¹¶æ¸²æŸ“
        document.querySelectorAll('pre code.language-mermaid').forEach((block, index) => {
            const container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = block.textContent;
            block.parentNode.replaceWith(container);
        });

        // æ¸²æŸ“æ‰€æœ‰ mermaid å›¾è¡¨
        await mermaid.run();
    </script><style>.cover-image{text-align:center;margin:1.5em 0 2em 0}.cover-image img{width:60%;height:auto;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15)}.mermaid{background:#fafafa;border:1px solid #ddd;padding:20px;margin:20px 0;overflow-x:auto}.mermaid svg{max-width:100%;height:auto}@media (max-width:768px){.cover-image img{width:100%}}</style></div></div><script>document.addEventListener('DOMContentLoaded',function(){const c=document.querySelector('.menu-toggle');const d=document.querySelector('.sidebar');const e=document.querySelector('.overlay');function a(){d.classList.toggle('active');e.classList.toggle('active')}c.addEventListener('click',a);e.addEventListener('click',a);let f=0;let g=0;document.addEventListener('touchstart',h=>{f=h.changedTouches[0].screenX},false);document.addEventListener('touchend',h=>{g=h.changedTouches[0].screenX;b()},false);function b(){const h=g- f;if(h>50&&f<30){d.classList.add('active');e.classList.add('active')}else if(h<-50&&d.classList.contains('active')){d.classList.remove('active');e.classList.remove('active')}}})</script>