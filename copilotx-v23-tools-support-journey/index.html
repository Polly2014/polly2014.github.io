<!doctype html><html><head><title>ğŸ”§ CopilotX v2.3: è®© OpenClaw ç»ˆäºèƒ½åŠ¨æ‰‹äº†</title><meta content="ä»ã€ŒAgent å¹»è§‰å†™æ–‡ä»¶ã€åˆ°ã€ŒçœŸæ­£èƒ½åŠ¨æ‰‹å†™ã€çš„è°ƒè¯•ä¹‹æ—…ã€‚æ·±å…¥åˆ†æ Anthropic â†” OpenAI æ ¼å¼è½¬æ¢ä¸­ tools æ”¯æŒçš„å®Œæ•´å®ç°ï¼Œä»¥åŠ Copilot åç«¯é‚£ä¸ªä¸èµ°å¯»å¸¸è·¯çš„ split-choices æ ¼å¼ã€‚" name=description><meta content="Polly, Blog, AI Blog, AI Assistant, Tutorials, Technology Blog, Baoli Wang" name=keywords><meta content="width=device-width,initial-scale=1" name=viewport><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content=#333 name=theme-color><meta content=article property=og:type><meta content=https://polly.wang/copilotx-v23-tools-support-journey/ property=og:url><meta content="ğŸ”§ CopilotX v2.3: è®© OpenClaw ç»ˆäºèƒ½åŠ¨æ‰‹äº†" property=og:title><meta content="ä»ã€ŒAgent å¹»è§‰å†™æ–‡ä»¶ã€åˆ°ã€ŒçœŸæ­£èƒ½åŠ¨æ‰‹å†™ã€çš„è°ƒè¯•ä¹‹æ—…ã€‚æ·±å…¥åˆ†æ Anthropic â†” OpenAI æ ¼å¼è½¬æ¢ä¸­ tools æ”¯æŒçš„å®Œæ•´å®ç°ï¼Œä»¥åŠ Copilot åç«¯é‚£ä¸ªä¸èµ°å¯»å¸¸è·¯çš„ split-choices æ ¼å¼ã€‚" property=og:description><meta content=https://polly.wang/copilotx-v23-tools-support-journey/cover.jpg property=og:image><meta content="Polly Blog" property=og:site_name><meta content=zh_CN property=og:locale><meta content=summary_large_image name=twitter:card><meta content=https://polly.wang/copilotx-v23-tools-support-journey/ name=twitter:url><meta content="ğŸ”§ CopilotX v2.3: è®© OpenClaw ç»ˆäºèƒ½åŠ¨æ‰‹äº†" name=twitter:title><meta content="ä»ã€ŒAgent å¹»è§‰å†™æ–‡ä»¶ã€åˆ°ã€ŒçœŸæ­£èƒ½åŠ¨æ‰‹å†™ã€çš„è°ƒè¯•ä¹‹æ—…ã€‚æ·±å…¥åˆ†æ Anthropic â†” OpenAI æ ¼å¼è½¬æ¢ä¸­ tools æ”¯æŒçš„å®Œæ•´å®ç°ï¼Œä»¥åŠ Copilot åç«¯é‚£ä¸ªä¸èµ°å¯»å¸¸è·¯çš„ split-choices æ ¼å¼ã€‚" name=twitter:description><meta content=https://polly.wang/copilotx-v23-tools-support-journey/cover.jpg name=twitter:image><meta content=2026-02-13T00:00:00 property=article:published_time><meta content=Polly property=article:author><meta content=CopilotX property=article:tag><meta content=OpenClaw property=article:tag><meta content="Tool Calling" property=article:tag><meta content=Anthropic property=article:tag><meta content=OpenAI property=article:tag><meta content="API ä»£ç†" property=article:tag><link rel="shortcut icon" href=https://polly.wang/images/polly.ico type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=icon type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=apple-touch-icon><link href=https://polly.wang/vendor/purecss/pure-min.css rel=stylesheet><link href=https://polly.wang/vendor/purecss/grids-responsive-min.css rel=stylesheet><link href=https://polly.wang/vendor/font-awesome/css/all.min.css rel=stylesheet><link href=https://polly.wang/css/style_new.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-1N289C8N8W" async></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-1N289C8N8W')</script><body><div class=menu-toggle><img alt=Menu src=https://polly.wang/images/polly.png></div><div class=overlay></div><div class="pure-g container"><div class="sidebar pure-u-1 pure-u-md-1-5"><div class=title><a class=pure-menu-heading href=https://polly.wang> <img class="avatar pure-img-responsive" src=https://polly.wang/images/polly.png> </a><div class=introduction><p>Polly's Blog</div><div class=nav><ul class=nav-links><li><a href=https://polly.wang><i class="fas fa-home"></i>Home</a><li><a href=https://polly.wang/archive><i class="fas fa-archive"></i>Archive</a><li><a href=https://polly.wang/category><i class="fas fa-folder"></i>Category</a><li><a href=https://polly.wang/blog><i class="fas fa-file-alt"></i>Posts</a><li><a href=https://polly.wang/cfp><i class="fas fa-calendar-alt"></i>CFP</a><li><a href=https://polly.wang/publication><i class="fas fa-file-pdf"></i>Research</a><li><a href=https://polly.wang/changelog><i class="fas fa-history"></i>Change Log</a><li><a href=https://polly.wang/about><i class="fas fa-info-circle"></i>About Me</a></ul></div><div class=social><ul class=social-links><li><a href=mailto:26716201@qq.com><i class="fas fa-envelope"></i></a><li><a href=https://twitter.com/Polly__007><i class="fab fa-twitter"></i></a><li><a href=https://www.linkedin.com/in/baoliwang><i class="fab fa-linkedin-in"></i></a><li><a href=https://github.com/Polly2014><i class="fab fa-github"></i></a></ul></div></div></div><div class="content pure-u-1 pure-u-md-4-5"><div class=blog-post><h1>ğŸ”§ CopilotX v2.3: è®© OpenClaw ç»ˆäºèƒ½åŠ¨æ‰‹äº†</h1><div class=cover-image><img alt="ğŸ”§ CopilotX v2.3: è®© OpenClaw ç»ˆäºèƒ½åŠ¨æ‰‹äº†" loading=lazy src=cover.jpg></div><div class=content><p>å‡Œæ™¨ 12:24ï¼Œå°é¾™è™¾ç»ˆäºå†™ä¸‹äº†å®ƒçš„ç¬¬ä¸€è¡Œå­—ï¼š<pre class=language-markdown data-lang=markdown style=background:#2b303b;color:#c0c5ce><code class=language-markdown data-lang=markdown><span style=color:#8fa1b3># ğŸ‘‹ Hello from the Claw
</span><span>
</span><span>æ·±å¤œå†™ä¸‹çš„ç¬¬ä¸€è¡Œå­—ï¼ŒåƒçŒ«åœ¨é”®ç›˜ä¸Šè¸©å‡ºçš„è„šå°ã€‚
</span><span>
</span><span> /\_/\  
</span><span>( o.o ) < æ–‡ä»¶å†™å…¥æˆåŠŸï¼
</span><span style=color:#d08770> > ^ <
</span></code></pre><p>è¿™ 149 ä¸ªå­—èŠ‚ï¼Œæ‰¿è½½çš„æ˜¯ä¸¤å¤©çš„è°ƒè¯•å†ç¨‹ã€‚</p><span id=continue-reading></span><h2 id=wen-ti-agent-zai-huan-xiang-zi-ji-xie-liao-wen-jian>é—®é¢˜ï¼šAgent åœ¨ã€Œå¹»æƒ³ã€è‡ªå·±å†™äº†æ–‡ä»¶</h2><p>äº‹æƒ…æ˜¯è¿™æ ·å¼€å§‹çš„ã€‚<p>OpenClaw æ˜¯æˆ‘åœ¨ç”¨çš„ä¸ªäºº AI åŠ©æ‰‹æ¡†æ¶ï¼Œå®ƒè¿æ¥ Telegram ç­‰å¤šä¸ªæ¸ é“ï¼Œåå°è·‘ç€ä¸€ä¸ª Agentã€‚æˆ‘ç”¨ CopilotX ä½œä¸º LLM Providerï¼ŒæŠŠ GitHub Copilot çš„æ¨¡å‹èƒ½åŠ›æš´éœ²æˆ Anthropic å…¼å®¹çš„ APIã€‚<p>ç†è®ºä¸Šï¼Œè¿™å¥—æ¶æ„åº”è¯¥å®Œç¾ï¼š<pre style=background:#2b303b;color:#c0c5ce><code><span>Telegram â†’ OpenClaw Gateway â†’ Agent â†’ CopilotX â†’ Copilot (Claude)
</span><span>                                 â†“
</span><span>                         files/search/edit tools
</span></code></pre><p>ä½†å½“æˆ‘è®© Agent å¸®æˆ‘å†™ä¸ªæ–‡ä»¶æ—¶ï¼Œå®ƒä¿¡èª“æ—¦æ—¦åœ°è¯´ï¼š<blockquote><p>âœ… å†™å¥½äº†ï¼ğŸ“„ æ–‡ä»¶åœ¨ <code>first-sign.md</code></blockquote><p>ç„¶è€Œâ€”â€”æ–‡ä»¶æ ¹æœ¬ä¸å­˜åœ¨ã€‚<h2 id=gen-yin-fen-xi-tools-can-shu-bei-chi-diao-liao>æ ¹å› åˆ†æï¼šTools å‚æ•°è¢«ã€Œåƒæ‰äº†ã€</h2><p>æˆ‘å¼€å§‹æ·±æŒ– session logsã€‚OpenClaw ä¼šæŠŠæ¯æ¬¡å¯¹è¯è®°å½•æˆ JSONL æ–‡ä»¶ã€‚æ‰“å¼€ä¸€çœ‹ï¼š<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>text</span><span>",
</span><span>  "</span><span style=color:#a3be8c>text</span><span>": "</span><span style=color:#a3be8c>å†™å¥½äº†ï¼æ–‡ä»¶åœ¨ first-sign.md</span><span>"
</span><span>}
</span></code></pre><p>æ²¡æœ‰ <code>tool_use</code> blockã€‚Agent æ ¹æœ¬æ²¡è°ƒç”¨å·¥å…·â€”â€”å®ƒåªæ˜¯ã€Œè¯´ã€è‡ªå·±è°ƒç”¨äº†ã€‚<p>è¿™æ˜¯å…¸å‹çš„ <strong>LLM å¹»è§‰ï¼ˆHallucinationï¼‰</strong>ï¼Œä½†ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿï¼Ÿ<p>ç­”æ¡ˆè—åœ¨ CopilotX çš„ <code>translator.py</code> é‡Œã€‚è¿™ä¸ªæ–‡ä»¶è´Ÿè´£æŠŠ Anthropic æ ¼å¼çš„è¯·æ±‚ç¿»è¯‘æˆ OpenAI æ ¼å¼å‘ç»™ Copilotï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#b48ead>def </span><span style=color:#8fa1b3>anthropic_to_openai_request</span><span>(</span><span style=color:#bf616a>body</span><span>: dict) -> dict:
</span><span>    </span><span style=color:#65737e># å¤„ç† messages, system, model, temperature...
</span><span>    </span><span style=color:#65737e># âŒ ä½†å®Œå…¨æ²¡å¤„ç† tools å‚æ•°ï¼
</span></code></pre><p>OpenClaw å‘é€çš„è¯·æ±‚é‡Œå¸¦ç€å®Œæ•´çš„ tools å®šä¹‰ï¼ˆread/write/edit ç­‰ï¼‰ï¼Œä½† CopilotX åœ¨ç¿»è¯‘æ—¶æŠŠå®ƒä»¬ä¸¢å¼ƒäº†ã€‚æ¨¡å‹æ”¶åˆ°çš„è¯·æ±‚é‡Œæ ¹æœ¬æ²¡æœ‰å¯ç”¨å·¥å…·ï¼Œè‡ªç„¶æ— æ³•è°ƒç”¨ã€‚<h2 id=jie-jue-fang-an-wan-zheng-de-tools-shuang-xiang-zhuan-huan>è§£å†³æ–¹æ¡ˆï¼šå®Œæ•´çš„ Tools åŒå‘è½¬æ¢</h2><p>è¦ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å®ç°å®Œæ•´çš„ Anthropic â†” OpenAI tools æ ¼å¼åŒå‘è½¬æ¢ã€‚è¿™æ¶‰åŠä¸‰ä¸ªå±‚é¢ï¼š<h3 id=1-qing-qiu-ce-tool-definitions-zhuan-huan>1. è¯·æ±‚ä¾§ï¼šTool Definitions è½¬æ¢</h3><p>Anthropic æ ¼å¼ï¼š<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>tools</span><span>": [{
</span><span>    "</span><span style=color:#a3be8c>name</span><span>": "</span><span style=color:#a3be8c>calculator</span><span>",
</span><span>    "</span><span style=color:#a3be8c>description</span><span>": "</span><span style=color:#a3be8c>Math calc</span><span>",
</span><span>    "</span><span style=color:#a3be8c>input_schema</span><span>": {"</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>object</span><span>", "</span><span style=color:#a3be8c>properties</span><span>": {</span><span style=background:#bf616a;color:#2b303b>...</span><span>}}
</span><span>  }]
</span><span>}
</span></code></pre><p>OpenAI æ ¼å¼ï¼š<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>tools</span><span>": [{
</span><span>    "</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>function</span><span>",
</span><span>    "</span><span style=color:#a3be8c>function</span><span>": {
</span><span>      "</span><span style=color:#a3be8c>name</span><span>": "</span><span style=color:#a3be8c>calculator</span><span>",
</span><span>      "</span><span style=color:#a3be8c>description</span><span>": "</span><span style=color:#a3be8c>Math calc</span><span>",
</span><span>      "</span><span style=color:#a3be8c>parameters</span><span>": {"</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>object</span><span>", "</span><span style=color:#a3be8c>properties</span><span>": {</span><span style=background:#bf616a;color:#2b303b>...</span><span>}}
</span><span>    }
</span><span>  }]
</span><span>}
</span></code></pre><h3 id=2-qing-qiu-ce-li-shi-xiao-xi-zhong-de-tool-use-tool-result>2. è¯·æ±‚ä¾§ï¼šå†å²æ¶ˆæ¯ä¸­çš„ tool_use/tool_result</h3><p>å½“ Agent è¿›è¡Œå¤šè½®å·¥å…·è°ƒç”¨æ—¶ï¼Œå†å²æ¶ˆæ¯ä¸­ä¼šåŒ…å«ä¹‹å‰çš„å·¥å…·è°ƒç”¨å’Œç»“æœã€‚<p>Anthropic æŠŠè¿™äº›æ”¾åœ¨ content blocks é‡Œï¼š<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{"</span><span style=color:#a3be8c>role</span><span>": "</span><span style=color:#a3be8c>assistant</span><span>", "</span><span style=color:#a3be8c>content</span><span>": [
</span><span>  {"</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>text</span><span>", "</span><span style=color:#a3be8c>text</span><span>": "</span><span style=color:#a3be8c>Let me calculate...</span><span>"},
</span><span>  {"</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>tool_use</span><span>", "</span><span style=color:#a3be8c>name</span><span>": "</span><span style=color:#a3be8c>calculator</span><span>", "</span><span style=color:#a3be8c>input</span><span>": {</span><span style=background:#bf616a;color:#2b303b>...</span><span>}}
</span><span>]}
</span></code></pre><p>è€Œ OpenAI ç”¨ç‹¬ç«‹çš„ <code>tool_calls</code> å­—æ®µå’Œ <code>role: "tool"</code> æ¶ˆæ¯ï¼š<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{"</span><span style=color:#a3be8c>role</span><span>": "</span><span style=color:#a3be8c>assistant</span><span>", "</span><span style=color:#a3be8c>content</span><span>": "</span><span style=color:#a3be8c>Let me calculate...</span><span>", "</span><span style=color:#a3be8c>tool_calls</span><span>": [</span><span style=background:#bf616a;color:#2b303b>...</span><span>]}
</span><span>{"</span><span style=color:#a3be8c>role</span><span>": "</span><span style=color:#a3be8c>tool</span><span>", "</span><span style=color:#a3be8c>tool_call_id</span><span>": "</span><span style=color:#a3be8c>xxx</span><span>", "</span><span style=color:#a3be8c>content</span><span>": "</span><span style=color:#a3be8c>425</span><span>"}
</span></code></pre><h3 id=3-xiang-ying-ce-tool-calls-tool-use>3. å“åº”ä¾§ï¼štool_calls â†’ tool_use</h3><p>æ¨¡å‹è¿”å› tool è°ƒç”¨æ—¶ï¼ŒOpenAI æ ¼å¼ï¼š<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>finish_reason</span><span>": "</span><span style=color:#a3be8c>tool_calls</span><span>",
</span><span>  "</span><span style=color:#a3be8c>message</span><span>": {
</span><span>    "</span><span style=color:#a3be8c>content</span><span>": "</span><span style=color:#a3be8c>I'll calculate that for you.</span><span>",
</span><span>    "</span><span style=color:#a3be8c>tool_calls</span><span>": [{"</span><span style=color:#a3be8c>id</span><span>": "</span><span style=color:#a3be8c>...</span><span>", "</span><span style=color:#a3be8c>function</span><span>": {"</span><span style=color:#a3be8c>name</span><span>": "</span><span style=color:#a3be8c>calculator</span><span>", "</span><span style=color:#a3be8c>arguments</span><span>": "</span><span style=color:#a3be8c>{...}</span><span>"}}]
</span><span>  }
</span><span>}
</span></code></pre><p>éœ€è¦è½¬æˆ Anthropic æ ¼å¼ï¼š<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>stop_reason</span><span>": "</span><span style=color:#a3be8c>tool_use</span><span>",
</span><span>  "</span><span style=color:#a3be8c>content</span><span>": [
</span><span>    {"</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>text</span><span>", "</span><span style=color:#a3be8c>text</span><span>": "</span><span style=color:#a3be8c>I'll calculate that for you.</span><span>"},
</span><span>    {"</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>tool_use</span><span>", "</span><span style=color:#a3be8c>id</span><span>": "</span><span style=color:#a3be8c>...</span><span>", "</span><span style=color:#a3be8c>name</span><span>": "</span><span style=color:#a3be8c>calculator</span><span>", "</span><span style=color:#a3be8c>input</span><span>": {</span><span style=background:#bf616a;color:#2b303b>...</span><span>}}
</span><span>  ]
</span><span>}
</span></code></pre><h2 id=cai-keng-copilot-de-split-choices-ge-shi>è¸©å‘ï¼šCopilot çš„ Split-Choices æ ¼å¼</h2><p>å½“æˆ‘ä»¥ä¸ºæå®šäº†ï¼Œæµ‹è¯•æ—¶å‘ç°å“åº”é‡Œåªæœ‰ textï¼Œtool_use block æ¶ˆå¤±äº†ã€‚<p>è°ƒè¯•å‘ç°ï¼ŒGitHub Copilot åç«¯è¿”å›çš„æ ¼å¼å¾ˆã€Œç‰¹åˆ«ã€â€”â€”å®ƒæŠŠ text å’Œ tool_calls æ”¾åœ¨<strong>ä¸¤ä¸ªç‹¬ç«‹çš„ choices</strong> é‡Œï¼š<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>choices</span><span>": [
</span><span>    {"</span><span style=color:#a3be8c>message</span><span>": {"</span><span style=color:#a3be8c>content</span><span>": "</span><span style=color:#a3be8c>I'll calculate...</span><span>"}},      </span><span style=color:#65737e>// choice[0]: åªæœ‰ text
</span><span>    {"</span><span style=color:#a3be8c>message</span><span>": {"</span><span style=color:#a3be8c>tool_calls</span><span>": [</span><span style=background:#bf616a;color:#2b303b>...</span><span>]}}                  </span><span style=color:#65737e>// choice[1]: åªæœ‰ tool_calls
</span><span>  ]
</span><span>}
</span></code></pre><p>è€Œæ ‡å‡† OpenAI æ ¼å¼æ˜¯æŠŠå®ƒä»¬æ”¾åœ¨åŒä¸€ä¸ª choice é‡Œï¼š<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>choices</span><span>": [
</span><span>    {"</span><span style=color:#a3be8c>message</span><span>": {"</span><span style=color:#a3be8c>content</span><span>": "</span><span style=color:#a3be8c>...</span><span>", "</span><span style=color:#a3be8c>tool_calls</span><span>": [</span><span style=background:#bf616a;color:#2b303b>...</span><span>]}}
</span><span>  ]
</span><span>}
</span></code></pre><p>æ‰€ä»¥æˆ‘çš„è½¬æ¢ä»£ç åªè¯» <code>choices[0]</code>ï¼Œè‡ªç„¶ä¸¢å¤±äº† <code>tool_calls</code>ã€‚<p>ä¿®å¤ï¼šéå†æ‰€æœ‰ choicesï¼Œåˆå¹¶ text å’Œ tool_callsï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#b48ead>def </span><span style=color:#8fa1b3>openai_to_anthropic_response</span><span>(</span><span style=color:#bf616a>openai_resp</span><span>: dict, </span><span style=color:#bf616a>model</span><span>: str) -> dict:
</span><span>    content_text = ""
</span><span>    all_tool_calls = []
</span><span>    
</span><span>    </span><span style=color:#65737e># åˆå¹¶æ‰€æœ‰ choices çš„å†…å®¹
</span><span>    </span><span style=color:#b48ead>for </span><span>choice </span><span style=color:#b48ead>in </span><span>openai_resp.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>choices</span><span>", []):
</span><span>        message = choice.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>message</span><span>", {})
</span><span>        </span><span style=color:#b48ead>if </span><span>message.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>content</span><span>"):
</span><span>            content_text += message["</span><span style=color:#a3be8c>content</span><span>"]
</span><span>        </span><span style=color:#b48ead>if </span><span>message.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>tool_calls</span><span>"):
</span><span>            all_tool_calls.</span><span style=color:#bf616a>extend</span><span>(message["</span><span style=color:#a3be8c>tool_calls</span><span>"])
</span><span>    
</span><span>    </span><span style=color:#65737e># æ„å»º Anthropic content blocks
</span><span>    content_blocks = []
</span><span>    </span><span style=color:#b48ead>if </span><span>content_text:
</span><span>        content_blocks.</span><span style=color:#bf616a>append</span><span>({"</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>text</span><span>", "</span><span style=color:#a3be8c>text</span><span>": content_text})
</span><span>    </span><span style=color:#b48ead>for </span><span>tc </span><span style=color:#b48ead>in </span><span>all_tool_calls:
</span><span>        content_blocks.</span><span style=color:#bf616a>append</span><span>({
</span><span>            "</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>tool_use</span><span>",
</span><span>            "</span><span style=color:#a3be8c>id</span><span>": tc["</span><span style=color:#a3be8c>id</span><span>"],
</span><span>            "</span><span style=color:#a3be8c>name</span><span>": tc["</span><span style=color:#a3be8c>function</span><span>"]["</span><span style=color:#a3be8c>name</span><span>"],
</span><span>            "</span><span style=color:#a3be8c>input</span><span>": json.</span><span style=color:#bf616a>loads</span><span>(tc["</span><span style=color:#a3be8c>function</span><span>"]["</span><span style=color:#a3be8c>arguments</span><span>"])
</span><span>        })
</span><span>    
</span><span>    </span><span style=color:#b48ead>return </span><span>{
</span><span>        "</span><span style=color:#a3be8c>content</span><span>": content_blocks,
</span><span>        "</span><span style=color:#a3be8c>stop_reason</span><span>": "</span><span style=color:#a3be8c>tool_use</span><span>" </span><span style=color:#b48ead>if </span><span>all_tool_calls </span><span style=color:#b48ead>else </span><span>"</span><span style=color:#a3be8c>end_turn</span><span>",
</span><span>        </span><span style=color:#d08770>...
</span><span>    }
</span></code></pre><h2 id=zui-zhong-ce-shi>æœ€ç»ˆæµ‹è¯•</h2><p>ä¿®å¤éƒ¨ç½²åï¼Œæµ‹è¯• APIï¼š<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>curl -s</span><span> https://api.polly.wang/v1/messages \
</span><span style=color:#bf616a>  -H </span><span>"</span><span style=color:#a3be8c>x-api-key: </span><span>$</span><span style=color:#bf616a>KEY</span><span>" \
</span><span style=color:#bf616a>  -d </span><span>'</span><span style=color:#a3be8c>{
</span><span style=color:#a3be8c>    "model": "claude-sonnet-4",
</span><span style=color:#a3be8c>    "messages": [{"role": "user", "content": "Use calculator to compute 25*17"}],
</span><span style=color:#a3be8c>    "tools": [{"name": "calculator", ...}]
</span><span style=color:#a3be8c>  }</span><span>'
</span></code></pre><p>å“åº”ï¼š<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>stop_reason</span><span>": "</span><span style=color:#a3be8c>tool_use</span><span>",
</span><span>  "</span><span style=color:#a3be8c>content</span><span>": [
</span><span>    {"</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>text</span><span>", "</span><span style=color:#a3be8c>text</span><span>": "</span><span style=color:#a3be8c>I'll use the calculator tool to compute 25*17 for you.</span><span>"},
</span><span>    {"</span><span style=color:#a3be8c>type</span><span>": "</span><span style=color:#a3be8c>tool_use</span><span>", "</span><span style=color:#a3be8c>id</span><span>": "</span><span style=color:#a3be8c>tooluse_xxx</span><span>", "</span><span style=color:#a3be8c>name</span><span>": "</span><span style=color:#a3be8c>calculator</span><span>", "</span><span style=color:#a3be8c>input</span><span>": {"</span><span style=color:#a3be8c>expr</span><span>": "</span><span style=color:#a3be8c>25*17</span><span>"}}
</span><span>  ]
</span><span>}
</span></code></pre><p>å®Œç¾ï¼âœ…<p>å›åˆ° OpenClawï¼Œè®©å°é¾™è™¾å†™æ–‡ä»¶ï¼š<pre style=background:#2b303b;color:#c0c5ce><code><span>ğŸ¾: å¸®æˆ‘å†™ä¸ª hello.md æ–‡ä»¶
</span><span>
</span><span>ğŸ“„ Command: ~/.openclaw/workspace/hello.md
</span><span>âœ… Successfully wrote 149 bytes
</span></code></pre><p>è¿™æ¬¡æ˜¯çœŸçš„å†™å…¥äº†ã€‚<code>cat ~/.openclaw/workspace/hello.md</code> ç¡®è®¤æ–‡ä»¶å­˜åœ¨ã€‚<h2 id=ban-ben-zong-jie>ç‰ˆæœ¬æ€»ç»“</h2><table><thead><tr><th>ç‰ˆæœ¬<th>ç‰¹æ€§<th>ä»£ç é‡<tbody><tr><td>v2.2.1<td>Config å‘½ä»¤<td>-<tr><td><strong>v2.3.0</strong><td>å®Œæ•´ Anthropic tools æ”¯æŒ<td>+822 è¡Œ<tr><td><strong>v2.3.1</strong><td>ä¿®å¤ Copilot split-choices æ ¼å¼<td>+115 è¡Œæµ‹è¯•</table><p>å…³é”®å®ç°ï¼š<ul><li><code>anthropic_tools_to_openai()</code>: å·¥å…·å®šä¹‰è½¬æ¢<li><code>anthropic_tool_use_to_openai()</code>: tool_use block è½¬æ¢<li><code>anthropic_tool_result_to_openai()</code>: tool_result è½¬æ¢<li><code>openai_tool_calls_to_anthropic()</code>: å“åº” tool_calls è½¬æ¢<li>Split-choices åˆå¹¶é€»è¾‘</ul><h2 id=jing-yan-jiao-xun>ç»éªŒæ•™è®­</h2><ol><li><strong>LLM å¹»è§‰ä¸æ€»æ˜¯æ¨¡å‹çš„é”™</strong> â€”â€” æœ‰æ—¶æ˜¯ä½ æ²¡æŠŠå·¥å…·å‘Šè¯‰å®ƒ<li><strong>ä¸åŒåç«¯çš„æ ¼å¼å·®å¼‚æ¯”æƒ³è±¡ä¸­å¤§</strong> â€”â€” Copilot çš„ split-choices å°±æ˜¯ä¸ªä¾‹å­<li><strong>å…ˆæµ‹ API å†æµ‹åº”ç”¨</strong> â€”â€” ç”¨ curl éš”ç¦»é—®é¢˜æ¯”åœ¨ OpenClaw é‡Œè°ƒè¯•å¿«å¾—å¤š<li><strong>session logs æ˜¯è°ƒè¯•åˆ©å™¨</strong> â€”â€” å®ƒå‘Šè¯‰ä½  Agent åˆ°åº•åšäº†ä»€ä¹ˆ</ol><p>ä¸‹ä¸€æ­¥ï¼šè®©å°é¾™è™¾å¸®æˆ‘ç®¡ç†åšå®¢ã€è®°å½•æ—¥å¸¸ï¼ŒçœŸæ­£æˆä¸ºã€Œæ•°å­—åˆ†èº«ã€çš„ä¸€éƒ¨åˆ†ã€‚<hr><p><em>æ·±å¤œçš„ç¡¬ç›˜ä¸ç¡è§‰ï¼Œä½†ç¨‹åºå‘˜è¯¥ç¡äº†ã€‚ğŸ¾</em></div><div class=navigation></div></div><div id=giscus-container><h2>Comments</h2><div class=giscus></div></div><script data-category="Blog Comments" async crossorigin data-category-id=DIC_kwDOL45duM4CnjlZ data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=pathname data-reactions-enabled=1 data-repo=Polly2014/polly2014.github.io data-repo-id=R_kgDOL45duA data-strict=0 data-theme=noborder_light src=https://giscus.app/client.js></script><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                // ç°ç™½é»‘è‰²è°ƒ + è“è‰²ç‚¹ç¼€
                primaryColor: '#e8e8e8',
                primaryTextColor: '#333',
                primaryBorderColor: '#999',
                lineColor: 'rgb(61, 146, 201)',
                secondaryColor: '#f5f5f5',
                tertiaryColor: '#fafafa',
                background: '#f2f2f2',
                mainBkg: '#f5f5f5',
                nodeBorder: '#999',
                clusterBkg: '#eee',
                clusterBorder: '#ccc',
                titleColor: '#333',
                edgeLabelBackground: '#f2f2f2',
                // æ–‡æœ¬é¢œè‰²
                textColor: '#333',
                nodeTextColor: '#333',
                // å…¶ä»–
                fontFamily: "'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace"
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // æŸ¥æ‰¾æ‰€æœ‰ mermaid ä»£ç å—å¹¶æ¸²æŸ“
        document.querySelectorAll('pre code.language-mermaid').forEach((block, index) => {
            const container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = block.textContent;
            block.parentNode.replaceWith(container);
        });

        // æ¸²æŸ“æ‰€æœ‰ mermaid å›¾è¡¨
        await mermaid.run();
    </script><style>.cover-image{text-align:center;margin:1.5em 0 2em 0}.cover-image img{width:60%;height:auto;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15)}.mermaid{background:#fafafa;border:1px solid #ddd;padding:20px;margin:20px 0;overflow-x:auto}.mermaid svg{max-width:100%;height:auto}@media (max-width:768px){.cover-image img{width:100%}}</style></div></div><script>document.addEventListener('DOMContentLoaded',function(){const c=document.querySelector('.menu-toggle');const d=document.querySelector('.sidebar');const e=document.querySelector('.overlay');function a(){d.classList.toggle('active');e.classList.toggle('active')}c.addEventListener('click',a);e.addEventListener('click',a);let f=0;let g=0;document.addEventListener('touchstart',h=>{f=h.changedTouches[0].screenX},false);document.addEventListener('touchend',h=>{g=h.changedTouches[0].screenX;b()},false);function b(){const h=g- f;if(h>50&&f<30){d.classList.add('active');e.classList.add('active')}else if(h<-50&&d.classList.contains('active')){d.classList.remove('active');e.classList.remove('active')}}})</script>