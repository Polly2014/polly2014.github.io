<!doctype html><html><head><title>✂️ GateX v2：删掉 2000 行代码后，它反而更强了</title><meta content="三周前我写了 GateX，一个把 Copilot 变成本地 API 的 VS Code 扩展。它长到了 3200 行、8 个源文件，拥有 Dashboard、缓存、队列、统计……以及一个我从来没打开过的 Web 面板。今天我删掉了 2000 行代码，留下 1726 行和 5 个文件。功能反而更强了。这篇文章记录从繁到简的全过程，以及我对 Less is More 的重新理解。" name=description><meta content="Polly, Blog, AI Blog, AI Assistant, Tutorials, Technology Blog, Baoli Wang" name=keywords><meta content="width=device-width,initial-scale=1" name=viewport><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content=#333 name=theme-color><meta content=article property=og:type><meta content=https://polly.wang/gatex-v2-from-bloat-to-lean/ property=og:url><meta content="✂️ GateX v2：删掉 2000 行代码后，它反而更强了" property=og:title><meta content="三周前我写了 GateX，一个把 Copilot 变成本地 API 的 VS Code 扩展。它长到了 3200 行、8 个源文件，拥有 Dashboard、缓存、队列、统计……以及一个我从来没打开过的 Web 面板。今天我删掉了 2000 行代码，留下 1726 行和 5 个文件。功能反而更强了。这篇文章记录从繁到简的全过程，以及我对 Less is More 的重新理解。" property=og:description><meta content=https://polly.wang/images/polly.png property=og:image><meta content="Polly Blog" property=og:site_name><meta content=zh_CN property=og:locale><meta content=summary_large_image name=twitter:card><meta content=https://polly.wang/gatex-v2-from-bloat-to-lean/ name=twitter:url><meta content="✂️ GateX v2：删掉 2000 行代码后，它反而更强了" name=twitter:title><meta content="三周前我写了 GateX，一个把 Copilot 变成本地 API 的 VS Code 扩展。它长到了 3200 行、8 个源文件，拥有 Dashboard、缓存、队列、统计……以及一个我从来没打开过的 Web 面板。今天我删掉了 2000 行代码，留下 1726 行和 5 个文件。功能反而更强了。这篇文章记录从繁到简的全过程，以及我对 Less is More 的重新理解。" name=twitter:description><meta content=https://polly.wang/images/polly.png name=twitter:image><meta content=2026-02-09T00:00:00 property=article:published_time><meta content=Polly property=article:author><meta content=GateX property=article:tag><meta content="VS Code Extension" property=article:tag><meta content=重构 property=article:tag><meta content="Less is More" property=article:tag><meta content=TypeScript property=article:tag><meta content="vscode.lm API" property=article:tag><meta content=AI工程 property=article:tag><meta content=开源 property=article:tag><link rel="shortcut icon" href=https://polly.wang/images/polly.ico type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=icon type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=apple-touch-icon><link href=https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css rel=stylesheet><link href=https://polly.wang/css/style_new.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-8JD13N7PHS" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-8JD13N7PHS';);</script><body><div class=menu-toggle><img alt=Menu src=https://polly.wang/images/polly.png></div><div class=overlay></div><div class="pure-g container"><div class="sidebar pure-u-1 pure-u-md-1-5"><div class=title><a class=pure-menu-heading href=https://polly.wang> <img class="avatar pure-img-responsive" src=https://polly.wang/images/polly.png> </a><div class=introduction><p>Polly's Blog</div><div class=nav><ul class=nav-links><li><a href=https://polly.wang><i class="fas fa-home"></i>Home</a><li><a href=https://polly.wang/archive><i class="fas fa-archive"></i>Archive</a><li><a href=https://polly.wang/category><i class="fas fa-folder"></i>Category</a><li><a href=https://polly.wang/blog><i class="fas fa-file-alt"></i>Posts</a><li><a href=https://polly.wang/cfp><i class="fas fa-calendar-alt"></i>CFP</a><li><a href=https://polly.wang/publication><i class="fas fa-file-pdf"></i>Research</a><li><a href=https://polly.wang/changelog><i class="fas fa-history"></i>Change Log</a><li><a href=https://polly.wang/about><i class="fas fa-info-circle"></i>About Me</a></ul></div><div class=social><ul class=social-links><li><a href=mailto:26716201@qq.com><i class="fas fa-envelope"></i></a><li><a href=https://twitter.com/Polly__007><i class="fab fa-twitter"></i></a><li><a href=https://www.linkedin.com/in/baoliwang><i class="fab fa-linkedin-in"></i></a><li><a href=https://github.com/Polly2014><i class="fab fa-github"></i></a></ul></div></div></div><div class="content pure-u-1 pure-u-md-4-5"><div class=blog-post><h1>✂️ GateX v2：删掉 2000 行代码后，它反而更强了</h1><div class=content><p>三周前，GateX v0.1.0 诞生了。<a href=/gatex-kill-agent-maestro>那篇文章</a>记录了一个很爽的故事——发现 Agent Maestro 有 120 秒硬编码超时，于是连夜自己写一个更好的。<p>代码提交，Marketplace 上架，故事结束。<p>但故事没有结束。代码在长。<hr><h2 id=chart-with-upwards-trend-yi-ge-kuo-zhan-shi-zen-yao-bian-pang-de>📈 一个扩展是怎么变胖的</h2><p>GateX 的初始需求很简单：<strong>把 VS Code 的 <code>vscode.lm</code> API 暴露为 HTTP 接口</strong>。说白了就是一个协议转换器——左手接 OpenAI/Anthropic 格式的请求，右手调 VS Code 的模型 API，中间做一下格式翻译。<p>核心代码大概 300 行就能搞定。<p>然后我开始"加功能"：<pre style=background:#2b303b;color:#c0c5ce><code><span>第 1 天：server.ts + extension.ts ✅
</span><span>第 2 天："要不加个 Dashboard 看看请求统计？"
</span><span>第 3 天："缓存相同请求能省 Token 吧？"
</span><span>第 4 天："并发请求应该排队处理……"
</span><span>第 5 天："统计数据得持久化……"
</span></code></pre><p>每一步都很"合理"。每一步都让代码更复杂。<p>到 v0.1.2 发布时，GateX 长成了这样：<table><thead><tr><th>文件<th>行数<th>功能<tbody><tr><td><code>server.ts</code><td>~600<td>HTTP 服务器（含硬编码模型映射表）<tr><td><code>dashboard.ts</code><td><strong>1,557</strong><td>Web Dashboard（内嵌 HTML/CSS/JS）<tr><td><code>stats.ts</code><td>278<td>统计追踪<tr><td><code>cache.ts</code><td>192<td>响应缓存<tr><td><code>queue.ts</code><td>187<td>请求队列<tr><td><code>extension.ts</code><td>~200<td>入口（到处是 statsManager 引用）<tr><td><code>models.ts</code><td>~120<td>模型管理<tr><td><code>statusBar.ts</code><td>~80<td>状态栏<tr><td><strong>合计</strong><td><strong>~3,200</strong><td></table><p>注意那个 <code>dashboard.ts</code>——<strong>1,557 行</strong>，比其他所有文件加起来还多。它在扩展内嵌了一个完整的 Web 页面，有请求量图表、成功率饼图、模型分布统计……<p>我大概打开过三次。其中两次是为了截图写 README。<hr><h2 id=copilotx-dai-lai-de-fan-si>🪞 CopilotX 带来的反思</h2><p>今天还开发了 <a href=/copilotx-turn-copilot-into-local-api>CopilotX</a>——一个 Python 独立工具，功能和 GateX 几乎相同（把 Copilot 变成本地 API），但完全不依赖 VS Code。<p>写 CopilotX 的过程让我重新审视 GateX：<blockquote><p>CopilotX 的核心代码只有 <strong>一个文件</strong>，却支持 OpenAI + Anthropic 双格式、流式输出、并发请求、智能重试。<p>GateX 有 <strong>8 个文件、3200 行</strong>，多出来的 2000 多行都在干什么？</blockquote><p>答案令人汗颜：<ul><li><strong>Dashboard</strong>（1,557 行）→ 我从来不看<li><strong>Cache</strong>（192 行）→ LLM 响应几乎不应该缓存（同样的 prompt 你想要不同的回答）<li><strong>Queue</strong>（187 行）→ VS Code 的 <code>vscode.lm</code> API 自己就有并发控制<li><strong>Stats</strong>（278 行）→ 统计数据喂给 Dashboard，但 Dashboard 我不看</ul><p>这 2,214 行代码，<strong>没有一行在解决真正的问题</strong>。<p>它们存在的唯一理由是：写的时候觉得"这个功能很酷"。<hr><h2 id=hocho-shou-zhu-dao-shi-zhong-gou>🔪 手术刀式重构</h2><p>认清了问题，重构方案就很清晰了：<h3 id=shan-shi-yao>删什么</h3><pre style=background:#2b303b;color:#c0c5ce><code><span>❌ dashboard.ts  (1,557 行) → 删
</span><span>❌ cache.ts      (192 行)   → 删
</span><span>❌ queue.ts      (187 行)   → 删
</span><span>❌ stats.ts      (278 行)   → 删
</span></code></pre><p>四个文件，一刀切。不是"先注释掉，以后可能用到"，是 <code>git rm</code>。<h3 id=xiu-shi-yao>修什么</h3><p><strong>server.ts</strong> 的问题最多：<ol><li><strong>JSON 解析没有 try/catch</strong> → 一个畸形请求就能让服务器 500<li><strong>模型参数被默默丢弃</strong> → <code>temperature</code>、<code>max_tokens</code> 传了但没传给 <code>model.sendRequest()</code><li><strong>Anthropic 模型映射硬编码</strong> → 写死了 5 个模型名的映射表，新模型出来就不认<li><strong>到处是 statsManager 引用</strong> → 删掉 stats 后满屏报错</ol><p>修复后的 <code>server.ts</code> 关键改进：<pre class=language-typescript data-lang=typescript style=background:#2b303b;color:#c0c5ce><code class=language-typescript data-lang=typescript><span style=color:#65737e>// 之前：空对象，温度、max_tokens 全被忽略
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>response </span><span>= </span><span style=color:#b48ead>await </span><span style=color:#bf616a>model</span><span>.</span><span style=color:#8fa1b3>sendRequest</span><span>(</span><span style=color:#bf616a>messages</span><span>, {}, </span><span style=color:#bf616a>token</span><span>);
</span><span>
</span><span style=color:#65737e>// 之后：正确传递模型参数
</span><span style=color:#b48ead>function </span><span style=color:#8fa1b3>buildModelOptions</span><span>(</span><span style=color:#bf616a>req</span><span>: OpenAIChatRequest) {
</span><span>    </span><span style=color:#b48ead>const </span><span style=color:#bf616a>opts</span><span>: Record&LTstring, unknown> = {};
</span><span>    </span><span style=color:#b48ead>if </span><span>(</span><span style=color:#bf616a>req</span><span>.</span><span style=color:#bf616a>temperature </span><span>!== </span><span style=color:#d08770>undefined</span><span>) </span><span style=color:#bf616a>opts</span><span>['</span><span style=color:#a3be8c>temperature</span><span>'] = </span><span style=color:#bf616a>req</span><span>.</span><span style=color:#bf616a>temperature</span><span>;
</span><span>    </span><span style=color:#b48ead>if </span><span>(</span><span style=color:#bf616a>req</span><span>.</span><span style=color:#bf616a>max_tokens </span><span>!== </span><span style=color:#d08770>undefined</span><span>) </span><span style=color:#bf616a>opts</span><span>['</span><span style=color:#a3be8c>max_tokens</span><span>'] = </span><span style=color:#bf616a>req</span><span>.</span><span style=color:#bf616a>max_tokens</span><span>;
</span><span>    </span><span style=color:#b48ead>if </span><span>(</span><span style=color:#bf616a>req</span><span>.</span><span style=color:#bf616a>top_p </span><span>!== </span><span style=color:#d08770>undefined</span><span>) </span><span style=color:#bf616a>opts</span><span>['</span><span style=color:#a3be8c>top_p</span><span>'] = </span><span style=color:#bf616a>req</span><span>.</span><span style=color:#bf616a>top_p</span><span>;
</span><span>    </span><span style=color:#b48ead>return </span><span>{ modelOptions: </span><span style=color:#bf616a>opts </span><span>};
</span><span>}
</span></code></pre><pre class=language-typescript data-lang=typescript style=background:#2b303b;color:#c0c5ce><code class=language-typescript data-lang=typescript><span style=color:#65737e>// 之前：硬编码映射，只认 5 个模型
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>MODEL_MAP</span><span>: Record&LTstring, string> = {
</span><span>    '</span><span style=color:#a3be8c>claude-3-5-sonnet</span><span>': '</span><span style=color:#a3be8c>copilot-claude-3.5-sonnet</span><span>',
</span><span>    '</span><span style=color:#a3be8c>claude-3-opus</span><span>': '</span><span style=color:#a3be8c>copilot-claude-3-opus</span><span>',
</span><span>    </span><span style=color:#65737e>// ...
</span><span>};
</span><span>
</span><span style=color:#65737e>// 之后：动态模糊匹配，不怕新模型
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>model </span><span>= </span><span style=color:#b48ead>await </span><span style=color:#bf616a>modelManager</span><span>.</span><span style=color:#8fa1b3>getModel</span><span>(</span><span style=color:#bf616a>requestedName</span><span>);
</span><span style=color:#65737e>// getModel 先精确匹配，不中再模糊匹配（包含关系 + 编辑距离）
</span></code></pre><h3 id=jia-shi-yao>加什么</h3><p>删了 2000 行，加了两个真正有用的功能：<p><strong>1. Vendor Filter（模型供应商过滤）</strong><p><code>vscode.lm.selectChatModels({})</code> 会返回 VS Code 里<strong>所有扩展</strong>提供的模型——不只是 Copilot，还有 AI Toolkit、Foundry Local 等。我的 VS Code 里一度列出了 <strong>215 个模型</strong>，大部分根本不能用。<p>解决方案：<code>gatex.vendors</code> 配置项，默认只暴露 <code>copilot</code> 模型。<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span style=color:#65737e>// settings.json
</span><span>{
</span><span>    "</span><span style=color:#a3be8c>gatex.vendors</span><span>": ["</span><span style=color:#a3be8c>copilot</span><span>"]  </span><span style=color:#65737e>// 215 → ~25 个有效模型
</span><span>}
</span></code></pre><p><strong>2. IDE 配置生成器（configGenerator.ts）</strong><p>这是从 <a href=https://github.com/Joouis/agent-maestro>Agent Maestro</a> 学来的灵感。与其让用户手动写配置，不如一键生成。<p>按 <code>Ctrl+Shift+P</code> → <code>GateX: Configure for IDE</code>，支持：<ul><li><strong>Claude Code</strong> → 双模型选择（main + fast），自动写入 <code>.claude/settings.json</code>，自动绕过 onboarding<li><strong>Codex CLI</strong> → 生成 <code>~/.codex/config.toml</code><li><strong>.env 文件</strong> → OpenAI + Anthropic 环境变量<li><strong>剪贴板</strong> → <code>export</code> 或 <code>$env:</code> 命令</ul><p>模型选择器按家族分组（Claude / GPT / Gemini / Other），每个 IDE 有 ⭐ 推荐：<pre style=background:#2b303b;color:#c0c5ce><code><span>⭐ Recommended
</span><span>   claude-sonnet-4
</span><span>── Claude ──
</span><span>   claude-sonnet-4
</span><span>   claude-haiku-3.5
</span><span>── GPT ──
</span><span>   gpt-4o
</span><span>   gpt-4o-mini
</span><span>── Gemini ──
</span><span>   gemini-2.0-flash
</span></code></pre><hr><h2 id=bar-chart-shu-zi-shuo-hua>📊 数字说话</h2><table><thead><tr><th>指标<th>v0.1.2<th>v1.0.0 (v2)<th>变化<tbody><tr><td>源文件数<td>8<td>5<td>-37%<tr><td>总代码行数<td>~3,200<td>1,726<td><strong>-46%</strong><tr><td>最大单文件<td>1,557 行 (dashboard)<td>687 行 (server)<td>-56%<tr><td>运行时依赖<td>0<td>0<td>—<tr><td>API 格式<td>OpenAI + Anthropic<td>OpenAI + Anthropic<td>—<tr><td>流式输出<td>✅<td>✅<td>—<tr><td>模型参数传递<td>❌ (被丢弃)<td>✅<td>🆕 修复<tr><td>JSON 错误保护<td>❌<td>✅<td>🆕 修复<tr><td>端口冲突处理<td>❌ (直接崩)<td>✅ (自动换端口)<td>🆕 修复<tr><td>Vendor 过滤<td>❌ (215个全列出)<td>✅ (默认仅 Copilot)<td>🆕 功能<tr><td>IDE 配置生成<td>❌<td>✅ (Claude/Codex/.env)<td>🆕 功能<tr><td>Web Dashboard<td>✅ (1,557行)<td>❌ (删了)<td>🗑️<tr><td>响应缓存<td>✅ (192行)<td>❌ (删了)<td>🗑️<tr><td>请求队列<td>✅ (187行)<td>❌ (删了)<td>🗑️<tr><td>统计追踪<td>✅ (278行)<td>❌ (删了)<td>🗑️</table><p><strong>少了 46% 的代码，多了 4 个新功能，修了 3 个 bug。</strong><p>这不是什么激进的重构，只是把不该存在的东西移除了。<hr><h2 id=wrench-si-ge-commit-de-gu-shi>🔧 四个 Commit 的故事</h2><p>Git log 精确记录了这次重构的四步：<pre style=background:#2b303b;color:#c0c5ce><code><span>682b0a2 feat: enhanced config generator (learned from Agent Maestro)
</span><span>97f4803 feat: add vendor filter (gatex.vendors) - default copilot only
</span><span>2da24a0 fix: fallback to next port when configured port is busy (EADDRINUSE)
</span><span>3546129 v2.0: Lean rewrite — delete bloat, fix bugs, add IDE config generator
</span></code></pre><p><strong>Commit 1</strong> (<code>3546129</code>)：大刀阔斧。删 4 个文件，重写 server.ts 和 extension.ts，新增 configGenerator.ts。编译通过，一次提交。<p><strong>Commit 2</strong> (<code>2da24a0</code>)：装上新版后发现端口 24680 被旧进程占着，扩展直接起不来。加了 <code>isPortAvailable()</code> 检测和自动换端口逻辑。<p><strong>Commit 3</strong> (<code>97f4803</code>)：发现 VS Code 里居然检测到 215 个模型——原来 AI Toolkit 等扩展也在注册模型。加了 vendor filter，默认只暴露 Copilot 的。<p><strong>Commit 4</strong> (<code>682b0a2</code>)：研究了 Agent Maestro 的配置生成器设计，学到了双模型选择、onboarding bypass、TOML 支持、家族分组等 UX 优化。重写 configGenerator.ts。<p>四个 commit，从粗到细，从结构到细节。重构不是一蹴而就的，而是<strong>用了之后才知道哪里还不对</strong>。<hr><h2 id=bulb-cong-agent-maestro-xue-dao-de-he-mei-xue-de>💡 从 Agent Maestro 学到的，和没学的</h2><p>v2 重构中有一个有趣的插曲：我回头仔细研究了当初"干掉"的 <a href=https://github.com/Joouis/agent-maestro>Agent Maestro</a>。<p>三周前的我只关注它的 120 秒超时缺陷。三周后重新看它，我注意到了一些优秀的设计：<p><strong>学到的：</strong><ul><li>⭐ 双模型选择器（main model + fast model）→ 完美适配 Claude Code 的 <code>ANTHROPIC_SMALL_FAST_MODEL</code><li>⭐ Onboarding bypass → 自动写 <code>~/.claude/config.json</code> 跳过 Anthropic 首次配置<li>⭐ 模型按家族分组 → 比一长串列表可读性好十倍<li>⭐ TOML 配置支持 → Codex CLI 用 TOML 而不是 JSON</ul><p><strong>没学的：</strong><ul><li>❌ MCP Server 集成 → 超出了"API Gateway"的职责<li>❌ 内置 Agent 框架 → 这是 Agent 该做的事，不是 Gateway<li>❌ 六种 IDE 配置（Cursor、Windsurf……）→ 先做好核心的，剩下按需加</ul><p>一个有趣的轮回：GateX 因为嫌 Agent Maestro 太复杂而诞生，v2 又从它身上学到了真正好的设计。<strong>不是否定它，而是有选择地吸收</strong>。<hr><h2 id=person-in-lotus-position-less-is-more-bu-shi-gong-neng-shao>🧘 Less is More 不是功能少</h2><p>重构完成后，我在想：为什么 v1 会写出 1,557 行的 Dashboard？<p>因为<strong>做加法太容易了</strong>。<p>写一个新功能、加一个新文件、多一个配置项——每次都能获得"我做了事情"的即时满足感。代码行数在涨，功能列表在长，README 里可以多写一个 bullet point。<p>但真正的用户体验在退化。启动慢了，配置复杂了，debug 难了，一个 JSON 畸形请求就能让服务器 500。<p><strong>Less is More 不是说功能要少</strong>。v2 的功能比 v1 多（vendor filter、配置生成器、端口容错）。Less is More 说的是：<blockquote><p><strong>每一行代码都应该为用户解决真正的问题。</strong></blockquote><ul><li>Dashboard 不解决任何问题 → 删<li>缓存 LLM 响应制造问题 → 删<li>自动配置 IDE 解决真问题 → 加<li>JSON 解析保护解决真问题 → 加</ul><p>我给自己定了一个以后写代码前要问的问题：<blockquote><p>"如果我不做这个功能，用户会怎样？"</blockquote><p>如果答案是"完全没影响"，那就不该做。<hr><h2 id=link-xi-lie-wen-zhang>🔗 系列文章</h2><p>GateX 系列现在有三篇了：<ol><li>⚡ <a href=/gatex-kill-agent-maestro>GateX：我如何用一天时间干掉 Agent Maestro</a> — 诞生<li>🚀 <a href=/gatex-marketplace-publish-journey>GateX 上架记：从打包到 Marketplace 的踩坑之旅</a> — 发布<li>✂️ <strong>本文：删掉 2000 行代码后，它反而更强了</strong> — 回归</ol><p>以及一篇姐妹项目的文章：<ol start=4><li>🚀 <a href=/copilotx-turn-copilot-into-local-api>CopilotX：一个晚上，把 GitHub Copilot 变成本地 API 服务器</a> — Python 独立版</ol><p><strong>GateX</strong> 是 VS Code 扩展版（零配置，开 VS Code 就能用），<strong>CopilotX</strong> 是 Python 独立版（<code>pip install copilotx</code>，纯终端就能跑）。两个工具互补，覆盖不同场景。<hr><h2 id=inbox-tray-huo-qu-gatex-v1-0-0>📥 获取 GateX v1.0.0</h2><pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#65737e># VS Code Marketplace
</span><span style=color:#bf616a>ext</span><span> install BaoliWang.gatex
</span><span>
</span><span style=color:#65737e># 或直接搜索 "GateX"
</span></code></pre><p>👉 <a href=https://github.com/Polly2014/GateX>GitHub: Polly2014/GateX</a> 👉 <a href="https://marketplace.visualstudio.com/items?itemName=BaoliWang.gatex">VS Code Marketplace</a><hr><p><em>写这篇文章时我又重新看了一遍 v1 的 dashboard.ts。1,557 行 TypeScript 里内嵌了完整的 HTML、CSS 和 Chart.js 调用。那个文件本身就是一个完美的反面教材：技术上没有错误，但完全不应该存在。</em><p><em>有时候，最好的代码就是被你删掉的那些。</em></div><div class=navigation></div></div><div id=giscus-container><h2>Comments</h2><div class=giscus></div></div><script data-category="Blog Comments" async crossorigin data-category-id=DIC_kwDOL45duM4CnjlZ data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=pathname data-reactions-enabled=1 data-repo=Polly2014/polly2014.github.io data-repo-id=R_kgDOL45duA data-strict=0 data-theme=noborder_light src=https://giscus.app/client.js></script><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                // 灰白黑色调 + 蓝色点缀
                primaryColor: '#e8e8e8',
                primaryTextColor: '#333',
                primaryBorderColor: '#999',
                lineColor: 'rgb(61, 146, 201)',
                secondaryColor: '#f5f5f5',
                tertiaryColor: '#fafafa',
                background: '#f2f2f2',
                mainBkg: '#f5f5f5',
                nodeBorder: '#999',
                clusterBkg: '#eee',
                clusterBorder: '#ccc',
                titleColor: '#333',
                edgeLabelBackground: '#f2f2f2',
                // 文本颜色
                textColor: '#333',
                nodeTextColor: '#333',
                // 其他
                fontFamily: "'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace"
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // 查找所有 mermaid 代码块并渲染
        document.querySelectorAll('pre code.language-mermaid').forEach((block, index) => {
            const container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = block.textContent;
            block.parentNode.replaceWith(container);
        });

        // 渲染所有 mermaid 图表
        await mermaid.run();
    </script><style>.cover-image{text-align:center;margin:1.5em 0 2em 0}.cover-image img{width:60%;height:auto;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15)}.mermaid{background:#fafafa;border:1px solid #ddd;padding:20px;margin:20px 0;overflow-x:auto}.mermaid svg{max-width:100%;height:auto}@media (max-width:768px){.cover-image img{width:100%}}</style></div></div><script>document.addEventListener('DOMContentLoaded',function(){const c=document.querySelector('.menu-toggle');const d=document.querySelector('.sidebar');const e=document.querySelector('.overlay');function a(){d.classList.toggle('active');e.classList.toggle('active')}c.addEventListener('click',a);e.addEventListener('click',a);let f=0;let g=0;document.addEventListener('touchstart',h=>{f=h.changedTouches[0].screenX},false);document.addEventListener('touchend',h=>{g=h.changedTouches[0].screenX;b()},false);function b(){const h=g- f;if(h>50&&f<30){d.classList.add('active');e.classList.add('active')}else if(h<-50&&d.classList.contains('active')){d.classList.remove('active');e.classList.remove('active')}}})</script>