<!doctype html><html><head><title>ğŸŒ CopilotX v2.0ï¼šä»æœ¬åœ°å·¥å…·åˆ°è¿œç¨‹æœåŠ¡ï¼Œä¸€ä¸ªä¸‹åˆçš„è¿›åŒ–</title><meta content="CopilotX v1.0 åªèƒ½åœ¨æœ¬æœºç”¨ã€‚ä»Šå¤©æˆ‘èŠ±äº†ä¸€ä¸ªä¸‹åˆï¼Œç»™å®ƒåŠ ä¸Šäº† API Key è®¤è¯ã€è¿œç¨‹æ¨¡å¼æ£€æµ‹ã€Caddy åå‘ä»£ç†æ¨¡æ¿ï¼Œè®©å®ƒå¯ä»¥éƒ¨ç½²åœ¨ Azure VM ä¸Šé€šè¿‡ HTTPS è¿œç¨‹è®¿é—®ã€‚ä» localhost åˆ° api.polly.wangï¼Œä»£ç åªå¢åŠ äº† 225 è¡Œã€‚" name=description><meta content="Polly, Blog, AI Blog, AI Assistant, Tutorials, Technology Blog, Baoli Wang" name=keywords><meta content="width=device-width,initial-scale=1" name=viewport><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content=article property=og:type><meta content=https://polly.wang/copilotx-v2-remote-deployment/ property=og:url><meta content="ğŸŒ CopilotX v2.0ï¼šä»æœ¬åœ°å·¥å…·åˆ°è¿œç¨‹æœåŠ¡ï¼Œä¸€ä¸ªä¸‹åˆçš„è¿›åŒ–" property=og:title><meta content="CopilotX v1.0 åªèƒ½åœ¨æœ¬æœºç”¨ã€‚ä»Šå¤©æˆ‘èŠ±äº†ä¸€ä¸ªä¸‹åˆï¼Œç»™å®ƒåŠ ä¸Šäº† API Key è®¤è¯ã€è¿œç¨‹æ¨¡å¼æ£€æµ‹ã€Caddy åå‘ä»£ç†æ¨¡æ¿ï¼Œè®©å®ƒå¯ä»¥éƒ¨ç½²åœ¨ Azure VM ä¸Šé€šè¿‡ HTTPS è¿œç¨‹è®¿é—®ã€‚ä» localhost åˆ° api.polly.wangï¼Œä»£ç åªå¢åŠ äº† 225 è¡Œã€‚" property=og:description><meta content=https://polly.wang/cover.jpg property=og:image><meta content="Polly Blog" property=og:site_name><meta content=zh_CN property=og:locale><meta content=summary_large_image name=twitter:card><meta content=https://polly.wang/copilotx-v2-remote-deployment/ name=twitter:url><meta content="ğŸŒ CopilotX v2.0ï¼šä»æœ¬åœ°å·¥å…·åˆ°è¿œç¨‹æœåŠ¡ï¼Œä¸€ä¸ªä¸‹åˆçš„è¿›åŒ–" name=twitter:title><meta content="CopilotX v1.0 åªèƒ½åœ¨æœ¬æœºç”¨ã€‚ä»Šå¤©æˆ‘èŠ±äº†ä¸€ä¸ªä¸‹åˆï¼Œç»™å®ƒåŠ ä¸Šäº† API Key è®¤è¯ã€è¿œç¨‹æ¨¡å¼æ£€æµ‹ã€Caddy åå‘ä»£ç†æ¨¡æ¿ï¼Œè®©å®ƒå¯ä»¥éƒ¨ç½²åœ¨ Azure VM ä¸Šé€šè¿‡ HTTPS è¿œç¨‹è®¿é—®ã€‚ä» localhost åˆ° api.polly.wangï¼Œä»£ç åªå¢åŠ äº† 225 è¡Œã€‚" name=twitter:description><meta content=https://polly.wang/cover.jpg name=twitter:image><meta content=2026-02-09T00:00:00 property=article:published_time><meta content=Polly property=article:author><meta content=CopilotX property=article:tag><meta content="GitHub Copilot" property=article:tag><meta content=Python property=article:tag><meta content=FastAPI property=article:tag><meta content=è¿œç¨‹éƒ¨ç½² property=article:tag><meta content=APIå®‰å…¨ property=article:tag><meta content=Caddy property=article:tag><meta content="Azure VM" property=article:tag><meta content=å¼€æº property=article:tag><link rel="shortcut icon" href=https://polly.wang/images/polly.ico type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=icon type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=apple-touch-icon><link href=https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css rel=stylesheet><link href=https://polly.wang/css/style_new.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-8JD13N7PHS" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-8JD13N7PHS';);</script><body><div class=menu-toggle><img alt=Menu src=https://polly.wang/images/polly.png></div><div class=overlay></div><div class="pure-g container"><div class="sidebar pure-u-1 pure-u-md-1-5"><div class=title><a class=pure-menu-heading href=https://polly.wang> <img class="avatar pure-img-responsive" src=https://polly.wang/images/polly.png> </a><div class=introduction><p>Polly's Blog</div><div class=nav><ul class=nav-links><li><a href=https://polly.wang><i class="fas fa-home"></i>Home</a><li><a href=https://polly.wang/archive><i class="fas fa-archive"></i>Archive</a><li><a href=https://polly.wang/category><i class="fas fa-folder"></i>Category</a><li><a href=https://polly.wang/blog><i class="fas fa-file-alt"></i>Posts</a><li><a href=https://polly.wang/cfp><i class="fas fa-calendar-alt"></i>CFP</a><li><a href=https://polly.wang/publication><i class="fas fa-file-pdf"></i>Research</a><li><a href=https://polly.wang/changelog><i class="fas fa-history"></i>Change log</a><li><a href=https://polly.wang/about><i class="fas fa-info-circle"></i>About Me</a></ul></div><div class=social><ul class=social-links><li><a href=mailto:26716201@qq.com><i class="fas fa-envelope"></i></a><li><a href=https://twitter.com/Polly__007><i class="fab fa-twitter"></i></a><li><a href=https://www.linkedin.com/in/baoliwang><i class="fab fa-linkedin-in"></i></a><li><a href=https://github.com/Polly2014><i class="fab fa-github"></i></a></ul></div></div></div><div class="content pure-u-1 pure-u-md-4-5"><div class=blog-post><h1>ğŸŒ CopilotX v2.0ï¼šä»æœ¬åœ°å·¥å…·åˆ°è¿œç¨‹æœåŠ¡ï¼Œä¸€ä¸ªä¸‹åˆçš„è¿›åŒ–</h1><div class=cover-image><img alt="ğŸŒ CopilotX v2.0ï¼šä»æœ¬åœ°å·¥å…·åˆ°è¿œç¨‹æœåŠ¡ï¼Œä¸€ä¸ªä¸‹åˆçš„è¿›åŒ–" loading=lazy src=cover.jpg></div><div class=content><p>ä»Šå¤©æ—©ä¸Šå‘å¸ƒäº† <a href=/copilotx-turn-copilot-into-local-api>CopilotX v1.0</a>ï¼Œä¸€ä¸ªæŠŠ GitHub Copilot å˜æˆæœ¬åœ° API çš„å·¥å…·ã€‚ä¸­åˆåƒé¥­æ—¶æˆ‘æƒ³äº†ä¸€ä¸ªé—®é¢˜ï¼š<p><strong>å¦‚æœæˆ‘å‡ºé—¨äº†ï¼Œç¬”è®°æœ¬ä¸åœ¨èº«è¾¹ï¼Œè¿˜èƒ½ç”¨è¿™äº›æ¨¡å‹å—ï¼Ÿ</strong><p>ç­”æ¡ˆæ˜¯â€”â€”æ”¾ä¸€å°äº‘æœåŠ¡å™¨ä¸Šä¸å°±è¡Œäº†ï¼Ÿ<p>ä½† v1.0 å®Œå…¨æ²¡æœ‰å®‰å…¨é˜²æŠ¤ã€‚å®ƒé»˜è®¤ç»‘å®š <code>127.0.0.1</code>ï¼Œåªèƒ½æœ¬æœºè®¿é—®ã€‚å¦‚æœç›´æ¥æ”¹æˆ <code>0.0.0.0</code> æš´éœ²åˆ°å…¬ç½‘ï¼Œä»»ä½•äººéƒ½èƒ½ç™½å«–ä½ çš„ Copilot è®¢é˜…ã€‚<p>äºæ˜¯æˆ‘èŠ±äº†ä¸€ä¸ªä¸‹åˆï¼ŒæŠŠ CopilotX ä»"æœ¬åœ°å·¥å…·"è¿›åŒ–æˆäº†"å¯è¿œç¨‹éƒ¨ç½²çš„æœåŠ¡"ã€‚<hr><h2 id=xu-qiu-fen-xi-san-fen-zhong-xiang-qing-chu>éœ€æ±‚åˆ†æï¼šä¸‰åˆ†é’Ÿæƒ³æ¸…æ¥š</h2><p>æˆ‘çš„éœ€æ±‚å…¶å®å¾ˆç®€å•ï¼š<ol><li><strong>æœ¬åœ°ç”¨æˆ·é›¶å½±å“</strong> â€”â€” ä¹‹å‰æ€ä¹ˆç”¨ï¼Œç°åœ¨è¿˜æ€ä¹ˆç”¨<li><strong>è¿œç¨‹éœ€è¦å¯†é’¥</strong> â€”â€” æ²¡æœ‰ API Key çš„è¯·æ±‚ç›´æ¥æ‹’ç»<li><strong>localhost å…è®¤è¯</strong> â€”â€” åœ¨æœåŠ¡å™¨æœ¬æœºè°ƒè¯•ä¸ç”¨å¸¦ Key<li><strong>HTTPS</strong> â€”â€” API Key ä¸èƒ½æ˜æ–‡ä¼ è¾“</ol><p>å†™æˆè¡¨æ ¼å°±ä¸€ç›®äº†ç„¶ï¼š<table><thead><tr><th>åœºæ™¯<th>Host<th>API Key<th>è¡Œä¸º<tbody><tr><td>æœ¬åœ°å¼€å‘ï¼ˆv1 ç”¨æˆ·ï¼‰<td><code>127.0.0.1</code><td>ä¸è®¾<td>å…¨å¼€ï¼Œå‘åå…¼å®¹<tr><td>è¿œç¨‹éƒ¨ç½²ï¼ˆæœ‰ä¿æŠ¤ï¼‰<td><code>0.0.0.0</code><td>è®¾äº†<td>localhost å…è®¤è¯ï¼Œè¿œç¨‹éœ€è¦ Bearer Token<tr><td>è¿œç¨‹éƒ¨ç½²ï¼ˆè£¸å¥”ï¼‰<td><code>0.0.0.0</code><td>æ²¡è®¾<td>âš ï¸ å¯åŠ¨æ—¶è­¦å‘Šï¼Œä½†å…è®¸è¿è¡Œ</table><p>æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼š<strong>"Local Trust, Remote Verify"</strong> â€”â€” æœ¬åœ°ä¿¡ä»»ï¼Œè¿œç¨‹éªŒè¯ã€‚<hr><h2 id=shi-xian-225-xing-dai-ma-de-jing-zhun-shou-zhu>å®ç°ï¼š225 è¡Œä»£ç çš„ç²¾å‡†æ‰‹æœ¯</h2><p>æ•´ä¸ª v2.0 åªæ”¹äº† 5 ä¸ªæ–‡ä»¶ï¼Œæ–°å¢ 3 ä¸ªéƒ¨ç½²æ¨¡æ¿ï¼Œæ€»å…± +225 è¡Œã€‚<h3 id=1-an-quan-chang-liang-config-py-8-xing>1. å®‰å…¨å¸¸é‡ï¼ˆconfig.pyï¼Œ+8 è¡Œï¼‰</h3><pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># â”€â”€ Security â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</span><span style=color:#bf616a>COPILOTX_API_KEY </span><span>= os.environ.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>COPILOTX_API_KEY</span><span>", "")
</span><span style=color:#bf616a>LOCALHOST_ADDRS </span><span>= {"</span><span style=color:#a3be8c>127.0.0.1</span><span>", "</span><span style=color:#a3be8c>::1</span><span>", "</span><span style=color:#a3be8c>localhost</span><span>"}
</span><span style=color:#bf616a>PUBLIC_PATHS </span><span>= {"</span><span style=color:#a3be8c>/health</span><span>", "</span><span style=color:#a3be8c>/</span><span>"}
</span></code></pre><p>ä¸‰ä¸ªå˜é‡ï¼Œä¸‰ä¸ªå†³ç­–ï¼š<ul><li><code>COPILOTX_API_KEY</code>ï¼š<strong>ç¯å¢ƒå˜é‡é©±åŠ¨</strong>ï¼Œä¸æ˜¯é…ç½®æ–‡ä»¶ã€‚å› ä¸ºå¯†é’¥ä¸è¯¥æäº¤åˆ°ä»£ç é‡Œ<li><code>LOCALHOST_ADDRS</code>ï¼šåŒæ—¶è¦†ç›– IPv4ã€IPv6 å’Œä¸»æœºå<li><code>PUBLIC_PATHS</code>ï¼šå¥åº·æ£€æŸ¥å’Œæ ¹è·¯å¾„æ°¸è¿œå¯è®¿é—®ï¼Œæ–¹ä¾¿ç›‘æ§æ¢æ´»</ul><h3 id=2-api-key-zhong-jian-jian-app-py-he-xin-50-xing>2. API Key ä¸­é—´ä»¶ï¼ˆapp.pyï¼Œæ ¸å¿ƒ 50 è¡Œï¼‰</h3><p>è¿™æ˜¯æ•´ä¸ª v2 çš„çµé­‚â€”â€”ä¸€ä¸ª Starlette BaseHTTPMiddlewareï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#b48ead>class </span><span style=color:#ebcb8b>ApiKeyMiddleware</span><span style=color:#eff1f5>(</span><span style=color:#a3be8c>BaseHTTPMiddleware</span><span style=color:#eff1f5>):
</span><span>    </span><span style=color:#b48ead>async def </span><span style=color:#8fa1b3>dispatch</span><span>(</span><span style=color:#bf616a>self</span><span>, </span><span style=color:#bf616a>request</span><span>: Request, </span><span style=color:#bf616a>call_next</span><span>) -> Response:
</span><span>        </span><span style=color:#65737e># æ²¡è®¾ Key â†’ å…¨æ”¾è¡Œï¼ˆå‘åå…¼å®¹ v1ï¼‰
</span><span>        </span><span style=color:#b48ead>if </span><span>not </span><span style=color:#bf616a>COPILOTX_API_KEY</span><span>:
</span><span>            </span><span style=color:#b48ead>return await </span><span style=color:#bf616a>call_next</span><span>(request)
</span><span>
</span><span>        </span><span style=color:#65737e># å…¬å¼€è·¯å¾„ â†’ æ”¾è¡Œ
</span><span>        </span><span style=color:#b48ead>if </span><span>request.url.path in </span><span style=color:#bf616a>PUBLIC_PATHS</span><span>:
</span><span>            </span><span style=color:#b48ead>return await </span><span style=color:#bf616a>call_next</span><span>(request)
</span><span>
</span><span>        </span><span style=color:#65737e># localhost â†’ æ”¾è¡Œï¼ˆæœ¬åœ°ä¿¡ä»»ï¼‰
</span><span>        client_host = request.client.host </span><span style=color:#b48ead>if </span><span>request.client </span><span style=color:#b48ead>else </span><span>""
</span><span>        </span><span style=color:#b48ead>if </span><span>client_host in </span><span style=color:#bf616a>LOCALHOST_ADDRS</span><span>:
</span><span>            </span><span style=color:#b48ead>return await </span><span style=color:#bf616a>call_next</span><span>(request)
</span><span>
</span><span>        </span><span style=color:#65737e># è¿œç¨‹è¯·æ±‚ â†’ éªŒè¯ Bearer Token
</span><span>        token = </span><span style=color:#bf616a>extract_token</span><span>(request)  </span><span style=color:#65737e># æ”¯æŒ 3 ç§ header æ ¼å¼
</span><span>        </span><span style=color:#b48ead>if </span><span>token != </span><span style=color:#bf616a>COPILOTX_API_KEY</span><span>:
</span><span>            </span><span style=color:#b48ead>return </span><span style=color:#bf616a>JSONResponse</span><span>(</span><span style=color:#bf616a>status_code</span><span>=</span><span style=color:#d08770>401</span><span>, </span><span style=color:#bf616a>content</span><span>={</span><span style=color:#d08770>...</span><span>})
</span><span>
</span><span>        </span><span style=color:#b48ead>return await </span><span style=color:#bf616a>call_next</span><span>(request)
</span></code></pre><p>å†³ç­–é“¾å¾ˆæ¸…æ™°ï¼š<strong>æ²¡ Key â†’ å…¬å¼€è·¯å¾„ â†’ localhost â†’ éªŒè¯ Token</strong>ã€‚æ¯ä¸€æ­¥éƒ½æ˜¯çŸ­è·¯åˆ¤æ–­ï¼Œå‘½ä¸­å°±æ”¾è¡Œï¼Œåˆ°æœ€åä¸€æ­¥æ‰çœŸæ­£éªŒè¯ã€‚<p>ä¸ºä»€ä¹ˆæ”¯æŒä¸‰ç§ header æ ¼å¼ï¼Ÿå› ä¸ºä¸åŒçš„ SDK ç”¨ä¸åŒçš„æ–¹å¼ä¼  API Keyï¼š<table><thead><tr><th>SDK<th>Header æ ¼å¼<tbody><tr><td>OpenAI SDK<td><code>Authorization: Bearer sk-xxx</code><tr><td>Anthropic SDK<td><code>x-api-key: sk-xxx</code><tr><td>Azure OpenAI SDK<td><code>api-key: xxx</code></table><p>ä¸€ä¸ªä¸­é—´ä»¶å…¼å®¹ä¸‰å¤§ç”Ÿæ€ï¼Œçœå¾—ç”¨æˆ·æŸ¥æ–‡æ¡£ã€‚<h3 id=3-cli-yuan-cheng-mo-shi-gan-zhi-cli-py-15-xing>3. CLI è¿œç¨‹æ¨¡å¼æ„ŸçŸ¥ï¼ˆcli.pyï¼Œ+15 è¡Œï¼‰</h3><p>å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹æ¨¡å¼å¹¶ç»™å‡ºæé†’ï¼š<pre style=background:#2b303b;color:#c0c5ce><code><span>ğŸš€ CopilotX v2.0.0
</span><span>âœ… Copilot Token valid (28m remaining, auto-refresh)
</span><span>ğŸ” API Key protection: ON (localhost exempt)     â† è¿œç¨‹+æœ‰ä¿æŠ¤
</span><span>ğŸ“‹ Models: gpt-4o, claude-sonnet-4, gemini-2.0-flash
</span></code></pre><p>æˆ–è€…å½“ä½  <code>0.0.0.0</code> å¯åŠ¨ä½†å¿˜äº†è®¾ Keyï¼š<pre style=background:#2b303b;color:#c0c5ce><code><span>âš ï¸  WARNING: Remote mode without API key!
</span><span>   Anyone can access your Copilot subscription.
</span><span>   Set COPILOTX_API_KEY env var to enable protection.
</span></code></pre><p>è¿™ä¸ªé»„è‰²è­¦å‘Šå¤Ÿé†’ç›®ï¼Œä½†ä¸é˜»æ­¢å¯åŠ¨â€”â€”ä¹Ÿè®¸ä½ ç¡®å®åœ¨å†…ç½‘ç¯å¢ƒä¸éœ€è¦ Keyã€‚<strong>æé†’ä½†ä¸å¼ºåˆ¶</strong>ã€‚<h3 id=4-bu-shu-mo-ban-deploy-3-ge-xin-wen-jian>4. éƒ¨ç½²æ¨¡æ¿ï¼ˆdeploy/ï¼Œ3 ä¸ªæ–°æ–‡ä»¶ï¼‰</h3><h4 id=caddyfile-3-xing-he-xin-pei-zhi>Caddyfileï¼ˆ3 è¡Œæ ¸å¿ƒé…ç½®ï¼‰</h4><pre style=background:#2b303b;color:#c0c5ce><code><span>api.polly.wang {
</span><span>    reverse_proxy localhost:24680
</span><span>}
</span></code></pre><p>å°±è¿™ä¹ˆå¤šã€‚Caddy çœ‹åˆ°åŸŸåå°±ä¼šè‡ªåŠ¨ï¼š<ul><li>å‘ Let's Encrypt ç”³è¯· TLS è¯ä¹¦<li>é…ç½® HTTPSï¼ˆ443ï¼‰<li>HTTP â†’ HTTPS é‡å®šå‘<li>è¯ä¹¦åˆ°æœŸå‰è‡ªåŠ¨ç»­æœŸ</ul><p>å¯¹æ¯” Nginx éœ€è¦ 25 è¡Œé…ç½® + æ‰‹åŠ¨è·‘ certbot + é… cron ç»­æœŸã€‚<strong>3 è¡Œ vs 25 è¡Œ + è¿ç»´</strong>ã€‚<h4 id=systemd-fu-wu-wen-jian>systemd æœåŠ¡æ–‡ä»¶</h4><pre class=language-ini data-lang=ini style=background:#2b303b;color:#c0c5ce><code class=language-ini data-lang=ini><span style=color:#b48ead>[Service]
</span><span style=color:#bf616a>Type</span><span>=simple
</span><span style=color:#bf616a>User</span><span>=copilotx
</span><span style=color:#bf616a>EnvironmentFile</span><span>=/home/copilotx/.env
</span><span style=color:#bf616a>ExecStart</span><span>=/home/copilotx/.local/bin/copilotx serve --host </span><span style=color:#d08770>0.0.0.0
</span><span style=color:#bf616a>Restart</span><span>=always
</span><span style=color:#bf616a>NoNewPrivileges</span><span>=</span><span style=color:#d08770>true
</span><span style=color:#bf616a>ProtectSystem</span><span>=strict
</span></code></pre><p>å‡ ä¸ªå®‰å…¨åŠ å›ºç»†èŠ‚ï¼š<ul><li><code>NoNewPrivileges=true</code>ï¼šè¿›ç¨‹ä¸èƒ½ææƒ<li><code>ProtectSystem=strict</code>ï¼šåªè¯»æŒ‚è½½ç³»ç»Ÿç›®å½•<li><code>Restart=always</code>ï¼šå´©äº†è‡ªåŠ¨é‡å¯<li><code>EnvironmentFile</code>ï¼šå¯†é’¥ä» <code>.env</code> æ–‡ä»¶åŠ è½½ï¼Œä¸å†™åœ¨ service é‡Œ</ul><hr><h2 id=jia-gou-yan-jin-cong-dan-ji-dao-liang-ceng>æ¶æ„æ¼”è¿›ï¼šä»å•æœºåˆ°ä¸¤å±‚</h2><p>v1.0 çš„æ¶æ„æ˜¯ä¸€æ¡ç›´çº¿ï¼š<pre style=background:#2b303b;color:#c0c5ce><code><span>ä½ çš„å·¥å…· â†’ CopilotX (localhost:24680) â†’ api.githubcopilot.com
</span></code></pre><p>v2.0 å˜æˆä¸¤å±‚ï¼š<pre style=background:#2b303b;color:#c0c5ce><code><span>ä½ çš„ç¬”è®°æœ¬ / æ‰‹æœº / ä»»æ„è®¾å¤‡
</span><span>    â”‚
</span><span>    â”‚  HTTPS (443)
</span><span>    â–¼
</span><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span>â”‚  Caddy (api.polly.wang)     â”‚  â† è‡ªåŠ¨ HTTPSï¼Œé›¶è¿ç»´
</span><span>â”‚  Let's Encrypt è¯ä¹¦          â”‚
</span><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span>             â”‚  HTTP (24680)     â† å†…ç½‘é€šä¿¡ï¼Œä¸å‡ºç½‘
</span><span>             â–¼
</span><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span>â”‚  CopilotX (0.0.0.0:24680)  â”‚
</span><span>â”‚  API Key éªŒè¯ + Token ç®¡ç†   â”‚
</span><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span>             â”‚  OpenAI æ ¼å¼ + Copilot JWT
</span><span>             â–¼
</span><span>    api.githubcopilot.com
</span><span>    â†’ GPT-4o, Claude, Gemini...
</span></code></pre><p>CopilotX æœ¬èº«ä¸ç®¡ HTTPS â€”â€” äº¤ç»™ä¸“ä¸šçš„ Caddy å¤„ç†ã€‚è¿™æ˜¯ <strong>Unix å“²å­¦</strong>ï¼šæ¯ä¸ªç¨‹åºåšå¥½ä¸€ä»¶äº‹ã€‚<hr><h2 id=wei-shi-yao-xuan-caddy-er-bu-shi-nginx>ä¸ºä»€ä¹ˆé€‰ Caddy è€Œä¸æ˜¯ Nginxï¼Ÿ</h2><p>è¿™ä¸ªé—®é¢˜æˆ‘è®¤çœŸæƒ³äº†ä¸€ä¸‹ã€‚ç»“è®ºæ˜¯ï¼š<strong>åœ¨ä¸ªäººé¡¹ç›®çš„åœºæ™¯ä¸‹ï¼ŒCaddy å®Œèƒœ</strong>ã€‚<table><thead><tr><th>ç»´åº¦<th>Caddy<th>Nginx<tbody><tr><td>HTTPS é…ç½®<td>é›¶é…ç½®ï¼Œè‡ªåŠ¨ Let's Encrypt<td>æ‰‹åŠ¨ certbot + cron ç»­æœŸ<tr><td>é…ç½®é‡<td>3 è¡Œ<td>~25 è¡Œ<tr><td>è¯ä¹¦ç»­æœŸ<td>è‡ªåŠ¨ï¼ˆå†…ç½®ï¼‰<td>éœ€è¦ cron æˆ– certbot timer<tr><td>æ€§èƒ½<td>ä¸‡çº§ QPSï¼ˆå¤Ÿäº†ï¼‰<td>åä¸‡çº§ QPSï¼ˆç”¨ä¸ä¸Šï¼‰</table><p>CopilotX æ˜¯ä¸ªäººç”¨çš„ API ä»£ç†ï¼Œåˆä¸æ˜¯æœåŠ¡ç™¾ä¸‡ç”¨æˆ·çš„ç½‘å…³ã€‚<strong>Caddy çš„è‡ªåŠ¨ HTTPS æ‰æ˜¯æ€æ‰‹é”</strong> â€”â€” å¿˜äº†ç»­æœŸè¯ä¹¦å¯¼è‡´æœåŠ¡æŒ‚æ‰ï¼ŸCaddy ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚<hr><h2 id=bu-shu-liu-cheng-5-fen-zhong-gao-ding>éƒ¨ç½²æµç¨‹ï¼š5 åˆ†é’Ÿæå®š</h2><p>å®é™…åœ¨ Azure VM ä¸Šéƒ¨ç½²çš„å®Œæ•´æµç¨‹ï¼š<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#65737e># 1. å®‰è£…
</span><span style=color:#bf616a>pip</span><span> install copilotx
</span><span>
</span><span style=color:#65737e># 2. è®¤è¯
</span><span style=color:#bf616a>copilotx</span><span> auth login
</span><span style=color:#65737e># â†’ æµè§ˆå™¨æˆæƒï¼Œå’Œæœ¬åœ°ç”¨ä¸€æ¨¡ä¸€æ ·
</span><span>
</span><span style=color:#65737e># 3. è®¾ç½® API Key
</span><span style=color:#b48ead>export </span><span style=color:#bf616a>COPILOTX_API_KEY</span><span>=$</span><span style=color:#a3be8c>(</span><span style=color:#bf616a>openssl</span><span style=color:#a3be8c> rand</span><span style=color:#bf616a> -hex</span><span style=color:#a3be8c> 32)
</span><span style=color:#96b5b4>echo </span><span>"</span><span style=color:#a3be8c>è®°ä½è¿™ä¸ª Key: </span><span>$</span><span style=color:#bf616a>COPILOTX_API_KEY</span><span>"
</span><span>
</span><span style=color:#65737e># 4. å¯åŠ¨
</span><span style=color:#bf616a>copilotx</span><span> serve</span><span style=color:#bf616a> --host</span><span> 0.0.0.0
</span><span>
</span><span style=color:#65737e># 5. å®‰è£… Caddyï¼ˆä¸€æ¬¡æ€§ï¼‰
</span><span style=color:#bf616a>sudo</span><span> apt install caddy
</span><span style=color:#96b5b4>echo </span><span>'</span><span style=color:#a3be8c>api.polly.wang { reverse_proxy localhost:24680 }</span><span>' | </span><span style=color:#bf616a>sudo</span><span> tee /etc/caddy/Caddyfile
</span><span style=color:#bf616a>sudo</span><span> systemctl reload caddy
</span></code></pre><p>ç„¶åä»ä»»ä½•åœ°æ–¹ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#b48ead>from </span><span>openai </span><span style=color:#b48ead>import </span><span>OpenAI
</span><span>
</span><span>client = </span><span style=color:#bf616a>OpenAI</span><span>(
</span><span>    </span><span style=color:#bf616a>base_url</span><span>="</span><span style=color:#a3be8c>https://api.polly.wang/v1</span><span>",
</span><span>    </span><span style=color:#bf616a>api_key</span><span>="</span><span style=color:#a3be8c>ä½ çš„COPILOTX_API_KEY</span><span>",
</span><span>)
</span><span>
</span><span>response = client.chat.completions.</span><span style=color:#bf616a>create</span><span>(
</span><span>    </span><span style=color:#bf616a>model</span><span>="</span><span style=color:#a3be8c>gpt-4o</span><span>",
</span><span>    </span><span style=color:#bf616a>messages</span><span>=[{"</span><span style=color:#a3be8c>role</span><span>": "</span><span style=color:#a3be8c>user</span><span>", "</span><span style=color:#a3be8c>content</span><span>": "</span><span style=color:#a3be8c>Hello from remote!</span><span>"}],
</span><span>)
</span><span style=color:#96b5b4>print</span><span>(response.choices[</span><span style=color:#d08770>0</span><span>].message.content)
</span></code></pre><p><strong>å’Œè°ƒ OpenAI å®˜æ–¹ API å®Œå…¨ä¸€æ ·çš„ä½“éªŒ</strong>ï¼Œåªæ˜¯ base_url æ¢æˆäº†ä½ è‡ªå·±çš„åŸŸåã€‚<hr><h2 id=ban-ben-lu-xian-tu>ç‰ˆæœ¬è·¯çº¿å›¾</h2><table><thead><tr><th>ç‰ˆæœ¬<th>ä»£å·<th>ç‰¹æ€§<th>çŠ¶æ€<tbody><tr><td>v1.0.0<td>Local<td>OAuthã€åŒ API æ ¼å¼ã€æµå¼å“åº”ã€æ¨¡å‹å‘ç°<td>âœ… å·²å‘å¸ƒ<tr><td><strong>v2.0.0</strong><td><strong>Remote</strong><td><strong>API Key è®¤è¯ã€è¿œç¨‹éƒ¨ç½²ã€Caddy/systemd æ¨¡æ¿</strong><td><strong>âœ… ä»Šå¤©å‘å¸ƒ</strong><tr><td>v3.0.0<td>Multi-User<td>Token Poolã€ç”¨æˆ·æ•°æ®åº“ã€OpenRouter æ¨¡å¼<td>ğŸ”œ è§„åˆ’ä¸­</table><p>v3.0.0 çš„æ„¿æ™¯æ˜¯æŠŠ CopilotX å˜æˆä¸€ä¸ª<strong>å¤šç”¨æˆ·çš„ AI API ç½‘å…³</strong>â€”â€”å¤šä¸ª GitHub è´¦å·çš„ Token ç»„æˆæ± å­ï¼Œåƒ OpenRouter ä¸€æ ·æŒ‰éœ€åˆ†é…ã€‚ä½†é‚£æ˜¯æ›´è¿œçš„äº‹äº†ã€‚<hr><h2 id=fan-si-225-xing-de-xin-zao-bi>åæ€ï¼š225 è¡Œçš„ä¿¡å™ªæ¯”</h2><p>å›é¡¾è¿™ä¸ªä¸‹åˆçš„å·¥ä½œï¼Œæˆ‘æœ€æ»¡æ„çš„ä¸€ç‚¹æ˜¯<strong>å…‹åˆ¶</strong>ã€‚<p>è¿œç¨‹éƒ¨ç½²è¿™ä¸ªéœ€æ±‚ï¼Œä¸€èˆ¬äººå¯èƒ½ä¼šæƒ³åŠ ï¼š<ul><li>ç”¨æˆ·æ³¨å†Œç³»ç»Ÿ<li>JWT ç­¾å‘å’ŒéªŒè¯<li>é€Ÿç‡é™åˆ¶ä¸­é—´ä»¶<li>æ•°æ®åº“å­˜ API Key<li>ç®¡ç†é¢æ¿</ul><p>è¿™äº›éƒ½æ˜¯"åˆç†"çš„åŠŸèƒ½ï¼Œä½†å¯¹äº"ä¸ªäººè¿œç¨‹è®¿é—®è‡ªå·±çš„ Copilot"è¿™ä¸ªåœºæ™¯ï¼Œå…¨æ˜¯è¿‡åº¦è®¾è®¡ã€‚<p>ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼ˆ<code>COPILOTX_API_KEY</code>ï¼‰+ ä¸€ä¸ªä¸­é—´ä»¶ï¼ˆ50 è¡Œï¼‰+ ä¸€ä¸ª Caddy é…ç½®ï¼ˆ3 è¡Œï¼‰ï¼Œå°±è§£å†³äº†æ‰€æœ‰é—®é¢˜ã€‚<p>è¿™è®©æˆ‘æƒ³èµ·ä»Šå¤©æ—©ä¸Šå†™çš„ <a href=/blog/gatex-v2-from-bloat-to-lean>GateX v2 åšæ–‡</a>é‡Œçš„é‚£å¥è¯ï¼š<strong>Less is More</strong>ã€‚GateX æ˜¯åˆ æ‰ 2000 è¡Œå˜å¼ºçš„ï¼ŒCopilotX v2 æ˜¯åªåŠ  225 è¡Œå°±å‡çº§çš„ã€‚ä¸¤ä¸ªæ–¹å‘ï¼ŒåŒä¸€ä¸ªé“ç† â€”â€” <strong>ä»£ç çš„ä»·å€¼ä¸åœ¨äºè¡Œæ•°ï¼Œåœ¨äºæ¯ä¸€è¡Œéƒ½è§£å†³çœŸå®é—®é¢˜</strong>ã€‚<p>v1.0 â†’ v2.0ï¼Œä» <code>localhost</code> åˆ° <code>api.polly.wang</code>ï¼Œ225 è¡Œä»£ç çš„è·ç¦»ã€‚<hr><h2 id=lian-jie>é“¾æ¥</h2><ul><li><strong>PyPI</strong>: <a href=https://pypi.org/project/copilotx/>pypi.org/project/copilotx</a> ï¼ˆv2.0.0ï¼‰<li><strong>GitHub</strong>: <a href=https://github.com/Polly2014/CopilotX>github.com/Polly2014/CopilotX</a><li><strong>å‰ç¯‡</strong>: <a href=/blog/copilotx-turn-copilot-into-local-api>CopilotX v1.0ï¼šä¸€ä¸ªæ™šä¸Šï¼ŒæŠŠ GitHub Copilot å˜æˆæœ¬åœ° API æœåŠ¡å™¨</a></ul><p>å‡çº§åªéœ€ä¸€è¡Œï¼š<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>pip</span><span> install</span><span style=color:#bf616a> --upgrade</span><span> copilotx
</span></code></pre><p>ä»æœ¬åœ°åˆ°è¿œç¨‹ï¼Œä¸‰è¡Œå‘½ä»¤çš„è·ç¦»åˆè¿‘äº†ä¸€æ­¥ã€‚ğŸŒ</div><div class=navigation></div></div><div id=giscus-container><h2>ç•™è¨€ä¸è®¨è®º</h2><div class=giscus></div></div><script data-category="Blog Comments" async crossorigin data-category-id=DIC_kwDOL45duM4CnjlZ data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=pathname data-reactions-enabled=1 data-repo=Polly2014/polly2014.github.io data-repo-id=R_kgDOL45duA data-strict=0 data-theme=noborder_light src=https://giscus.app/client.js></script><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                // ç°ç™½é»‘è‰²è°ƒ + è“è‰²ç‚¹ç¼€
                primaryColor: '#e8e8e8',
                primaryTextColor: '#333',
                primaryBorderColor: '#999',
                lineColor: 'rgb(61, 146, 201)',
                secondaryColor: '#f5f5f5',
                tertiaryColor: '#fafafa',
                background: '#f2f2f2',
                mainBkg: '#f5f5f5',
                nodeBorder: '#999',
                clusterBkg: '#eee',
                clusterBorder: '#ccc',
                titleColor: '#333',
                edgeLabelBackground: '#f2f2f2',
                // æ–‡æœ¬é¢œè‰²
                textColor: '#333',
                nodeTextColor: '#333',
                // å…¶ä»–
                fontFamily: "'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace"
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // æŸ¥æ‰¾æ‰€æœ‰ mermaid ä»£ç å—å¹¶æ¸²æŸ“
        document.querySelectorAll('pre code.language-mermaid').forEach((block, index) => {
            const container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = block.textContent;
            block.parentNode.replaceWith(container);
        });

        // æ¸²æŸ“æ‰€æœ‰ mermaid å›¾è¡¨
        await mermaid.run();
    </script><style>.cover-image{text-align:center;margin:1.5em 0 2em 0}.cover-image img{width:60%;height:auto;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15)}.mermaid{background:#fafafa;border:1px solid #ddd;padding:20px;margin:20px 0;overflow-x:auto}.mermaid svg{max-width:100%;height:auto}@media (max-width:768px){.cover-image img{width:100%}}</style></div></div><script>document.addEventListener('DOMContentLoaded',function(){const c=document.querySelector('.menu-toggle');const d=document.querySelector('.sidebar');const e=document.querySelector('.overlay');function a(){d.classList.toggle('active');e.classList.toggle('active')}c.addEventListener('click',a);e.addEventListener('click',a);let f=0;let g=0;document.addEventListener('touchstart',h=>{f=h.changedTouches[0].screenX},false);document.addEventListener('touchend',h=>{g=h.changedTouches[0].screenX;b()},false);function b(){const h=g- f;if(h>50&&f<30){d.classList.add('active');e.classList.add('active')}else if(h<-50&&d.classList.contains('active')){d.classList.remove('active');e.classList.remove('active')}}})</script>