<!doctype html><html><head><title>Polly Blog - AI Assistant, Tutorials, and Insights</title><meta content="Explore Polly Blog for AI tutorials, insights, and updates on cutting-edge technology." name=description><meta content="Polly, Blog, AI Blog, AI Assistant, Tutorials, Technology Blog, Baoli Wang" name=keywords><meta content="width=device-width,initial-scale=1" name=viewport><meta content="text/html; charset=utf-8" http-equiv=content-type><link rel="shortcut icon" href=https://polly.wang/images/polly.ico type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=icon type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=apple-touch-icon><link href=https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css rel=stylesheet><link href=https://polly.wang/css/style_new.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-8JD13N7PHS" async></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-8JD13N7PHS')</script><body><div class=menu-toggle><img alt=Menu src=https://polly.wang/images/polly.png></div><div class=overlay></div><div class="pure-g container"><div class="sidebar pure-u-1 pure-u-md-1-5"><div class=title><a class=pure-menu-heading href=https://polly.wang> <img class="avatar pure-img-responsive" src=https://polly.wang/images/polly.png> </a><div class=introduction><p>Polly's Blog</div><div class=nav><ul class=nav-links><li><a href=https://polly.wang><i class="fas fa-home"></i>Home</a><li><a href=https://polly.wang/archive><i class="fas fa-archive"></i>Archive</a><li><a href=https://polly.wang/category><i class="fas fa-folder"></i>Category</a><li><a href=https://polly.wang/blog><i class="fas fa-file-alt"></i>Posts</a><li><a href=https://polly.wang/publication><i class="fas fa-file-pdf"></i>Research</a><li><a href=https://polly.wang/changelog><i class="fas fa-history"></i>Change log</a><li><a href=https://polly.wang/about><i class="fas fa-info-circle"></i>About Me</a></ul></div><div class=social><ul class=social-links><li><a href=mailto:26716201@qq.com><i class="fas fa-envelope"></i></a><li><a href=https://twitter.com/Polly__007><i class="fab fa-twitter"></i></a><li><a href=https://www.linkedin.com/in/baoliwang><i class="fab fa-linkedin-in"></i></a><li><a href=https://github.com/Polly2014><i class="fab fa-github"></i></a></ul></div></div></div><div class="content pure-u-1 pure-u-md-4-5"><div class=blog-post><h1>OpenHands Starter Telemetry Dashboard å®è·µ</h1><div class=content><h2 id=yi-xiang-mu-bei-jing-yu-yi-yi>ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸æ„ä¹‰</h2><p>OpenHands Starteræ˜¯ä¸€ä¸ªå¸®åŠ©ç”¨æˆ·å¿«é€Ÿéƒ¨ç½²AIå¼€å‘å¹³å°çš„å·¥å…·ï¼Œä¸ºäº†æ›´å¥½åœ°äº†è§£ç”¨æˆ·å®‰è£…ä½“éªŒå’Œæ½œåœ¨é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ”¶é›†å…³é”®é¥æµ‹æ•°æ®ã€‚ç„¶è€Œï¼ŒåŸå§‹æ•°æ®éš¾ä»¥ç›´è§‚ç†è§£ï¼Œå›¢é˜Ÿè¿«åˆ‡éœ€è¦ä¸€ä¸ªå¯è§†åŒ–ä»ªè¡¨æ¿ï¼Œå°†è¿™äº›æ•°æ®è½¬åŒ–ä¸ºæœ‰ä»·å€¼çš„è§è§£ã€‚<p>åŸºäºæ­¤éœ€æ±‚ï¼Œæˆ‘ä»¬è®¾è®¡å¹¶å®ç°äº†OpenHands Starteré¥æµ‹ä»ªè¡¨æ¿ï¼Œå®ƒèƒ½å¤Ÿå±•ç¤ºå…³é”®å®‰è£…æŒ‡æ ‡ã€æ“ä½œç³»ç»Ÿåˆ†å¸ƒã€å®‰è£…æ­¥éª¤æˆåŠŸç‡ï¼Œå¹¶æä¾›è¯¦ç»†çš„ä¼šè¯åˆ†æåŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘å›¢é˜Ÿä¸æ–­ä¼˜åŒ–äº§å“ä½“éªŒã€‚<p><img alt="Dashboard Preview" src=https://polly.wang/openhands-telemetry-dashboard/DashBoard_Preview.png><h2 id=er-ji-zhu-zhan-xuan-ze>äºŒã€æŠ€æœ¯æ ˆé€‰æ‹©</h2><p>åœ¨æŠ€æœ¯é€‰å‹ä¸Šï¼Œæˆ‘ä»¬è€ƒè™‘äº†å¼€å‘æ•ˆç‡ã€æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼Œæœ€ç»ˆé€‰å®šï¼š<ol><li><strong>FastAPI</strong> - é«˜æ€§èƒ½Pythonåç«¯æ¡†æ¶ï¼Œç”¨äºæ„å»ºAPIæœåŠ¡<li><strong>MongoDB</strong> - çµæ´»çš„æ–‡æ¡£æ•°æ®åº“ï¼Œé€‚åˆå­˜å‚¨ç»“æ„å¤šå˜çš„é¥æµ‹æ•°æ®<li><strong>Streamlit</strong> - è½»é‡çº§æ•°æ®å¯è§†åŒ–æ¡†æ¶ï¼Œå¿«é€Ÿæ„å»ºäº¤äº’å¼ä»ªè¡¨æ¿<li><strong>Plotly</strong> - å¼ºå¤§çš„äº¤äº’å¼å›¾è¡¨åº“ï¼Œå¢å¼ºæ•°æ®å¯è§†åŒ–ä½“éªŒ<li><strong>Docker</strong> - å®¹å™¨åŒ–éƒ¨ç½²ï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§å’Œç®€åŒ–éƒ¨ç½²æµç¨‹</ol><p>é€‰æ‹©FastAPIä¸Streamlitè¿™ä¸€ç»„åˆæ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘çš„å†³å®šã€‚FastAPIæä¾›äº†é«˜æ€§èƒ½çš„æ•°æ®å¤„ç†èƒ½åŠ›å’Œç±»å‹æç¤ºä¼˜åŠ¿ï¼ŒStreamlitåˆ™æå¤§ç®€åŒ–äº†æ•°æ®å¯è§†åŒ–å‰ç«¯å¼€å‘ï¼ŒäºŒè€…ç»“åˆå®ç°äº†å¿«é€Ÿå¼€å‘å’Œå“è¶Šæ€§èƒ½çš„å¹³è¡¡ã€‚<h2 id=san-jia-gou-she-ji>ä¸‰ã€æ¶æ„è®¾è®¡</h2><p>ç³»ç»Ÿé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼ŒèŒè´£æ¸…æ™°ï¼š<pre style=background:#2b303b;color:#c0c5ce><code><span>OpenHands Telemetry Dashboard
</span><span>â”œâ”€â”€ æ•°æ®å±‚ (MongoDB)
</span><span>â”œâ”€â”€ APIæœåŠ¡å±‚ (FastAPI)
</span><span>â”‚   â”œâ”€â”€ æ•°æ®æ¥æ”¶æ¨¡å—
</span><span>â”‚   â”œâ”€â”€ æ•°æ®å¤„ç†æ¨¡å—
</span><span>â”‚   â””â”€â”€ æ•°æ®åˆ†ææ¨¡å—
</span><span>â””â”€â”€ å¯è§†åŒ–å±‚ (Streamlit)
</span><span>    â”œâ”€â”€ æ¦‚è§ˆä»ªè¡¨æ¿
</span><span>    â”œâ”€â”€ è¯¦ç»†ä¼šè¯åˆ†æ
</span><span>    â””â”€â”€ æ•°æ®å¯¼å‡ºåŠŸèƒ½
</span></code></pre><p>æ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š<details><summary>OpenHands Telemetryæ¶æ„ (ç‚¹å‡»å±•å¼€)</summary> <p><img alt=OpenHands_Starter_Telemetry_Architecture src=https://polly.wang/openhands-telemetry-dashboard/OpenHands_Starter_Telemetry_Architecture.png></p></details><h2 id=si-xi-tong-shi-xian-xiang-jie>å››ã€ç³»ç»Ÿå®ç°è¯¦è§£</h2><h3 id=4-1-xiang-mu-jie-gou-she-zhi>4.1 é¡¹ç›®ç»“æ„è®¾ç½®</h3><pre class=language-text data-lang=text style=background:#2b303b;color:#c0c5ce><code class=language-text data-lang=text><span>openhands-telemetry/           # é¡¹ç›®æ ¹ç›®å½•
</span><span>â”‚
</span><span>â”œâ”€â”€ api/                       # API åç«¯
</span><span>â”‚   â”œâ”€â”€ venv/                  # Python è™šæ‹Ÿç¯å¢ƒ
</span><span>â”‚   â”œâ”€â”€ requirements.txt       # ä¾èµ–åˆ—è¡¨
</span><span>â”‚   â””â”€â”€ app/                   # API æºä»£ç ç›®å½•
</span><span>â”‚       â”œâ”€â”€ main.py            # ä¸»å…¥å£æ–‡ä»¶
</span><span>â”‚       â”œâ”€â”€ .env               # ç¯å¢ƒå˜é‡é…ç½®
</span><span>â”‚       â”œâ”€â”€ routers/           # API è·¯ç”±
</span><span>â”‚       â”‚   â””â”€â”€ telemetry.py
</span><span>â”‚       â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
</span><span>â”‚       â”‚   â””â”€â”€ telemetry.py
</span><span>â”‚       â”œâ”€â”€ config/            # é…ç½®æ–‡ä»¶
</span><span>â”‚       â”‚   â””â”€â”€ db.py
</span><span>â”‚       â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
</span><span>â”‚           â””â”€â”€ logger.py
</span><span>â”‚
</span><span>â”œâ”€â”€ dashboard/                 # Streamlit å‰ç«¯
</span><span>â”‚   â”œâ”€â”€ venv/                  # Python è™šæ‹Ÿç¯å¢ƒ
</span><span>â”‚   â”œâ”€â”€ requirements.txt       # ä¾èµ–åˆ—è¡¨
</span><span>â”‚   â””â”€â”€ app.py                 # Streamlit åº”ç”¨
</span><span>â”‚
</span><span>â””â”€â”€ docker/                    # Docker é…ç½®
</span><span>    â”œâ”€â”€ api.Dockerfile
</span><span>    â””â”€â”€ dashboard.Dockerfile
</span></code></pre><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¸…æ™°çš„é¡¹ç›®ç»“æ„ï¼š<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>mkdir -p</span><span> openhands-telemetry/{api,dashboard,docker}
</span><span style=color:#96b5b4>cd</span><span> openhands-telemetry
</span></code></pre><h3 id=4-2-fastapihou-duan-shi-xian>4.2 FastAPIåç«¯å®ç°</h3><h4 id=4-2-1-shu-ju-mo-xing-she-ji>4.2.1 æ•°æ®æ¨¡å‹è®¾è®¡</h4><p>å®šä¹‰æ¸…æ™°çš„æ•°æ®æ¨¡å‹æ˜¯ç³»ç»Ÿçš„åŸºç¡€ã€‚æˆ‘ä»¬ä½¿ç”¨Pydanticæ„å»ºå¼ºç±»å‹æ¨¡å‹ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># api/app/models/telemetry.py
</span><span style=color:#b48ead>from </span><span>datetime </span><span style=color:#b48ead>import </span><span>datetime
</span><span style=color:#b48ead>from </span><span>typing </span><span style=color:#b48ead>import </span><span>Dict, Any, Optional
</span><span style=color:#b48ead>from </span><span>pydantic </span><span style=color:#b48ead>import </span><span>BaseModel, Field
</span><span>
</span><span style=color:#b48ead>class </span><span style=color:#ebcb8b>TelemetryEvent</span><span style=color:#eff1f5>(</span><span style=color:#a3be8c>BaseModel</span><span style=color:#eff1f5>):
</span><span>    anonymousId: str
</span><span>    sessionId: str
</span><span>    step: str
</span><span>    status: str
</span><span>    timestamp: datetime = </span><span style=color:#bf616a>Field</span><span>(</span><span style=color:#bf616a>default_factory</span><span>=datetime.utcnow)
</span><span>    scriptVersion: Optional[str] = </span><span style=color:#d08770>None
</span><span>    osVersion: Optional[str] = </span><span style=color:#d08770>None 
</span><span>    osName: Optional[str] = </span><span style=color:#d08770>None
</span><span>    cpuArchitecture: Optional[str] = </span><span style=color:#d08770>None
</span><span>    memoryGB: Optional[float] = </span><span style=color:#d08770>None
</span><span>    metrics: Dict[str, Any] = </span><span style=color:#bf616a>Field</span><span>(</span><span style=color:#bf616a>default_factory</span><span>=dict)
</span><span>
</span><span style=color:#b48ead>class </span><span style=color:#ebcb8b>TelemetryStats</span><span style=color:#eff1f5>(</span><span style=color:#a3be8c>BaseModel</span><span style=color:#eff1f5>):
</span><span>    total_sessions: int
</span><span>    successful_installs: int
</span><span>    success_rate: float
</span><span>    installation_by_os: Dict[str, int]
</span><span>    steps_status: Dict[str, Dict[str, int]]
</span><span>    avg_install_time: float
</span></code></pre><h4 id=4-2-2-shu-ju-ku-lian-jie-pei-zhi>4.2.2 æ•°æ®åº“è¿æ¥é…ç½®</h4><p>ä½¿ç”¨Motorä½œä¸ºMongoDBçš„å¼‚æ­¥å®¢æˆ·ç«¯ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># api/app/config/db.py
</span><span style=color:#b48ead>import </span><span>os
</span><span style=color:#b48ead>from </span><span>motor.motor_asyncio </span><span style=color:#b48ead>import </span><span>AsyncIOMotorClient
</span><span style=color:#b48ead>from </span><span>dotenv </span><span style=color:#b48ead>import </span><span>load_dotenv
</span><span>
</span><span style=color:#bf616a>load_dotenv</span><span>()
</span><span>
</span><span>mongodb_uri = os.</span><span style=color:#bf616a>getenv</span><span>("</span><span style=color:#a3be8c>MONGODB_URI</span><span>", "</span><span style=color:#a3be8c>mongodb://localhost:27017</span><span>")
</span><span>mongodb_db = os.</span><span style=color:#bf616a>getenv</span><span>("</span><span style=color:#a3be8c>MONGODB_DB</span><span>", "</span><span style=color:#a3be8c>openhands_telemetry</span><span>")
</span><span>
</span><span>client = </span><span style=color:#bf616a>AsyncIOMotorClient</span><span>(mongodb_uri)
</span><span>db = client[mongodb_db]
</span><span>
</span><span>telemetry_collection = db.telemetry_events
</span></code></pre><h4 id=4-2-3-he-xin-apilu-you-shi-xian>4.2.3 æ ¸å¿ƒAPIè·¯ç”±å®ç°</h4><p>å®ç°æ•°æ®æ¥æ”¶ä¸åˆ†æAPIï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># api/app/routers/telemetry.py
</span><span style=color:#b48ead>from </span><span>fastapi </span><span style=color:#b48ead>import </span><span>APIRouter, HTTPException, status
</span><span style=color:#b48ead>from </span><span>datetime </span><span style=color:#b48ead>import </span><span>datetime, timedelta
</span><span style=color:#b48ead>from </span><span>typing </span><span style=color:#b48ead>import </span><span>Dict, Any, List
</span><span>
</span><span style=color:#b48ead>from ..</span><span>models.telemetry </span><span style=color:#b48ead>import </span><span>TelemetryEvent, TelemetryStats
</span><span style=color:#b48ead>from ..</span><span>config.db </span><span style=color:#b48ead>import </span><span>telemetry_collection
</span><span style=color:#b48ead>from ..</span><span>utils.logger </span><span style=color:#b48ead>import </span><span>get_logger
</span><span>
</span><span>router = </span><span style=color:#bf616a>APIRouter</span><span>(</span><span style=color:#bf616a>prefix</span><span>="</span><span style=color:#a3be8c>/api/telemetry</span><span>", </span><span style=color:#bf616a>tags</span><span>=["</span><span style=color:#a3be8c>telemetry</span><span>"])
</span><span>logger = </span><span style=color:#bf616a>get_logger</span><span>("</span><span style=color:#a3be8c>telemetry_router</span><span>")
</span><span>
</span><span>@router.</span><span style=color:#bf616a>post</span><span>("</span><span style=color:#a3be8c>/</span><span>", </span><span style=color:#bf616a>status_code</span><span>=status.</span><span style=color:#bf616a>HTTP_201_CREATED</span><span>)
</span><span style=color:#b48ead>async def </span><span style=color:#8fa1b3>receive_telemetry</span><span>(</span><span style=color:#bf616a>event</span><span>: Dict[str, Any]):
</span><span>    </span><span style=color:#65737e>"""æ¥æ”¶é¥æµ‹æ•°æ®"""
</span><span>    </span><span style=color:#b48ead>try</span><span>:
</span><span>        </span><span style=color:#65737e># æå–åŸºç¡€å­—æ®µ
</span><span>        telemetry_data = {
</span><span>            "</span><span style=color:#a3be8c>anonymousId</span><span>": event.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>anonymousId</span><span>"),
</span><span>            "</span><span style=color:#a3be8c>sessionId</span><span>": event.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>sessionId</span><span>"),
</span><span>            "</span><span style=color:#a3be8c>step</span><span>": event.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>step</span><span>"),
</span><span>            "</span><span style=color:#a3be8c>status</span><span>": event.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>status</span><span>"),
</span><span>            "</span><span style=color:#a3be8c>scriptVersion</span><span>": event.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>scriptVersion</span><span>"),
</span><span>            "</span><span style=color:#a3be8c>osVersion</span><span>": event.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>osVersion</span><span>"),
</span><span>            "</span><span style=color:#a3be8c>osName</span><span>": event.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>osName</span><span>"),
</span><span>            "</span><span style=color:#a3be8c>cpuArchitecture</span><span>": event.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>cpuArchitecture</span><span>"),
</span><span>            "</span><span style=color:#a3be8c>memoryGB</span><span>": event.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>memoryGB</span><span>")
</span><span>        }
</span><span>        
</span><span>        </span><span style=color:#65737e># å¤„ç†æ—¶é—´æˆ³
</span><span>        timestamp = event.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>timestamp</span><span>")
</span><span>        </span><span style=color:#b48ead>if </span><span>timestamp:
</span><span>            </span><span style=color:#b48ead>try</span><span>:
</span><span>                telemetry_data["</span><span style=color:#a3be8c>timestamp</span><span>"] = datetime.</span><span style=color:#bf616a>fromisoformat</span><span>(timestamp.</span><span style=color:#bf616a>replace</span><span>("</span><span style=color:#a3be8c>Z</span><span>", "</span><span style=color:#a3be8c>+00:00</span><span>"))
</span><span>            </span><span style=color:#b48ead>except </span><span>(ValueError, TypeError):
</span><span>                telemetry_data["</span><span style=color:#a3be8c>timestamp</span><span>"] = datetime.</span><span style=color:#bf616a>utcnow</span><span>()
</span><span>        </span><span style=color:#b48ead>else</span><span>:
</span><span>            telemetry_data["</span><span style=color:#a3be8c>timestamp</span><span>"] = datetime.</span><span style=color:#bf616a>utcnow</span><span>()
</span><span>        
</span><span>        </span><span style=color:#65737e># é¢å¤–çš„æŒ‡æ ‡æ•°æ®
</span><span>        metrics = {}
</span><span>        </span><span style=color:#b48ead>for </span><span>key, value </span><span style=color:#b48ead>in </span><span>event.</span><span style=color:#bf616a>items</span><span>():
</span><span>            </span><span style=color:#b48ead>if </span><span>key not in telemetry_data:
</span><span>                metrics[key] = value
</span><span>        
</span><span>        telemetry_data["</span><span style=color:#a3be8c>metrics</span><span>"] = metrics
</span><span>        
</span><span>        </span><span style=color:#65737e># å­˜å‚¨åˆ°æ•°æ®åº“
</span><span>        result = </span><span style=color:#b48ead>await </span><span>telemetry_collection.</span><span style=color:#bf616a>insert_one</span><span>(telemetry_data)
</span><span>        
</span><span>        </span><span style=color:#b48ead>return </span><span>{"</span><span style=color:#a3be8c>status</span><span>": "</span><span style=color:#a3be8c>success</span><span>", "</span><span style=color:#a3be8c>id</span><span>": </span><span style=color:#bf616a>str</span><span>(result.inserted_id)}
</span><span>    
</span><span>    </span><span style=color:#b48ead>except </span><span>Exception </span><span style=color:#b48ead>as </span><span>e:
</span><span>        logger.</span><span style=color:#bf616a>error</span><span>(</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Error processing telemetry: </span><span>{</span><span style=color:#bf616a>str</span><span>(e)}")
</span><span>        </span><span style=color:#b48ead>raise </span><span style=color:#bf616a>HTTPException</span><span>(
</span><span>            </span><span style=color:#bf616a>status_code</span><span>=status.</span><span style=color:#bf616a>HTTP_500_INTERNAL_SERVER_ERROR</span><span>,
</span><span>            </span><span style=color:#bf616a>detail</span><span>=</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Failed to process telemetry data: </span><span>{</span><span style=color:#bf616a>str</span><span>(e)}"
</span><span>        )
</span></code></pre><h4 id=4-2-4-tong-ji-shu-ju-api>4.2.4 ç»Ÿè®¡æ•°æ®API</h4><p>å®ç°ç”¨äºä»ªè¡¨æ¿çš„æ•°æ®ç»Ÿè®¡APIï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span>@router.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>/stats</span><span>", </span><span style=color:#bf616a>response_model</span><span>=TelemetryStats)
</span><span style=color:#b48ead>async def </span><span style=color:#8fa1b3>get_telemetry_stats</span><span>():
</span><span>    </span><span style=color:#65737e>"""è·å–é¥æµ‹æ•°æ®ç»Ÿè®¡æ‘˜è¦"""
</span><span>    </span><span style=color:#b48ead>try</span><span>:
</span><span>        </span><span style=color:#65737e># è·å–ä¼šè¯æ€»æ•°
</span><span>        total_sessions = </span><span style=color:#96b5b4>len</span><span>(</span><span style=color:#b48ead>await </span><span>telemetry_collection.</span><span style=color:#bf616a>distinct</span><span>("</span><span style=color:#a3be8c>sessionId</span><span>"))
</span><span>        
</span><span>        </span><span style=color:#65737e># è·å–æˆåŠŸå®‰è£…æ•°
</span><span>        completed_installs = </span><span style=color:#b48ead>await </span><span>telemetry_collection.</span><span style=color:#bf616a>count_documents</span><span>({
</span><span>            "</span><span style=color:#a3be8c>step</span><span>": "</span><span style=color:#a3be8c>install</span><span>",
</span><span>            "</span><span style=color:#a3be8c>status</span><span>": "</span><span style=color:#a3be8c>completed</span><span>",
</span><span>            "</span><span style=color:#a3be8c>metrics.success</span><span>": </span><span style=color:#d08770>True
</span><span>        })
</span><span>        
</span><span>        </span><span style=color:#65737e># è®¡ç®—æˆåŠŸç‡
</span><span>        success_rate = (completed_installs / total_sessions * </span><span style=color:#d08770>100</span><span>) </span><span style=color:#b48ead>if </span><span>total_sessions > </span><span style=color:#d08770>0 </span><span style=color:#b48ead>else </span><span style=color:#d08770>0
</span><span>        
</span><span>        </span><span style=color:#65737e># è·å–æŒ‰æ“ä½œç³»ç»Ÿåˆ’åˆ†çš„å®‰è£…æ•°
</span><span>        os_pipeline = [
</span><span>            {"</span><span style=color:#a3be8c>$group</span><span>": {
</span><span>                "</span><span style=color:#a3be8c>_id</span><span>": "</span><span style=color:#a3be8c>$osName</span><span>",
</span><span>                "</span><span style=color:#a3be8c>count</span><span>": {"</span><span style=color:#a3be8c>$sum</span><span>": </span><span style=color:#d08770>1</span><span>}
</span><span>            }},
</span><span>            {"</span><span style=color:#a3be8c>$match</span><span>": {"</span><span style=color:#a3be8c>_id</span><span>": {"</span><span style=color:#a3be8c>$ne</span><span>": </span><span style=color:#d08770>None</span><span>}}}
</span><span>        ]
</span><span>        
</span><span>        os_result = </span><span style=color:#b48ead>await </span><span>telemetry_collection.</span><span style=color:#bf616a>aggregate</span><span>(os_pipeline).</span><span style=color:#bf616a>to_list</span><span>(</span><span style=color:#d08770>None</span><span>)
</span><span>        installation_by_os = {item["</span><span style=color:#a3be8c>_id</span><span>"]: item["</span><span style=color:#a3be8c>count</span><span>"] </span><span style=color:#b48ead>for </span><span>item </span><span style=color:#b48ead>in </span><span>os_result}
</span><span>        
</span><span>        </span><span style=color:#65737e># è·å–æŒ‰æ­¥éª¤åˆ’åˆ†çš„çŠ¶æ€ç»Ÿè®¡
</span><span>        steps_pipeline = [
</span><span>            {"</span><span style=color:#a3be8c>$group</span><span>": {
</span><span>                "</span><span style=color:#a3be8c>_id</span><span>": {"</span><span style=color:#a3be8c>step</span><span>": "</span><span style=color:#a3be8c>$step</span><span>", "</span><span style=color:#a3be8c>status</span><span>": "</span><span style=color:#a3be8c>$status</span><span>"},
</span><span>                "</span><span style=color:#a3be8c>count</span><span>": {"</span><span style=color:#a3be8c>$sum</span><span>": </span><span style=color:#d08770>1</span><span>}
</span><span>            }}
</span><span>        ]
</span><span>        
</span><span>        steps_result = </span><span style=color:#b48ead>await </span><span>telemetry_collection.</span><span style=color:#bf616a>aggregate</span><span>(steps_pipeline).</span><span style=color:#bf616a>to_list</span><span>(</span><span style=color:#d08770>None</span><span>)
</span><span>        
</span><span>        steps_status = {}
</span><span>        </span><span style=color:#b48ead>for </span><span>item </span><span style=color:#b48ead>in </span><span>steps_result:
</span><span>            step = item["</span><span style=color:#a3be8c>_id</span><span>"]["</span><span style=color:#a3be8c>step</span><span>"]
</span><span>            status = item["</span><span style=color:#a3be8c>_id</span><span>"]["</span><span style=color:#a3be8c>status</span><span>"]
</span><span>            count = item["</span><span style=color:#a3be8c>count</span><span>"]
</span><span>            
</span><span>            </span><span style=color:#b48ead>if </span><span>step not in steps_status:
</span><span>                steps_status[step] = {}
</span><span>            
</span><span>            steps_status[step][status] = count
</span><span>        
</span><span>        </span><span style=color:#65737e># è®¡ç®—å¹³å‡å®‰è£…æ—¶é—´
</span><span>        time_pipeline = [
</span><span>            {"</span><span style=color:#a3be8c>$match</span><span>": {
</span><span>                "</span><span style=color:#a3be8c>step</span><span>": "</span><span style=color:#a3be8c>install</span><span>"
</span><span>            }},
</span><span>            {"</span><span style=color:#a3be8c>$group</span><span>": {
</span><span>                "</span><span style=color:#a3be8c>_id</span><span>": "</span><span style=color:#a3be8c>$sessionId</span><span>",
</span><span>                "</span><span style=color:#a3be8c>minTime</span><span>": {"</span><span style=color:#a3be8c>$min</span><span>": "</span><span style=color:#a3be8c>$timestamp</span><span>"},
</span><span>                "</span><span style=color:#a3be8c>maxTime</span><span>": {"</span><span style=color:#a3be8c>$max</span><span>": "</span><span style=color:#a3be8c>$timestamp</span><span>"}
</span><span>            }},
</span><span>            {"</span><span style=color:#a3be8c>$project</span><span>": {
</span><span>                "</span><span style=color:#a3be8c>_id</span><span>": </span><span style=color:#d08770>0</span><span>,
</span><span>                "</span><span style=color:#a3be8c>duration</span><span>": {"</span><span style=color:#a3be8c>$subtract</span><span>": ["</span><span style=color:#a3be8c>$maxTime</span><span>", "</span><span style=color:#a3be8c>$minTime</span><span>"]}
</span><span>            }},
</span><span>            {"</span><span style=color:#a3be8c>$group</span><span>": {
</span><span>                "</span><span style=color:#a3be8c>_id</span><span>": </span><span style=color:#d08770>None</span><span>,
</span><span>                "</span><span style=color:#a3be8c>avgDuration</span><span>": {"</span><span style=color:#a3be8c>$avg</span><span>": "</span><span style=color:#a3be8c>$duration</span><span>"}
</span><span>            }}
</span><span>        ]
</span><span>        
</span><span>        time_result = </span><span style=color:#b48ead>await </span><span>telemetry_collection.</span><span style=color:#bf616a>aggregate</span><span>(time_pipeline).</span><span style=color:#bf616a>to_list</span><span>(</span><span style=color:#d08770>None</span><span>)
</span><span>        avg_install_time = </span><span style=color:#d08770>0
</span><span>        
</span><span>        </span><span style=color:#b48ead>if </span><span>time_result:
</span><span>            </span><span style=color:#65737e># è½¬æ¢ä¸ºç§’
</span><span>            avg_install_time = time_result[</span><span style=color:#d08770>0</span><span>]["</span><span style=color:#a3be8c>avgDuration</span><span>"] / </span><span style=color:#d08770>1000 </span><span style=color:#b48ead>if </span><span>time_result </span><span style=color:#b48ead>else </span><span style=color:#d08770>0
</span><span>        
</span><span>        </span><span style=color:#b48ead>return </span><span style=color:#bf616a>TelemetryStats</span><span>(
</span><span>            </span><span style=color:#bf616a>total_sessions</span><span>=total_sessions,
</span><span>            </span><span style=color:#bf616a>successful_installs</span><span>=completed_installs,
</span><span>            </span><span style=color:#bf616a>success_rate</span><span>=success_rate,
</span><span>            </span><span style=color:#bf616a>installation_by_os</span><span>=installation_by_os,
</span><span>            </span><span style=color:#bf616a>steps_status</span><span>=steps_status,
</span><span>            </span><span style=color:#bf616a>avg_install_time</span><span>=avg_install_time
</span><span>        )
</span><span>    
</span><span>    </span><span style=color:#b48ead>except </span><span>Exception </span><span style=color:#b48ead>as </span><span>e:
</span><span>        logger.</span><span style=color:#bf616a>error</span><span>(</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Error generating telemetry stats: </span><span>{</span><span style=color:#bf616a>str</span><span>(e)}")
</span><span>        </span><span style=color:#b48ead>raise </span><span style=color:#bf616a>HTTPException</span><span>(
</span><span>            </span><span style=color:#bf616a>status_code</span><span>=status.</span><span style=color:#bf616a>HTTP_500_INTERNAL_SERVER_ERROR</span><span>,
</span><span>            </span><span style=color:#bf616a>detail</span><span>=</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Failed to generate telemetry statistics: </span><span>{</span><span style=color:#bf616a>str</span><span>(e)}"
</span><span>        )
</span></code></pre><h4 id=4-2-5-hui-hua-xiang-qing-api>4.2.5 ä¼šè¯è¯¦æƒ…API</h4><pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span>@router.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>/sessions/</span><span style=color:#d08770>{session_id}</span><span style=color:#a3be8c>/events</span><span>")
</span><span style=color:#b48ead>async def </span><span style=color:#8fa1b3>get_session_events</span><span>(</span><span style=color:#bf616a>session_id</span><span>: str):
</span><span>    </span><span style=color:#65737e>"""è·å–æŒ‡å®šä¼šè¯çš„äº‹ä»¶åºåˆ—"""
</span><span>    </span><span style=color:#b48ead>try</span><span>:
</span><span>        events = </span><span style=color:#b48ead>await </span><span>telemetry_collection.</span><span style=color:#bf616a>find</span><span>(
</span><span>            {"</span><span style=color:#a3be8c>sessionId</span><span>": session_id}
</span><span>        ).</span><span style=color:#bf616a>sort</span><span>("</span><span style=color:#a3be8c>timestamp</span><span>", </span><span style=color:#d08770>1</span><span>).</span><span style=color:#bf616a>to_list</span><span>(</span><span style=color:#d08770>None</span><span>)
</span><span>        
</span><span>        </span><span style=color:#65737e># è½¬æ¢ ObjectId ä¸ºå­—ç¬¦ä¸²
</span><span>        </span><span style=color:#b48ead>for </span><span>event </span><span style=color:#b48ead>in </span><span>events:
</span><span>            event["</span><span style=color:#a3be8c>_id</span><span>"] = </span><span style=color:#bf616a>str</span><span>(event["</span><span style=color:#a3be8c>_id</span><span>"])
</span><span>        
</span><span>        </span><span style=color:#b48ead>if </span><span>not events:
</span><span>            </span><span style=color:#b48ead>raise </span><span style=color:#bf616a>HTTPException</span><span>(
</span><span>                </span><span style=color:#bf616a>status_code</span><span>=status.</span><span style=color:#bf616a>HTTP_404_NOT_FOUND</span><span>,
</span><span>                </span><span style=color:#bf616a>detail</span><span>=</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Session with ID </span><span>{session_id}</span><span style=color:#a3be8c> not found</span><span>"
</span><span>            )
</span><span>            
</span><span>        </span><span style=color:#b48ead>return </span><span>{"</span><span style=color:#a3be8c>session_id</span><span>": session_id, "</span><span style=color:#a3be8c>events</span><span>": events}
</span><span>    
</span><span>    </span><span style=color:#b48ead>except </span><span>HTTPException:
</span><span>        </span><span style=color:#b48ead>raise
</span><span>    </span><span style=color:#b48ead>except </span><span>Exception </span><span style=color:#b48ead>as </span><span>e:
</span><span>        logger.</span><span style=color:#bf616a>error</span><span>(</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Error retrieving session events: </span><span>{</span><span style=color:#bf616a>str</span><span>(e)}")
</span><span>        </span><span style=color:#b48ead>raise </span><span style=color:#bf616a>HTTPException</span><span>(
</span><span>            </span><span style=color:#bf616a>status_code</span><span>=status.</span><span style=color:#bf616a>HTTP_500_INTERNAL_SERVER_ERROR</span><span>,
</span><span>            </span><span style=color:#bf616a>detail</span><span>=</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Failed to retrieve session events: </span><span>{</span><span style=color:#bf616a>str</span><span>(e)}"
</span><span>        )
</span></code></pre><h4 id=4-2-6-ying-yong-ru-kou-dian>4.2.6 åº”ç”¨å…¥å£ç‚¹</h4><p>å°†æ‰€æœ‰ç»„ä»¶è¿æ¥åˆ°FastAPIåº”ç”¨ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># api/app/main.py
</span><span style=color:#b48ead>from </span><span>fastapi </span><span style=color:#b48ead>import </span><span>FastAPI
</span><span style=color:#b48ead>from </span><span>fastapi.middleware.cors </span><span style=color:#b48ead>import </span><span>CORSMiddleware
</span><span style=color:#b48ead>import </span><span>uvicorn
</span><span style=color:#b48ead>import </span><span>os
</span><span style=color:#b48ead>from </span><span>dotenv </span><span style=color:#b48ead>import </span><span>load_dotenv
</span><span>
</span><span style=color:#b48ead>from .</span><span>routers </span><span style=color:#b48ead>import </span><span>telemetry
</span><span style=color:#b48ead>from .</span><span>utils.logger </span><span style=color:#b48ead>import </span><span>get_logger
</span><span>
</span><span style=color:#65737e># åŠ è½½ç¯å¢ƒå˜é‡
</span><span style=color:#bf616a>load_dotenv</span><span>()
</span><span>
</span><span style=color:#65737e># åˆå§‹åŒ– FastAPI åº”ç”¨
</span><span>app = </span><span style=color:#bf616a>FastAPI</span><span>(
</span><span>    </span><span style=color:#bf616a>title</span><span>="</span><span style=color:#a3be8c>OpenHands Telemetry API</span><span>",
</span><span>    </span><span style=color:#bf616a>description</span><span>="</span><span style=color:#a3be8c>API for receiving and analyzing OpenHands installation telemetry</span><span>",
</span><span>    </span><span style=color:#bf616a>version</span><span>="</span><span style=color:#a3be8c>1.0.0</span><span>"
</span><span>)
</span><span>
</span><span style=color:#65737e># æ·»åŠ CORSä¸­é—´ä»¶
</span><span>app.</span><span style=color:#bf616a>add_middleware</span><span>(
</span><span>    CORSMiddleware,
</span><span>    </span><span style=color:#bf616a>allow_origins</span><span>=["</span><span style=color:#a3be8c>*</span><span>"],  </span><span style=color:#65737e># åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”é™åˆ¶ä¸ºç‰¹å®šåŸŸå
</span><span>    </span><span style=color:#bf616a>allow_credentials</span><span>=</span><span style=color:#d08770>True</span><span>,
</span><span>    </span><span style=color:#bf616a>allow_methods</span><span>=["</span><span style=color:#a3be8c>*</span><span>"],
</span><span>    </span><span style=color:#bf616a>allow_headers</span><span>=["</span><span style=color:#a3be8c>*</span><span>"],
</span><span>)
</span><span>
</span><span style=color:#65737e># åŒ…å«è·¯ç”±
</span><span>app.</span><span style=color:#bf616a>include_router</span><span>(telemetry.router)
</span><span>
</span><span style=color:#65737e># æ ¹è·¯ç”±
</span><span>@app.</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>/</span><span>")
</span><span style=color:#b48ead>async def </span><span style=color:#8fa1b3>root</span><span>():
</span><span>    </span><span style=color:#b48ead>return </span><span>{
</span><span>        "</span><span style=color:#a3be8c>message</span><span>": "</span><span style=color:#a3be8c>Welcome to OpenHands Telemetry API</span><span>",
</span><span>        "</span><span style=color:#a3be8c>documentation</span><span>": "</span><span style=color:#a3be8c>/docs</span><span>",
</span><span>    }
</span><span>
</span><span style=color:#b48ead>if </span><span>__name__ == "</span><span style=color:#a3be8c>__main__</span><span>":
</span><span>    port = </span><span style=color:#bf616a>int</span><span>(os.</span><span style=color:#bf616a>getenv</span><span>("</span><span style=color:#a3be8c>API_PORT</span><span>", </span><span style=color:#d08770>9999</span><span>))
</span><span>    uvicorn.</span><span style=color:#bf616a>run</span><span>("</span><span style=color:#a3be8c>app.main:app</span><span>", </span><span style=color:#bf616a>host</span><span>="</span><span style=color:#a3be8c>0.0.0.0</span><span>", </span><span style=color:#bf616a>port</span><span>=port, </span><span style=color:#bf616a>reload</span><span>=</span><span style=color:#d08770>True</span><span>)
</span></code></pre><h3 id=4-3-streamlityi-biao-ban-shi-xian>4.3 Streamlitä»ªè¡¨æ¿å®ç°</h3><p>Streamlitè®©æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿåˆ›å»ºäº¤äº’å¼æ•°æ®å¯è§†åŒ–ç•Œé¢ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># dashboard/app.py
</span><span style=color:#b48ead>import </span><span>streamlit </span><span style=color:#b48ead>as </span><span>st
</span><span style=color:#b48ead>import </span><span>pandas </span><span style=color:#b48ead>as </span><span>pd
</span><span style=color:#b48ead>import </span><span>plotly.express </span><span style=color:#b48ead>as </span><span>px
</span><span style=color:#b48ead>import </span><span>plotly.graph_objects </span><span style=color:#b48ead>as </span><span>go
</span><span style=color:#b48ead>import </span><span>requests
</span><span style=color:#b48ead>from </span><span>datetime </span><span style=color:#b48ead>import </span><span>datetime, timedelta
</span><span style=color:#b48ead>import </span><span>os
</span><span style=color:#b48ead>from </span><span>dotenv </span><span style=color:#b48ead>import </span><span>load_dotenv
</span><span>
</span><span style=color:#65737e># åŠ è½½ç¯å¢ƒå˜é‡
</span><span style=color:#bf616a>load_dotenv</span><span>()
</span><span>
</span><span style=color:#65737e># è®¾ç½®é¡µé¢é…ç½®
</span><span>st.</span><span style=color:#bf616a>set_page_config</span><span>(
</span><span>    </span><span style=color:#bf616a>page_title</span><span>="</span><span style=color:#a3be8c>OpenHands Telemetry Dashboard</span><span>",
</span><span>    </span><span style=color:#bf616a>page_icon</span><span>="</span><span style=color:#a3be8c>ğŸ“Š</span><span>",
</span><span>    </span><span style=color:#bf616a>layout</span><span>="</span><span style=color:#a3be8c>wide</span><span>"
</span><span>)
</span><span>
</span><span style=color:#65737e># é…ç½®
</span><span style=color:#bf616a>API_URL </span><span>= os.</span><span style=color:#bf616a>getenv</span><span>("</span><span style=color:#a3be8c>API_URL</span><span>", "</span><span style=color:#a3be8c>http://localhost:9999</span><span>")
</span><span>
</span><span style=color:#65737e># é¡µé¢æ ‡é¢˜
</span><span>st.</span><span style=color:#bf616a>title</span><span>("</span><span style=color:#a3be8c>OpenHands Telemetry Dashboard</span><span>")
</span><span>st.</span><span style=color:#bf616a>markdown</span><span>("</span><span style=color:#a3be8c>### Installation Telemetry Analytics</span><span>")
</span><span>
</span><span style=color:#65737e># åœ¨ä»ªè¡¨æ¿ä¸­æ·»åŠ æ—¥æœŸé€‰æ‹©å™¨
</span><span>st.sidebar.</span><span style=color:#bf616a>header</span><span>("</span><span style=color:#a3be8c>ç­›é€‰å™¨</span><span>")
</span><span>date_options = ["</span><span style=color:#a3be8c>æœ€è¿‘7å¤©</span><span>", "</span><span style=color:#a3be8c>æœ€è¿‘30å¤©</span><span>", "</span><span style=color:#a3be8c>æœ€è¿‘90å¤©</span><span>", "</span><span style=color:#a3be8c>å…¨éƒ¨</span><span>"]
</span><span>date_filter = st.sidebar.</span><span style=color:#bf616a>selectbox</span><span>("</span><span style=color:#a3be8c>æ—¶é—´èŒƒå›´</span><span>", date_options)
</span><span>
</span><span style=color:#65737e># æ ¹æ®æ—¥æœŸç­›é€‰ä¿®æ”¹ API è¯·æ±‚
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>filter_by_date</span><span>(</span><span style=color:#bf616a>date_filter</span><span>):
</span><span>    today = datetime.</span><span style=color:#bf616a>utcnow</span><span>()
</span><span>    </span><span style=color:#b48ead>if </span><span>date_filter == "</span><span style=color:#a3be8c>æœ€è¿‘7å¤©</span><span>":
</span><span>        start_date = today - </span><span style=color:#bf616a>timedelta</span><span>(</span><span style=color:#bf616a>days</span><span>=</span><span style=color:#d08770>7</span><span>)
</span><span>    </span><span style=color:#b48ead>elif </span><span>date_filter == "</span><span style=color:#a3be8c>æœ€è¿‘30å¤©</span><span>":
</span><span>        start_date = today - </span><span style=color:#bf616a>timedelta</span><span>(</span><span style=color:#bf616a>days</span><span>=</span><span style=color:#d08770>30</span><span>)
</span><span>    </span><span style=color:#b48ead>elif </span><span>date_filter == "</span><span style=color:#a3be8c>æœ€è¿‘90å¤©</span><span>":
</span><span>        start_date = today - </span><span style=color:#bf616a>timedelta</span><span>(</span><span style=color:#bf616a>days</span><span>=</span><span style=color:#d08770>90</span><span>)
</span><span>    </span><span style=color:#b48ead>else</span><span>:
</span><span>        </span><span style=color:#b48ead>return </span><span style=color:#d08770>None  </span><span style=color:#65737e># å…¨éƒ¨æ•°æ®
</span><span>    
</span><span>    </span><span style=color:#b48ead>return </span><span>start_date.</span><span style=color:#bf616a>isoformat</span><span>()
</span><span>
</span><span style=color:#65737e># è·å–ç»Ÿè®¡æ•°æ®
</span><span>@st.</span><span style=color:#bf616a>cache_data</span><span>(</span><span style=color:#bf616a>ttl</span><span>=</span><span style=color:#d08770>300</span><span>)  </span><span style=color:#65737e># ç¼“å­˜5åˆ†é’Ÿ
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>get_telemetry_stats</span><span>():
</span><span>    </span><span style=color:#b48ead>try</span><span>:
</span><span>        response = requests.</span><span style=color:#bf616a>get</span><span>(</span><span style=color:#b48ead>f</span><span>"{</span><span style=color:#bf616a>API_URL</span><span>}</span><span style=color:#a3be8c>/api/telemetry/stats</span><span>")
</span><span>        response.</span><span style=color:#bf616a>raise_for_status</span><span>()
</span><span>        </span><span style=color:#b48ead>return </span><span>response.</span><span style=color:#bf616a>json</span><span>()
</span><span>    </span><span style=color:#b48ead>except </span><span>Exception </span><span style=color:#b48ead>as </span><span>e:
</span><span>        st.</span><span style=color:#bf616a>error</span><span>(</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Error fetching telemetry stats: </span><span>{</span><span style=color:#bf616a>str</span><span>(e)}")
</span><span>        </span><span style=color:#b48ead>return </span><span style=color:#d08770>None
</span><span>
</span><span style=color:#65737e># è·å–æœ€è¿‘ä¼šè¯
</span><span>@st.</span><span style=color:#bf616a>cache_data</span><span>(</span><span style=color:#bf616a>ttl</span><span>=</span><span style=color:#d08770>300</span><span>)
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>get_recent_sessions</span><span>(</span><span style=color:#bf616a>limit</span><span>=</span><span style=color:#d08770>10</span><span>):
</span><span>    </span><span style=color:#b48ead>try</span><span>:
</span><span>        response = requests.</span><span style=color:#bf616a>get</span><span>(</span><span style=color:#b48ead>f</span><span>"{</span><span style=color:#bf616a>API_URL</span><span>}</span><span style=color:#a3be8c>/api/telemetry/recent?limit=</span><span>{limit}")
</span><span>        response.</span><span style=color:#bf616a>raise_for_status</span><span>()
</span><span>        </span><span style=color:#b48ead>return </span><span>response.</span><span style=color:#bf616a>json</span><span>()
</span><span>    </span><span style=color:#b48ead>except </span><span>Exception </span><span style=color:#b48ead>as </span><span>e:
</span><span>        st.</span><span style=color:#bf616a>error</span><span>(</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Error fetching recent sessions: </span><span>{</span><span style=color:#bf616a>str</span><span>(e)}")
</span><span>        </span><span style=color:#b48ead>return </span><span>[]
</span><span>
</span><span style=color:#65737e># è·å–ä¼šè¯è¯¦æƒ…
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>get_session_events</span><span>(</span><span style=color:#bf616a>session_id</span><span>):
</span><span>    </span><span style=color:#b48ead>try</span><span>:
</span><span>        response = requests.</span><span style=color:#bf616a>get</span><span>(</span><span style=color:#b48ead>f</span><span>"{</span><span style=color:#bf616a>API_URL</span><span>}</span><span style=color:#a3be8c>/api/telemetry/sessions/</span><span>{session_id}</span><span style=color:#a3be8c>/events</span><span>")
</span><span>        response.</span><span style=color:#bf616a>raise_for_status</span><span>()
</span><span>        </span><span style=color:#b48ead>return </span><span>response.</span><span style=color:#bf616a>json</span><span>()
</span><span>    </span><span style=color:#b48ead>except </span><span>Exception </span><span style=color:#b48ead>as </span><span>e:
</span><span>        st.</span><span style=color:#bf616a>error</span><span>(</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Error fetching session events: </span><span>{</span><span style=color:#bf616a>str</span><span>(e)}")
</span><span>        </span><span style=color:#b48ead>return </span><span style=color:#d08770>None
</span><span>
</span><span style=color:#65737e># å¯¼å‡ºåŠŸèƒ½
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>export_to_csv</span><span>(</span><span style=color:#bf616a>df</span><span>, </span><span style=color:#bf616a>filename</span><span>):
</span><span>    </span><span style=color:#b48ead>return </span><span>df.</span><span style=color:#bf616a>to_csv</span><span>().</span><span style=color:#bf616a>encode</span><span>('</span><span style=color:#a3be8c>utf-8</span><span>')
</span><span>
</span><span style=color:#65737e># åˆ·æ–°æŒ‰é’®
</span><span style=color:#b48ead>if </span><span>st.</span><span style=color:#bf616a>button</span><span>("</span><span style=color:#a3be8c>åˆ·æ–°æ•°æ®</span><span>"):
</span><span>    st.cache_data.</span><span style=color:#bf616a>clear</span><span>()
</span><span>    st.</span><span style=color:#bf616a>success</span><span>("</span><span style=color:#a3be8c>æ•°æ®å·²åˆ·æ–°!</span><span>")
</span><span>
</span><span style=color:#65737e># è·å–æ•°æ®
</span><span>stats = </span><span style=color:#bf616a>get_telemetry_stats</span><span>()
</span><span>recent_sessions = </span><span style=color:#bf616a>get_recent_sessions</span><span>(</span><span style=color:#d08770>20</span><span>)
</span><span>
</span><span style=color:#65737e># æ˜¾ç¤ºKPIå¡ç‰‡
</span><span style=color:#b48ead>if </span><span>stats:
</span><span>    col1, col2, col3, col4 = st.</span><span style=color:#bf616a>columns</span><span>(</span><span style=color:#d08770>4</span><span>)
</span><span>    </span><span style=color:#b48ead>with </span><span>col1:
</span><span>        st.</span><span style=color:#bf616a>metric</span><span>("</span><span style=color:#a3be8c>æ€»å®‰è£…æ¬¡æ•°</span><span>", stats['</span><span style=color:#a3be8c>total_sessions</span><span>'])
</span><span>    </span><span style=color:#b48ead>with </span><span>col2:
</span><span>        st.</span><span style=color:#bf616a>metric</span><span>("</span><span style=color:#a3be8c>æˆåŠŸå®‰è£…</span><span>", stats['</span><span style=color:#a3be8c>successful_installs</span><span>'])
</span><span>    </span><span style=color:#b48ead>with </span><span>col3:
</span><span>        st.</span><span style=color:#bf616a>metric</span><span>("</span><span style=color:#a3be8c>æˆåŠŸç‡</span><span>", </span><span style=color:#b48ead>f</span><span>"{stats['</span><span style=color:#a3be8c>success_rate</span><span>']</span><span style=color:#d08770>:.1f</span><span>}</span><span style=color:#a3be8c>%</span><span>")
</span><span>    </span><span style=color:#b48ead>with </span><span>col4:
</span><span>        st.</span><span style=color:#bf616a>metric</span><span>("</span><span style=color:#a3be8c>å¹³å‡å®‰è£…æ—¶é—´</span><span>", </span><span style=color:#b48ead>f</span><span>"{stats['</span><span style=color:#a3be8c>avg_install_time</span><span>']</span><span style=color:#d08770>:.1f</span><span>}</span><span style=color:#a3be8c> ç§’</span><span>")
</span><span>
</span><span>    </span><span style=color:#65737e># åˆ›å»ºæ“ä½œç³»ç»Ÿåˆ†å¸ƒå›¾è¡¨
</span><span>    st.</span><span style=color:#bf616a>subheader</span><span>("</span><span style=color:#a3be8c>æŒ‰æ“ä½œç³»ç»Ÿåˆ†ç±»çš„å®‰è£…æ•°</span><span>")
</span><span>    os_data = pd.</span><span style=color:#bf616a>DataFrame</span><span>({
</span><span>        "</span><span style=color:#a3be8c>æ“ä½œç³»ç»Ÿ</span><span>": stats["</span><span style=color:#a3be8c>installation_by_os</span><span>"].</span><span style=color:#bf616a>keys</span><span>(),
</span><span>        "</span><span style=color:#a3be8c>å®‰è£…æ•°</span><span>": stats["</span><span style=color:#a3be8c>installation_by_os</span><span>"].</span><span style=color:#bf616a>values</span><span>()
</span><span>    })
</span><span>    
</span><span>    </span><span style=color:#b48ead>if </span><span>not os_data.empty:
</span><span>        fig = px.</span><span style=color:#bf616a>pie</span><span>(os_data, </span><span style=color:#bf616a>names</span><span>="</span><span style=color:#a3be8c>æ“ä½œç³»ç»Ÿ</span><span>", </span><span style=color:#bf616a>values</span><span>="</span><span style=color:#a3be8c>å®‰è£…æ•°</span><span>", </span><span style=color:#bf616a>hole</span><span>=</span><span style=color:#d08770>0.4</span><span>)
</span><span>        fig.</span><span style=color:#bf616a>update_layout</span><span>(</span><span style=color:#bf616a>height</span><span>=</span><span style=color:#d08770>400</span><span>)
</span><span>        st.</span><span style=color:#bf616a>plotly_chart</span><span>(fig, </span><span style=color:#bf616a>use_container_width</span><span>=</span><span style=color:#d08770>True</span><span>)
</span><span>    </span><span style=color:#b48ead>else</span><span>:
</span><span>        st.</span><span style=color:#bf616a>info</span><span>("</span><span style=color:#a3be8c>æš‚æ— æ“ä½œç³»ç»Ÿæ•°æ®</span><span>")
</span><span>
</span><span>    </span><span style=color:#65737e># åˆ›å»ºæ­¥éª¤æˆåŠŸç‡å›¾è¡¨
</span><span>    st.</span><span style=color:#bf616a>subheader</span><span>("</span><span style=color:#a3be8c>å®‰è£…æ­¥éª¤çŠ¶æ€åˆ†å¸ƒ</span><span>")
</span><span>    
</span><span>    steps_data = []
</span><span>    </span><span style=color:#b48ead>for </span><span>step, statuses </span><span style=color:#b48ead>in </span><span>stats["</span><span style=color:#a3be8c>steps_status</span><span>"].</span><span style=color:#bf616a>items</span><span>():
</span><span>        total = </span><span style=color:#96b5b4>sum</span><span>(statuses.</span><span style=color:#bf616a>values</span><span>())
</span><span>        </span><span style=color:#b48ead>for </span><span>status, count </span><span style=color:#b48ead>in </span><span>statuses.</span><span style=color:#bf616a>items</span><span>():
</span><span>            steps_data.</span><span style=color:#bf616a>append</span><span>({
</span><span>                "</span><span style=color:#a3be8c>æ­¥éª¤</span><span>": step,
</span><span>                "</span><span style=color:#a3be8c>çŠ¶æ€</span><span>": status,
</span><span>                "</span><span style=color:#a3be8c>æ•°é‡</span><span>": count,
</span><span>                "</span><span style=color:#a3be8c>ç™¾åˆ†æ¯”</span><span>": (count / total * </span><span style=color:#d08770>100</span><span>) </span><span style=color:#b48ead>if </span><span>total > </span><span style=color:#d08770>0 </span><span style=color:#b48ead>else </span><span style=color:#d08770>0
</span><span>            })
</span><span>    
</span><span>    steps_df = pd.</span><span style=color:#bf616a>DataFrame</span><span>(steps_data)
</span><span>    </span><span style=color:#b48ead>if </span><span>not steps_df.empty:
</span><span>        fig = px.</span><span style=color:#bf616a>bar</span><span>(
</span><span>            steps_df,
</span><span>            </span><span style=color:#bf616a>x</span><span>="</span><span style=color:#a3be8c>æ­¥éª¤</span><span>",
</span><span>            </span><span style=color:#bf616a>y</span><span>="</span><span style=color:#a3be8c>æ•°é‡</span><span>",
</span><span>            </span><span style=color:#bf616a>color</span><span>="</span><span style=color:#a3be8c>çŠ¶æ€</span><span>",
</span><span>            </span><span style=color:#bf616a>barmode</span><span>="</span><span style=color:#a3be8c>stack</span><span>",
</span><span>            </span><span style=color:#bf616a>text</span><span>="</span><span style=color:#a3be8c>ç™¾åˆ†æ¯”</span><span>",
</span><span>            </span><span style=color:#bf616a>labels</span><span>={"</span><span style=color:#a3be8c>ç™¾åˆ†æ¯”</span><span>": "</span><span style=color:#a3be8c>%</span><span>"}
</span><span>        )
</span><span>        fig.</span><span style=color:#bf616a>update_layout</span><span>(</span><span style=color:#bf616a>height</span><span>=</span><span style=color:#d08770>500</span><span>)
</span><span>        st.</span><span style=color:#bf616a>plotly_chart</span><span>(fig, </span><span style=color:#bf616a>use_container_width</span><span>=</span><span style=color:#d08770>True</span><span>)
</span><span>    </span><span style=color:#b48ead>else</span><span>:
</span><span>        st.</span><span style=color:#bf616a>info</span><span>("</span><span style=color:#a3be8c>æš‚æ— æ­¥éª¤æ•°æ®</span><span>")
</span><span style=color:#b48ead>else</span><span>:
</span><span>    st.</span><span style=color:#bf616a>warning</span><span>("</span><span style=color:#a3be8c>æ— æ³•è·å–ç»Ÿè®¡æ•°æ®ã€‚è¯·ç¡®ä¿åç«¯APIæ­£åœ¨è¿è¡Œã€‚</span><span>")
</span><span>
</span><span style=color:#65737e># æ˜¾ç¤ºæœ€è¿‘ä¼šè¯
</span><span>st.</span><span style=color:#bf616a>subheader</span><span>("</span><span style=color:#a3be8c>æœ€è¿‘å®‰è£…ä¼šè¯</span><span>")
</span><span style=color:#b48ead>if </span><span>recent_sessions:
</span><span>    </span><span style=color:#65737e># åˆ›å»ºä¼šè¯è¡¨æ ¼
</span><span>    sessions_df = pd.</span><span style=color:#bf616a>DataFrame</span><span>(recent_sessions)
</span><span>    sessions_df["</span><span style=color:#a3be8c>timestamp</span><span>"] = pd.</span><span style=color:#bf616a>to_datetime</span><span>(sessions_df["</span><span style=color:#a3be8c>timestamp</span><span>"])
</span><span>    sessions_df["</span><span style=color:#a3be8c>æ—¶é—´</span><span>"] = sessions_df["</span><span style=color:#a3be8c>timestamp</span><span>"].dt.</span><span style=color:#bf616a>strftime</span><span>("</span><span style=color:#d08770>%Y</span><span style=color:#a3be8c>-</span><span style=color:#d08770>%m</span><span style=color:#a3be8c>-</span><span style=color:#d08770>%d %H</span><span style=color:#a3be8c>:</span><span style=color:#d08770>%M</span><span style=color:#a3be8c>:</span><span style=color:#d08770>%S</span><span>")
</span><span>    sessions_df["</span><span style=color:#a3be8c>çŠ¶æ€</span><span>"] = sessions_df["</span><span style=color:#a3be8c>success</span><span>"].</span><span style=color:#bf616a>apply</span><span>(</span><span style=color:#b48ead>lambda </span><span style=color:#bf616a>x</span><span>: "</span><span style=color:#a3be8c>æˆåŠŸ</span><span>" </span><span style=color:#b48ead>if </span><span>x </span><span style=color:#b48ead>else </span><span>"</span><span style=color:#a3be8c>å¤±è´¥</span><span>")
</span><span>    sessions_df["</span><span style=color:#a3be8c>æŒç»­æ—¶é—´</span><span>"] = sessions_df["</span><span style=color:#a3be8c>duration_seconds</span><span>"].</span><span style=color:#bf616a>apply</span><span>(</span><span style=color:#b48ead>lambda </span><span style=color:#bf616a>x</span><span>: </span><span style=color:#b48ead>f</span><span>"{x</span><span style=color:#d08770>:.1f</span><span>}</span><span style=color:#a3be8c> ç§’</span><span>")
</span><span>    
</span><span>    </span><span style=color:#65737e># ä½¿ç”¨Streamlitçš„åˆ—æ ¼å¼åŒ–
</span><span>    sessions_display = sessions_df[["</span><span style=color:#a3be8c>session_id</span><span>", "</span><span style=color:#a3be8c>æ—¶é—´</span><span>", "</span><span style=color:#a3be8c>çŠ¶æ€</span><span>", "</span><span style=color:#a3be8c>æŒç»­æ—¶é—´</span><span>", "</span><span style=color:#a3be8c>os</span><span>"]]
</span><span>    sessions_display.columns = ["</span><span style=color:#a3be8c>ä¼šè¯ID</span><span>", "</span><span style=color:#a3be8c>æ—¶é—´</span><span>", "</span><span style=color:#a3be8c>çŠ¶æ€</span><span>", "</span><span style=color:#a3be8c>æŒç»­æ—¶é—´</span><span>", "</span><span style=color:#a3be8c>æ“ä½œç³»ç»Ÿ</span><span>"]
</span><span>
</span><span>    </span><span style=color:#65737e># æ·»åŠ å¯¼å‡ºåŠŸèƒ½
</span><span>    csv = </span><span style=color:#bf616a>export_to_csv</span><span>(sessions_df, "</span><span style=color:#a3be8c>sessions.csv</span><span>")
</span><span>    st.</span><span style=color:#bf616a>download_button</span><span>(
</span><span>        </span><span style=color:#bf616a>label</span><span>="</span><span style=color:#a3be8c>å¯¼å‡ºä¼šè¯æ•°æ®ä¸ºCSV</span><span>",
</span><span>        </span><span style=color:#bf616a>data</span><span>=csv,
</span><span>        </span><span style=color:#bf616a>file_name</span><span>="</span><span style=color:#a3be8c>openhands_sessions.csv</span><span>",
</span><span>        </span><span style=color:#bf616a>mime</span><span>="</span><span style=color:#a3be8c>text/csv</span><span>",
</span><span>    )
</span><span>    
</span><span>    </span><span style=color:#65737e># å¢åŠ ä¼šè¯è¯¦æƒ…å±•å¼€åŠŸèƒ½
</span><span>    selected_session = st.</span><span style=color:#bf616a>selectbox</span><span>("</span><span style=color:#a3be8c>é€‰æ‹©ä¼šè¯æŸ¥çœ‹è¯¦æƒ…:</span><span>", sessions_df["</span><span style=color:#a3be8c>session_id</span><span>"].</span><span style=color:#bf616a>tolist</span><span>())
</span><span>    
</span><span>    </span><span style=color:#b48ead>if </span><span>selected_session:
</span><span>        session_data = </span><span style=color:#bf616a>get_session_events</span><span>(selected_session)
</span><span>        </span><span style=color:#b48ead>if </span><span>session_data and session_data["</span><span style=color:#a3be8c>events</span><span>"]:
</span><span>            st.</span><span style=color:#bf616a>subheader</span><span>(</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>ä¼šè¯ </span><span>{selected_session}</span><span style=color:#a3be8c> è¯¦æƒ…</span><span>")
</span><span>            
</span><span>            events = session_data["</span><span style=color:#a3be8c>events</span><span>"]
</span><span>            events_df = pd.</span><span style=color:#bf616a>DataFrame</span><span>(events)
</span><span>            
</span><span>            </span><span style=color:#65737e># ä¸ºæ—¶é—´è½´åˆ›å»ºæ•°æ®
</span><span>            events_df["</span><span style=color:#a3be8c>timestamp</span><span>"] = pd.</span><span style=color:#bf616a>to_datetime</span><span>(events_df["</span><span style=color:#a3be8c>timestamp</span><span>"])
</span><span>            events_df = events_df.</span><span style=color:#bf616a>sort_values</span><span>("</span><span style=color:#a3be8c>timestamp</span><span>")
</span><span>            
</span><span>            </span><span style=color:#65737e># åˆ›å»ºæ—¶é—´è½´å¯è§†åŒ–
</span><span>            fig = go.</span><span style=color:#bf616a>Figure</span><span>()
</span><span>            
</span><span>            </span><span style=color:#b48ead>for </span><span>i, event </span><span style=color:#b48ead>in </span><span>events_df.</span><span style=color:#bf616a>iterrows</span><span>():
</span><span>                </span><span style=color:#65737e># æ ¹æ®äº‹ä»¶çŠ¶æ€è®¾ç½®é¢œè‰²
</span><span>                color = "</span><span style=color:#a3be8c>green</span><span>"
</span><span>                </span><span style=color:#b48ead>if </span><span>event["</span><span style=color:#a3be8c>status</span><span>"] == "</span><span style=color:#a3be8c>failure</span><span>":
</span><span>                    color = "</span><span style=color:#a3be8c>red</span><span>"
</span><span>                </span><span style=color:#b48ead>elif </span><span>event["</span><span style=color:#a3be8c>status</span><span>"] == "</span><span style=color:#a3be8c>warning</span><span>" or event["</span><span style=color:#a3be8c>status</span><span>"] == "</span><span style=color:#a3be8c>partial</span><span>":
</span><span>                    color = "</span><span style=color:#a3be8c>orange</span><span>"
</span><span>                
</span><span>                </span><span style=color:#65737e># æ·»åŠ äº‹ä»¶ç‚¹
</span><span>                fig.</span><span style=color:#bf616a>add_trace</span><span>(go.</span><span style=color:#bf616a>Scatter</span><span>(
</span><span>                    </span><span style=color:#bf616a>x</span><span>=[event["</span><span style=color:#a3be8c>timestamp</span><span>"]],
</span><span>                    </span><span style=color:#bf616a>y</span><span>=[event["</span><span style=color:#a3be8c>step</span><span>"]],
</span><span>                    </span><span style=color:#bf616a>mode</span><span>="</span><span style=color:#a3be8c>markers+text</span><span>",
</span><span>                    </span><span style=color:#bf616a>marker</span><span>=</span><span style=color:#bf616a>dict</span><span>(</span><span style=color:#bf616a>color</span><span>=color, </span><span style=color:#bf616a>size</span><span>=</span><span style=color:#d08770>15</span><span>),
</span><span>                    </span><span style=color:#bf616a>text</span><span>=[event["</span><span style=color:#a3be8c>status</span><span>"]],
</span><span>                    </span><span style=color:#bf616a>textposition</span><span>="</span><span style=color:#a3be8c>top center</span><span>",
</span><span>                    </span><span style=color:#bf616a>name</span><span>=</span><span style=color:#b48ead>f</span><span>"{event['</span><span style=color:#a3be8c>step</span><span>']}</span><span style=color:#a3be8c> - </span><span>{event['</span><span style=color:#a3be8c>status</span><span>']}"
</span><span>                ))
</span><span>            
</span><span>            fig.</span><span style=color:#bf616a>update_layout</span><span>(
</span><span>                </span><span style=color:#bf616a>title</span><span>="</span><span style=color:#a3be8c>å®‰è£…æ­¥éª¤æ—¶é—´è½´</span><span>",
</span><span>                </span><span style=color:#bf616a>xaxis_title</span><span>="</span><span style=color:#a3be8c>æ—¶é—´</span><span>",
</span><span>                </span><span style=color:#bf616a>yaxis_title</span><span>="</span><span style=color:#a3be8c>å®‰è£…æ­¥éª¤</span><span>",
</span><span>                </span><span style=color:#bf616a>height</span><span>=</span><span style=color:#d08770>500
</span><span>            )
</span><span>            
</span><span>            st.</span><span style=color:#bf616a>plotly_chart</span><span>(fig, </span><span style=color:#bf616a>use_container_width</span><span>=</span><span style=color:#d08770>True</span><span>)
</span><span>            
</span><span>            </span><span style=color:#65737e># æ˜¾ç¤ºäº‹ä»¶è¯¦æƒ…
</span><span>            </span><span style=color:#b48ead>with </span><span>st.</span><span style=color:#bf616a>expander</span><span>("</span><span style=color:#a3be8c>æŸ¥çœ‹ä¼šè¯äº‹ä»¶è¯¦æƒ…</span><span>"):
</span><span>                </span><span style=color:#65737e># é€‰æ‹©è¦å±•ç¤ºçš„åˆ—
</span><span>                display_cols = ["</span><span style=color:#a3be8c>step</span><span>", "</span><span style=color:#a3be8c>status</span><span>", "</span><span style=color:#a3be8c>timestamp</span><span>"]
</span><span>                st.</span><span style=color:#bf616a>dataframe</span><span>(events_df[display_cols])
</span><span>                
</span><span>                </span><span style=color:#65737e># æ˜¾ç¤ºæœ€åä¸€ä¸ªäº‹ä»¶çš„è¯¦ç»†æŒ‡æ ‡
</span><span>                </span><span style=color:#b48ead>if </span><span>"</span><span style=color:#a3be8c>metrics</span><span>" in events_df.columns:
</span><span>                    last_event = events_df.iloc[-</span><span style=color:#d08770>1</span><span>]
</span><span>                    </span><span style=color:#b48ead>if </span><span style=color:#96b5b4>isinstance</span><span>(last_event["</span><span style=color:#a3be8c>metrics</span><span>"], dict) and last_event["</span><span style=color:#a3be8c>metrics</span><span>"]:
</span><span>                        st.</span><span style=color:#bf616a>subheader</span><span>("</span><span style=color:#a3be8c>æœ€ç»ˆæŒ‡æ ‡</span><span>")
</span><span>                        </span><span style=color:#b48ead>for </span><span>key, value </span><span style=color:#b48ead>in </span><span>last_event["</span><span style=color:#a3be8c>metrics</span><span>"].</span><span style=color:#bf616a>items</span><span>():
</span><span>                            st.</span><span style=color:#bf616a>text</span><span>(</span><span style=color:#b48ead>f</span><span>"{key}</span><span style=color:#a3be8c>: </span><span>{value}")
</span><span style=color:#b48ead>else</span><span>:
</span><span>    st.</span><span style=color:#bf616a>info</span><span>("</span><span style=color:#a3be8c>æš‚æ— æœ€è¿‘ä¼šè¯æ•°æ®</span><span>")
</span><span>
</span><span style=color:#65737e># é¡µè„š
</span><span>st.</span><span style=color:#bf616a>markdown</span><span>("</span><span style=color:#a3be8c>---</span><span>")
</span><span>st.</span><span style=color:#bf616a>markdown</span><span>("</span><span style=color:#a3be8c>OpenHands Telemetry Dashboard | Â© 2025</span><span>")
</span></code></pre><h3 id=4-4-rong-qi-hua-pei-zhi>4.4 å®¹å™¨åŒ–é…ç½®</h3><h4 id=4-4-1-apifu-wu-rong-qi>4.4.1 APIæœåŠ¡å®¹å™¨</h4><pre class=language-dockerfile data-lang=dockerfile style=background:#2b303b;color:#c0c5ce><code class=language-dockerfile data-lang=dockerfile><span style=color:#65737e># docker/api.Dockerfile
</span><span style=color:#b48ead>FROM</span><span> python:3.11-slim
</span><span>
</span><span style=color:#b48ead>WORKDIR </span><span>/app
</span><span>
</span><span style=color:#b48ead>COPY</span><span> api/requirements.txt .
</span><span>
</span><span style=color:#b48ead>RUN </span><span>pip install --no-cache-dir -r requirements.txt
</span><span>
</span><span style=color:#b48ead>COPY</span><span> api/app ./app
</span><span>
</span><span>CMD ["</span><span style=color:#a3be8c>uvicorn</span><span>", "</span><span style=color:#a3be8c>app.main:app</span><span>", "</span><span style=color:#a3be8c>--host</span><span>", "</span><span style=color:#a3be8c>0.0.0.0</span><span>", "</span><span style=color:#a3be8c>--port</span><span>", "</span><span style=color:#a3be8c>9999</span><span>"]
</span></code></pre><h4 id=4-4-2-streamlityi-biao-ban-rong-qi>4.4.2 Streamlitä»ªè¡¨æ¿å®¹å™¨</h4><pre class=language-dockerfile data-lang=dockerfile style=background:#2b303b;color:#c0c5ce><code class=language-dockerfile data-lang=dockerfile><span style=color:#65737e># docker/dashboard.Dockerfile
</span><span style=color:#b48ead>FROM</span><span> python:3.11-slim
</span><span>
</span><span style=color:#b48ead>WORKDIR </span><span>/app
</span><span>
</span><span style=color:#b48ead>COPY</span><span> dashboard/requirements.txt .
</span><span>
</span><span style=color:#b48ead>RUN </span><span>pip install --no-cache-dir -r requirements.txt
</span><span>
</span><span style=color:#b48ead>COPY</span><span> dashboard/app.py .
</span><span>
</span><span style=color:#b48ead>EXPOSE </span><span>8501
</span><span>
</span><span>CMD ["</span><span style=color:#a3be8c>streamlit</span><span>", "</span><span style=color:#a3be8c>run</span><span>", "</span><span style=color:#a3be8c>app.py</span><span>"]
</span></code></pre><h4 id=4-4-3-docker-composepei-zhi>4.4.3 Docker Composeé…ç½®</h4><pre class=language-yaml data-lang=yaml style=background:#2b303b;color:#c0c5ce><code class=language-yaml data-lang=yaml><span style=color:#65737e># docker-compose.yml
</span><span style=color:#bf616a>services</span><span>:
</span><span>  </span><span style=color:#bf616a>mongodb</span><span>:
</span><span>    </span><span style=color:#bf616a>image</span><span>: </span><span style=color:#a3be8c>mongo:6.0.5
</span><span>    </span><span style=color:#bf616a>ports</span><span>:
</span><span>      - "</span><span style=color:#a3be8c>27017:27017</span><span>"
</span><span>    </span><span style=color:#bf616a>volumes</span><span>:
</span><span>      - </span><span style=color:#a3be8c>mongo_data:/data/db
</span><span>    </span><span style=color:#bf616a>restart</span><span>: </span><span style=color:#a3be8c>always
</span><span>    
</span><span>  </span><span style=color:#bf616a>api</span><span>:
</span><span>    </span><span style=color:#bf616a>build</span><span>:
</span><span>      </span><span style=color:#bf616a>context</span><span>: </span><span style=color:#d08770>.
</span><span>      </span><span style=color:#bf616a>dockerfile</span><span>: </span><span style=color:#a3be8c>docker/api.Dockerfile
</span><span>    </span><span style=color:#bf616a>ports</span><span>:
</span><span>      - "</span><span style=color:#a3be8c>9999:9999</span><span>"
</span><span>    </span><span style=color:#bf616a>depends_on</span><span>:
</span><span>      - </span><span style=color:#a3be8c>mongodb
</span><span>    </span><span style=color:#bf616a>environment</span><span>:
</span><span>      - </span><span style=color:#a3be8c>MONGODB_URI=mongodb://mongodb:27017
</span><span>      - </span><span style=color:#a3be8c>MONGODB_DB=openhands_telemetry
</span><span>      - </span><span style=color:#a3be8c>ENVIRONMENT=production
</span><span>    </span><span style=color:#bf616a>restart</span><span>: </span><span style=color:#a3be8c>always
</span><span>    
</span><span>  </span><span style=color:#bf616a>dashboard</span><span>:
</span><span>    </span><span style=color:#bf616a>build</span><span>:
</span><span>      </span><span style=color:#bf616a>context</span><span>: </span><span style=color:#d08770>.
</span><span>      </span><span style=color:#bf616a>dockerfile</span><span>: </span><span style=color:#a3be8c>docker/dashboard.Dockerfile
</span><span>    </span><span style=color:#bf616a>ports</span><span>:
</span><span>      - "</span><span style=color:#a3be8c>8501:8501</span><span>"
</span><span>    </span><span style=color:#bf616a>depends_on</span><span>:
</span><span>      - </span><span style=color:#a3be8c>api
</span><span>    </span><span style=color:#bf616a>environment</span><span>:
</span><span>      - </span><span style=color:#a3be8c>API_URL=http://api:9999
</span><span>    </span><span style=color:#bf616a>restart</span><span>: </span><span style=color:#a3be8c>always
</span><span>
</span><span style=color:#bf616a>volumes</span><span>:
</span><span>  </span><span style=color:#bf616a>mongo_data</span><span>:
</span></code></pre><h2 id=wu-bu-shu-yu-pei-zhi>äº”ã€éƒ¨ç½²ä¸é…ç½®</h2><h3 id=5-1-chuang-jian-yi-lai-wen-jian>5.1 åˆ›å»ºä¾èµ–æ–‡ä»¶</h3><p>é¡¹ç›®ä¾èµ–ç®¡ç†æ˜¯ç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§çš„å…³é”®ï¼š<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#65737e># APIä¾èµ–
</span><span style=color:#96b5b4>cd</span><span> api
</span><span style=color:#bf616a>python -m</span><span> venv venv
</span><span style=color:#96b5b4>source</span><span> venv/bin/activate  </span><span style=color:#65737e># Windows: venv\Scripts\activate
</span><span style=color:#bf616a>pip</span><span> install fastapi uvicorn motor pymongo pandas python-dotenv
</span><span style=color:#bf616a>pip</span><span> freeze > requirements.txt
</span><span>
</span><span style=color:#65737e># Dashboardä¾èµ–
</span><span style=color:#96b5b4>cd</span><span> ../dashboard
</span><span style=color:#bf616a>python -m</span><span> venv venv
</span><span style=color:#96b5b4>source</span><span> venv/bin/activate  </span><span style=color:#65737e># Windows: venv\Scripts\activate
</span><span style=color:#bf616a>pip</span><span> install streamlit pandas matplotlib plotly requests python-dotenv
</span><span style=color:#bf616a>pip</span><span> freeze > requirements.txt
</span></code></pre><h3 id=5-2-gou-jian-yu-qi-dong-fu-wu>5.2 æ„å»ºä¸å¯åŠ¨æœåŠ¡</h3><p>ä½¿ç”¨Docker Composeç®€åŒ–éƒ¨ç½²æµç¨‹ï¼š<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#65737e># æ„å»ºé•œåƒ
</span><span style=color:#bf616a>docker-compose</span><span> build
</span><span>
</span><span style=color:#65737e># å¯åŠ¨æœåŠ¡
</span><span style=color:#bf616a>docker-compose</span><span> up</span><span style=color:#bf616a> -d
</span></code></pre><h3 id=5-3-chu-shi-hua-ce-shi-shu-ju>5.3 åˆå§‹åŒ–æµ‹è¯•æ•°æ®</h3><p>ä¸ºéªŒè¯ä»ªè¡¨æ¿åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€ä¸€äº›æµ‹è¯•æ•°æ®ï¼š<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#65737e># æµ‹è¯•æ•°æ®å‘é€è„šæœ¬
</span><span style=color:#bf616a>import</span><span> requests
</span><span style=color:#bf616a>import</span><span> json
</span><span style=color:#bf616a>from</span><span> datetime import datetime, timedelta
</span><span style=color:#bf616a>import</span><span> random
</span><span style=color:#bf616a>import</span><span> uuid
</span><span>
</span><span style=color:#bf616a>API_URL</span><span> = "</span><span style=color:#a3be8c>http://localhost:9999</span><span>"
</span><span>
</span><span style=color:#65737e># ç”Ÿæˆä¸€äº›ä¼šè¯ID
</span><span style=color:#bf616a>session_ids</span><span> = </span><span style=color:#b48ead>[</span><span>str(uuid.uuid4()) for _ in range(5)</span><span style=color:#b48ead>]
</span><span style=color:#bf616a>os_names</span><span> = </span><span style=color:#b48ead>[</span><span>"</span><span style=color:#a3be8c>Windows</span><span>", "</span><span style=color:#a3be8c>MacOS</span><span>", "</span><span style=color:#a3be8c>Linux</span><span>"</span><span style=color:#b48ead>]
</span><span style=color:#bf616a>os_versions</span><span> = </span><span style=color:#b48ead>[</span><span>"</span><span style=color:#a3be8c>Windows 10</span><span>", "</span><span style=color:#a3be8c>Windows 11</span><span>", "</span><span style=color:#a3be8c>MacOS 12.5</span><span>", "</span><span style=color:#a3be8c>Ubuntu 22.04</span><span>"</span><span style=color:#b48ead>]
</span><span style=color:#bf616a>steps</span><span> = </span><span style=color:#b48ead>[</span><span>"</span><span style=color:#a3be8c>check_prerequisites</span><span>", "</span><span style=color:#a3be8c>download_docker</span><span>", "</span><span style=color:#a3be8c>install_docker</span><span>", "</span><span style=color:#a3be8c>configure_docker</span><span>", "</span><span style=color:#a3be8c>install</span><span>"</span><span style=color:#b48ead>]
</span><span style=color:#bf616a>statuses</span><span> = </span><span style=color:#b48ead>[</span><span>"</span><span style=color:#a3be8c>started</span><span>", "</span><span style=color:#a3be8c>in_progress</span><span>", "</span><span style=color:#a3be8c>completed</span><span>", "</span><span style=color:#a3be8c>warning</span><span>", "</span><span style=color:#a3be8c>failure</span><span>"</span><span style=color:#b48ead>]
</span><span>
</span><span style=color:#65737e># ç”Ÿæˆéšæœºäº‹ä»¶
</span><span style=color:#b48ead>for</span><span> session_id </span><span style=color:#b48ead>in</span><span> session_ids:
</span><span>    </span><span style=color:#bf616a>anonymous_id</span><span> = str(uuid.uuid4())</span><span style=color:#bf616a>[:16]
</span><span>    </span><span style=color:#bf616a>os_name</span><span> = random.choice(os_names)
</span><span>    </span><span style=color:#bf616a>os_version</span><span> = random.choice(</span><span style=color:#b48ead>[</span><span>v for v in os_versions if os_name in v</span><span style=color:#b48ead>]</span><span>)
</span><span>    
</span><span>    </span><span style=color:#65737e># ä¸ºæ¯ä¸ªä¼šè¯åˆ›å»ºä¸€ç³»åˆ—äº‹ä»¶
</span><span>    </span><span style=color:#bf616a>base_time</span><span> = datetime.utcnow() </span><span style=color:#bf616a>-</span><span> timedelta(days=random.randint(0, 6))
</span><span>    
</span><span>    </span><span style=color:#65737e># éšæœºå†³å®šè¿™ä¸ªä¼šè¯æ˜¯å¦æˆåŠŸ
</span><span>    </span><span style=color:#bf616a>success</span><span> = random.random() > </span><span style=color:#d08770>0</span><span style=color:#bf616a>.3
</span><span>    
</span><span>    </span><span style=color:#b48ead>for</span><span> i, step </span><span style=color:#b48ead>in</span><span> enumerate(steps)</span><span style=color:#96b5b4>:
</span><span>        </span><span style=color:#65737e># æ¯ä¸ªæ­¥éª¤çš„æ—¶é—´å¢åŠ ä¸€äº›éšæœºå€¼
</span><span>        </span><span style=color:#bf616a>event_time</span><span> = base_time + timedelta(minutes=i*5 + random.randint(1, 3))
</span><span>        
</span><span>        </span><span style=color:#65737e># å¯¹äºå¤±è´¥çš„ä¼šè¯ï¼Œå¯èƒ½åœ¨æŸä¸ªæ­¥éª¤å¤±è´¥
</span><span>        </span><span style=color:#b48ead>if </span><span style=color:#bf616a>not</span><span> success and i > </span><span style=color:#d08770>2</span><span> and random.random() > </span><span style=color:#d08770>0</span><span style=color:#bf616a>.7:
</span><span>            </span><span style=color:#bf616a>status</span><span> = "</span><span style=color:#a3be8c>failure</span><span>"
</span><span>            </span><span style=color:#bf616a>metrics</span><span> = {"</span><span style=color:#a3be8c>error_code</span><span>": random.randint(100, 500), "</span><span style=color:#a3be8c>success</span><span>": False}
</span><span>        </span><span style=color:#b48ead>else</span><span style=color:#96b5b4>:
</span><span>            </span><span style=color:#bf616a>status</span><span> = "</span><span style=color:#a3be8c>completed</span><span>" if i < len(steps) </span><span style=color:#bf616a>-</span><span> 1 or success else "</span><span style=color:#a3be8c>failure</span><span>"
</span><span>            </span><span style=color:#bf616a>metrics</span><span> = {"</span><span style=color:#a3be8c>success</span><span>": status == "</span><span style=color:#a3be8c>completed</span><span>"}
</span><span>        
</span><span>        </span><span style=color:#65737e># åˆ›å»ºäº‹ä»¶æ•°æ®
</span><span>        </span><span style=color:#bf616a>event</span><span> = {
</span><span>            "</span><span style=color:#a3be8c>anonymousId</span><span>": anonymous_id,
</span><span>            "</span><span style=color:#a3be8c>sessionId</span><span>": session_id,
</span><span>            "</span><span style=color:#a3be8c>step</span><span>": step,
</span><span>            "</span><span style=color:#a3be8c>status</span><span>": status,
</span><span>            "</span><span style=color:#a3be8c>timestamp</span><span>": event_time.isoformat(),
</span><span>            "</span><span style=color:#a3be8c>scriptVersion</span><span>": "</span><span style=color:#a3be8c>1.0.0</span><span>",
</span><span>            "</span><span style=color:#a3be8c>osName</span><span>": os_name,
</span><span>            "</span><span style=color:#a3be8c>osVersion</span><span>": os_version,
</span><span>            "</span><span style=color:#a3be8c>cpuArchitecture</span><span>": "</span><span style=color:#a3be8c>x64</span><span>",
</span><span>            "</span><span style=color:#a3be8c>memoryGB</span><span>": random.randint(8, 64),
</span><span>            "</span><span style=color:#a3be8c>metrics</span><span>": metrics
</span><span>        }
</span><span>        
</span><span>        </span><span style=color:#65737e># å‘é€äº‹ä»¶
</span><span>        </span><span style=color:#bf616a>response</span><span> = requests.post(f"</span><span style=color:#a3be8c>{API_URL}/api/telemetry</span><span>", json=event)
</span><span>        </span><span style=color:#bf616a>print</span><span>(f"</span><span style=color:#a3be8c>Session {session_id}, Step {step}: {response.status_code}</span><span>")
</span></code></pre><h2 id=liu-xi-tong-gong-neng-zhan-shi>å…­ã€ç³»ç»ŸåŠŸèƒ½å±•ç¤º</h2><p>OpenHands Telemetry Dashboardæä¾›å¤šä¸ªå…³é”®åŠŸèƒ½ï¼ŒåŠ©åŠ›å›¢é˜ŸæŒç»­ä¼˜åŒ–äº§å“ä½“éªŒï¼š<h3 id=6-1-zong-lan-zhi-biao>6.1 æ€»è§ˆæŒ‡æ ‡</h3><p>ä»ªè¡¨æ¿é¡¶éƒ¨æ˜¾ç¤ºå››ä¸ªæ ¸å¿ƒKPIï¼š<ul><li>æ€»å®‰è£…æ¬¡æ•°<li>æˆåŠŸå®‰è£…æ•°<li>å®‰è£…æˆåŠŸç‡<li>å¹³å‡å®‰è£…æ—¶é—´</ul><p>è¿™äº›æŒ‡æ ‡æä¾›äº†å®‰è£…è„šæœ¬æ•ˆæœçš„ç›´è§‚åé¦ˆï¼Œå¸®åŠ©å›¢é˜Ÿå¿«é€Ÿè¯„ä¼°æ•´ä½“è¡¨ç°ã€‚<h3 id=6-2-cao-zuo-xi-tong-fen-bu>6.2 æ“ä½œç³»ç»Ÿåˆ†å¸ƒ</h3><p>é€šè¿‡ç¯å½¢é¥¼å›¾å±•ç¤ºä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„å®‰è£…åˆ†å¸ƒï¼Œå¸®åŠ©å›¢é˜Ÿäº†è§£ç”¨æˆ·ç¯å¢ƒæ„æˆã€‚<h3 id=6-3-an-zhuang-bu-zou-fen-xi>6.3 å®‰è£…æ­¥éª¤åˆ†æ</h3><p>å †å æŸ±çŠ¶å›¾æ¸…æ™°å±•ç¤ºäº†æ¯ä¸ªå®‰è£…æ­¥éª¤çš„æˆåŠŸ/å¤±è´¥æƒ…å†µï¼Œå¸®åŠ©å¿«é€Ÿè¯†åˆ«é—®é¢˜ç¯èŠ‚ã€‚å›¾è¡¨æŒ‰æ­¥éª¤åˆ†ç»„ï¼Œé€šè¿‡é¢œè‰²åŒºåˆ†ä¸åŒçŠ¶æ€ï¼Œæ•´åˆäº†ç™¾åˆ†æ¯”æ ‡ç­¾ï¼Œæ•°æ®ç›´è§‚æ˜“è¯»ã€‚<h3 id=6-4-hui-hua-xiang-qing-yu-shi-jian-zhou>6.4 ä¼šè¯è¯¦æƒ…ä¸æ—¶é—´è½´</h3><p>ç³»ç»Ÿæœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯è¯¦ç»†çš„ä¼šè¯åˆ†æï¼šç”¨æˆ·å¯é€‰æ‹©ç‰¹å®šä¼šè¯ï¼ŒæŸ¥çœ‹å®Œæ•´çš„å®‰è£…æ—¶é—´è½´å’ŒçŠ¶æ€å˜åŒ–ã€‚æ—¶é—´è½´ä½¿ç”¨é¢œè‰²ç¼–ç ï¼ˆç»¿è‰²=æˆåŠŸï¼Œçº¢è‰²=å¤±è´¥ï¼Œæ©™è‰²=è­¦å‘Šï¼‰ç›´è§‚å±•ç¤ºå®‰è£…æµç¨‹ï¼Œæ¯ä¸ªäº‹ä»¶ç‚¹æ˜¾ç¤ºæ­¥éª¤åç§°å’ŒçŠ¶æ€ã€‚<h3 id=6-5-shu-ju-dao-chu-gong-neng>6.5 æ•°æ®å¯¼å‡ºåŠŸèƒ½</h3><p>ä¸ºæ–¹ä¾¿è¿›ä¸€æ­¥åˆ†æï¼Œç³»ç»Ÿæ”¯æŒå°†ä¼šè¯æ•°æ®å¯¼å‡ºä¸ºCSVæ ¼å¼ï¼Œä¾¿äºåœ¨Excelç­‰å·¥å…·ä¸­æ·±å…¥ç ”ç©¶ã€‚<h2 id=qi-chang-jian-wen-ti-yu-jie-jue-fang-an>ä¸ƒã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2><p>åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°å¹¶è§£å†³äº†å‡ ä¸ªå…¸å‹é—®é¢˜ï¼š<h3 id=7-1-dockerjing-xiang-la-qu-wen-ti>7.1 Dockeré•œåƒæ‹‰å–é—®é¢˜</h3><p><strong>é—®é¢˜</strong>ï¼šåœ¨æŸäº›ç½‘ç»œç¯å¢ƒä¸‹ï¼ŒMongoDBé•œåƒæ‹‰å–å¤±è´¥ï¼ŒæŠ¥é”™"unauthorized: incorrect username or password"ã€‚<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<ol><li>æ‰‹åŠ¨ç™»å½•Docker Hub: <code>docker login</code><li>å¦‚æ— è´¦å·ï¼ŒæŒ‡å®šå…·ä½“MongoDBç‰ˆæœ¬: <code>mongo:6.0.5</code><li>æ¸…ç†Dockerç¼“å­˜: <code>docker system prune -a</code></ol><h3 id=7-2-apiyu-dashboardtong-xin-wen-ti>7.2 APIä¸Dashboardé€šä¿¡é—®é¢˜</h3><p><strong>é—®é¢˜</strong>ï¼šDashboardæ— æ³•è¿æ¥åˆ°APIæœåŠ¡ã€‚<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<ol><li>ç¡®ä¿Dockerç½‘ç»œé…ç½®æ­£ç¡®<li>åœ¨Docker Composeä¸­å°†API_URLè®¾ç½®ä¸ºæœåŠ¡åç§°: <code>API_URL=http://api:9999</code><li>å¢åŠ è°ƒè¯•è¾“å‡ºéªŒè¯è¿æ¥: <code>st.sidebar.text(f"API URL: {API_URL}")</code></ol><h3 id=7-3-shu-ju-geng-xin-yan-chi>7.3 æ•°æ®æ›´æ–°å»¶è¿Ÿ</h3><p><strong>é—®é¢˜</strong>ï¼šStreamlitç¼“å­˜å¯¼è‡´æ•°æ®æ›´æ–°ä¸åŠæ—¶ã€‚<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<ol><li>æ·»åŠ å¼ºåˆ¶åˆ·æ–°æŒ‰é’®: <code>st.cache_data.clear()</code><li>è°ƒæ•´ç¼“å­˜TTL: <code>@st.cache_data(ttl=60)</code><li>ä½¿ç”¨å®éªŒæ€§é‡æ–°è¿è¡Œ: <code>st.experimental_rerun()</code></ol><h2 id=ba-wei-lai-you-hua-fang-xiang>å…«ã€æœªæ¥ä¼˜åŒ–æ–¹å‘</h2><p>OpenHands Telemetry Dashboardä»æœ‰å¤šä¸ªå¯ä¼˜åŒ–æ–¹å‘ï¼š<h3 id=8-1-yi-chang-jian-ce-yu-gao-jing>8.1 å¼‚å¸¸æ£€æµ‹ä¸å‘Šè­¦</h3><p>å®ç°è‡ªåŠ¨å¼‚å¸¸æ£€æµ‹é€»è¾‘ï¼Œå½“å®‰è£…å¤±è´¥ç‡çªç„¶ä¸Šå‡æ—¶ï¼Œè‡ªåŠ¨å‘Šè­¦é€šçŸ¥å¼€å‘å›¢é˜Ÿã€‚<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#b48ead>async def </span><span style=color:#8fa1b3>detect_failure_anomalies</span><span>():
</span><span>    </span><span style=color:#65737e>"""æ£€æµ‹å¼‚å¸¸å¤±è´¥æ¨¡å¼"""
</span><span>    </span><span style=color:#65737e># è·å–æœ€è¿‘24å°æ—¶å†…æ•°æ®
</span><span>    one_day_ago = datetime.</span><span style=color:#bf616a>utcnow</span><span>() - </span><span style=color:#bf616a>timedelta</span><span>(</span><span style=color:#bf616a>hours</span><span>=</span><span style=color:#d08770>24</span><span>)
</span><span>    
</span><span>    </span><span style=color:#65737e># è®¡ç®—å¤±è´¥ç‡
</span><span>    total_installs = </span><span style=color:#b48ead>await </span><span>telemetry_collection.</span><span style=color:#bf616a>count_documents</span><span>({
</span><span>        "</span><span style=color:#a3be8c>step</span><span>": "</span><span style=color:#a3be8c>install</span><span>",
</span><span>        "</span><span style=color:#a3be8c>timestamp</span><span>": {"</span><span style=color:#a3be8c>$gte</span><span>": one_day_ago}
</span><span>    })
</span><span>    
</span><span>    failed_installs = </span><span style=color:#b48ead>await </span><span>telemetry_collection.</span><span style=color:#bf616a>count_documents</span><span>({
</span><span>        "</span><span style=color:#a3be8c>step</span><span>": "</span><span style=color:#a3be8c>install</span><span>",
</span><span>        "</span><span style=color:#a3be8c>status</span><span>": "</span><span style=color:#a3be8c>failure</span><span>",
</span><span>        "</span><span style=color:#a3be8c>timestamp</span><span>": {"</span><span style=color:#a3be8c>$gte</span><span>": one_day_ago}
</span><span>    })
</span><span>    
</span><span>    failure_rate = failed_installs / total_installs </span><span style=color:#b48ead>if </span><span>total_installs > </span><span style=color:#d08770>0 </span><span style=color:#b48ead>else </span><span style=color:#d08770>0
</span><span>    
</span><span>    </span><span style=color:#65737e># å¼‚å¸¸æ£€æµ‹é€»è¾‘
</span><span>    </span><span style=color:#b48ead>if </span><span>failure_rate > </span><span style=color:#d08770>0.3 </span><span>and total_installs > </span><span style=color:#d08770>10</span><span>:
</span><span>        </span><span style=color:#65737e># è§¦å‘å‘Šè­¦
</span><span>        </span><span style=color:#bf616a>send_alert</span><span>(</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>å®‰è£…å¤±è´¥ç‡è¾¾åˆ°</span><span>{failure_rate*</span><span style=color:#d08770>100:.1f</span><span>}</span><span style=color:#a3be8c>%ï¼Œè¯·æ£€æŸ¥ç³»ç»Ÿ</span><span>")
</span></code></pre><h3 id=8-2-qu-shi-fen-xi>8.2 è¶‹åŠ¿åˆ†æ</h3><p>æ·»åŠ åŸºäºæ—¶é—´çš„è¶‹åŠ¿åˆ†æï¼Œå¸®åŠ©å›¢é˜Ÿç†è§£ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„æ€§èƒ½å˜åŒ–ã€‚<h3 id=8-3-yong-hu-ti-yan-ping-fen>8.3 ç”¨æˆ·ä½“éªŒè¯„åˆ†</h3><p>é›†æˆç”¨æˆ·åé¦ˆæ•°æ®ï¼Œåˆ›å»ºç»¼åˆç”¨æˆ·ä½“éªŒè¯„åˆ†ï¼Œå…¨é¢è¯„ä¼°å®‰è£…ä½“éªŒã€‚<h3 id=8-4-aiyu-ce-fen-xi>8.4 AIé¢„æµ‹åˆ†æ</h3><p>å¼•å…¥æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œé¢„æµ‹å¯èƒ½å¤±è´¥çš„å®‰è£…ï¼Œå¹¶æä¾›é¢„é˜²æ€§å»ºè®®ã€‚<h2 id=jiu-zong-jie-yu-jing-yan-fen-xiang>ä¹ã€æ€»ç»“ä¸ç»éªŒåˆ†äº«</h2><p>é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬æˆåŠŸæ„å»ºäº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„é¥æµ‹æ•°æ®ä»ªè¡¨æ¿ï¼Œä¸ºOpenHands Starterçš„æŒç»­ä¼˜åŒ–æä¾›äº†æ•°æ®æ”¯æŒã€‚è¿™ä¸ªç³»ç»Ÿå…·æœ‰å‡ ä¸ªå…³é”®ä¼˜åŠ¿ï¼š<ol><li><strong>æŠ€æœ¯æ ˆåˆç†</strong>ï¼šFastAPIä¸Streamlitçš„ç»„åˆæ—¢é«˜æ•ˆåˆå¼ºå¤§<li><strong>éƒ¨ç½²ç®€å•</strong>ï¼šDockerå®¹å™¨åŒ–ä½¿å¾—éƒ¨ç½²è¿‡ç¨‹ä¸€è‡´ä¸”ç®€å•<li><strong>æ•°æ®å¯è§†åŒ–ç›´è§‚</strong>ï¼šäº¤äº’å¼å›¾è¡¨ä½¿å¤æ‚æ•°æ®æ˜“äºç†è§£<li><strong>æ‰©å±•æ€§å¼º</strong>ï¼šæ¨¡å—åŒ–è®¾è®¡ä¾¿äºæœªæ¥åŠŸèƒ½æ‰©å±•</ol><p>ä»è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å­¦åˆ°äº†å‡ ä¸ªå…³é”®ç»éªŒï¼š<ol><li><strong>å‰åç«¯èŒè´£åˆ†ç¦»</strong>ï¼šFastAPIä¸“æ³¨äºæ•°æ®å¤„ç†ï¼ŒStreamlitä¸“æ³¨äºå¯è§†åŒ–<li><strong>æ•°æ®å»ºæ¨¡çš„é‡è¦æ€§</strong>ï¼šè‰¯å¥½çš„æ•°æ®æ¨¡å‹è®¾è®¡æ˜¯ç³»ç»Ÿç¨³å®šæ€§çš„åŸºç¡€<li><strong>å®¹å™¨åŒ–å¸¦æ¥ä¾¿åˆ©</strong>ï¼šDockeræå¤§ç®€åŒ–äº†å¤šç»„ä»¶ç³»ç»Ÿçš„éƒ¨ç½²å’Œç®¡ç†<li><strong>ç”¨æˆ·ä¸ºä¸­å¿ƒçš„è®¾è®¡</strong>ï¼šä»ç”¨æˆ·éœ€æ±‚å‡ºå‘çš„è®¾è®¡æ‰èƒ½åˆ›é€ çœŸæ­£æœ‰ä»·å€¼çš„å·¥å…·</ol><p>é€šè¿‡è¿™ä¸ªä»ªè¡¨æ¿ï¼ŒOpenHandså›¢é˜Ÿèƒ½å¤ŸæŒç»­ç›‘æ§å®‰è£…è¿‡ç¨‹ï¼Œå¿«é€Ÿè¯†åˆ«å¹¶è§£å†³é—®é¢˜ï¼Œä¸æ–­æå‡ç”¨æˆ·ä½“éªŒã€‚<p><strong>æºç åœ°å€</strong>ï¼š<a href=https://github.com/Polly2014/OpenHands-Starter-Dashboard>GitHub - OpenHands Telemetry Dashboard</a></div><div class=navigation></div></div><div id=giscus-container><h2>ç•™è¨€ä¸è®¨è®º</h2><div class=giscus></div></div><script data-category="Blog Comments" async crossorigin data-category-id=DIC_kwDOL45duM4CnjlZ data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=pathname data-reactions-enabled=1 data-repo=Polly2014/polly2014.github.io data-repo-id=R_kgDOL45duA data-strict=0 data-theme=noborder_light src=https://giscus.app/client.js></script><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({
            startOnLoad: false,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#a855f7',
                primaryTextColor: '#fff',
                primaryBorderColor: '#a855f7',
                lineColor: '#06b6d4',
                secondaryColor: '#16213e',
                tertiaryColor: '#1a1a2e',
                background: '#0f0f1a',
                mainBkg: '#1a1a2e',
                nodeBorder: '#a855f7',
                clusterBkg: '#16213e',
                clusterBorder: '#a855f7',
                titleColor: '#ec4899',
                edgeLabelBackground: '#1a1a2e'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // æŸ¥æ‰¾æ‰€æœ‰ mermaid ä»£ç å—å¹¶æ¸²æŸ“
        document.querySelectorAll('pre code.language-mermaid').forEach((block, index) => {
            const container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = block.textContent;
            block.parentNode.replaceWith(container);
        });

        // æ¸²æŸ“æ‰€æœ‰ mermaid å›¾è¡¨
        await mermaid.run();
    </script><style>.mermaid{background:#1a1a2e;border:1px solid #a855f7;border-radius:8px;padding:20px;margin:20px 0;overflow-x:auto}.mermaid svg{max-width:100%;height:auto}</style></div></div><script>document.addEventListener('DOMContentLoaded',function(){const c=document.querySelector('.menu-toggle');const d=document.querySelector('.sidebar');const e=document.querySelector('.overlay');function a(){d.classList.toggle('active');e.classList.toggle('active')}c.addEventListener('click',a);e.addEventListener('click',a);let f=0;let g=0;document.addEventListener('touchstart',h=>{f=h.changedTouches[0].screenX},false);document.addEventListener('touchend',h=>{g=h.changedTouches[0].screenX;b()},false);function b(){const h=g- f;if(h>50&&f<30){d.classList.add('active');e.classList.add('active')}else if(h<-50&&d.classList.contains('active')){d.classList.remove('active');e.classList.remove('active')}}})</script>