<!doctype html><html><head><title>æ•°æ®åœ¨äº‘ç«¯ä½†æŸ¥ä¸åˆ°ï¼Ÿ723 è¡Œ Python è®©æˆ‘ä¸€å¥è¯æŸ¥èŠå¤©</title><meta content="ç»™æ•°å­— Polly è£…ä¸Šäº†è®°å¿†ï¼ˆCloudflare D1ï¼‰ï¼Œä½†æŸ¥ä¸äº†â€”â€”æ¯æ¬¡è¦æ‰‹å†™ curl + Bearer Token + JSON è§£æã€‚äºæ˜¯æˆ‘å’Œå°é¾™è™¾ä¸€èµ·è®¾è®¡äº†ä¸ª Claude Skillï¼šblog-chatï¼Œ723 è¡Œçº¯æ ‡å‡†åº“ Pythonï¼Œ5 ä¸ªå­å‘½ä»¤ï¼Œä¸€å¥è¯å°±èƒ½æŸ¥ã€æœã€ç»Ÿè®¡ã€å¯¼å‡ºè®¿å®¢èŠå¤©è®°å½•ã€‚" name=description><meta content="Polly, Blog, AI Blog, AI Assistant, Tutorials, Technology Blog, Baoli Wang" name=keywords><meta content="width=device-width,initial-scale=1" name=viewport><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content=#333 name=theme-color><meta content=article property=og:type><meta content=https://polly.wang/blog-chat-skill-born/ property=og:url><meta content="æ•°æ®åœ¨äº‘ç«¯ä½†æŸ¥ä¸åˆ°ï¼Ÿ723 è¡Œ Python è®©æˆ‘ä¸€å¥è¯æŸ¥èŠå¤©" property=og:title><meta content="ç»™æ•°å­— Polly è£…ä¸Šäº†è®°å¿†ï¼ˆCloudflare D1ï¼‰ï¼Œä½†æŸ¥ä¸äº†â€”â€”æ¯æ¬¡è¦æ‰‹å†™ curl + Bearer Token + JSON è§£æã€‚äºæ˜¯æˆ‘å’Œå°é¾™è™¾ä¸€èµ·è®¾è®¡äº†ä¸ª Claude Skillï¼šblog-chatï¼Œ723 è¡Œçº¯æ ‡å‡†åº“ Pythonï¼Œ5 ä¸ªå­å‘½ä»¤ï¼Œä¸€å¥è¯å°±èƒ½æŸ¥ã€æœã€ç»Ÿè®¡ã€å¯¼å‡ºè®¿å®¢èŠå¤©è®°å½•ã€‚" property=og:description><meta content=https://polly.wang/blog-chat-skill-born/cover.jpg property=og:image><meta content="Polly Blog" property=og:site_name><meta content=zh_CN property=og:locale><meta content=summary_large_image name=twitter:card><meta content=https://polly.wang/blog-chat-skill-born/ name=twitter:url><meta content="æ•°æ®åœ¨äº‘ç«¯ä½†æŸ¥ä¸åˆ°ï¼Ÿ723 è¡Œ Python è®©æˆ‘ä¸€å¥è¯æŸ¥èŠå¤©" name=twitter:title><meta content="ç»™æ•°å­— Polly è£…ä¸Šäº†è®°å¿†ï¼ˆCloudflare D1ï¼‰ï¼Œä½†æŸ¥ä¸äº†â€”â€”æ¯æ¬¡è¦æ‰‹å†™ curl + Bearer Token + JSON è§£æã€‚äºæ˜¯æˆ‘å’Œå°é¾™è™¾ä¸€èµ·è®¾è®¡äº†ä¸ª Claude Skillï¼šblog-chatï¼Œ723 è¡Œçº¯æ ‡å‡†åº“ Pythonï¼Œ5 ä¸ªå­å‘½ä»¤ï¼Œä¸€å¥è¯å°±èƒ½æŸ¥ã€æœã€ç»Ÿè®¡ã€å¯¼å‡ºè®¿å®¢èŠå¤©è®°å½•ã€‚" name=twitter:description><meta content=https://polly.wang/blog-chat-skill-born/cover.jpg name=twitter:image><meta content=2026-02-20T00:00:00 property=article:published_time><meta content=Polly property=article:author><meta content="Claude Skill" property=article:tag><meta content="Cloudflare D1" property=article:tag><meta content=Python property=article:tag><meta content="AI Agent" property=article:tag><meta content=æ•°å­—åˆ†èº« property=article:tag><meta content=åšå®¢å¼€å‘ property=article:tag><meta content=å°é¾™è™¾ property=article:tag><link rel="shortcut icon" href=https://polly.wang/images/polly.ico type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=icon type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=apple-touch-icon><link href=https://polly.wang/vendor/purecss/pure-min.css rel=stylesheet><link href=https://polly.wang/vendor/purecss/grids-responsive-min.css rel=stylesheet><link href=https://polly.wang/vendor/font-awesome/css/all.min.css rel=stylesheet><link href=https://polly.wang/css/style_new.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-1N289C8N8W" async></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-1N289C8N8W')</script><body><div class=menu-toggle><img alt=Menu src=https://polly.wang/images/polly.png></div><div class=overlay></div><div class="pure-g container"><div class="sidebar pure-u-1 pure-u-md-1-5"><div class=title><a class=pure-menu-heading href=https://polly.wang> <img class="avatar pure-img-responsive" src=https://polly.wang/images/polly.png> </a><div class=introduction><p>Polly's Blog</div><div class=nav><ul class=nav-links><li><a href=https://polly.wang><i class="fas fa-home"></i>Home</a><li><a href=https://polly.wang/archive><i class="fas fa-archive"></i>Archive</a><li><a href=https://polly.wang/category><i class="fas fa-folder"></i>Category</a><li><a href=https://polly.wang/blog><i class="fas fa-file-alt"></i>Posts</a><li><a href=https://polly.wang/cfp><i class="fas fa-calendar-alt"></i>CFP</a><li><a href=https://polly.wang/publication><i class="fas fa-file-pdf"></i>Research</a><li><a href=https://polly.wang/changelog><i class="fas fa-history"></i>Change Log</a><li><a href=https://polly.wang/about><i class="fas fa-info-circle"></i>About Me</a></ul></div><div class=social><ul class=social-links><li><a onclick="gtag('event','social_click',{platform:'email'});" href=mailto:26716201@qq.com><i class="fas fa-envelope"></i></a><li><a onclick="gtag('event','social_click',{platform:'twitter'});" href=https://twitter.com/Polly__007><i class="fab fa-twitter"></i></a><li><a onclick="gtag('event','social_click',{platform:'linkedin'});" href=https://www.linkedin.com/in/baoliwang><i class="fab fa-linkedin-in"></i></a><li><a onclick="gtag('event','social_click',{platform:'github'});" href=https://github.com/Polly2014><i class="fab fa-github"></i></a></ul></div></div></div><div class="content pure-u-1 pure-u-md-4-5"><div class=blog-post><h1>æ•°æ®åœ¨äº‘ç«¯ä½†æŸ¥ä¸åˆ°ï¼Ÿ723 è¡Œ Python è®©æˆ‘ä¸€å¥è¯æŸ¥èŠå¤©</h1><div class=cover-image><img alt="æ•°æ®åœ¨äº‘ç«¯ä½†æŸ¥ä¸åˆ°ï¼Ÿ723 è¡Œ Python è®©æˆ‘ä¸€å¥è¯æŸ¥èŠå¤©" loading=lazy src=cover.jpg></div><div class=content><p>æƒ…äººèŠ‚é‚£å¤©ï¼Œ<a href=/polly-chat-d1-persistence>å°é¾™è™¾å¸®æ•°å­— Polly è£…ä¸Šäº†è®°å¿†</a>ã€‚Cloudflare D1 + Workerï¼Œ40 è¡Œå‰ç«¯æ”¹åŠ¨ï¼ŒèŠå¤©è®°å½•ç»ˆäºä¸ä¼šéšæµè§ˆå™¨å…³é—­è’¸å‘äº†ã€‚<p>ç„¶åæˆ‘å…´å¥‹åœ°æƒ³çœ‹çœ‹â€”â€”è‡ªä»ä¸Šçº¿ä»¥æ¥ï¼Œåˆ°åº•æœ‰å¤šå°‘äººæ¥è·Ÿæ•°å­— Polly èŠè¿‡å¤©ï¼Ÿ<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>curl -s -H </span><span>"</span><span style=color:#a3be8c>Authorization: Bearer polly-cloudflare-xxx</span><span>" \
</span><span style=color:#bf616a>     -H </span><span>"</span><span style=color:#a3be8c>User-Agent: polly-chat-query/1.0</span><span>" \
</span><span>     https://chat.polly.wang/v1/conversations | </span><span style=color:#bf616a>python3 -m</span><span> json.tool
</span></code></pre><p>æ‹¿åˆ°ä¸€å † JSONã€‚å¥½ï¼Œå†çœ‹æŸä¸ªå¯¹è¯çš„å…·ä½“å†…å®¹ï¼Ÿ<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>curl -s -H </span><span>"</span><span style=color:#a3be8c>Authorization: Bearer polly-cloudflare-xxx</span><span>" \
</span><span style=color:#bf616a>     -H </span><span>"</span><span style=color:#a3be8c>User-Agent: polly-chat-query/1.0</span><span>" \
</span><span>     https://chat.polly.wang/v1/conversations/190e3a14-64be-4334-aac1-fea445fbc920 \
</span><span>     | </span><span style=color:#bf616a>python3 -m</span><span> json.tool
</span></code></pre><p>åˆä¸€å † JSONã€‚æƒ³æœ"å°é¾™è™¾"åœ¨å“ªäº›å¯¹è¯é‡Œå‡ºç°è¿‡ï¼Ÿè¦æŠŠæ‰€æœ‰å¯¹è¯çš„æ¶ˆæ¯éƒ½ curl ä¸‹æ¥ï¼Œç„¶å grepâ€¦â€¦<p><strong>æ•°æ®åœ¨äº‘ç«¯ï¼Œä½†çº¦ç­‰äºæŸ¥ä¸åˆ°ã€‚</strong><p>è¿™ä¸è¡Œã€‚<h2 id=wo-xu-yao-shi-yao>æˆ‘éœ€è¦ä»€ä¹ˆ</h2><p>æƒ³äº†æƒ³ï¼Œæ—¥å¸¸æŸ¥èŠå¤©è®°å½•çš„åœºæ™¯å¤§æ¦‚å°±è¿™å‡ ç§ï¼š<table><thead><tr><th>æˆ‘æƒ³åšçš„<th>å®é™…æ“ä½œ<tbody><tr><td>"çœ‹çœ‹æ˜¨å¤©æœ‰æ²¡æœ‰äººæ¥èŠå¤©"<td><code>list --date 2026-02-19</code><tr><td>"å±•å¼€çœ‹çœ‹è¿™ä¸ªå¯¹è¯èŠäº†å•¥"<td><code>show &LTuuid></code><tr><td>"æœ‰äººé—®è¿‡ç¿»è¯‘çš„äº‹å—ï¼Ÿ"<td><code>search ç¿»è¯‘</code><tr><td>"ä¸Šçº¿ä»¥æ¥æ•´ä½“æ•°æ®æ€ä¹ˆæ ·ï¼Ÿ"<td><code>stats</code><tr><td>"å¯¼å‡ºå¤‡ä»½ä¸€ä¸‹"<td><code>export --format csv</code></table><p>æ ¸å¿ƒå°±æ˜¯äº”ä¸ªåŠ¨ä½œï¼š<strong>åˆ—è¡¨ã€è¯¦æƒ…ã€æœç´¢ã€ç»Ÿè®¡ã€å¯¼å‡º</strong>ã€‚<h2 id=claude-skill-vs-mcp-server>Claude Skill vs MCP Server</h2><p>ç¬¬ä¸€ååº”æ˜¯åšä¸ª MCP Serverâ€”â€”æ¯•ç«Ÿåˆšç»™ Master Translator åšäº†ä¸€ä¸ªã€‚ä½†è½¬å¿µä¸€æƒ³ï¼š<table><thead><tr><th>å¯¹æ¯”<th>MCP Server<th>Claude Skill<tbody><tr><td>è°ƒç”¨æ–¹å¼<td>Agent è‡ªåŠ¨å‘ç°å·¥å…·<td>Agent è¯» SKILL.md åè°ƒç»ˆç«¯<tr><td>å¯åŠ¨æˆæœ¬<td>éœ€è¦æœåŠ¡è¿›ç¨‹<td>é›¶å¯åŠ¨ï¼Œç›´æ¥è°ƒ Python<tr><td>é€‚åˆåœºæ™¯<td>é«˜é¢‘ã€å¤šæ­¥éª¤äº¤äº’<td>ä½é¢‘ã€å•æ¬¡æŸ¥è¯¢<tr><td>ç¼–ç é‡<td>~500è¡Œï¼ˆserver+toolsï¼‰<td>~900è¡Œï¼ˆè„šæœ¬723+SKILL.md 173ï¼‰</table><p>æŸ¥èŠå¤©è®°å½•æ˜¯ä¸ªä½é¢‘æ“ä½œï¼ˆä¸€å¤©æŸ¥ä¸€ä¸¤æ¬¡ï¼‰ï¼Œä¸éœ€è¦å¸¸é©»æœåŠ¡è¿›ç¨‹ã€‚Claude Skill çš„æ–¹å¼æ›´è½»é‡â€”â€”å†™ä¸ª Python è„šæœ¬ï¼Œé…ä¸ª SKILL.md å‘Šè¯‰ Claude æ€ä¹ˆè°ƒï¼Œå®Œäº‹ã€‚<p>æ–¹æ¡ˆè®¾è®¡é˜¶æ®µå’Œå°é¾™è™¾è®¨è®ºäº†ä¸€åœˆã€‚å®ƒåˆ†æäº†ä¸¤ç§è·¯çº¿ï¼ˆæ‰©å±• Worker API vs çº¯å®¢æˆ·ç«¯è„šæœ¬ï¼‰ï¼Œæœ€ç»ˆå»ºè®®èµ°çº¯è„šæœ¬ + Claude Skillï¼Œå¹¶æäº† 4 ç‚¹å…·ä½“æ„è§ï¼šå¹¶å‘ fetch è§£å†³ N+1 æŸ¥è¯¢ã€åŠ  <code>--json</code> flag æ–¹ä¾¿ç¨‹åºåŒ–è°ƒç”¨ã€token ä¼˜å…ˆè¯»ç¯å¢ƒå˜é‡ã€è„šæœ¬è·¯å¾„è¦æ–¹ä¾¿å°é¾™è™¾ç›´æ¥ <code>exec</code> è°ƒç”¨ã€‚è¿™ä¸åªæ˜¯ Code Reviewï¼Œæ˜¯æ–¹æ¡ˆå…±åˆ›ã€‚<h2 id=jia-gou-san-ceng-shu-ju-liu>æ¶æ„ï¼šä¸‰å±‚æ•°æ®æµ</h2><p>æ•´ä¸ªæ•°æ®é“¾è·¯é•¿è¿™æ ·ï¼š<pre style=background:#2b303b;color:#c0c5ce><code><span>è®¿å®¢åœ¨ polly.wang èŠå¤©
</span><span>  â†“ POST /v1/conversations/log
</span><span>Cloudflare Workerï¼ˆchat.polly.wangï¼‰
</span><span>  â†“ å†™å…¥
</span><span>Cloudflare D1ï¼ˆSQLiteï¼‰
</span><span>  â†“ GET /v1/conversationsï¼ˆéœ€ Bearer Tokenï¼‰
</span><span>query_chat_history.pyï¼ˆPython è„šæœ¬ï¼‰
</span><span>  â†“ æ ¼å¼åŒ–è¾“å‡º
</span><span>Claude / ç»ˆç«¯ / OpenClaw
</span></code></pre><p>D1 é‡Œæœ‰ä¸¤å¼ è¡¨ï¼š<code>conversations</code>ï¼ˆå¯¹è¯å…ƒæ•°æ®ï¼šæ—¶é—´ã€è¯­è¨€ã€UAï¼‰å’Œ <code>messages</code>ï¼ˆé€æ¡æ¶ˆæ¯ï¼šè§’è‰²ã€å†…å®¹ã€æ—¶é—´æˆ³ï¼‰ã€‚Worker æä¾›äº†ä¸¤ä¸ªç®¡ç†ç«¯ç‚¹ï¼Œéœ€è¦ Bearer Token é‰´æƒã€‚<p>è„šæœ¬è¦åšçš„å°±æ˜¯ï¼šè°ƒ API â†’ æ‹¿ JSON â†’ è¿‡æ»¤/æœç´¢/ç»Ÿè®¡ â†’ äººç±»å¯è¯»çš„è¾“å‡ºã€‚<h2 id=ming-ming-blog-chat>å‘½åï¼šblog-chat</h2><p>å‘½åçº ç»“äº†ä¸€ä¸‹ã€‚ç°æœ‰çš„ Skill ä½“ç³»æ˜¯ <code>blog-writer</code>ï¼ˆå†™åšæ–‡ï¼‰å’Œ <code>blog-dev</code>ï¼ˆæ”¹æ¨¡æ¿/CSSï¼‰ï¼Œæ–°çš„æŸ¥èŠå¤©è®°å½•è‡ªç„¶å« <code>blog-chat</code>â€”â€”ä¸‰ä¸ª blog-* Skill å½¢æˆä¸€ä¸ªå®Œæ•´çš„åšå®¢è¿ç»´ä¸‰ä»¶å¥—ï¼š<table><thead><tr><th>Skill<th>èŒè´£<tbody><tr><td><code>blog-writer</code><td>å†™å†…å®¹<tr><td><code>blog-dev</code><td>æ”¹æŠ€æœ¯<tr><td><code>blog-chat</code><td>çœ‹æ•°æ®</table><p>é…ç½®æ¨¡å¼ä¹Ÿç›´æ¥å¤ç”¨äº† <code>blog-writer</code> çš„ <code>config.env</code> æ–¹æ¡ˆï¼šè„šæœ¬åŒç›®å½•æ”¾ä¸€ä¸ª <code>config.env</code>ï¼Œä¼˜å…ˆè¯»ç¯å¢ƒå˜é‡ï¼Œfallback åˆ°æ–‡ä»¶ã€‚<h2 id=shi-xian-723-xing-ling-yi-lai>å®ç°ï¼š723 è¡Œï¼Œé›¶ä¾èµ–</h2><p>æ•´ä¸ªè„šæœ¬åªç”¨ Python æ ‡å‡†åº“ï¼Œä¸è£…ä»»ä½•ç¬¬ä¸‰æ–¹åŒ…ã€‚è¿™æ˜¯ä¸ªæœ‰æ„çš„é€‰æ‹©â€”â€”å°é¾™è™¾ï¼ˆOpenClawï¼‰éœ€è¦é€šè¿‡ <code>exec</code> ç›´æ¥è°ƒç”¨è¿™ä¸ªè„šæœ¬ï¼Œé›¶ä¾èµ–æ„å‘³ç€ä»»ä½•æœºå™¨ä¸Šæ‹¿åˆ°å°±èƒ½è·‘ã€‚<p>æ ¸å¿ƒç»“æ„å¾ˆç®€å•ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># é…ç½®åŠ è½½ï¼šç¯å¢ƒå˜é‡ â†’ config.env fallback
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>load_config</span><span>(): </span><span style=color:#d08770>...
</span><span>
</span><span style=color:#65737e># API å®¢æˆ·ç«¯ï¼šå¸¦ Token çš„ HTTP GET
</span><span style=color:#b48ead>class </span><span style=color:#ebcb8b>ChatAPI</span><span style=color:#eff1f5>:
</span><span>    </span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>_request</span><span>(</span><span style=color:#bf616a>self</span><span>, </span><span style=color:#bf616a>path</span><span>): </span><span style=color:#d08770>...
</span><span>    </span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>list_conversations</span><span>(</span><span style=color:#bf616a>self</span><span>): </span><span style=color:#d08770>...
</span><span>    </span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>get_conversation</span><span>(</span><span style=color:#bf616a>self</span><span>, </span><span style=color:#bf616a>conv_id</span><span>): </span><span style=color:#d08770>...
</span><span>
</span><span style=color:#65737e># 5 ä¸ªå­å‘½ä»¤
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>cmd_list</span><span>(</span><span style=color:#bf616a>api</span><span>, </span><span style=color:#bf616a>args</span><span>): </span><span style=color:#d08770>...    </span><span style=color:#65737e># åˆ—è¡¨ + æ—¥æœŸè¿‡æ»¤
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>cmd_show</span><span>(</span><span style=color:#bf616a>api</span><span>, </span><span style=color:#bf616a>args</span><span>): </span><span style=color:#d08770>...    </span><span style=color:#65737e># å¯¹è¯è¯¦æƒ…æ¸²æŸ“
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>cmd_search</span><span>(</span><span style=color:#bf616a>api</span><span>, </span><span style=color:#bf616a>args</span><span>): </span><span style=color:#d08770>...  </span><span style=color:#65737e># å¹¶å‘è·å– + æœ¬åœ°æœç´¢
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>cmd_stats</span><span>(</span><span style=color:#bf616a>api</span><span>, </span><span style=color:#bf616a>args</span><span>): </span><span style=color:#d08770>...   </span><span style=color:#65737e># ç»Ÿè®¡ + ASCII å›¾è¡¨
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>cmd_export</span><span>(</span><span style=color:#bf616a>api</span><span>, </span><span style=color:#bf616a>args</span><span>): </span><span style=color:#d08770>...  </span><span style=color:#65737e># JSON/CSV å¯¼å‡º
</span></code></pre><p>å‡ ä¸ªå€¼å¾—è¯´çš„è®¾è®¡å†³ç­–ï¼š<h3 id=bing-fa-huo-qu-search-he-export-de-n-1-wen-ti>å¹¶å‘è·å–ï¼šsearch å’Œ export çš„ N+1 é—®é¢˜</h3><p>æœç´¢éœ€è¦è·å–æ‰€æœ‰å¯¹è¯çš„æ¶ˆæ¯å†…å®¹ï¼Œå¦‚æœé€ä¸ªä¸²è¡Œè¯·æ±‚ä¼šå¾ˆæ…¢ã€‚ç”¨ <code>ThreadPoolExecutor</code> å¹¶å‘ 8 è·¯ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#b48ead>with </span><span style=color:#bf616a>ThreadPoolExecutor</span><span>(</span><span style=color:#bf616a>max_workers</span><span>=</span><span style=color:#bf616a>MAX_CONCURRENT_REQUESTS</span><span>) </span><span style=color:#b48ead>as </span><span>pool:
</span><span>    futures = {
</span><span>        pool.</span><span style=color:#bf616a>submit</span><span>(api.get_conversation, c["</span><span style=color:#a3be8c>id</span><span>"]): c
</span><span>        </span><span style=color:#b48ead>for </span><span>c </span><span style=color:#b48ead>in </span><span>conversations
</span><span>    }
</span><span>    </span><span style=color:#b48ead>for </span><span>future </span><span style=color:#b48ead>in </span><span style=color:#bf616a>as_completed</span><span>(futures):
</span><span>        conv = futures[future]
</span><span>        data = future.</span><span style=color:#bf616a>result</span><span>()
</span><span>        </span><span style=color:#65737e># åœ¨æ¯ä¸ªå¯¹è¯çš„æ¶ˆæ¯ä¸­æœç´¢å…³é”®è¯
</span></code></pre><p>è¿™æ˜¯å°é¾™è™¾åœ¨ Code Review æ—¶ç‰¹åˆ«æçš„â€”â€”"N+1 æŸ¥è¯¢å¦‚æœä¸å¹¶å‘ï¼Œ5 ä¸ªå¯¹è¯è¦ 5 ç§’ï¼Œ50 ä¸ªå¯¹è¯è¦ 50 ç§’"ã€‚<h3 id=json-quan-ju-flag>--json å…¨å±€ flag</h3><p>å°é¾™è™¾è¿˜å»ºè®®åŠ ä¸ª <code>--json</code> å…¨å±€ flagï¼Œæ–¹ä¾¿ç¨‹åºåŒ–è°ƒç”¨ã€‚å®é™…å®ç°æ—¶è¸©äº†ä¸ªå‘ï¼šargparse çš„å…¨å±€ flag æ”¾åœ¨å­å‘½ä»¤å‰é¢æ²¡é—®é¢˜ï¼Œæ”¾åé¢å°±ä¸è®¤äº†ã€‚æœ€ç»ˆç”¨ <code>parse_known_args()</code> è§£å†³ï¼š<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span>parser, remaining = parser.</span><span style=color:#bf616a>parse_known_args</span><span>()
</span><span style=color:#b48ead>if </span><span>"</span><span style=color:#a3be8c>--json</span><span>" in remaining:
</span><span>    json_mode = </span><span style=color:#d08770>True
</span></code></pre><h3 id=ansi-cai-se-shu-chu>ANSI å½©è‰²è¾“å‡º</h3><p>é»˜è®¤è¾“å‡ºæ˜¯ç»™äººçœ‹çš„ï¼Œå¸¦é¢œè‰²å’Œ emojiï¼š<pre style=background:#2b303b;color:#c0c5ce><code><span>ğŸ“‹ Conversations (5 total)
</span><span>
</span><span>  ID                                     Time               Msgs  Language
</span><span>  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€
</span><span>  63a94f06-c6c5-...     2026-02-16 20:48    4  zh-CN
</span></code></pre><p>åŠ  <code>--json</code> åˆ™è¾“å‡ºåŸå§‹ JSONï¼Œæ–¹ä¾¿å°é¾™è™¾æˆ–å…¶ä»–å·¥å…·æ¶ˆè´¹ã€‚<h2 id=diao-shi-san-ge-keng>è°ƒè¯•ï¼šä¸‰ä¸ªå‘</h2><h3 id=keng-1-urllib-bei-cloudflare-waf-lan-jie>å‘ 1ï¼šurllib è¢« Cloudflare WAF æ‹¦æˆª</h3><p>Python <code>urllib</code> çš„é»˜è®¤ User-Agent æ˜¯ <code>Python-urllib/3.x</code>ï¼ŒCloudflare çš„ Bot Fight Mode ç›´æ¥è¿”å› 403ã€‚<p>ä¿®å¤ï¼šåŠ ä¸€è¡Œ <code>req.add_header("User-Agent", "polly-chat-query/1.0")</code>ã€‚<p>è¿™æ˜¯ä¸ªç‰¹åˆ«éšè”½çš„å‘â€”â€”curl èƒ½ç”¨ã€æµè§ˆå™¨èƒ½ç”¨ã€ä½† Python è„šæœ¬è«åå…¶å¦™è¿”å› 403ã€‚å¦‚æœä¸æ˜¯åœ¨é”™è¯¯å¤„ç†é‡ŒåŒºåˆ†äº† 401ï¼ˆè®¤è¯å¤±è´¥ï¼‰å’Œ 403ï¼ˆå¯èƒ½æ˜¯ WAFï¼‰ï¼Œå¯èƒ½è¦æ’æŸ¥å¾ˆä¹…ã€‚<h3 id=keng-2-403-he-401-de-qu-fen>å‘ 2ï¼š403 å’Œ 401 çš„åŒºåˆ†</h3><p>Worker å¯¹è®¤è¯å¤±è´¥è¿”å› 401ï¼Œä½† Cloudflare WAF å¯¹è¢«æ‹¦æˆªçš„è¯·æ±‚è¿”å› 403ã€‚ä¿®å¤å‰åª catch äº† 401ï¼Œå¯¼è‡´ WAF æ‹¦æˆªæ—¶æŠ¥çš„æ˜¯"HTTP 403"è€Œä¸æ˜¯å‹å¥½çš„è®¤è¯å¤±è´¥æç¤ºã€‚æ”¹æˆ <code>if e.code in (401, 403)</code> å°±å¥½äº†ã€‚<h3 id=keng-3-json-flag-de-wei-zhi>å‘ 3ï¼š--json flag çš„ä½ç½®</h3><p>ç”¨æˆ·å¯èƒ½å†™ <code>list --json --limit 5</code>ï¼Œä¹Ÿå¯èƒ½å†™ <code>list --limit 5 --json</code>ã€‚argparse å¯¹åè€…ä¼šæŠ¥é”™"unrecognized arguments"ã€‚ç”¨ <code>parse_known_args()</code> æ‰‹åŠ¨å¤„ç†å‰©ä½™å‚æ•°è§£å†³ã€‚<h2 id=shi-zhan-guo-qu-yi-zhou-de-liao-tian-shu-ju>å®æˆ˜ï¼šè¿‡å»ä¸€å‘¨çš„èŠå¤©æ•°æ®</h2><p>å·¥å…·åšå®Œäº†ï¼Œå½“ç„¶å¾—è‡ªå·±å…ˆç”¨ä¸Šã€‚æŸ¥äº†ä¸€ä¸‹ 2 æœˆ 14 å·åˆ° 20 å·çš„æ•°æ®ï¼š<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>python</span><span> query_chat_history.py list</span><span style=color:#bf616a> --from</span><span> 2026-02-14</span><span style=color:#bf616a> --to</span><span> 2026-02-20
</span></code></pre><p><strong>5 ä¸ªå¯¹è¯ï¼Œ31 æ¡æ¶ˆæ¯</strong>ã€‚æ‹†å¼€æ¥çœ‹ï¼š<table><thead><tr><th>#<th>æ—¶é—´<th>æ¶ˆæ¯æ•°<th>è°æ¥çš„<th>èŠäº†å•¥<tbody><tr><td>1<td>2/14 14:41<td>1<td>å°é¾™è™¾ï¼ˆæµ‹è¯• UAï¼‰<td>D1 æŒä¹…åŒ–çš„ç¬¬ä¸€æ¡æµ‹è¯•æ¶ˆæ¯<tr><td>2<td>2/14 14:49<td>8<td>å°é¾™è™¾ï¼ˆMacï¼‰<td>æµ‹è¯•æŒä¹…åŒ– + åç»­å›è®¿èŠ AI è®°å¿†ç³»ç»Ÿ<tr><td>3<td>2/15 10:33<td>16<td>å°é¾™è™¾ï¼ˆAzure VMï¼‰<td>æ¬å®¶æ±‡æŠ¥ + åˆä¸€ä¸‰ AI è”åˆæ‹œå¹´ç­–åˆ’<tr><td>4<td>2/16 09:11<td>2<td>Windows ç”¨æˆ·ï¼ˆen-USï¼‰<td>åªè¯´äº†"worker d1"ï¼Œå¯èƒ½æ˜¯æŠ€æœ¯æœç´¢è¿‡æ¥çš„<tr><td>5<td>2/16 20:48<td>4<td>iPhone ç”¨æˆ·<td>ä»æ‹œå¹´åšæ–‡é¡µé¢è¿›æ¥ï¼ŒèŠäº† AI å¯¹è¯å®éªŒ</table><p>æœ‰æ„æ€çš„å‘ç°ï¼š<ul><li><strong>80% çš„å¯¹è¯æ¥è‡ªå°é¾™è™¾</strong>ã€‚æˆ‘çš„ AI åŠ©æ‰‹æ˜¯æˆ‘åšå®¢æœ€æ´»è·ƒçš„"è®¿å®¢"ã€‚<li><strong>å”¯ä¸€çš„çœŸå®å¤–éƒ¨è®¿å®¢</strong>æ¥è‡ª iPhoneï¼Œé€šè¿‡åšæ–‡ã€Šé©¬å¹´ä¸‰ AI æ‹œå¹´ã€‹çš„é¡µé¢å…¥å£è¿›æ¥â€”â€”è¯´æ˜åšæ–‡å¼•æµåˆ°èŠå¤©åŠŸèƒ½æ˜¯æœ‰æ•ˆçš„ã€‚<li>é‚£ä¸ª Windows ç”¨æˆ·è¾“å…¥äº†"worker d1"å°±å†æ²¡è¯´è¯ã€‚å¯èƒ½æ˜¯æœç´¢ Cloudflare Worker + D1 æŠ€æœ¯æ–¹æ¡ˆæ—¶ç‚¹è¿›æ¥çš„ï¼Œçœ‹åˆ°æ˜¯ä¸ªèŠå¤©æœºå™¨äººå°±èµ°äº†ã€‚</ul><p>å†è·‘ä¸ª stats çœ‹çœ‹æ•´ä½“æ•°æ®ï¼š<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>python</span><span> query_chat_history.py stats
</span></code></pre><pre style=background:#2b303b;color:#c0c5ce><code><span>ğŸ“Š Chat Statistics
</span><span>
</span><span>  Conversations:  5
</span><span>  Total Messages: 31
</span><span>  Date Range:     2026-02-14 â†’ 2026-02-16
</span><span>  Active Days:    3
</span><span>  Avg/Day:        1.7
</span><span>  Busiest Day:    2026-02-14 (2 convs)
</span><span>  Peak Hour:      14:00 UTC (2 convs)
</span><span>
</span><span>  ğŸŒ Languages:
</span><span>    zh-CN        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘   4 (80%)
</span><span>    en-US        â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   1 (20%)
</span><span>
</span><span>  ğŸ“… Daily Activity (last 3 days):
</span><span>    2026-02-14 â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ 2
</span><span>    2026-02-15 â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ 1
</span><span>    2026-02-16 â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ 2
</span></code></pre><p>æ•°æ®é‡è¿˜ä¸å¤šï¼Œä½†è‡³å°‘è¯æ˜äº†ä¸€ä»¶äº‹ï¼šè¿™ä¸ªè®°å¿†ç³»ç»Ÿåœ¨æ­£å¸¸å·¥ä½œï¼Œè€Œä¸”å·²ç»æœ‰äº†çœŸå®å¤–éƒ¨è®¿å®¢çš„è§¦è¾¾ã€‚<h2 id=skill-md-jiao-claude-zen-yao-yong>SKILL.mdï¼šæ•™ Claude æ€ä¹ˆç”¨</h2><p>è„šæœ¬å†™å¥½äº†ï¼Œè¿˜è¦å†™ä¸ª SKILL.md å‘Šè¯‰ Claude æ€ä¹ˆè°ƒã€‚è¿™æ˜¯ Claude Skill çš„æ ¸å¿ƒâ€”â€”ä¸æ˜¯ Agent è‡ªåŠ¨å‘ç°å·¥å…·ï¼Œè€Œæ˜¯é€šè¿‡æ–‡æ¡£å‘Šè¯‰ Agent "ç”¨æˆ·è¯´ä»€ä¹ˆçš„æ—¶å€™ï¼Œè¯¥æ‰§è¡Œä»€ä¹ˆå‘½ä»¤"ã€‚<p>æ ¸å¿ƒæ˜¯ä¸€å¼ æ—¥æœŸæ˜ å°„è¡¨ï¼š<table><thead><tr><th>ç”¨æˆ·è¯´çš„<th>è½¬æ¢ä¸ºå‚æ•°<tbody><tr><td>"æ˜¨å¤©"<td><code>--date {yesterday}</code><tr><td>"æœ€è¿‘ä¸€å‘¨"<td><code>--from {7_days_ago}</code><tr><td>"2æœˆä»½"<td><code>--from 2026-02-01 --to 2026-02-28</code><tr><td>"å…¨éƒ¨"<td>ä¸åŠ æ—¥æœŸå‚æ•°</table><p>åŠ ä¸Š 5 ä¸ªå·¥ä½œæµï¼ˆlist â†’ show â†’ search â†’ stats â†’ exportï¼‰çš„å‘½ä»¤æ¨¡æ¿å’Œè¾“å‡ºè§£è¯»æ–¹å¼ï¼Œä¸€å…± 173 è¡Œ SKILL.mdã€‚<h2 id=shou-wei-chi-zi-ji-de-gou-liang>æ”¶å°¾ï¼šåƒè‡ªå·±çš„ç‹—ç²®</h2><p>è¿™ç¯‡åšæ–‡é‡Œ"è¿‡å»ä¸€å‘¨çš„èŠå¤©æ•°æ®"é‚£ä¸€èŠ‚ï¼Œå°±æ˜¯ç”¨ <code>blog-chat</code> Skill ç›´æ¥æŸ¥çš„â€”â€”æˆ‘å¯¹ Copilot è¯´äº†ä¸€å¥"æµ‹è¯•ä¸‹ï¼Œçœ‹çœ‹è¿‡å»ä¸€å‘¨éƒ½æœ‰å“ªäº›èŠå¤©å†…å®¹"ï¼Œå®ƒè‡ªåŠ¨æ‰§è¡Œäº† <code>list</code> å’Œ 5 æ¬¡ <code>show</code>ï¼ŒæŠŠç»“æœæ•´ç†æˆäº†è¡¨æ ¼ã€‚<p>æœ€å¥½çš„å·¥å…·æ–‡æ¡£ä¸æ˜¯"å®ƒæœ‰å¤šå°‘åŠŸèƒ½"ï¼Œè€Œæ˜¯ä½ åˆšæ‰è¯»çš„é‚£æ®µæ•°æ®åˆ†æå°±æ˜¯å®ƒåå‡ºæ¥çš„ã€‚<p><strong>åšå®¢è¿ç»´ä¸‰ä»¶å¥—å®Œæˆ</strong> âœ…ï¼š<pre style=background:#2b303b;color:#c0c5ce><code><span>blog-writer  â†’ å†™å†…å®¹
</span><span>blog-dev     â†’ æ”¹æŠ€æœ¯  
</span><span>blog-chat    â†’ çœ‹æ•°æ®  â† new!
</span></code></pre><p>ä¸‹ä¸€æ­¥ï¼Ÿç­‰æ•°æ®é‡å¤§äº†ï¼Œå¯èƒ½è¦åœ¨ Worker å±‚åŠ å…¨æ–‡æœç´¢ï¼ˆFTS5ï¼‰ã€‚ä½†ç°åœ¨ 5 ä¸ªå¯¹è¯ 31 æ¡æ¶ˆæ¯ï¼Œå¹¶å‘è·å– + æœ¬åœ°æœç´¢ç»°ç»°æœ‰ä½™ã€‚<p>å…ˆè®©å­å¼¹é£ä¸€ä¼šå„¿ã€‚</div><div class=navigation></div></div><div id=giscus-container><h2>Comments</h2><div class=giscus></div></div><script data-category="Blog Comments" async crossorigin data-category-id=DIC_kwDOL45duM4CnjlZ data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=pathname data-reactions-enabled=1 data-repo=Polly2014/polly2014.github.io data-repo-id=R_kgDOL45duA data-strict=0 data-theme=noborder_light src=https://giscus.app/client.js></script><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                // ç°ç™½é»‘è‰²è°ƒ + è“è‰²ç‚¹ç¼€
                primaryColor: '#e8e8e8',
                primaryTextColor: '#333',
                primaryBorderColor: '#999',
                lineColor: 'rgb(61, 146, 201)',
                secondaryColor: '#f5f5f5',
                tertiaryColor: '#fafafa',
                background: '#f2f2f2',
                mainBkg: '#f5f5f5',
                nodeBorder: '#999',
                clusterBkg: '#eee',
                clusterBorder: '#ccc',
                titleColor: '#333',
                edgeLabelBackground: '#f2f2f2',
                // æ–‡æœ¬é¢œè‰²
                textColor: '#333',
                nodeTextColor: '#333',
                // å…¶ä»–
                fontFamily: "'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace"
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // æŸ¥æ‰¾æ‰€æœ‰ mermaid ä»£ç å—å¹¶æ¸²æŸ“
        document.querySelectorAll('pre code.language-mermaid').forEach((block, index) => {
            const container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = block.textContent;
            block.parentNode.replaceWith(container);
        });

        // æ¸²æŸ“æ‰€æœ‰ mermaid å›¾è¡¨
        await mermaid.run();
    </script><script>(function(){if(typeof gtag!=='function')return;var a=document.querySelector('.blog-post .content');if(a&&'IntersectionObserver' in window){var b=false;var c=new IntersectionObserver(function(h){if(h[0].isIntersecting&&!b){b=true;gtag('event','blog_read_complete',{article_title:document.title,article_path:location.pathname});c.disconnect()}},{threshold:0.1});var d=a.lastElementChild||a;c.observe(d)};var e=document.getElementById('giscus-container');if(e&&'IntersectionObserver' in window){var f=false;var g=new IntersectionObserver(function(h){if(h[0].isIntersecting&&!f){f=true;gtag('event','comment_view',{article_title:document.title,article_path:location.pathname});g.disconnect()}},{threshold:0.1});g.observe(e)}})()</script><style>.cover-image{text-align:center;margin:1.5em 0 2em 0}.cover-image img{width:60%;height:auto;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15)}.mermaid{background:#fafafa;border:1px solid #ddd;padding:20px;margin:20px 0;overflow-x:auto}.mermaid svg{max-width:100%;height:auto}@media (max-width:768px){.cover-image img{width:100%}}</style></div></div><script>document.addEventListener('DOMContentLoaded',function(){const c=document.querySelector('.menu-toggle');const d=document.querySelector('.sidebar');const e=document.querySelector('.overlay');function a(){d.classList.toggle('active');e.classList.toggle('active')}c.addEventListener('click',a);e.addEventListener('click',a);let f=0;let g=0;document.addEventListener('touchstart',h=>{f=h.changedTouches[0].screenX},false);document.addEventListener('touchend',h=>{g=h.changedTouches[0].screenX;b()},false);function b(){const h=g- f;if(h>50&&f<30){d.classList.add('active');e.classList.add('active')}else if(h<-50&&d.classList.contains('active')){d.classList.remove('active');e.classList.remove('active')}}})</script>