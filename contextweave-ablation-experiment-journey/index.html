<!doctype html><html><head><title>从崩溃到突破：ContextWeave 消融实验的一天</title><meta content="记录 ContextWeave 长文档翻译系统消融实验的完整历程：从发现 LLM 生成崩溃现象，到设计 5 配置消融矩阵，再到诊断 TCR 计算逻辑 bug，最终收获 81% 实验完成度的一天。" name=description><meta content="Polly, Blog, AI Blog, AI Assistant, Tutorials, Technology Blog, Baoli Wang" name=keywords><meta content="width=device-width,initial-scale=1" name=viewport><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content=article property=og:type><meta content=https://polly.wang/contextweave-ablation-experiment-journey/ property=og:url><meta content="从崩溃到突破：ContextWeave 消融实验的一天" property=og:title><meta content="记录 ContextWeave 长文档翻译系统消融实验的完整历程：从发现 LLM 生成崩溃现象，到设计 5 配置消融矩阵，再到诊断 TCR 计算逻辑 bug，最终收获 81% 实验完成度的一天。" property=og:description><meta content=https://polly.wang/images/polly.png property=og:image><meta content="Polly Blog" property=og:site_name><meta content=zh_CN property=og:locale><meta content=summary_large_image name=twitter:card><meta content=https://polly.wang/contextweave-ablation-experiment-journey/ name=twitter:url><meta content="从崩溃到突破：ContextWeave 消融实验的一天" name=twitter:title><meta content="记录 ContextWeave 长文档翻译系统消融实验的完整历程：从发现 LLM 生成崩溃现象，到设计 5 配置消融矩阵，再到诊断 TCR 计算逻辑 bug，最终收获 81% 实验完成度的一天。" name=twitter:description><meta content=https://polly.wang/images/polly.png name=twitter:image><meta content=2026-01-03T00:00:00 property=article:published_time><meta content=Polly property=article:author><meta content=机器翻译 property=article:tag><meta content=LLM property=article:tag><meta content=消融实验 property=article:tag><meta content=ContextWeave property=article:tag><meta content=长文档翻译 property=article:tag><meta content=DeepSeek property=article:tag><meta content=学术论文 property=article:tag><link rel="shortcut icon" href=https://polly.wang/images/polly.ico type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=icon type=image/x-icon><link href=https://polly.wang/images/polly.ico rel=apple-touch-icon><link href=https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css rel=stylesheet><link href=https://polly.wang/css/style_new.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-8JD13N7PHS" async></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-8JD13N7PHS')</script><body><div class=menu-toggle><img alt=Menu src=https://polly.wang/images/polly.png></div><div class=overlay></div><div class="pure-g container"><div class="sidebar pure-u-1 pure-u-md-1-5"><div class=title><a class=pure-menu-heading href=https://polly.wang> <img class="avatar pure-img-responsive" src=https://polly.wang/images/polly.png> </a><div class=introduction><p>Polly's Blog</div><div class=nav><ul class=nav-links><li><a href=https://polly.wang><i class="fas fa-home"></i>Home</a><li><a href=https://polly.wang/archive><i class="fas fa-archive"></i>Archive</a><li><a href=https://polly.wang/category><i class="fas fa-folder"></i>Category</a><li><a href=https://polly.wang/blog><i class="fas fa-file-alt"></i>Posts</a><li><a href=https://polly.wang/publication><i class="fas fa-file-pdf"></i>Research</a><li><a href=https://polly.wang/changelog><i class="fas fa-history"></i>Change log</a><li><a href=https://polly.wang/about><i class="fas fa-info-circle"></i>About Me</a></ul></div><div class=social><ul class=social-links><li><a href=mailto:26716201@qq.com><i class="fas fa-envelope"></i></a><li><a href=https://twitter.com/Polly__007><i class="fab fa-twitter"></i></a><li><a href=https://www.linkedin.com/in/baoliwang><i class="fab fa-linkedin-in"></i></a><li><a href=https://github.com/Polly2014><i class="fab fa-github"></i></a></ul></div></div></div><div class="content pure-u-1 pure-u-md-4-5"><div class=blog-post><h1>从崩溃到突破：ContextWeave 消融实验的一天</h1><div class=content><p>今天是 2026 年的第三天，也是我在 ContextWeave 项目上收获最大的一天。<p>从早上开始运行消融实验，到深夜完成实验清单更新，这一天经历了兴奋、困惑、沮丧，最后又回到平静的满足。作为一个正在准备 ACL/EMNLP 投稿的研究者，我想记录下这段宝贵的经历。<h2 id=dart-bei-jing-wei-shi-yao-xu-yao-xiao-rong-shi-yan>🎯 背景：为什么需要消融实验</h2><p>ContextWeave 是我开发的一个长文档翻译系统，核心思想是通过<strong>智能分块 + 上下文编织</strong>来解决 LLM 翻译长文档时的各种问题。在之前的实验中，我已经验证了系统的整体效果：<ul><li>成功翻译 60 万字符的完整书籍<li>COMETKiwi 质量评分超越人工翻译（在 FIDIC 法律文档上）<li>支持 6 种目标语言</ul><p>但是，顶会 Reviewer 一定会问一个问题：<strong>"每个组件的独立贡献是多少？"</strong><p>这就是消融实验（Ablation Study）的意义——逐个移除系统组件，量化每个部分的价值。<h2 id=bar-chart-e14-5-pei-zhi-xiao-rong-ju-zhen>📊 E14：5 配置消融矩阵</h2><p>我设计了 5 个配置来验证系统的核心组件：<table><thead><tr><th>配置<th>分块方式<th>上下文<th>术语注入<th>预期作用<tbody><tr><td>A0<td>Direct（不分块）<td>-<td>-<td>验证 LLM 崩溃现象<tr><td>A1<td>Fixed-4K<td>❌<td>❌<td>基线：仅分块<tr><td>A2<td>Section-Aware<td>❌<td>❌<td>验证智能分块<tr><td>A3<td>Section-Aware<td>✅<td>❌<td>验证上下文编织<tr><td>A4<td>Section-Aware<td>✅<td>✅<td>完整系统</table><p>测试文档选用了 Mustafa 的《The Coming Wave》第 4-6 章，约 115K 字符。<h3 id=di-yi-ge-liang-xi-a0-pei-zhi-que-ren-beng-kui>第一个惊喜：A0 配置确认崩溃</h3><p>当 A0（Direct 翻译）的结果出来时，我知道论文的核心论点站住了：<pre style=background:#2b303b;color:#c0c5ce><code><span>A0_direct:
</span><span>  - char_ratio: 13.47%  ← 只输出了原文的 13.5%！
</span><span>  - TCR: 45.45%
</span><span>  - 状态: COLLAPSED
</span></code></pre><p><strong>115K 字符的输入，LLM 只输出了不到 16K 字符，然后就"累了"停止了。</strong><p>这不是 token limit 的问题——DeepSeek V3 有 128K 上下文窗口，8K 输出限制。按理说 115K 输入完全在能力范围内。但 LLM 就是"崩溃"了，这正是我们系统要解决的核心问题。<h3 id=di-er-ge-liang-xi-fen-kuai-de-xi-ju-xing-xiao-guo>第二个惊喜：分块的戏剧性效果</h3><p>A1（Fixed-4K 分块）的结果让人振奋：<pre style=background:#2b303b;color:#c0c5ce><code><span>A1_fixed_only:
</span><span>  - char_ratio: 30.83%  ← 从 13.5% 提升到 30.8%！
</span><span>  - COMETKiwi: 0.8238
</span><span>  - TCR: 77.27%
</span></code></pre><p>仅仅是把文档分成小块，输出完整度就提升了 <strong>+17.4 个百分点</strong>。这是分块策略最直接的价值证明。<h2 id=cold-sweat-yu-dao-wen-ti-tcr-wei-shi-yao-bu-zeng-chang>😰 遇到问题：TCR 为什么不增长？</h2><p>按照我的预期，A4（完整系统 + 术语注入）的 TCR 应该明显高于其他配置。但结果让我困惑：<table><thead><tr><th>配置<th>TCR<tbody><tr><td>A1 (Fixed)<td>77.27%<tr><td>A2 (Section)<td>75.00%<tr><td>A3 (+Context)<td>75.00%<tr><td>A4 (+Term)<td>77.27%</table><p><strong>A4 的 TCR 和 A1 一样？术语注入没有效果？</strong><p>这不符合直觉。我花了几个小时排查问题。<h3 id=di-yi-ci-zhen-duan-fen-kuai-luo-ji-bug>第一次诊断：分块逻辑 bug</h3><p>首先发现分块引擎有问题。当遇到超大章节时，<code>_split_large_section</code> 函数没有被正确调用，导致某些块超过了目标大小限制。<p>修复后重跑，问题依旧。<h3 id=di-er-ci-zhen-duan-tcr-ji-suan-tai-yan-ge>第二次诊断：TCR 计算太严格</h3><p>深入分析 TCR 计算逻辑后，我发现了真正的问题：<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># 原始的严格匹配
</span><span style=color:#b48ead>if </span><span>term_zh in translation:
</span><span>    matches += </span><span style=color:#d08770>1
</span></code></pre><p>这要求术语的中文翻译<strong>完全一致</strong>才算匹配。但实际上：<ul><li>术语表：<code>"artificial intelligence" → "人工智能"</code><li>A4 翻译：<code>"人工智能技术"</code> ← 包含术语但不完全匹配</ul><p>修复为宽松匹配后：<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># 宽松匹配：检查术语是否被包含
</span><span style=color:#b48ead>if </span><span style=color:#96b5b4>any</span><span>(variant in translation </span><span style=color:#b48ead>for </span><span>variant </span><span style=color:#b48ead>in </span><span>[term_zh, term_zh.</span><span style=color:#bf616a>replace</span><span>(' ', '')]):
</span><span>    matches += </span><span style=color:#d08770>1
</span></code></pre><p>结果立刻改善：<table><thead><tr><th>配置<th>TCR (严格)<th>TCR (宽松)<tbody><tr><td>A1<td>77.27%<td>92.86%<tr><td>A4<td>77.27%<td><strong>96.43%</strong></table><p><strong>终于看到了 +3.5pp 的提升！</strong><h2 id=mag-yi-wai-fa-xian-bian-jie-fen-xi-de-jie-zhi>🔍 意外发现：边界分析的价值</h2><p>在排查过程中，我额外做了边界分析，发现了更有价值的结论：<table><thead><tr><th>分块方式<th>边界数量<th>问题边界<th>词中截断<tbody><tr><td>Fixed-4K<td>28<td>17 (60.7%)<td>17<tr><td>Section-Aware<td>23<td>0 (0%)<td>0</table><p><strong>Section-Aware 分块完全消除了词中截断问题！</strong><p>这个发现比 TCR 的微小提升更有说服力。Fixed-4K 有超过 60% 的边界会在单词中间截断，而 Section-Aware 通过尊重文档结构，实现了 100% 的段落完整性。<h2 id=memo-shi-yan-qing-dan-geng-xin>📝 实验清单更新</h2><p>一天下来，我更新了完整的实验清单：<table><thead><tr><th>状态<th>数量<th>占比<tbody><tr><td>✅ 完成<td>13<td><strong>81%</strong><tr><td>⚠️ 部分/暂停<td>3<td>19%<tr><td>❌ 未开始<td>0<td>0%</table><p>特别值得一提的是 E01（CCF 指标验证），我决定采用<strong>文献替代</strong>方案而非人工标注：<blockquote><p>We adopt established MT completeness metrics from prior work. <strong>Paragraph Retention Rate (PRR)</strong> follows the structural preservation principle proposed by [Tiedemann & Thottingal, 2020]...</blockquote><p>这是学术写作的常见策略——当某个指标已经在领域内被广泛验证时，引用权威文献比重新做人工实验更有说服力。<h2 id=mortar-board-jin-tian-xue-dao-de-jiao-xun>🎓 今天学到的教训</h2><h3 id=1-shi-yan-she-ji-yao-kao-lu-ping-gu-li-du>1. 实验设计要考虑评估粒度</h3><p>TCR 计算的严格 vs 宽松匹配问题，本质上是评估粒度的选择。在消融实验中，选择合适的评估方式和选择合适的测试数据同样重要。<h3 id=2-yang-ben-liang-jue-ding-jie-lun-ke-xin-du>2. 样本量决定结论可信度</h3><p>E14 实验只匹配了 22 个术语（术语表 92 个中的 24%），这导致 TCR 差异不够显著。下次改进时需要：<ul><li>更换术语密集的测试文档（如 FIDIC 法律合同）<li>或扩大术语表到 150+ 条目</ul><h3 id=3-yi-wai-fa-xian-you-shi-bi-yu-she-mu-biao-geng-you-jie-zhi>3. 意外发现有时比预设目标更有价值</h3><p>边界分析本来只是调试手段，但"Section-Aware 消除 100% 边界问题"这个发现，比 TCR 的 3.5pp 提升更能说明方法的价值。<h2 id=rocket-xia-yi-bu-ji-hua>🚀 下一步计划</h2><p>E14 暂停，但核心发现已经足够支撑论文：<ul><li>✅ <strong>分块防止崩溃</strong>：Char% 13.5% → 30.8% (+17.4pp)<li>✅ <strong>Section-Aware 消除边界问题</strong>：60.7% → 0%<li>✅ <strong>完整系统质量最优</strong>：COMETKiwi 0.833</ul><p>剩余的 P0 实验：<ol><li>E02：DCR 边界重复检测（可用理论分析替代）<li>E05：多文档 TCR 汇总</ol><hr><p>今天的工作让我更深刻地理解了一点：<strong>好的研究不是一帆风顺的，而是在发现问题、解决问题的循环中逐步前进的。</strong><p>从崩溃到突破，这一天的经历会成为论文 Discussion 部分的宝贵素材。<p>休息一下，明天继续！☕<hr><p><em>如果你对长文档翻译或 LLM 应用有兴趣，欢迎关注 ContextWeave 项目的后续更新。</em></div><div class=navigation></div></div><div id=giscus-container><h2>留言与讨论</h2><div class=giscus></div></div><script data-category="Blog Comments" async crossorigin data-category-id=DIC_kwDOL45duM4CnjlZ data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=pathname data-reactions-enabled=1 data-repo=Polly2014/polly2014.github.io data-repo-id=R_kgDOL45duA data-strict=0 data-theme=noborder_light src=https://giscus.app/client.js></script><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                // 灰白黑色调 + 蓝色点缀
                primaryColor: '#e8e8e8',
                primaryTextColor: '#333',
                primaryBorderColor: '#999',
                lineColor: 'rgb(61, 146, 201)',
                secondaryColor: '#f5f5f5',
                tertiaryColor: '#fafafa',
                background: '#f2f2f2',
                mainBkg: '#f5f5f5',
                nodeBorder: '#999',
                clusterBkg: '#eee',
                clusterBorder: '#ccc',
                titleColor: '#333',
                edgeLabelBackground: '#f2f2f2',
                // 文本颜色
                textColor: '#333',
                nodeTextColor: '#333',
                // 其他
                fontFamily: "'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace"
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // 查找所有 mermaid 代码块并渲染
        document.querySelectorAll('pre code.language-mermaid').forEach((block, index) => {
            const container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = block.textContent;
            block.parentNode.replaceWith(container);
        });

        // 渲染所有 mermaid 图表
        await mermaid.run();
    </script><style>.cover-image{text-align:center;margin:1.5em 0 2em 0}.cover-image img{width:60%;height:auto;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15)}.mermaid{background:#fafafa;border:1px solid #ddd;padding:20px;margin:20px 0;overflow-x:auto}.mermaid svg{max-width:100%;height:auto}@media (max-width:768px){.cover-image img{width:100%}}</style></div></div><script>document.addEventListener('DOMContentLoaded',function(){const c=document.querySelector('.menu-toggle');const d=document.querySelector('.sidebar');const e=document.querySelector('.overlay');function a(){d.classList.toggle('active');e.classList.toggle('active')}c.addEventListener('click',a);e.addEventListener('click',a);let f=0;let g=0;document.addEventListener('touchstart',h=>{f=h.changedTouches[0].screenX},false);document.addEventListener('touchend',h=>{g=h.changedTouches[0].screenX;b()},false);function b(){const h=g- f;if(h>50&&f<30){d.classList.add('active');e.classList.add('active')}else if(h<-50&&d.classList.contains('active')){d.classList.remove('active');e.classList.remove('active')}}})</script>