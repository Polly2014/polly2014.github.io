<!DOCTYPE html>
<html>
<head>
    <title>Polly&#x27;s Blog</title>
    <meta name="description" content="Wangbaoli">
    <meta name="keywords" content="Polly, Blog, Baoli Wang">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <!--<link rel="stylesheet" href="https://polly2014.github.io/css/style.css">-->
    <link rel="stylesheet" href="https://polly2014.github.io/css/style_new.css">
    
</head>
<body>
    <!-- 添加汉堡菜单按钮 -->
    <div class="menu-toggle">
        <img src=https://polly2014.github.io/images/polly.png alt="Menu">
    </div>
    <!-- 添加遮罩层 -->
    <div class="overlay"></div>
    <div class="pure-g container">
        <div class="sidebar pure-u-1 pure-u-md-1-5">
            <div class="title">
                <a class="pure-menu-heading" href=https://polly2014.github.io>
                    <img class="avatar pure-img-responsive" src=https://polly2014.github.io/images/polly.png>
                </a>
                <div class="introduction">
                    <p>Polly&#x27;s Blog</p>
                </div>
                <div class="nav">
                    <ul class="nav-links">
                        <li><a href=https://polly2014.github.io><i class="fas fa-home"></i>Home</a></li>
                        <li><a href=https://polly2014.github.io/archive><i class="fas fa-archive"></i>Archive</a></li>
                        <li><a href=https://polly2014.github.io/tags><i class="fas fa-folder"></i>Category</a></li>
                        <li><a href=https://polly2014.github.io/blog><i class="fas fa-file-alt"></i>Posts</a></li>
                        <li><a href=https://polly2014.github.io/publication><i class="fas fa-file-pdf"></i>Research</a></li>
                        <li><a href=https://polly2014.github.io/about><i class="fas fa-info-circle"></i>About Me</a></li>
                    </ul>
                </div>
                <div class="social">
                    <ul class="social-links">
                        <li><a href="mailto:26716201@qq.com"><i class="fas fa-envelope"></i></a></li>
                        <li><a href="https://twitter.com/Polly__007"><i class="fab fa-twitter"></i></a></li>
                        <li><a href="https://www.linkedin.com/in/baoliwang"><i class="fab fa-linkedin-in"></i></a></li>
                        <li><a href="https://github.com/Polly2014"><i class="fab fa-github"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="content pure-u-1 pure-u-md-4-5">
            
    <!-- 
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-source-code-analysis-006&#x2F;">OpenHands 源码解析系列（六）：与大语言模型（LLM）的交互</a></h2>
                <p class="post-date">2025-02-24</p>
            </div>
            <p class="post-summary pure-u-1">解析 OpenHands 如何通过 LLM 模块与大语言模型交互。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-source-code-analysis-002&#x2F;">OpenHands 源码解析系列（二）：前端架构与用户交互流程</a></h2>
                <p class="post-date">2025-02-24</p>
            </div>
            <p class="post-summary pure-u-1">解析 OpenHands 前端的技术栈、组件设计及与后端的交互逻辑。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;azure-deepseek-service-deployment-guidance&#x2F;">Azure部署DeepSeek&#x2F;GPT大模型服务</a></h2>
                <p class="post-date">2025-02-11</p>
            </div>
            <p class="post-summary pure-u-1">详细介绍如何在Azure Foundry上部署各种大模型服务。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-redevelopment-frontend-002&#x2F;">OpenHands 二次开发系列（二）：前端重构设计规划 - DeepSeek版</a></h2>
                <p class="post-date">2025-02-26</p>
            </div>
            <p class="post-summary pure-u-1">OpenHands Re-development: Frontend Design with DeepSeek</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-redevelopment-frontend-001&#x2F;">OpenHands 二次开发系列（一）：前端重构设计规划 - GPT-4o版</a></h2>
                <p class="post-date">2025-02-26</p>
            </div>
            <p class="post-summary pure-u-1">OpenHands Re-development: Frontend Design with GPT-4o</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-source-code-analysis-001&#x2F;">OpenHands 源码解析系列（一）：项目概览与架构设计</a></h2>
                <p class="post-date">2025-02-24</p>
            </div>
            <p class="post-summary pure-u-1">快速了解 OpenHands 的整体架构和模块设计。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;travel-list-with-tesla&#x2F;">生活不止眼前的苟且，还是诗和远方的田野</a></h2>
                <p class="post-date">2024-07-08</p>
            </div>
            <p class="post-summary pure-u-1">灵魂和身体，总要有一个在路上</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-server-api-document&#x2F;">OpenHands API 使用指南：构建智能化开发体验</a></h2>
                <p class="post-date">2025-02-25</p>
            </div>
            <p class="post-summary pure-u-1">OpenHands Server API Documentation</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-source-code-analysis-004&#x2F;">OpenHands 源码解析系列（四）：对话管理与意图解析</a></h2>
                <p class="post-date">2025-02-24</p>
            </div>
            <p class="post-summary pure-u-1">解析 OpenHands 如何解析用户输入并分配代理。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-source-code-analysis-008&#x2F;">OpenHands 源码解析系列（八）：安全性与扩展性设计</a></h2>
                <p class="post-date">2025-02-24</p>
            </div>
            <p class="post-summary pure-u-1">解析 OpenHands 的安全性设计与系统扩展性的实现细节。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-source-code-analysis-009&#x2F;">OpenHands 源码解析系列（九）：从源码到实践</a></h2>
                <p class="post-date">2025-02-24</p>
            </div>
            <p class="post-summary pure-u-1">从源码到实践，帮助开发者快速上手 OpenHands 的开发与部署。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-source-code-analysis-007&#x2F;">OpenHands 源码解析系列（七）：事件流与存储管理</a></h2>
                <p class="post-date">2025-02-24</p>
            </div>
            <p class="post-summary pure-u-1">解析 OpenHands 的事件流处理逻辑和存储管理模块的实现细节。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-source-code-analysis-005&#x2F;">OpenHands 源码解析系列（五）：代理系统与任务分配</a></h2>
                <p class="post-date">2025-02-24</p>
            </div>
            <p class="post-summary pure-u-1">解析 OpenHands 的代理设计模式及其在任务分配中的作用。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-deployment-guidance&#x2F;">Azure部署OpenHands指南</a></h2>
                <p class="post-date">2025-02-12</p>
            </div>
            <p class="post-summary pure-u-1">OpenHands可谓AI时代的程序员瑞士军刀，本文详细介绍如何在Azure上安装Docker、Docker Compose，部署OpenHands，并配置Azure的GPT-4o API接口。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;register-openai-chatgpt&#x2F;">OpenAI ChatGPT注册指南</a></h2>
                <p class="post-date">2024-08-15</p>
            </div>
            <p class="post-summary pure-u-1">拥抱开源，GPT Changes the World!</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;second-post&#x2F;">我的博文标题2</a></h2>
                <p class="post-date">2023-05-02</p>
            </div>
            <p class="post-summary pure-u-1">这是博文的摘要。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-source-code-analysis-010&#x2F;">OpenHands 源码解析系列（十）：总结与展望</a></h2>
                <p class="post-date">2025-02-24</p>
            </div>
            <p class="post-summary pure-u-1">总结 OpenHands 源码解析系列的核心内容，并展望其未来发展方向。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;how-to-build-blog-with-zola&#x2F;">如何借助GPT搭建Zola个人博客</a></h2>
                <p class="post-date">2024-05-01</p>
            </div>
            <p class="post-summary pure-u-1">本文将详细介绍如何借助GPT搭建Zola个人博客。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-vs-coding-copilots&#x2F;">OpenHands vs Coding Copilots: 深度剖析与对比</a></h2>
                <p class="post-date">2025-02-24</p>
            </div>
            <p class="post-summary pure-u-1">深度剖析 OpenHands 与 Github Copilot、Cursor 等 Coding Copilot&#x2F;Agent 的区别，探索其设计理念与应用场景。</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;hack-for-droiyan&#x2F;">Droiyan手游渗透测试</a></h2>
                <p class="post-date">2023-12-28</p>
            </div>
            <p class="post-summary pure-u-1">童年沉迷的网迷，如今推出了手游，氪金的不行，生气之余，渗透测试一波 &gt;_&lt;</p>
        </div>
    
        <div class="blog-post pure-g">
            <div class="post-header">
                <h2 class="post-title"><a href="https:&#x2F;&#x2F;polly2014.github.io&#x2F;openhands-source-code-analysis-003&#x2F;">OpenHands 源码解析系列（三）：后端架构与核心模块</a></h2>
                <p class="post-date">2025-02-24</p>
            </div>
            <p class="post-summary pure-u-1">解析 OpenHands 后端的模块划分、启动流程及核心逻辑。</p>
        </div>
     -->
    <div class="polly-chat">
        <h2>Welcome to talk with Polly</h2>
        <div id="chat-box">
            <!-- Chat messages will appear here -->
        </div>
        <div class="input-container">
            <input id="user-input" type="text" placeholder="Type your message here..." />
            <button id="send-button"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
    <script>
        // 配置常量
        const CONFIG = {
            API_KEY: '13b0343745850744bd1383e2050c0ae98129951e575cd7b5d1a2a11cd3f7846c',
            API_URL: ['localhost', '127.0.0.1'].includes(window.location.hostname)
                ? 'http://localhost:50206' 
                : 'https://20.51.201.85:50206',
            WS_URL: ['localhost', '127.0.0.1'].includes(window.location.hostname)
                ? 'ws://localhost:50206'
                : 'ws://20.51.201.85:50206',
            HEADERS: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'X-API-Key': '13b0343745850744bd1383e2050c0ae98129951e575cd7b5d1a2a11cd3f7846c'
            }
        };
    
        // 全局变量
        let ws = null;
        let preferWebSocket = false;  // 默认优先使用 WebSocket
        let wsConnected = false;     // WebSocket 连接状态
        let reconnectAttempts = 0;
        const MAX_RECONNECT_ATTEMPTS = 3;
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
    
        // 打字机效果
        function typeWriter(element, text, speed = 50) {
            let i = 0;
            element.textContent = '';
            return new Promise(resolve => {
                function type() {
                    if (i < text.length) {
                        element.textContent += text.charAt(i);
                        i++;
                        scrollToBottom();
                        setTimeout(type, speed);
                    } else {
                        resolve();
                    }
                }
                type();
            });
        }

        // 滚动到底部的辅助函数
        function scrollToBottom() {
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // 添加连接状态检查
        function checkConnection() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                console.log('检测到连接断开，尝试重连');
                handleReconnect();
                return false;
            }
            return true;
        }
    
        // WebSocket 初始化
        function initWebSocket() {
            if (!preferWebSocket) {
                console.log('已切换到 HTTP 模式');
                userInput.disabled = false;
                return;
            }
    
            const wsUrl = new URL(`${CONFIG.WS_URL}/ws/polly`);
            wsUrl.searchParams.append('api_key', CONFIG.API_KEY);
            ws = new WebSocket(wsUrl.toString());

            // 添加心跳检测
            let heartbeatInterval;
            
            ws.onopen = () => {
                console.log('WebSocket 连接成功');
                wsConnected = true;
                userInput.disabled = false;
                reconnectAttempts = 0;

                // 开始发送心跳
                heartbeatInterval = setInterval(() => {
                    if (ws.readyState === WebSocket.OPEN) {
                        ws.send(JSON.stringify({ type: 'ping' }));
                    }
                }, 30000); // 每30秒发送一次心跳
            };
            
            ws.onclose = (event) => {
                console.log(`WebSocket 连接关闭: ${event.code} - ${event.reason}`);
                wsConnected = false;
                userInput.disabled = false;

                // 清理心跳定时器
                clearInterval(heartbeatInterval);
                
                if (event.code === 4003) {
                    console.log('API 密钥验证失败，切换到 HTTP 模式');
                    preferWebSocket = false;
                } else {
                    handleReconnect();
                }
            };
            
            ws.onerror = (error) => {
                console.error('WebSocket 错误:', error);
                wsConnected = false;
            };
        }
    
        // 重连逻辑
        function handleReconnect() {
            if (!preferWebSocket) return;
            
            if (reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {
                reconnectAttempts++;
                const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), 30000);
                console.log(`尝试第 ${reconnectAttempts} 次重连，延迟 ${delay}ms`);
                setTimeout(initWebSocket, delay);
            } else {
                console.log('WebSocket 连接失败多次，切换到 HTTP 模式');
                preferWebSocket = false;
                userInput.disabled = false;
            }
        }
    
        async function sendMessage() {
            const userMessage = userInput.value;
            if (!userMessage) return;
        
            // 禁用输入框和发送按钮，防止重复发送
            userInput.disabled = true;
            sendButton.disabled = true;
        
            try {
                // 扩展聊天界面
                const pollyChat = document.querySelector('.polly-chat');
                if (!pollyChat.classList.contains('expanded')) {
                    pollyChat.classList.add('expanded');
                    chatBox.classList.add('expanded');
                    await new Promise(resolve => setTimeout(resolve, 300));
                }
        
                // 显示用户消息
                displayUserMessage(userMessage);
                userInput.value = '';
        
                // 创建 Polly 回复容器
                const { pollyContainer, pollyBubble } = createPollyMessageContainer();
                
                // 尝试使用 WebSocket 发送消息
                if (preferWebSocket && ws && ws.readyState === WebSocket.OPEN) {
                    try {
                        const response = await sendWebSocketMessage(userMessage);
                        await displayPollyResponse(pollyBubble, response.reply);
                    } catch (wsError) {
                        console.error('WebSocket 发送失败:', wsError);
                        
                        // 如果是连接问题，尝试重连
                        if (wsError.message.includes('连接断开') || wsError.message.includes('超时')) {
                            if (await attemptReconnection()) {
                                // 重连成功，重试消息发送
                                const retryResponse = await sendWebSocketMessage(userMessage);
                                await displayPollyResponse(pollyBubble, retryResponse.reply);
                                return;
                            }
                        }
                        
                        // 如果重连失败或其他错误，降级到 HTTP
                        console.log('降级到 HTTP 模式');
                        preferWebSocket = false;
                        const httpResponse = await sendHttpMessage(userMessage);
                        await displayPollyResponse(pollyBubble, httpResponse.reply);
                    }
                } else {
                    // 使用 HTTP 发送消息
                    const response = await sendHttpMessage(userMessage);
                    await displayPollyResponse(pollyBubble, response.reply);
                }
        
            } catch (error) {
                console.error('消息发送失败:', error);
                const errorBubble = document.querySelector('.chat-bubble.polly:last-child');
                await handleError(errorBubble, error);
            } finally {
                // 重新启用输入控件
                userInput.disabled = false;
                sendButton.disabled = false;
                userInput.focus();
                
                // 滚动到最新消息
                scrollToBottom();
            }
        }
        
        // WebSocket 消息发送
        async function sendWebSocketMessage(message, timeout = 10000) {
            return new Promise((resolve, reject) => {
                const timeoutId = setTimeout(() => {
                    reject(new Error('WebSocket 响应超时'));
                }, timeout);
        
                const messageHandler = (event) => {
                    clearTimeout(timeoutId);
                    try {
                        const data = JSON.parse(event.data);
                        if (data.error) {
                            reject(new Error(data.error));
                        } else {
                            resolve(data);
                        }
                    } catch (error) {
                        reject(new Error('无效的响应格式'));
                    }
                    ws.removeEventListener('message', messageHandler);
                };
        
                try {
                    ws.addEventListener('message', messageHandler);
                    ws.send(JSON.stringify({ message }));
                } catch (error) {
                    clearTimeout(timeoutId);
                    ws.removeEventListener('message', messageHandler);
                    reject(new Error('WebSocket 发送失败'));
                }
            });
        }
        
        // HTTP 消息发送
        async function sendHttpMessage(message) {
            try {
                const response = await fetch(`${CONFIG.API_URL}/api/polly`, {
                    method: 'POST',
                    headers: CONFIG.HEADERS,
                    mode: 'cors',
                    credentials: 'include',
                    body: JSON.stringify({ message })
                });
        
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (response.status === 403) {
                        throw new Error('API Key 验证失败');
                    }
                    throw new Error(errorData.detail || `请求失败 (${response.status})`);
                }
        
                return response.json();
            } catch (error) {
                console.error('HTTP请求错误:', error);
                // 如果是证书错误，给出更友好的提示
                if (error.message.includes('SSL') || error.message.includes('cert')) {
                    throw new Error('服务器证书验证失败，请使用HTTP或更新证书');
                }
                throw error;
            }
        }
        
        // 重连尝试
        async function attemptReconnection(maxAttempts = 2) {
            for (let i = 0; i < maxAttempts; i++) {
                try {
                    await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, i)));
                    await initWebSocket();
                    
                    if (ws && ws.readyState === WebSocket.OPEN) {
                        console.log('重连成功');
                        return true;
                    }
                } catch (error) {
                    console.error(`第 ${i + 1} 次重连失败:`, error);
                }
            }
            return false;
        }
        
        // 显示 Polly 响应
        async function displayPollyResponse(bubble, message) {
            const thinkingDiv = bubble.querySelector('.thinking');
            if (thinkingDiv) {
                bubble.removeChild(thinkingDiv);
            }
            bubble.innerHTML = '';
            await typeWriter(bubble, message);

            // 添加滚动
            scrollToBottom();
        }
    
        // 辅助函数：显示用户消息
        function displayUserMessage(message) {
            const messageContainer = document.createElement('div');
            messageContainer.className = 'message-container user-message';
            
            const userBubble = document.createElement('div');
            userBubble.className = 'chat-bubble user';
            userBubble.textContent = message;
            
            const userAvatar = document.createElement('div');
            userAvatar.className = 'chat-avatar';
            userAvatar.innerHTML = '<i class="fas fa-user"></i>';
            
            messageContainer.appendChild(userBubble);
            messageContainer.appendChild(userAvatar);
            chatBox.appendChild(messageContainer);

            // 添加滚动
            scrollToBottom();
        }
    
        // 辅助函数：创建 Polly 消息容器
        function createPollyMessageContainer() {
            const pollyContainer = document.createElement('div');
            pollyContainer.className = 'message-container polly-message';
            
            const pollyAvatar = document.createElement('div');
            pollyAvatar.className = 'chat-avatar';
            pollyAvatar.innerHTML = `<img src="https://polly2014.github.io/images/polly.png" alt="Polly">`;
            
            const pollyBubble = document.createElement('div');
            pollyBubble.className = 'chat-bubble polly';
            
            const thinkingDiv = document.createElement('div');
            thinkingDiv.className = 'thinking';
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('span');
                thinkingDiv.appendChild(dot);
            }
            pollyBubble.appendChild(thinkingDiv);
            
            pollyContainer.appendChild(pollyAvatar);
            pollyContainer.appendChild(pollyBubble);
            chatBox.appendChild(pollyContainer);
            
            return { pollyContainer, pollyBubble };
        }
    
        // 辅助函数：错误处理
        async function handleError(pollyBubble, error) {
            console.error('Error:', error);
            pollyBubble.innerHTML = '';
            
            let errorMessage = '哎呀，出错了 >_<';
            if (error.message.includes('API Key')) {
                errorMessage = 'API Key 验证失败，请联系管理员';
            } else if (error.message.includes('请求失败')) {
                errorMessage = '网络请求失败，请稍后再试';
            } else if (error.message.includes('超时')) {
                errorMessage = '响应超时，已切换到 HTTP 模式';
            }
            
            await typeWriter(pollyBubble, errorMessage);
        }
    
        // 事件监听器
        window.addEventListener('load', () => {
            initWebSocket();
            userInput.focus();
            
            const pollyChat = document.querySelector('.polly-chat');
            pollyChat.style.opacity = '0';
            requestAnimationFrame(() => {
                pollyChat.style.transition = 'opacity 0.6s ease-out';
                pollyChat.style.opacity = '1';
            });
        });
    
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendMessage();
            }
        });
    
        document.querySelector('.polly-chat').addEventListener('click', () => {
            userInput.focus();
        });
    
        userInput.addEventListener('click', (event) => {
            event.stopPropagation();
        });
    
        sendButton.addEventListener('click', (event) => {
            event.stopPropagation();
        });
    </script>
    

        </div>
    </div>
    <!-- 在body标签结束前添加JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const menuToggle = document.querySelector('.menu-toggle');
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.overlay');

            // 切换侧边栏显示状态
            function toggleSidebar() {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
            }

            // 点击菜单按钮显示侧边栏
            menuToggle.addEventListener('click', toggleSidebar);

            // 点击遮罩层隐藏侧边栏
            overlay.addEventListener('click', toggleSidebar);

            // 处理移动端滑动手势
            let touchStartX = 0;
            let touchEndX = 0;

            document.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            }, false);

            document.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, false);

            function handleSwipe() {
                const swipeDistance = touchEndX - touchStartX;
                // 从左向右滑动显示菜单
                if (swipeDistance > 50 && touchStartX < 30) {
                    sidebar.classList.add('active');
                    overlay.classList.add('active');
                }
                // 从右向左滑动隐藏菜单
                else if (swipeDistance < -50 && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                }
            }
        });
    </script>
</body>
</html>